(window.webpackJsonp=window.webpackJsonp||[]).push([[14],Array(304).concat([function(t,e){t.exports=function(t){var e=t.attrs,i=t.bem,s=t.block,o=t.tag;s("b-page").elem("icon")(o()("link"),i()(!1),e()((function(){return{rel:"icon",type:"image/png",href:this.ctx.url,sizes:this.ctx.sizes}})))}},function(t,e){t.exports=function(t){(0,t.block)("sidebar").elem("close").tag()("span")}},function(t,e){t.exports=function(t){var e=t.block,i=t.BEM;e("m-editor-button").mod("type","help").content()((function(){return{block:"button2",mix:{block:"m-editor-button",elem:"button"},js:{notPrevent:!0},title:i.I18N("m-editor-button","help"),tabindex:-1,url:this.ctx.helpURL,target:"_blank",mods:{theme:"normal",size:"m",pin:this.ctx.pin,type:"link"},content:{elem:"text",content:this.ctx.content}}}))}},function(t,e){t.exports=function(t){var e=t.attrs,i=t.block,s=t.tag;i("w-userpic")(s()("img"),e()((function(){var t=this.ctx.size+"px";return{width:t,height:t}})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.content;e("page-editor").elem("header")(i()([{elem:"title"},{elem:"actions"}]))}},function(t,e){t.exports=function(t){var e=t.block,i=t.content,s=t.BEM;e("page-editor").elem("title")(i()((function(){return{block:"m-replacer",mods:{type:"page-title"},content:this.ctx.title,placeholder:s.I18N("page-editor","title_placeholder")}})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.content,s=t.BEM;e("page-editor").elem("actions")(i()((function(){return{block:"radio-button",js:{id:"edit-action"},mix:{block:"b-editor-actions",js:!0},mods:{theme:"normal",size:"m"},name:"edit-action",value:"edit",content:[{elem:"radio",controlAttrs:{value:"edit"},content:s.I18N("page-editor","page_edit")},{elem:"radio",controlAttrs:{value:"view"},content:s.I18N("page-editor","page_view")}]}})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.content;e("page-editor").elem("topbar")(i()({block:"m-editor-buttons",mods:{type:"page-editor"}}))}},function(t,e){t.exports=function(t){var e=t.block,i=t.replace,s=t.BEM;e("page-editor").elem("info")(i()((function(){return{block:"b-revision-info",content:{elem:"text",content:s.I18N("page-editor","page_update_warning")},mix:{block:this.block,elem:"info"}}})))}},function(t,e){t.exports=function(t){(0,t.block)("page-editor").elem("editor").match((function(){return this.ctx.key})).content()((function(){return{block:"m-editor",mix:{block:"w-editor-suggest",js:{url:this["i-global"].hosts.suggest.url,layers:{people:{itemType:"staff",keywords:["@","staff:","кто:","укого:","ского:","кому:","кого:","кем:","ком:","оком:"],valueField:"login"}}}},mods:{type:"edit-page",split:!0},js:{drafts:{key:this.ctx.key+"#page-editor"},uploadParams:{reqParams:{type:"PUT",url:this.ctx.uploadUrl,xhrFields:{withCredentials:!0}},URLPath:"data.data.url"},forms:{apiUrl:this.ctx.formsApiUrl,adminUrl:this.ctx.formsAdminUrl,user:this.ctx.user},buttons:[["h2","h3"],["bold","italic","strikethrough"],["ul","ol"],["indent","outdent"],["quote","link","picture","video","code","table","readmore","help"],["form"]],virtualButtons:["underline"]}}}))}},function(t,e){t.exports=function(t){var e=t.block,i=t.content;e("page-editor").elem("preview")(i()((function(){return[{block:"spin2",mods:{size:"l",position:"center"}},{elem:"preview-content"}]})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.content,s=t.BEM;e("page-editor").elem("bottombar")(i()((function(){var t=[{block:"button2",mix:{block:"b-editor-close-button",js:!0},tabindex:1,mods:{theme:"normal",size:"m",editor:"cancel"},text:s.I18N("page-editor","page_update_reject")},{block:"button2",mix:[{block:"b-readonly-item",js:!0},{block:"b-editor-save-button",js:!0}],tabindex:0,mods:{size:"m",editor:"save",theme:"action"},text:s.I18N("page-editor","page_save")},{block:"spin2",mods:{size:"m",editor:"save"}}];return this.ctx.canSwitchWf&&(t=t.concat({block:this.block,elem:"wf-switcher",withNewWf:this.ctx.withNewWf})),t.concat({block:this.block,elem:"split-switcher"})})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.content,s=t.BEM;e("page-editor").elem("wf-switcher")(i()((function(){return[{block:"tumbler",mods:{size:"m",theme:"normal",checked:this.ctx.withNewWf?"yes":""},content:{elem:"option",side:"left",content:s.I18N("page-editor","new_wf")}}]})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.content,s=t.BEM;e("page-editor").elem("split-switcher")(i()((function(){return{block:"tumbler",mods:{size:"m",theme:"normal"},content:{elem:"option",side:"left",content:s.I18N("page-editor","split_mode")}}})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.BEM;e("editor-help").elem("syntax").content()((function(){return{elem:"group",title:i.I18N("editor-help","syntax-title"),content:[{elem:"syntax-sample",content:[{elem:"syntax-code",content:"==="}," ",i.I18N("editor-help","syntax-h2-title")]},{elem:"syntax-sample",content:[{elem:"syntax-code",content:"===="}," ",i.I18N("editor-help","syntax-h3-title")]},{elem:"syntax-sample",content:[{elem:"syntax-code",content:"(("},i.I18N("editor-help","syntax-url-title"),{elem:"syntax-code",content:"))"}]},{elem:"syntax-sample",content:[{elem:"syntax-code",content:"<{"},i.I18N("editor-help","syntax-cat-title-upper"),{tag:"br"},i.I18N("editor-help","syntax-cat-title-bottom"),{elem:"syntax-code",content:"}>"}]},{elem:"syntax-sample",content:[{elem:"syntax-code",content:"кто:"},i.I18N("editor-help","syntax-login-title"),{elem:"syntax-code",content:"@"}," ",i.I18N("editor-help","syntax-login-description-title")]},{elem:"syntax-sample",content:[{elem:"syntax-code",content:"QUEUE-123"}," ",i.I18N("editor-help","syntax-queue-title")]},{elem:"syntax-sample",content:[{elem:"syntax-code",content:"%%("+i.I18N("editor-help","lang")+")"},i.I18N("editor-help","syntax-highlight-title"),{elem:"syntax-code",content:"%%"}]},{elem:"syntax-sample",content:[{elem:"syntax-code",content:"{{"},i.I18N("editor-help","syntax-action-title"),{elem:"syntax-code",content:"}}"}]}]}}))}},function(t,e){t.exports=function(t){var e=t.block,i=t.BEM;e("editor-help").elem("hotkeys").content()((function(){return{elem:"group",title:i.I18N("editor-help","hotkeys-title"),content:[{key:"B",description:i.I18N("editor-help","hotkey-bold-title")},{key:"I",description:i.I18N("editor-help","hotkey-italic-title")},{key:"Shift + S",description:i.I18N("editor-help","hotkey-stroke-title")},{key:"Shift + L",description:i.I18N("editor-help","hotkey-list-title")},{key:"Z",description:i.I18N("editor-help","hotkey-undo-title")},{key:"Enter",description:i.I18N("editor-help","hotkey-save-title")}].map((function(t){return{elem:"hotkey",key:t.key,description:t.description}}))}})),e("editor-help").elem("hotkey").content()((function(){return[{elem:"hotkey-key",tag:"span",content:"Ctrl + "+this.ctx.key},{elem:"hotkey-description",tag:"span",content:" - "+this.ctx.description}]}))}},function(t,e){t.exports=function(t){var e=t.block,i=t.BEM;e("b-event").elem("date").content()((function(){var t=i.blocks["mi-helpers"].getDateFromHumanString(this.ctx.timestamp),e=function(t){return t<10?"0"+t:t},s=[],o=e(t.getDate()),n=e(t.getMonth()+1),a=t.getFullYear(),r=e(t.getHours()),l=e(t.getMinutes());return s.push([o,n,a].join("."),[r,l].join(":")),s.join(", ")}))}},function(t,e){t.exports=function(t){(0,t.block)("b-event").elem("user").content()((function(){var t=this.ctx.login;return{block:"m-username",mods:{theme:this.ctx.theme,dismissed:this.ctx.isDismissed?"yes":""},mix:[{block:"mi-staff-card",js:{user:t}}],url:this["i-global"].hosts.staff.url+"/"+t,content:t+"@"}}))}},function(t,e){t.exports=function(t){(0,t.block)("b-event").elem("action").elemMod("type","subscribe-other-user").content()((function(){return{block:"i-bem",elem:"i18n",keyset:"b-events-log",key:"subscribe_other_user",content:{block:"b-event",elem:"user",theme:this.ctx.theme,login:this.ctx.data.subscribed_user_login}}}))}},function(t,e){t.exports=function(t){var e=t.block,i=t.BEM;e("b-event").elem("action").elemMod("type","default").content()((function(){return i.I18N("b-events-log",this.ctx.type)}))}},function(t,e){t.exports=function(t){var e=t.block,i=t.BEM;e("w-attachments").elem("more").content()((function(){return[{block:"link",mods:{pseudo:"yes",theme:this._theme},content:[i.I18N("w-attachments","more")," ",{block:"w-attachments",elem:"more-count",tag:"span",content:0}," ",{block:"awesome-icon",mods:{icon:"angle-down"}}]}]}))}},function(t,e){t.exports=function(t){var e=t.applyNext,i=t.attrs,s=t.block,o=t.content,n=t.def,a=t.tag;s("w-file-name")(a()("span"),i()((function(){return{style:"max-width: "+this.ctx.width.max+"px"}})),o()((function(){var t=this["w-file-name"].splitFileName(this.ctx.content);return[{elem:"name",tag:"span",attrs:{style:"max-width: "+this.ctx.width.name+"px"},content:t.name},{elem:"ext",tag:"span",content:t.ext}]})),n().match((function(){return!this["w-file-name"]}))((function(){return this["w-file-name"]={splitFileName:function(t){var e=t.lastIndexOf(".");return-1===e?t:{name:t.substr(0,e),ext:t.substr(e)}}},e()})))}},function(t,e){t.exports=function(t){var e=t.attrs,i=t.block,s=t.content,o=t.tag,n=t.BEM;i("w-attach").elem("size")(o()("span"),e()((function(){return{title:this.ctx.content}})),s()((function(){return this.ctx.content+" "+n.I18N("w-attach","megabytes")})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.BEM;e("b-grid-table-width-controll").content()((function(){var t=this.ctx.width_units||"%";return[{block:"input",value:this.ctx.width||"",placeholder:i.I18N("b-grid-table-width-controll","auto"),mods:{size:this.ctx.size,theme:this.mods.theme},content:[this.ctx.label&&{elem:"label",content:this.ctx.label},{elem:"control",attrs:{autocomplete:"off"}}]},{block:"select2",mods:{size:this.ctx.size,theme:this.mods.theme||"normal",type:"radiocheck",text:"vary"},text:t,val:t,items:[{val:"%",text:"%"},{val:"px",text:"px"}],button:{mods:{theme:this.mods.theme||"normal"}}}]}))}},function(t,e){t.exports=function(t){(0,t.block)("b-event").elem("action").elemMod("type","change-owner").content()((function(){var t=this.ctx.data,e=this.ctx.theme;return[{block:"i-bem",elem:"i18n",keyset:"b-events-log",key:"change_owner",content:{block:"b-event",elem:"user",theme:e,login:t.previous_owner}},{block:"b-event",elem:"user",theme:e,login:t.new_owner}]}))}},function(t,e){t.exports=function(t){var e=t.applyNext,i=t.block,s=t.content,o=t.js;i("sidebar").def()((function(){var t=this.mods;return t.state||(t.state="close"),this.ctx.selected&&(t.selected=this.ctx.selected),this.ctx.tabs||(this.ctx.tabs=[]),e()})),i("sidebar")(o()((function(){return this.ctx.js||!0})),s()((function(){return[{elem:"tabs",tabs:this.ctx.tabs,selected:this.ctx.selected},{elem:"content-container",content:{block:"sidebar",elem:"tab-content",elemMods:{tab:this.ctx.selected},preLoad:this.ctx.preLoad,redirect:this.ctx.redirect}},{block:"sidebar",elem:"loader"}]})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.content,s=t.tag;e("sidebar").elem("tabs")(s()("ul"),i()((function(){return[this.ctx.tabs.map((function(t){return{elem:"tab",elemMods:{type:t,selected:t===this.ctx.selected?"yes":""}}}),this),{elem:"close"}]})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.content,s=t.tag;e("sidebar").elem("tab")(s()("li"),i()((function(){return[{block:"awesome-icon",attrs:{title:this._label},mods:{icon:this._icon}}]})))}},function(t,e){t.exports=function(t){var e=t.applyNext,i=t.block,s=t.BEM;i("sidebar").elem("tab").elemMod("type","cluster-tree").def()((function(){return e({_label:s.I18N("sidebar","cluster-tree-label"),_icon:"sitemap"})}))}},function(t,e){t.exports=function(t){var e=t.applyNext,i=t.block,s=t.BEM;i("sidebar").elem("tab").elemMod("type","files").def()((function(){return e({_label:s.I18N("sidebar","files-label"),_icon:"paperclip"})}))}},function(t,e){t.exports=function(t){var e=t.applyNext,i=t.block,s=t.BEM;i("sidebar").elem("tab").elemMod("type","events").def()((function(){return e({_label:s.I18N("sidebar","events-label"),_icon:"clock-o"})}))}},function(t,e){t.exports=function(t){var e=t.applyNext,i=t.block,s=t.BEM;i("sidebar").elem("tab").elemMod("type","hotkeys").def()((function(){return e({_label:s.I18N("sidebar","hotkeys-label"),_icon:"question-circle"})}))}},function(t,e){t.exports=function(t){var e=t.applyNext,i=t.block,s=t.BEM;i("sidebar").elem("tab").elemMod("type","grid-code").def()((function(){return e({_label:s.I18N("sidebar","grid-code-label"),_icon:"code"})}))}},function(t,e){t.exports=function(t){var e=t.applyNext,i=t.block,s=t.BEM;i("sidebar").elem("tab").elemMod("type","grid-settings").def()((function(){return e({_label:s.I18N("sidebar","grid-settings-label"),_icon:"cogs"})}))}},function(t,e){t.exports=function(t){!function(t){if(null==t)throw new TypeError("Cannot destructure undefined")}(t)}},function(t,e){t.exports=function(t){var e=t.block,i=t.js,s=t.wrap;e("b-toc")(s()((function(){var t=this.mods,e=this.ctx,i=this.ctx.data;return i?(i.content[0].mods={type:"sidebar"},e.content=i):t.load="yes",e})),i()((function(){return this.ctx.js||!0})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.content,s=t.js;e("w-translate-item")(s()((function(){return{from:"us"===this.ctx.from?"en":this.ctx.from,to:"us"===this.ctx.to?"en":this.ctx.to}})),i()((function(){return[{block:"country-flag",mods:{s16:this.ctx.from}},{block:"awesome-icon",mods:{icon:"arrow-right"}},{block:"country-flag",mods:{s16:this.ctx.to}}]})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.content,s=t.elem,o=t.js,n=t.match,a=t.BEM;e("w-comments")(o()(!0),n((function(){return!this.ctx.replaced})).replace()((function(){var t={short:"yes"},e=this.ctx;return e.js.commentsCount||(t["no-comments"]="yes"),Object.assign(e.mods,t),e.replaced=!0,e})),i()((function(){return[{elem:"header",content:[{block:"awesome-icon",mods:{icon:"comments",type:"comments"}},{elem:"caption",count:this.ctx.js.commentsCount},{block:"button2",mods:{theme:"normal",size:"s",role:"short-switch"},mix:{block:"w-comments",elem:"show-comments"},text:a.I18N("w-comments","expand")},{block:"button2",mods:{theme:"normal",size:"s",role:"add-comment-header"},mix:{block:"w-comments",elem:"add-comment"},text:a.I18N("w-comments","add_comment")},{block:"spin2",mods:{size:"xxs",type:"load-comments"}}]},{elem:"comments-list"},{elem:"show-more",content:[{block:"spin2",mods:{size:"xs",role:"show-more"}},{block:"button2",mods:{theme:"normal",size:"s",role:"show-more"},text:a.I18N("w-comments","show_more")}]},{elem:"add-comments",content:[{block:"button2",mods:{theme:"normal",size:"m",role:"add-comment"},text:a.I18N("w-comments","add_comment")},{elem:"add-comment-form",content:[{elem:"add-comment-caption",content:a.I18N("w-comments","new_comment")},{elem:"add-comment-editor"},{elem:"add-comment-buttons",content:[{block:"button2",mods:{theme:"normal",size:"s",role:"cancel-new-comment"},text:a.I18N("w-comments","cancel")},{elem:"right",content:[{block:"spin2",mods:{size:"xxs",type:"add-comment"}},{block:"button2",mods:{size:"s",theme:"action",role:"submit-new-comment",disabled:"yes"},text:a.I18N("w-comments","add")}]}]}]}]}]})),s("caption").content()((function(){var t=this.ctx.count,e=t%10;return t?!e||t>=11&&t<=20?t+" "+a.I18N("w-comments","null_form"):1===e?t+" "+a.I18N("w-comments","first_form"):e>=2&&e<=4?t+" "+a.I18N("w-comments","second_form"):t+" "+a.I18N("w-comments","null_form"):a.I18N("w-comments","no_comments")})))}},function(t,e){t.exports=function(t){var e=t.attrs,i=t.block,s=t.content,o=t.elem,n=t.js,a=t.tag,r=t.BEM;i("w-comment")(n()(!0),s()((function(){var t=this.ctx.data;return[{elem:"icon",login:t.user.login},{elem:"wrapper",content:[{elem:"created",content:[{elem:"username",content:{block:"m-username",mods:{dismissed:t.user.is_dismissed?"yes":""},mix:[{block:"mi-staff-card",js:{user:t.user.login}}],url:"//staff.yandex-team.ru/"+t.user.login,content:t.user.display}},{elem:"date",content:this["mi-helpers"].dateFormat(t.created_at)}]},{elem:"content",content:this.ctx.bemjson},{elem:"actions",content:[{elem:"reply",content:r.I18N("w-comment","reply")},{elem:"edit",content:r.I18N("w-comment","edit")},{elem:"remove",content:r.I18N("w-comment","remove")}]},{elem:"form",content:[{elem:"comment-editor"},{elem:"comment-buttons",content:[{block:"button2",mods:{theme:"normal",size:"s",role:"cancel"},text:r.I18N("w-comment","cancel")},{elem:"right",content:[{block:"spin2",mods:{size:"xs",type:"editor-submit"}},{block:"button2",mods:{size:"s",theme:"action",role:"submit"},text:""}]}]}]}]}]})),o("icon")(a()("img"),e()((function(){return{src:"//center.yandex-team.ru/api/v1/user/"+this.ctx.login+"/avatar/100.jpg"}}))))}},,function(t,e){t.exports=function(t){var e=t.block,i=t.content,s=t.BEM;e("m-editor-popup").mod("type","video")(i()((function(){return[{elem:"header",tag:"h3",content:s.I18N("m-editor-popup","createVideo")},{elem:"content",content:[{tag:"label",block:"textinput",elem:"label",content:[{tag:"span",block:"textinput",elem:"label-text",content:s.I18N("m-editor-popup","videoLink")},{block:"textinput",mods:{theme:"normal","has-clear":"yes",size:"s",video:"link"},controlAttrs:{name:"videoSrc"},text:"",placeholder:s.I18N("m-editor-popup","videoLinkPlaceholder")}]}]}]})))}},function(t,e){t.exports=function(t){(0,t.block)("b-page-official-user").content()((function(){return[{block:"m-userpic",url:"http://staff/"+this.ctx.user.login,size:"30",login:this.ctx.user.login},{block:"m-username",mods:{dismissed:this.ctx.user.is_dismissed?"yes":""},mix:[{block:"mi-staff-card",js:{user:this.ctx.user.login}}],url:"//staff.yandex-team.ru/"+this.ctx.user.login,content:this.ctx.user.display}]}))}},function(t,e){t.exports=function(t){var e=t.apply,i=t.block,s=t.content,o=t.BEM;i("b-page-more-panel")(s()((function(t,i){var s=new Set(i.disable);return[{block:"b-page-more-panel-item",mix:{block:"w-action",mods:{type:"sub"},js:!0},content:o.I18N("b-page-more-panel","create_page")},{block:"b-page-more-panel-item",mix:[{block:"w-action",mods:{type:"tree"},js:!0}],content:o.I18N("b-page-more-panel","tree")},{block:"b-page-more-panel-item",mods:{disabled:s.has("move")||i.redirect?"yes":""},mix:[{block:"w-action",mods:{type:"move"},js:{type:"page"}}],content:o.I18N("b-page-more-panel","move")},{block:"b-page-more-panel-item",mods:{disabled:s.has("copy")||!i.canCopy||i.redirect?"yes":""},mix:{block:"w-action",mods:{type:"copy"},js:{type:"article"}},content:o.I18N("b-page-more-panel","copy")},{block:"b-page-more-panel-item",mods:{disabled:i.redirect?"yes":""},mix:[{block:"w-action",mods:{type:"subscribe"},js:!0}],content:o.I18N("b-page-more-panel","subscriptions_control")},{block:"b-page-more-panel-item",mods:{disabled:i.redirect?"yes":""},mix:{block:"w-action",mods:{type:"access"},js:!0},content:o.I18N("b-page-more-panel","page_access")},{block:"b-page-more-panel-item",mods:{type:"old-page",disabled:i.redirect?"yes":""},mix:[{block:"w-action",mods:{type:"old-page"},js:{actuality:"obsolete"===i.actuality?"obsolete":"actual"}}],content:"obsolete"===i.actuality?o.I18N("b-page-more-panel","mark_as_actual"):o.I18N("b-page-more-panel","mark_as_obsolete")},{block:"b-page-more-panel-item",mix:[{block:"w-action",mods:{type:"referrers"},js:!0}],content:o.I18N("b-page-more-panel","referrers")},{block:"b-page-more-panel-item",mix:[{block:"w-action",mods:{type:"settings"},js:{user:i.user}}],content:o.I18N("b-page-more-panel","settings")},{block:"b-page-more-panel-item",mods:{disabled:i.redirect?"yes":""},mix:[{block:"w-action",mods:{type:"delete"},js:{type:"page",breadcrumbs:i.breadcrumbs}}],content:o.I18N("b-page-more-panel","delete")},{block:"w-action",mods:{type:"unsubscribe"},js:!0},{block:"w-action",mods:{type:"files"},js:!0},{block:"w-action",mods:{type:"subpages-change-author"},js:!0},{block:"w-action",mods:{type:"unsubscribe"},js:!0},{block:"w-action",mods:{type:"authors"},js:!0},e("rejected-access"),{block:"w-action",mods:{type:"authorship"},js:!0},{block:"w-action",mods:{type:"request-page-author"},js:!0}]})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.BEM;e("b-old-page-mark").content()((function(){return[{elem:"text",content:i.I18N("b-old-page-mark","old_page")},{elem:"popup",content:[{block:"popup2",mods:{target:"anchor",theme:"normal",autoclosable:"yes",page:"old-page"},directions:["bottom-center"],content:[{elem:"content",content:[{block:"b-old-page-mark",elem:"date",content:[i.I18N("b-old-page-mark","last_update")+" ",{block:"m-date",format:"full",timestamp:this.ctx.modified_at}]}]}]}]}]}))}},function(t,e){t.exports=function(t){(0,t.block)("b-page-more-panel-item").js()(!0)}},function(t,e){t.exports=function(t){(0,t.block)("page-editor").content()((function(t,e){return[{elem:"header"},{elem:"topbar"},{elem:"info"},{elem:"editor"},{elem:"preview"},{elem:"bottombar",withNewWf:e.withNewWf,canSwitchWf:e.canSwitchWf}]}))}},function(t,e){t.exports=function(t){var e=t.block,i=t.content,s=t.js,o=t.tag;e("m-replacer")(s()((function(){return{placeholder:this.ctx.placeholder}})),i()((function(){return[{elem:"text",content:this.ctx.content}]}))),e("m-replacer").elem("text").tag()("span"),e("m-replacer").elem("field")(o()("span"),i()((function(){return[{block:"input",js:{autoFocus:"yes"},mods:{size:"m",theme:"normal",type:"replace"},placeholder:this.ctx.placeholder,value:this.ctx.val,content:{elem:"control"}}]})))}},function(t,e){t.exports=function(t){(0,t.block)("sidebar").elem("tab-content").elemMod("tab","hotkeys").content()({block:"editor-help",mods:{type:"sidebar",theme:"dark"}})}},function(t,e){t.exports=function(t){var e=t.applyNext,i=t.block,s=t.content,o=t.elem,n=t.js,a=t.tag,r=t.BEM;i("editor-help")(n()((function(){return this.ctx.js||!0})),s()((function(){return[{elem:"group",title:r.I18N("editor-help","manual-title"),content:[{elem:"items-list",items:[{url:"/wiki/vodstvo/syntax/",text:r.I18N("editor-help","full-syntax-link")},{url:"/wiki/vodstvo/tables/",text:r.I18N("editor-help","tables-syntax-link")},{url:"/wiki/vodstvo/actions/",text:r.I18N("editor-help","actions-list-link")},{url:"/wiki/vodstvo/formatters/code/",text:r.I18N("editor-help","highlighting-link")}]}]},{elem:"syntax"},{elem:"hotkeys"}]})),o("items-list")(a()("ul"),s()((function(){return this.ctx.items.map((function(t){return{elem:"list-item",content:{block:"link",mods:{theme:this.mods.theme},url:t.url,target:"_blank",title:t.text,content:t.text}}}),this)}))),o("list-item").tag()("li"),o("syntax-code").tag()("span")),i("editor-help").elem("group").content()((function(){return[{elem:"group-title",content:this.ctx.title},e()]}))}},function(t,e){t.exports=function(t){(0,t.block)("sidebar").elem("tab-content").elemMod("tab","cluster-tree").content()({block:"b-cluster-tree",mods:{type:"sidebar",theme:"dark"}})}},function(t,e){t.exports=function(t){var e=t.applyNext,i=t.block,s=t.content,o=t.js,n=t.BEM;i("b-cluster-tree").def()((function(){var t=this.ctx.mods||{};return t.theme=t.theme||"normal",this.ctx.mods=t,e()})),i("b-cluster-tree")(o()((function(){return this.ctx.js||!0})),s()((function(){return[{elem:"total",content:[n.I18N("b-cluster-tree","subpages")+" ",{elem:"total-count",content:""}]},{block:"b-cluster-tree-sort",mods:{theme:this.mods.theme}},{block:"b-cluster-tree-filter",mods:{theme:this.mods.theme}},{elem:"list",content:[]}]}))),i("b-cluster-tree").elem("total-count").tag()("span"),i("b-cluster-tree").elem("date").match((function(){return this.ctx.timestamp})).content()((function(){var t=n.blocks["mi-helpers"].getDateFromHumanString(this.ctx.timestamp),e=function(t){return t<10?"0"+t:t},i=[],s=e(t.getDate()),o=e(t.getMonth()+1),a=t.getFullYear(),r=e(t.getHours()),l=e(t.getMinutes());return i.push([s,o,a].join("."),[r,l].join(":")),i.join(", ")}))}},function(t,e){t.exports=function(t){var e=t.block,i=t.elem,s=t.js,o=t.BEM;e("b-cluster-tree-sort")(s()((function(){return this.ctx.js||!0})),i("select").content()((function(){return{block:"select2",mods:{theme:"normal",size:"s",type:"radio",text:"vary"},val:this.ctx.val,items:[{val:"title",text:o.I18N("b-cluster-tree-sort","sort_by_name")},{val:"tag",text:o.I18N("b-cluster-tree-sort","sort_by_address")},{val:"created_at",text:o.I18N("b-cluster-tree-sort","sort_by_createDate")},{val:"modified_at",text:o.I18N("b-cluster-tree-sort","sort_by_updates")}],button:{mods:{theme:"dark"}}}})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.elem,s=t.js;e("b-cluster-tree-filter")(s()((function(){return this.ctx.js||!0})),i("select").replace()((function(){return{block:"select2",mods:{theme:"normal",size:"s",type:"check"},items:this.ctx.items||[],val:this.ctx.val||null,button:{mods:{theme:"dark"},content:[{block:"icon",mods:{size:"s",type:"arrow",direction:"bottom"},mix:[{block:"button2",elem:"icon",elemMods:{side:"right"}},{block:"select2",elem:"arrow"}]},{block:"button2",elem:"text",content:{block:"awesome-icon",mods:{icon:"filter"}}}]}}})))}},function(t,e){t.exports=function(t){(0,t.block)("sidebar").elem("tab-content").elemMod("tab","events").content()({block:"b-events-log",mods:{type:"sidebar",theme:"dark"}})}},function(t,e){t.exports=function(t){var e=t.applyNext,i=t.block,s=t.content,o=t.def,n=t.elem,a=t.js,r=t.BEM;i("b-events-log")(o()((function(){return this.ctx.mods=this.ctx.mods||{},this.ctx.mods.theme=this.ctx.mods.theme||"normal",e()})),a()((function(){return this.ctx.js||!0})),n("list").tag()("ol"),n("item").tag()("li"),s()((function(){return[{block:"b-events-select",mods:{theme:this.ctx.mods.theme}},{elem:"list"},{elem:"more",content:[{block:"link",mix:{block:"b-events-log",elem:"more-link",tag:"span"},mods:{pseudo:"yes",theme:this.ctx.mods.theme},content:[r.I18N("b-events-log","more_events")," ",{block:"awesome-icon",mods:{icon:"angle-down"}}]},{block:"spin2",mods:{size:"xs"}}]},{elem:"mask",content:{block:"spin2",mods:{size:"s"}}}]})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.content,s=t.js,o=t.BEM;e("b-events-select")(s()(!0),i()((function(){return{block:"select2",name:"events",mods:{size:"s",theme:"normal",text:"vary",type:"radiocheck"},button:{mods:{theme:"dark"}},text:o.I18N("b-events-select","only_edits"),val:"create,edit",items:[{val:"create,edit",text:o.I18N("b-events-select","only_edits")},{val:"watch,unwatch,subscribe_other_user",text:o.I18N("b-events-select","only_subscribes")},{val:"add_file,delete_file",text:o.I18N("b-events-select","only_attaches")},{val:"add_comment,delete_comment,remove_comment",text:o.I18N("b-events-select","only_comments")},{val:"",text:o.I18N("b-events-select","all_events")}]}})))}},function(t,e){t.exports=function(t){var e=t.block;e("b-diff-grid").tag()("table"),e("b-diff-grid").elem("row").tag()("tr"),e("b-diff-grid").elem("field").tag()("td")}},function(t,e){t.exports=function(t){var e=t.block;e("b-diff-string").elem("chunk").tag()("span"),e("b-diff-string").elem("chunk").elemMod("diff-type","added").tag()("ins"),e("b-diff-string").elem("chunk").elemMod("diff-type","deleted").tag()("del")}},function(t,e){t.exports=function(t){(0,t.block)("sidebar").elem("tab-content").elemMod("tab","files").content()({block:"w-attachments",mods:{type:"sidebar",theme:"dark"}})}},function(t,e){t.exports=function(t){var e=t.applyNext,i=t.attrs,s=t.block,o=t.content,n=t.def,a=t.elem,r=t.js,l=t.BEM;s("w-attachments")(n()((function(){var t=this.mods;return t.theme=t.theme||"normal",e({_theme:t.theme})})),r()(!0),o()([{elem:"overall-progress"},{elem:"attach-button"},{elem:"attachments"},{elem:"more"}]),a("attach-button").content()((function(){return[{block:"attach",mods:{size:"s",theme:this._theme},text:l.I18N("w-attachments","upload-btn-text")},{tag:"br"},{elem:"drop-message",tag:"span",content:l.I18N("w-attachments","drop-panel-message")}]})),a("attach-loader")(i()((function(){return{id:this.ctx.id}})),o()((function(){return[{block:"w-file-name",width:{max:260,name:230},mix:{block:"w-attachments",elem:"attach-loader-file"},content:this.ctx.name},{elem:"progress"}]}))),a("attach").replace()((function(){return{block:"w-attach",mods:{theme:this.elemMods.theme},mix:{block:"w-attachments",elem:"attach"},attach:this.ctx.attach,redirect:this.ctx.redirect}})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.BEM;e("w-attachments").elem("progress").content()((function(){return[{elem:"percent",tag:"span",content:"0"},{elem:"meter",tag:"span"},{elem:"error-controls",content:[{block:"awesome-icon",mods:{icon:"repeat"},attrs:{title:i.I18N("w-attachments","upload-repeat")},mix:{block:"w-attachments",elem:"repeat"}},{block:"awesome-icon",mods:{icon:"ban-circle"},attrs:{title:i.I18N("w-attachments","upload-cancel")},mix:{block:"w-attachments",elem:"cancel"}}]}]}))}},function(t,e){t.exports=function(t){var e=t.applyNext,i=t.attrs,s=t.block,o=t.content,n=t.def,a=t.js,r=t.BEM;s("w-attach")(n()((function(){var t=this.ctx.mods||{};return t.theme=t.theme||"normal",this.ctx.mods=t,e({_theme:t.theme,_attach:this.ctx.attach})})),i()((function(){return{title:this._attach.name}})),a()((function(){return{attach:this.ctx.attach}})),o()((function(){return[{elem:"attach-name",url:this._attach.docviewer_url?this._attach.docviewer_url:this._attach.url+"?download=1",target:this._attach.docviewer_url?"_blank":"_self",content:this.ctx.attach.name},{elem:"about",content:[{elem:"author",content:this.ctx.attach.user_name}," / ",{elem:"date",content:this.ctx.attach.upload_date}," / ",{elem:"size",content:this.ctx.attach.size}]},{elem:"controls",redirect:this.ctx.redirect},{elem:"hider",attrs:{title:r.I18N("w-attach","hide_options_hint")},content:{block:"awesome-icon",mods:{icon:"angle-right"}}},{block:"tooltip",mods:{size:"s",theme:"normal",autoclosable:"yes"},js:{offset:10},content:r.I18N("w-attach","file_link_copied")}]})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.content,s=t.tag;e("w-attach").elem("author")(s()("span"),i()((function(){return[{block:"m-username",mods:{theme:this._theme},mix:{block:"mi-staff-card",js:{user:this.ctx.content}},url:"//staff.yandex-team.ru/"+this.ctx.content,content:this.ctx.content+"@"}]})))}},function(t,e){t.exports=function(t){(0,t.block)("w-attach").elem("attach-name").content()((function(){return{block:"link",mods:{theme:this._theme},target:this.ctx.target,title:this.ctx.content,url:this.ctx.url,content:{block:"w-file-name",width:{max:260,name:230},content:this.ctx.content}}}))}},function(t,e){t.exports=function(t){var e=t.attrs,i=t.block,s=t.tag;i("w-attach").elem("date")(s()("span"),e()((function(){return{title:this["mi-helpers"].getHumanStringFromDate({date:new Date(this.ctx.content)})}})))}},function(t,e){t.exports=function(t){var e=t.attrs,i=t.block,s=t.content,o=t.tag,n=t.BEM;i("w-attach").elem("controls")(o()("span"),e()((function(){return{title:this._attach.name}})),s()((function(){return[{elem:"controls-container",content:[{block:"awesome-icon",mods:{icon:"trash"},attrs:{title:n.I18N("w-attach","remove_link")},mix:[{block:"w-attach",elem:"control",elemMods:{type:"remove",visible:!this._attach.can_delete||this.ctx.redirect?"no":""}}]},{block:"w-attach",elem:"control",elemMods:{type:"download"},content:{block:"link",url:this._attach.url+"?download=1",content:{block:"awesome-icon",mods:{icon:"download"},attrs:{title:n.I18N("w-attach","download_link")}}}},{block:"awesome-icon",mods:{icon:"link"},attrs:{title:n.I18N("w-attach","copy_link")},mix:[{block:"w-attach",elem:"control",elemMods:{type:"copy"}}]}]}]})))}},function(t,e){t.exports=function(t){(0,t.block)("sidebar").elem("tab-content").elemMod("tab","grid-code").content()({block:"b-grid-table-code",mods:{type:"sidebar",theme:"dark"}})}},function(t,e){t.exports=function(t){var e=t.block,i=t.content,s=t.mix;e("b-grid-table-code")(s()({block:"b-sidebar-section"}),i()((function(){return{block:"b-grid-table-code-form",mods:{theme:this.mods.theme}}})))}},function(t,e){t.exports=function(t){(0,t.block)("b-grid-table-code-form").js()({data:{width:100,width_units:"%",read_only:!1,show_numbers:!0,show_sorting:!0}})}},function(t,e){t.exports=function(t){(0,t.block)("sidebar").elem("tab-content").elemMod("tab","grid-settings").content()((function(){return{block:"b-grid-table-settings",mods:{type:"sidebar",theme:"dark"},redirect:this.ctx.redirect}}))}},function(t,e){t.exports=function(t){var e=t.applyNext,i=t.block,s=t.content,o=t.def,n=t.js,a=t.mix,r=t.BEM;i("b-grid-table-settings")(o()((function(){return this.ctx.mods=this.ctx.mods||{},this.ctx.mods.theme=this.ctx.mods.theme||"normal",e()})),a()({block:"b-sidebar-section"}),n()((function(){return this.ctx.js||!0})),s()((function(){return[{elem:"settings",content:[{elem:"grid-title",content:{block:"input",mods:{size:"m",theme:this.ctx.mods.theme},value:"",content:{elem:"control",controlAttrs:{placeholder:r.I18N("b-grid-table-settings","table_name"),autocomplete:"off"}}}},{elem:"sorting",content:{block:"b-grid-table-sorting-controll",mods:{theme:this.ctx.mods.theme}}},{elem:"submit",content:{block:"button2",mods:{size:"m",theme:"action",disabled:this.ctx.redirect?"yes":""},text:r.I18N("b-grid-table-settings","save")}}]}]})))}},function(t,e){t.exports=function(t){var e=t.applyNext,i=t.block,s=t.content,o=t.def,n=t.js,a=t.BEM;i("b-grid-table-sorting-controll")(o()((function(){return this.ctx.mods=this.ctx.mods||{},this.ctx.mods.theme=this.ctx.mods.theme||"normal",e()})),n()((function(){return this.ctx.js||!0})),s()((function(){return[{elem:"sortings"},{elem:"add-sorting",content:{block:"link",mods:{pseudo:"yes",theme:this.ctx.mods.theme},content:a.I18N("b-grid-table-sorting-controll","add_sort")}}]})))}},function(t,e){t.exports=function(t){var e=t.applyNext,i=t.block,s=t.content,o=t.def;i("b-grid-table-fields-list")(o()((function(){var t=this.ctx.selected,i=this.ctx.fields.map((function(e){return{name:e.name,title:e.title,selected:e.name===t}}));return this.ctx.mods=this.ctx.mods||{},this.ctx.mods.theme=this.ctx.mods.theme||"normal",e({_options:i})})),s()((function(){return{block:"select2",js:{defaultValue:this.ctx.selected},name:"grid-fields",mods:{size:"m",theme:this.mods.theme,text:"vary",type:"radiocheck"},val:this.ctx.selected,text:this.ctx.selected,items:this._options.map((function(t){return{val:t.name,text:t.title}})),button:{mods:{theme:this.mods.theme}}}})))}},function(t,e){t.exports=function(t){var e=t.applyNext,i=t.block,s=t.content,o=t.def,n=t.tag,a=t.BEM;i("b-grid-table-sorting-list")(o()((function(){return this.ctx.mods=this.ctx.mods||{},this.ctx.mods.theme=this.ctx.mods.theme||"normal",e()})),n()("span"),s()((function(){return{block:"radio-button",mods:{size:"m",theme:this.mods.theme},name:"sorting_"+Date.now(),value:"asc"===this.ctx.selected?"asc":"desc",content:[{elem:"radio",controlAttrs:{value:"asc"},content:a.I18N("b-grid-table-sorting-list","a_z")},{elem:"radio",controlAttrs:{value:"desc"},content:a.I18N("b-grid-table-sorting-list","z_a")}]}})))}},function(t,e){t.exports=function(t){(0,t.block)("sidebar").elem("loader").content()({block:"spin2",mods:{size:"l",progress:"yes"}})}},function(t,e){t.exports=function(t){var e=t.block,i=t.BEM;e("wi-files-dropper").elem("drop-zone").content()((function(){return{elem:"drop-text",tag:"span",content:i.I18N("wi-files-dropper","drop_here")}}))}},function(t,e){t.exports=function(t){var e=t.block,i=t.BEM;e("b-readonly").content()((function(){return[{elem:"wrapper",content:[{elem:"text",content:[i.I18N("b-readonly","in_readonly"),{html:"<br/>"},i.I18N("b-readonly","cant_change")]},{elem:"close",content:{block:"awesome-icon",mods:{icon:"remove"}}}]},{elem:"icon"}]}))}},function(t,e){t.exports=function(t){(0,t.block)("b-page-title").tag()("h1")}},function(t,e){t.exports=function(t){var e=t.block,i=t.content,s=t.elem,o=t.js;e("w-page-info")(o()(!0),i()((function(){return[{elem:"content",parentCtx:this.ctx},{elem:"right"}]})),s("right").content()({block:"awesome-icon",mods:{icon:"remove",type:"hide"}}))}},function(t,e){t.exports=function(t){(0,t.block)("b-grid-table").elem("table").tag()("table")}},function(t,e){t.exports=function(t){var e=t.block,i=t.elem,s=t.mod;e("b-grid-table-cell")(s("type","td").tag()("td"),s("type","th").tag()("th"),i("old-changed").tag()("span"),i("new-changed").tag()("span"),i("br").tag()("br"))}},function(t,e){t.exports=function(t){var e=t.applyNext,i=t.block,s=t.def;i("m-suggest-item").mod("type","people")(s()((function(){return this.ctx.mods=this.ctx.mods||{},this.ctx.mods.type="staff",this.ctx.data.department||(this.ctx.data.department=this.ctx.data.department_name||""),e()})))}},function(t,e){t.exports=function(t){var e=t.applyNext,i=t.block,s=t.def;i("m-suggest-item").mod("type","groups")(s()((function(){return this.ctx.mods=this.ctx.mods||{},this.ctx.mods.type="group",this.ctx.data.name||(this.ctx.data.name=this.ctx.data.title),e()})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.elem;e("b-grid-table-head")(i("old-changed").tag()("span"),i("new-changed").tag()("span"))}},function(t,e){t.exports=function(t){var e=t.block,i=t.content,s=t.js,o=t.BEM;e("b-grid-table-list-options")(s()((function(){return{options:this.ctx.options}})),i()((function(){return[{elem:"items-container",content:[{elem:"drag-delimiter"}].concat(this.ctx.options.map((function(t){return{block:"b-grid-table-list-options-item",text:t}})))},{elem:"add-item",content:{block:"awesome-icon",mods:{icon:"plus",type:"add-item"}}},{block:"tooltip",js:{to:["right","left"]},mods:{size:"xs",theme:"error",type:"duplicate"},content:o.I18N("b-grid-table-list-options","duplicate")}]})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.content,s=t.js;e("b-grid-table-list-options-item")(s()((function(){return{text:this.ctx.text}})),i()((function(){return[{block:"awesome-icon",mods:{icon:"reorder",type:"sort"},attrs:{draggable:"true"}},{elem:"item-content-wrapper",content:[{elem:"item-content",content:this.ctx.text},{block:"input",mods:{size:"s",type:"item-val"},content:[{elem:"control"}],value:this.ctx.text}]},{block:"awesome-icon",mods:{icon:"trash",type:"remove"}}]})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.content,s=t.js,o=t.BEM;e("b-grid-table-bar")(s()((function(){return{isAction:this.ctx.isAction}})),i()((function(){return[{block:"b-grid-table-options",js:{gridUrl:this.ctx.gridUrl,isAction:this.ctx.isAction,actuality:this.ctx.actuality,fieldsCount:this.ctx.fieldsCount,redirect:this.ctx.redirect},breadcrumbs:this.ctx.breadcrumbs,user:this.ctx.user},{block:"b-grid-table-editors",js:{supertag:this.ctx.gridUrl}},{elem:"scroll-arrows",content:[{block:"awesome-icon",mods:{icon:"angle-left",type:"scroll-left"}},{block:"awesome-icon",mods:{icon:"angle-right",type:"scroll-right"}}]},{block:"button2",mods:{size:"s",theme:"action",role:"edit"},text:o.I18N("b-grid-table","edit")}]})))}},function(t,e){t.exports=function(t){var e=t.attrs,i=t.block,s=t.elem,o=t.js,n=t.tag;i("b-grid-table-editors")(o()(!0),s("editor")(n()("img"),e()((function(){return{src:"//center.yandex-team.ru/api/v1/user/"+this.ctx.user.login+"/avatar/50.jpg"}}))))}},function(t,e){t.exports=function(t){var e=t.apply,i=t.block,s=t.BEM;i("b-grid-table-options").content()((function(){return[{block:"dropdown2",mods:{switcher:"button2",theme:"normal",autoclosable:"yes",role:"table-options"},switcher:{block:"button2",mods:{theme:"normal",size:"s"},content:{block:"awesome-icon",mods:{icon:"cog"}}},popup:{block:"popup2",mods:{role:"table-options"},directions:["top-left","bottom-left","right-center"],content:[{block:"b-grid-table-options-item",content:s.I18N("b-grid-table-options","tree"),mods:{action:"tree"},mix:{block:"w-action",mods:{type:"tree"},js:!0},js:!0},{block:"b-grid-table-options-item",content:s.I18N("b-grid-table-options","copy"),mods:{action:"copy",disabled:!this.ctx.js.isAction&&this.ctx.js.redirect?"yes":""},mix:[{block:"w-action",mods:{type:"copy"},js:{type:"grid",isAction:this.ctx.js.isAction||!1,source:"/"+this.ctx.js.gridUrl}}],js:!0},{block:"b-grid-table-options-item",content:s.I18N("b-grid-table-options","move"),mods:{action:"move",disabled:!this.ctx.js.isAction&&this.ctx.js.redirect?"yes":""},mix:[{block:"w-action",mods:{type:"move"},js:{type:"grid",isAction:this.ctx.js.isAction||!1,source:"/"+this.ctx.js.gridUrl}}],js:!0},{block:"b-grid-table-options-item",content:s.I18N("b-grid-table-options","import"),mods:{action:"import",disabled:!this.ctx.js.isAction&&this.ctx.js.redirect?"yes":""},mix:[{block:"w-action",mods:{type:"import"},js:{type:"grid",isAction:this.ctx.js.isAction||!1,source:"/"+this.ctx.js.gridUrl,fieldsCount:this.ctx.js.fieldsCount}}],js:!0},{block:"b-grid-table-options-item",content:s.I18N("b-grid-table-options","export"),mods:{action:"export",disabled:!this.ctx.js.isAction&&this.ctx.js.redirect?"yes":""},js:!0},this.ctx.js.isAction&&{block:"b-grid-table-options-item",content:s.I18N("b-grid-table-options","parent_table"),mods:{action:"parent"},js:!0},!this.ctx.js.isAction&&{block:"b-grid-table-options-item",content:"obsolete"===this.ctx.js.actuality?s.I18N("b-grid-table-options","mark_as_actual"):s.I18N("b-grid-table-options","mark_as_obsolete"),mods:{action:"old-page",disabled:!this.ctx.js.isAction&&this.ctx.js.redirect?"yes":""},mix:[{block:"w-action",mods:{type:"old-page"},js:{actuality:"obsolete"===this.ctx.js.actuality?"obsolete":"actual"}}],js:!0},{block:"b-grid-table-options-item",content:s.I18N("b-grid-table-options","referrers"),mods:{action:"settings"},mix:[{block:"w-action",mods:{type:"referrers"},js:!0}],js:!0},{block:"b-grid-table-options-item",content:s.I18N("b-grid-table-options","settings"),mods:{action:"settings"},mix:[{block:"w-action",mods:{type:"settings"},js:{isAction:this.ctx.js.isAction||!1,source:"/"+this.ctx.js.gridUrl,user:this.ctx.user}}],js:!0},{elem:"line"},{block:"b-grid-table-options-item",content:s.I18N("b-grid-table-options","delete"),mods:{action:"delete",disabled:!this.ctx.js.isAction&&this.ctx.js.redirect?"yes":""},mix:[{block:"w-action",mods:{type:"delete"},js:{type:"grid",isAction:this.ctx.js.isAction||!1,source:"/"+this.ctx.js.gridUrl,breadcrumbs:this.ctx.breadcrumbs}}],js:!0},{block:"w-action",mods:{type:"subscribe"},js:!0},{block:"w-action",mods:{type:"unsubscribe"},js:!0},{block:"w-action",mods:{type:"subpages-change-author"},js:!0},{block:"w-action",mods:{type:"access"},js:!0},{block:"w-action",mods:{type:"files"},js:!0},{block:"w-action",mods:{type:"authors"},js:!0},{block:"w-action",mods:{type:"authorship"},js:!0},e("rejected-access"),{block:"w-action",mods:{type:"request-page-author"},js:!0}]}}]}))}},function(t,e){t.exports=function(t){var e=t.block,i=t.content,s=t.js,o=t.BEM;e("w-user-settings")(s()((function(){return{settings:this.ctx.settings}})),i()((function(){var t=this.ctx.settings;return{block:"island",content:[{block:"w-user-settings",elem:"header",content:o.I18N("w-user-settings","settings")},{block:"w-user-settings",elem:"row",content:[{block:"w-user-settings",elem:"col",mix:{block:"w-user-settings",elem:"left-col"},content:o.I18N("w-user-settings","ui_lang")},{block:"w-user-settings",elem:"col",content:{block:"radio-button",mods:{theme:"normal",size:"s",type:"language"},name:"lang",value:t.language,content:[{elem:"radio",controlAttrs:{value:"ru"},content:"Русский"},{elem:"radio",controlAttrs:{value:"en"},content:"English"}]}}]},{block:"w-user-settings",elem:"row",content:[{block:"w-user-settings",elem:"col",mix:{block:"w-user-settings",elem:"left-col"},content:o.I18N("w-user-settings","content_translation")},{block:"w-user-settings",elem:"col",content:{block:"radio-button",mods:{theme:"normal",size:"s",type:"show-translate"},name:"translate",value:String(t.propose_content_translation),content:[{elem:"radio",controlAttrs:{value:"true"},content:o.I18N("w-user-settings","show")},{elem:"radio",controlAttrs:{value:"false"},content:o.I18N("w-user-settings","hide")}]}}]},{block:"w-user-settings",elem:"row",content:[{block:"w-user-settings",elem:"col",mix:{block:"w-user-settings",elem:"left-col"},content:o.I18N("w-user-settings","use_full_width_content")},{block:"w-user-settings",elem:"col",content:{block:"tumbler",mods:{theme:"normal",size:"s",checked:t.use_full_width_content?"":"yes",type:"use_full_width_content"}}}]},{block:"w-user-settings",elem:"submit",content:[{block:"spin2",mods:{size:"xs"}},{block:"button2",mods:{size:"s",theme:"action",role:"submit"},text:o.I18N("w-user-settings","save")}]}]}})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.content,s=t.js;e("scroll")(s()(!0),i().mod("tech","js")((function(){return[{elem:"native",content:{elem:"content",content:this.ctx.content}},{elem:"track",elemMods:{orientation:"vertical"},content:{elem:"thumb",elemMods:{orientation:"vertical"}}},{elem:"track",elemMods:{orientation:"horizontal"},content:{elem:"thumb",elemMods:{orientation:"horizontal"}}}]})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.content,s=t.tag;e("wiki-math").elem("tex-view")(s()("pre"),i()((function(){return{tag:"code",cls:"tex",content:this.ctx.content}})))}},,function(t,e){t.exports=function(t){(0,t.block)("b-widget").content()((function(){return[{block:"spin2",mods:{type:"load",size:"s"}},{elem:"content",content:[],parentCtx:this.ctx}]}))}},function(t,e){t.exports=function(t){var e=t.block;e("b-user-group").tag()("span"),e("b-user-group").elem("remove").tag()("span")}},function(t,e){t.exports=function(t){var e=t.apply,i=t.applyNext,s=t.block,o=t.def,n=t.elem,a=t.js,r=t.mode,l=t.BEM;s("b-widget").mod("type","page-access")(a()((function(){return{user:this.ctx.user,data:this.ctx.data,canChange:this.ctx.canChange}})),o()((function(){var t=this.ctx.mods||{};return t["show-users"]="restricted"===this.ctx.data.type?"yes":"",this.ctx.mods=t,this.ctx.canChange=e("can-change"),i()})),r("can-change")()((function(){var t=this.ctx.data,e=this.ctx.user;return e.is_admin||Boolean(t.authors.find((function(t){return t.login===e.login})))})),n("content").content()((function(){var t=this.ctx.parentCtx.canChange;return{elem:"content-wrapper",content:[{elem:"header",tag:"h2",content:l.I18N("b-widget","access_caption")},{block:"radiobox",mods:{theme:"normal",size:"m",disabled:t?"":"yes"},name:"access_type",content:[{elem:"radio",content:[l.I18N("b-widget","access_to_parent")+" ",{block:"b-widget",elem:"parent-access",tag:"span"}],controlAttrs:{value:"inherited"}},{tag:"br"},{elem:"radio",mix:{block:"b-widget",elem:"access-radio",elemMods:{type:"common"}},content:l.I18N("b-widget","access_free"),controlAttrs:{value:"common"}},{tag:"br"},{elem:"radio",mix:{block:"b-widget",elem:"access-radio",elemMods:{type:"owner"}},content:l.I18N("b-widget","access_lock"),controlAttrs:{value:"owner"}},{tag:"br"},{elem:"radio",mix:{block:"b-widget",elem:"access-radio",elemMods:{type:"restricted"}},content:l.I18N("b-widget","restricted"),controlAttrs:{value:"restricted"}}]},{block:"spin2",mods:{size:"xxs",type:"action-load"}},{elem:"restricted-groups",content:[{block:"m-suggest",js:{addRequestParams:{"people.per_page":4,"people.query":"i_is_dismissed:0"},maxPopupHeight:330},mods:{type:"intranet-v2",size:"s",role:"restricted"},inputMods:{disabled:t?"":"yes"},hint:l.I18N("b-widget","add_department_or_person"),types:[{name:"people"},{name:"groups"}]},{elem:"users-list"},{block:"b-groups-list"},{block:"b-services-list"},{block:"b-wiki-list"}]},{elem:"buttons",content:[{block:"spin2",mods:{size:"xs",type:"save-access"}},{block:"button2",mods:{size:"m",role:"cancel",theme:"normal"},tabindex:1,text:l.I18N("b-widget","reject")},{block:"button2",mods:{theme:"action",size:"m",role:"save",disabled:t?"":"yes"},tabindex:0,text:l.I18N("b-widget","save")}]}]}})))}},function(t,e){t.exports=function(t){var e=t.applyNext,i=t.block,s=t.BEM;i("b-widget").mod("type","old-page").content()((function(){var t=e(),i=[];return i.push([{elem:"title",elemMods:{actuality:"obsolete"},content:s.I18N("b-widget","mark_page_as_obsolete")},{elem:"title",elemMods:{actuality:"actual"},content:s.I18N("b-widget","mark_page_as_actual")},{elem:"comment",content:{block:"input",mods:{type:"textarea",size:"s"},name:"test",placeholder:s.I18N("b-widget","comment"),content:{elem:"control",attrs:{rows:"3"}}}},{elem:"links",content:{elem:"link",content:{block:"input",mods:{size:"s"},placeholder:s.I18N("b-widget","link_wiki_page"),content:[{elem:"label",content:s.I18N("b-widget","add_links_text")},{elem:"control"}]}}},{elem:"add-link",content:[{block:"link",content:s.I18N("b-widget","add_link")}]},{elem:"buttons",content:[{block:"spin2",mods:{size:"xs",type:"old-page"}},{block:"button2",mods:{size:"m",role:"old-page-cancel",theme:"normal"},tabindex:1,text:s.I18N("b-widget","cancel")},{block:"button2",mods:{size:"m",role:"old-page",theme:"action"},tabindex:0,text:s.I18N("b-widget","mark")}]}]),t[1]&&(t[1].content=i),t}))}},function(t,e){t.exports=function(t){var e=t.applyNext,i=t.block,s=t.content,o=t.js;i("m-suggest-item").mod("type","cluster")(o()((function(){var t=this.ctx.data;return this.extend(e(),{value:t.tag})})),s()((function(){var t,e,i,s=this.ctx.data.tag,o=s.indexOf(this.ctx.inputData.text);return-1!==o?(t=s.substr(0,o),e=s.substr(o+this.ctx.inputData.text.length),i=[t,{elem:"selected",content:this.ctx.inputData.text},e]):i=s,{elem:"info-wrapper",content:i}})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.elem,s=t.js,o=t.BEM;e("b-widget").mod("type","subscribe")(s()((function(){return{subscribers:this.ctx.subscribers}})),i("content").content()((function(){var t=this.ctx.parentCtx.subscribers,e=Boolean(this.ctx.parentCtx.mods&&"yes"===this.ctx.parentCtx.mods.subscribers);return[{block:"tabs",mods:{control:"menu",size:"m",theme:"normal",layout:"horiz"},panes:"oh-my-tabs",content:[{elem:"tab",elemMods:{active:e?"":"yes"},content:o.I18N("b-widget","sign_on_page")},{elem:"tab",elemMods:{active:e?"yes":"",type:"subscribers"},content:o.I18N("b-widget","subscribers")+(t.length?" "+t.length:"")}]},{block:"tabs-panes",id:"oh-my-tabs",content:[{elem:"pane",elemMods:{active:e?"":"yes"},content:[{block:"m-suggest",mods:{type:"intranet-v2",size:"m",multiple:"yes"},hint:o.I18N("b-widget","add_users"),js:{addRequestParams:{"people.per_page":8,"people.query":"i_is_dismissed:0"}},types:[{name:"people"}]},{block:"input",mods:{type:"textarea",subscribe:"comment"},content:{elem:"control",attrs:{placeholder:o.I18N("b-widget","comment"),rows:5}}},{block:"b-widget",elem:"users-result",content:o.I18N("b-widget","success_subscribe")}]},{elem:"pane",elemMods:{active:e?"yes":""},content:{block:"b-widget",elem:"subscribers"}}]},{elem:"buttons",content:[{block:"spin2",mods:{size:"s",type:"subscribe-load"}},{block:"button2",mods:{theme:"normal",size:"m",role:"close"},tabindex:0,text:o.I18N("b-widget","close")},{block:"button2",mods:{theme:"normal",size:"m",role:"cancel"},tabindex:-1,text:o.I18N("b-widget","cancel")},{block:"button2",mods:{theme:"action",size:"m",role:"save",disabled:"yes"},tabindex:0,text:o.I18N("b-widget","subscribe")}]}]})))}},function(t,e){t.exports=function(t){var e=t.applyNext,i=t.block,s=t.BEM;i("b-widget").mod("type","unsubscribe").elem("content").content()((function(){var t=e();return Array.isArray(t)||(t=[t]),t.push({elem:"header",tag:"h2",content:s.I18N("b-widget","unsubscribe_propose")},{elem:"buttons",content:[{block:"button2",mods:{theme:"normal",size:"s",role:"cancel"},text:s.I18N("b-widget","cancel")},{elem:"right",content:[{block:"spin2",mods:{size:"xs",type:"unsubscribe-load"}},{block:"button2",mods:{theme:"action",size:"s",role:"unsubscribe"},text:s.I18N("b-widget","unsubscribe")}]}]}),t}))}},function(t,e){t.exports=function(t){var e=t.block,i=t.elem,s=t.js,o=t.BEM;e("b-widget").mod("type","page-settings")(s()(!0),i("content").content()((function(){var t=this.ctx.parentCtx.js;return[{block:"b-widget",elem:"header",content:o.I18N("b-widget","page-settings")},{elem:"settings",content:[{block:"w-page-setting",mods:{type:"keywords",readonly:t.isRedirectPage?"yes":""},data:t.keywords,path:t.ajaxPath},{block:"w-page-setting",mods:{type:"authors",readonly:t.canEdit&&!t.isRedirectPage?"":"yes"},showGetAuthorship:!t.isRedirectPage&&!t.canEdit,data:{authors:t.authors},path:t.ajaxPath},{block:"w-page-setting",mods:{type:"redirect",readonly:t.canEdit?"":"yes"},data:t.redirect,path:t.ajaxPath},{block:"w-page-setting",mods:{type:"comments",readonly:t.canEdit?"":"yes"},data:t.comments,path:t.ajaxPath},{block:"checkbox",mods:{theme:"normal",size:"s",checked:t.readonly?"yes":"",disabled:t.canEdit?"":"yes",role:"readonly"},text:o.I18N("b-widget","readonly_page")}]},{elem:"redirected-from"}]})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.content,s=t.js;e("w-page-setting")(s()((function(){return{data:this.ctx.data,path:this.ctx.path}})),i()((function(){return[{elem:"top-line",content:[{elem:"header"},{block:"spin2",mods:{size:"xxs"}},{elem:"data-preview",data:this.ctx.data}]},{elem:"form",data:this.ctx.data}]})))}},function(t,e){t.exports=function(t){var e=t.attrs,i=t.block,s=t.content,o=t.elem,n=t.BEM;i("w-page-setting").mod("type","authors")(e()((function(){return{title:n.I18N("w-page-setting","setup-authors")}})),s()((function(){return[{elem:"top-line",content:[{elem:"header",showGetAuthorship:this.ctx.showGetAuthorship},{block:"spin2",mods:{size:"xxs"}},{elem:"data-preview",data:this.ctx.data}]},{elem:"form",data:this.ctx.data}]})),o("header").content()((function(){return[n.I18N("w-page-setting","authors"),this.ctx.showGetAuthorship&&{elem:"get-authorship"}]})),o("get-authorship").content()((function(){return{block:"button2",mods:{size:"m",theme:"normal"},text:n.I18N("w-page-setting","get-authorship")}})),o("data-preview").content()((function(){return{block:"w-authors",visibleCount:3,inline:!0,withPhoto:!0}})),o("form").content()((function(){return[{block:"link",mods:{theme:"black",pseudo:"yes",type:"mass-change-author"},text:n.I18N("w-page-setting","change_author_in_cluster")},{block:"multiple-suggest",size:"s",js:{addRequestParams:{"people.per_page":5,"people.query":"i_is_dismissed:0"}},hint:n.I18N("w-page-setting","staff-search"),types:[{name:"people"}]},{block:"button2",mods:{theme:"normal",size:"s",role:"save-authors"},text:n.I18N("b-widget","save")}]})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.content,s=t.js;e("multiple-suggest")(i()((function(){return{block:"m-suggest",js:this.ctx.js,mods:{size:this.ctx.size,type:"intranet-v2"},inputMods:{disabled:this.ctx.disabled?"yes":""},hint:this.ctx.hint,types:this.ctx.types}})),s()((function(){return{listHeaders:this.ctx.listHeaders,active:!this.ctx.disabled,types:this.ctx.types.map((function(t){return t.name}))}})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.content,s=t.BEM;e("multiple-suggest-item").mod("type","groups")(i()((function(){var t=this.ctx.data;return[t.name,t.externals_count>0&&{block:"awesome-icon",mods:{icon:"warning"},attrs:{title:s.I18N("w-access-button","external_group")},mix:{block:this.block,elem:"external-warning"}},this.ctx.active&&{block:"awesome-icon",mods:{icon:"remove"},mix:{block:this.block,elem:"remove"}}]})))}},function(t,e){t.exports=function(t){var e=t.attrs,i=t.block,s=t.elem,o=t.BEM;i("w-page-setting").mod("type","keywords")(e()((function(){return{title:o.I18N("w-page-setting","setup-keywords")}})),s("header").content()((function(){return o.I18N("w-page-setting","keywords")})),s("data-preview").content()((function(){return this.ctx.data&&this.ctx.data.join(", ")||o.I18N("w-page-setting","no-keywords")})),s("form").content()((function(){return[{block:"input",mods:{size:"s",clear:"no"},placeholder:o.I18N("w-page-setting","tags_list"),content:[{elem:"control"}]},{block:"button2",mods:{theme:"normal",size:"s",disabled:"yes"},text:o.I18N("w-page-setting","add")},{elem:"keywords",content:this.ctx.data&&this.ctx.data.map((function(t){return{block:"w-baloon",text:t}}))}]})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.content,s=t.js;e("w-baloon")(s()((function(){return{text:this.ctx.text}})),i()((function(){return[this.ctx.text,{elem:"clear"}]})))}},function(t,e){t.exports=function(t){var e=t.attrs,i=t.block,s=t.elem,o=t.BEM;i("w-page-setting").mod("type","comments")(e()((function(){return{title:o.I18N("w-page-setting","setup-comments")}})),s("header").content()((function(){return o.I18N("w-page-setting","comments")})),s("data-preview").content()((function(){return o.I18N("w-page-setting","enabled"===this.ctx.data.comments_status?"on":"off")})),s("form").content()((function(){return[{block:"select2",mods:{size:"s",type:"radio",width:"fixed",theme:"normal",role:"comments",text:"vary"},name:Math.random().toString(),val:"enabled"===this.ctx.data.comments_status?"on":"off",text:o.I18N("w-page-setting","enabled"===this.ctx.data.comments_status?"is_on":"is_off"),items:[{val:"on",text:o.I18N("w-page-setting","to_on")},{val:"off",text:o.I18N("w-page-setting","to_off")}]},{block:"button2",mods:{theme:"normal",size:"s",disabled:"yes",role:"save-comments"},text:o.I18N("b-widget","save")},this.ctx.data.subpages_count?{elem:"with-subpages",content:{block:"checkbox",mods:{theme:"normal",size:"s",checked:"disabled_on_page"!==this.ctx.data.comments_status?"yes":"",type:"with_subpages"},text:" +"+this.ctx.data.subpages_count+" "+o.I18N("b-widget","cluster_subpages",{count:this.ctx.data.subpages_count})}}:""]})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.elem,s=t.BEM;e("b-widget").mod("type","approve-rejected-access")(i("rejects").tag()("ol"),i("reject-item").tag()("li"),i("content").content()((function(){return[{elem:"header",content:s.I18N("b-widget","attention")},{elem:"approve-rejected-text1",content:s.I18N("b-widget","approve_rejected_text1")},{elem:"rejects",content:this.ctx.parentCtx.data.rejects.users.map((function(t){return{block:"b-widget",elem:"reject-item",content:{block:"w-username",user:t}}})).concat(this.ctx.parentCtx.data.rejects.groups.map((function(t){return{block:"b-widget",elem:"reject-item",content:t.name}})))},{elem:"approve-rejected-more",content:{block:"link",mods:{theme:"normal",type:"more"},url:"/wiki/vodstvo/idm/",target:"_blank",content:s.I18N("b-widget","how_request_access")}},{elem:"buttons",content:[{block:"button2",mods:{size:"m",theme:"normal",role:"ok"},tabindex:1,text:s.I18N("b-widget","reject_ok")}]}]})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.elem,s=t.BEM;e("b-widget").mod("type","authorship")(i("content").content()((function(){return[{elem:"header",content:s.I18N("b-widget","get_authorship")},{elem:"message",content:{block:"input",mods:{type:"textarea",size:"s"},placeholder:s.I18N("b-widget","get_authorship_message_placeholder"),content:{elem:"control",attrs:{rows:"6"}}}},{elem:"buttons",content:[{block:"button2",mods:{size:"m",role:"cancel",theme:"normal"},tabindex:1,text:s.I18N("b-widget","cancel")},{elem:"right-buttons",content:[{block:"spin2",mods:{size:"xs",type:"send"}},{block:"button2",mods:{size:"m",role:"send",theme:"action"},tabindex:0,text:s.I18N("b-widget","send")}]}]}]})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.elem,s=t.js,o=t.BEM;e("b-widget").mod("type","page-delete")(s()(!0),i("content").content()((function(){var t=this.ctx.parentCtx.js.pages,e=this.ctx.parentCtx.js.users;return[{elem:"header",content:o.I18N("b-widget","page-remove")},t.length?{elem:"linked-pages",content:[{elem:"linked-pages-title",content:o.I18N("b-widget","linked-pages")+" ("+t.length+"):"},{elem:"linked-pages-list",content:t.map((function(t){return{elem:"linked-page",content:{block:"link",url:t.url,content:t.tag}}}))}]}:"",e.length?{elem:"page-watchers",content:[{elem:"page-watchers-title",content:o.I18N("b-widget","page-watchers")+" ("+e.length+"):"},{elem:"page-watchers-list",content:e.map((function(t){return{elem:"watcher",content:{block:"m-username",mods:{dismissed:t.is_dismissed?"yes":""},mix:[{block:"mi-staff-card",js:{user:t.login}}],url:"//staff.yandex-team.ru/"+t.login,content:t.display}}}))}]}:"",{elem:"delete-message",content:o.I18N("b-widget","delete-message")},{elem:"buttons",content:[{block:"button2",mods:{theme:"normal",size:"m",role:"cancel"},tabindex:1,text:o.I18N("b-widget","cancel")},{elem:"right-buttons",content:[{block:"spin2",mods:{size:"xs",type:"page-delete"}},{block:"button2",mods:{size:"m",role:"page-delete",theme:"action"},tabindex:0,text:o.I18N("b-widget","remove")}]}]}]})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.BEM;e("b-widget").mod("type","page-import").elem("content").content()((function(){return[{block:"b-widget",elem:"header",content:i.I18N("b-widget","import-data")},{block:"button2",mods:{size:"s",role:"load-another-file",visibility:"hidden",theme:"normal"},content:{elem:"text",content:[{block:"awesome-icon",mods:{icon:"upload"}},i.I18N("b-widget","load_another_file")]}},{elem:"configs",content:[{elem:"attach",content:[{block:"attach",mods:{size:"s",theme:"normal"},tabindex:1,holder:i.I18N("b-widget","select_file"),text:i.I18N("attach","button-text"),button:{control:{attrs:{autocomplete:"off",accept:".csv,.tsv,.txt"}}}}]},i.I18N("b-widget","fields_seperator"),{block:"select2",mods:{size:"s",theme:"normal",type:"radiocheck",role:"fields-separator",text:"vary"},text:";",val:";",items:[{val:",",text:","},{val:";",text:";"},{val:"\t",text:"\\t"}]},i.I18N("b-widget","rows_separator"),{block:"select2",mods:{size:"s",theme:"normal",type:"radiocheck",role:"rows-separator",text:"vary"},text:'"',val:'"',items:[{val:'"',text:'"'},{val:"'",text:"'"}]},{block:"checkbox",mods:{theme:"normal",size:"s",type:"import-head"},text:i.I18N("b-widget","import_first_line")}]},{elem:"preview"},{elem:"errors",elemMods:{visibility:"hidden"}},{elem:"buttons",content:[{block:"spin2",mods:{size:"xs",type:"file-load"}},{block:"button2",mods:{theme:"normal",size:"s",role:"import-cancel"},text:i.I18N("b-widget","cancel")},{block:"button2",mods:{size:"s",role:"load",theme:"action",disabled:"yes"},text:i.I18N("b-widget","load")},{block:"button2",mods:{size:"s",role:"import",theme:"action",disabled:"yes",visibility:"hidden"},text:i.I18N("b-widget","import")},{block:"tooltip",mods:{size:"s",theme:"error",type:"import"},content:i.I18N("b-widget","import_error")}]}]}))}},function(t,e){t.exports=function(t){!function(t){if(null==t)throw new TypeError("Cannot destructure undefined")}(t)}},function(t,e){t.exports=function(t){var e=t.block,i=t.elem,s=t.js,o=t.BEM;e("b-widget").mod("type","referrers")(s()(!0),i("content").content()((function(){var t=this.ctx.parentCtx.js.pages;return[{elem:"header",content:o.I18N("b-widget","linked-pages")+" ("+t.length+"):"},{elem:"linked-pages",content:{elem:"linked-pages-list",content:t.map((function(t){return{elem:"linked-page",content:{block:"link",url:t.url,content:t.tag}}}))}},{elem:"buttons",content:[{block:"button2",mods:{theme:"normal",size:"m",role:"close"},text:o.I18N("b-widget","close")}]}]})))}},function(t,e){t.exports=function(t){var e=t.applyNext,i=t.block,s=t.elem,o=t.js,n=t.BEM;i("b-widget").mod("type","request-page-author")(o()((function(){return{request_login:this.ctx.request_login}})),s("content").content()((function(){var t=e();return Array.isArray(t)||(t=[t]),t.push({elem:"header",tag:"h2",content:n.I18N("b-widget","request_page_author_propose")},{elem:"buttons",content:[{block:"spin2",mods:{size:"xs",type:"add"}},{block:"button2",mods:{theme:"normal",size:"s",role:"cancel"},text:n.I18N("b-widget","cancel")},{block:"button2",mods:{theme:"action",size:"s",role:"add"},text:n.I18N("b-widget","add")}]}),t})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.elem,s=t.js,o=t.BEM;e("b-widget").mod("type","subpages-change-author")(s()((function(){return{currentUser:this.ctx.currentUser,authors:this.ctx.authors,baseWidgetData:this.ctx.baseWidgetData}})),i("content").content()((function(){return[{elem:"inputs",parentCtx:this.ctx.parentCtx},{elem:"tree"},{elem:"buttons",content:[{block:"spin2",mods:{size:"s",role:"save"}},this.ctx.parentCtx.baseWidgetData?{block:"button2",mods:{size:"m",theme:"normal",role:"back"},text:o.I18N("b-widget","back")}:{block:"button2",mods:{size:"m",theme:"normal",role:"cancel"},text:o.I18N("b-widget","cancel")},{block:"button2",mods:{size:"m",theme:"action",role:"save",disabled:"yes"},text:o.I18N("b-widget","change_authors")}]}]})),i("suggest-from").replace()((function(){return{block:"m-suggest",mods:{type:"b2b",multicomplete:"yes",role:"from"},js:{intranet:!0},url:o.blocks["i-global"].param("hosts").suggest.url,input:{block:"textinput",mix:{block:"m-suggest",elem:"textinput"},mods:{size:"s",theme:"normal",disabled:this.ctx.canEditLeftInput?"":"yes","has-clear":"no"},autocomplete:!1,name:"text",text:this.ctx.canEditLeftInput?"":this.ctx.currentUser.first_name+" "+this.ctx.currentUser.last_name}}})),i("suggest-to").replace()((function(){return{block:"m-suggest",mods:{type:"b2b",multicomplete:"yes",role:"to"},js:{intranet:!0},url:o.blocks["i-global"].param("hosts").suggest.url,input:{block:"textinput",mix:{block:"m-suggest",elem:"textinput"},mods:{size:"s",theme:"normal","has-clear":"no"},autocomplete:!1,name:"text",text:""}}})),i("inputs").content()((function(){var t=this.ctx.parentCtx.currentUser,e=t.is_admin||this.ctx.parentCtx.authors.some((function(e){return e.login===t.login}));return[{elem:"suggest-from",currentUser:t,canEditLeftInput:e},{elem:"change-to",content:o.I18N("b-widget","change-to")},{elem:"suggest-to"}]})))}},function(t,e){t.exports=function(t){var e=t.applyNext,i=t.block,s=t.js;i("m-suggest").mod("type","b2b")(s()((function(){var t=e()||{},i=Object.assign({},t.addRequestParams,{org_id:this["i-global"].orgId});return Object.assign({},t,{addRequestParams:i})})))}},function(t,e,i){t.exports=function(t){var e=t.block,s=t.content,o=t.elem,n=t.match,a=t.BEM;e("b-wiki-tree")(n((function(){return!this.ctx.replaced})).replace()((function(){var t=this.ctx,e=t.mods||{};return t.js.data&&t.js.data.nomark&&(e.nomark="yes"),t.replaced=!0,t.mods=e,t})),s()((function(){var t=this.ctx.js.totalData||this.ctx.totalData,e=t.page;return[{elem:"head",content:[{elem:"title",content:[a.I18N("b-wiki-tree","cluster_tree")+" ",{block:"link",url:e.url,content:{html:i(264)(e.title||e.cluster)}}]},t.expand_all_url&&{elem:"expand-all",content:[{block:"button2",mods:{theme:"normal",size:"s",role:"expand-all"},text:a.I18N("b-wiki-tree","expand_all")},t.limit_exceeded&&{elem:"not-full-loaded"}]}]},{block:"spin2",mods:{size:"xxs",type:"update-tree"}},{elem:"tree",content:t.subpages&&t.subpages.map((function(t){return{block:"b-wiki-tree-page",mods:{expandable:t.expand_url||t.subpages.length?"yes":"",expanded:t.subpages.length?"yes":"","data-loaded":t.subpages.length?"yes":"",type:t.page.type.toLowerCase()},data:t}}))}]})),o("not-full-loaded").content()((function(){return a.I18N("b-wiki-tree","not_full_loaded")})),o("full-loaded").content()((function(){return a.I18N("b-wiki-tree","full_loaded")})))}},,,,,function(t,e,i){t.exports=function(t){var e=t.block,s=t.content,o=t.elem,n=t.js,a=t.BEM;e("b-wiki-tree-page")(n()((function(){return{data:this.ctx.data}})),s()((function(){return[{elem:"expand"},{elem:"content",data:this.ctx.data}]})),o("content").content()((function(){var t=this.ctx.data,e=t.page.type.toLowerCase(),s=t.page.url;return"n"===e&&(s+="/.create"),[{elem:"self",content:[{block:"link",mods:{type:e},url:s,content:{html:i(264)(t.page.title||t.page.cluster)}},{elem:"type-icon"},t.page.authors&&{elem:"authors",authors:t.page.authors},{elem:"created",time:t.page.created_at},{elem:"modified",time:t.page.modified_at},t.page.files&&{elem:"files",files:t.page.files}]},{elem:"children",subpages:t.subpages}]})),o("authors").replace()((function(){var t=this.ctx.authors;return t&&t.map((function(e,i){return e.display=e.login,[{block:"w-username",user:e},i!==t.length-1?",":""]}))})),o("created").match((function(){return this.ctx.time})).content()((function(){return a.I18N("b-wiki-tree-page","created")+": "+this["mi-helpers"].dateFormat(new Date(1e3*this.ctx.time))})),o("created").match((function(){return!this.ctx.time})).replace()(""),o("modified").match((function(){return this.ctx.time})).content()((function(){return a.I18N("b-wiki-tree-page","modified")+": "+this["mi-helpers"].dateFormat(new Date(1e3*this.ctx.time))})),o("modified").match((function(){return!this.ctx.time})).replace()(""),o("files").content()((function(){var t=this.ctx.files;return[{elem:"left-bracket"},t.slice(0,2).map((function(e,i){return[{elem:"file",data:e},!(i===t.length-1)&&","]})),t.length>2&&" ...",{elem:"right-bracket"}]})),o("file").content()((function(){return[{block:"awesome-icon",mods:{icon:"file"}},{block:"link",mods:{type:"file"},url:this.ctx.data.url,content:this.ctx.data.name}]})),o("left-bracket").content()("("),o("right-bracket").content()(")"),o("children").content()((function(){return this.ctx.subpages&&this.ctx.subpages.map((function(t){return{block:"b-wiki-tree-page",mods:{expandable:t.expand_url||t.subpages.length?"yes":"",expanded:t.subpages.length?"yes":"","data-loaded":t.subpages.length?"yes":"",type:t.page.type.toLowerCase()},data:t}}))})))}},function(t,e){t.exports=function(t){(0,t.block)("b-wiki-tree-page").mod("type","c").elem("type-icon").content()({block:"awesome-icon",mods:{icon:"lock"}})}},function(t,e){t.exports=function(t){(0,t.block)("b-wiki-tree-page").mod("type","r").elem("type-icon").content()({block:"awesome-icon",mods:{icon:"share"}})}},function(t,e){t.exports=function(t){(0,t.block)("b-wiki-tree-page").mod("type","g").elem("type-icon").content()({block:"awesome-icon",mods:{icon:"table"}})}},function(t,e){t.exports=function(t){var e=t.block,i=t.elem,s=t.js,o=t.BEM;e("b-widget").mod("type","tree")(s()(!0),i("content").content()((function(){var t=this.ctx.parentCtx;return[{elem:"header",content:o.I18N("b-widget","subpages")+" "+(t.data.page.title||t.data.page.cluster)},{block:"b-wiki-tree",js:{totalData:this.ctx.parentCtx.data,data:{nomark:!0}}},{elem:"buttons",content:[{block:"button2",mods:{theme:"normal",size:"s",role:"back"},text:o.I18N("b-widget","back")},{elem:"right-buttons",content:{block:"button2",mods:{theme:"normal",size:"s",role:"close"},text:o.I18N("b-widget","close")}}]}]})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.elem,s=t.js,o=t.BEM;e("b-widget").mod("type","redirect-message")(s()(!0),i("content").content()((function(){return[{elem:"message",content:o.I18N("b-widget","operation_for_redirect")},{elem:"buttons",content:[{block:"button2",mods:{size:"m",role:"cancel",theme:"normal"},text:o.I18N("b-widget","cancel")},{block:"button2",mods:{size:"m",theme:"action",role:"settings"},text:o.I18N("b-widget","remove_redirect")}]}]})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.BEM;e("w-page-info").mod("type","possibly-obsolete").elem("content").content()((function(){return[i.I18N("w-page-info","possible_obsolete_notification"),{block:"button2",mods:{size:"xs",theme:"normal"},mix:[{block:"w-action",mods:{type:"old-page"},js:{actuality:"actual"}}],text:i.I18N("w-page-info","not_actual")},{block:"button2",mods:{theme:"normal",size:"xs"},mix:[{block:"w-action",mods:{type:"old-page"},js:{actuality:"obsolete"}}],text:i.I18N("w-page-info","actual")}]}))}},function(t,e){t.exports=function(t){var e=t.block,i=t.BEM;e("w-page-info").mod("type","redirect").elem("content").content()((function(){return[{block:"awesome-icon",mods:{icon:"lock"}},i.I18N("w-page-info","redirect-message"),{block:"button2",mods:{theme:"normal",size:"xs",role:"settings"},text:i.I18N("w-page-info","remove_redirect")}]}))}},function(t,e){t.exports=function(t){var e=t.block,i=t.BEM;e("w-page-info").mod("type","redirected-from").elem("content").content()((function(){return[i.I18N("w-page-info","redirected")+" ",{block:"link",url:this.xmlEscape(this.ctx.parentCtx.url)+"?noredirect",content:decodeURIComponent(this.ctx.parentCtx.url)}]}))}},function(t,e){t.exports=function(t){var e=t.attrs,i=t.block,s=t.tag;i("select-multiple")(s()("select"),e()((function(){return{name:this.ctx.name,multiple:"multiple"}}))),i("select-multiple").elem("option").tag()("option")}},function(t,e){t.exports=function(t){var e=t.block,i=t.BEM;e("b-favs-widget").content()((function(){return[{elem:"paranja"},{elem:"content",content:[{block:"b-favs-folders",js:!0},{block:"b-favs-links",js:!0},{block:"button2",mods:{theme:"normal",size:"m"},mix:[{block:"b-readonly-item",js:!0},{block:"b-favs-options-button",js:!0}],text:i.I18N("b-favs-widget","settings")}]}]}))}},function(t,e){t.exports=function(t){var e=t.block;e("b-favs-folders").content()({block:"scroll",mods:{theme:"normal",tech:"js"},content:[{block:"spin2",mods:{size:"xs",show:"no"}},{block:"b-favs-folders",elem:"list",content:[]}]}),e("b-favs-folders").elem("list").tag()("ol"),e("b-favs-folders").elem("item").tag()("li")}},function(t,e){t.exports=function(t){var e=t.block;e("b-favs-folder").elem("name").tag()("span"),e("b-favs-folder").elem("count").tag()("span")}},function(t,e){t.exports=function(t){var e=t.block,i=t.BEM;e("b-favs-links").content()((function(){return[{block:"spin2",mods:{size:"xs",show:"no",type:"load"}},{block:"input",mods:{size:"m",theme:"lite",type:"filter"},placeholder:i.I18N("b-favs-links","name_search"),content:{elem:"control"}},{block:"scroll",mods:{theme:"normal",tech:"js"},content:{block:"b-favs-links",elem:"list",content:[]}}]})),e("b-favs-links").elem("list").tag()("ol"),e("b-favs-links").elem("item").tag()("li")}},function(t,e){t.exports=function(t){var e=t.block,i=t.BEM;e("b-favs-link").elem("date").match((function(){return this.ctx.timestamp})).content()((function(){var t=i.blocks["mi-helpers"].getDateFromHumanString(this.ctx.timestamp),e=function(t){return t<10?"0"+t:t};return[e(t.getDate()),e(t.getMonth()+1),t.getFullYear()].join(".")}))}},function(t,e){t.exports=function(t){var e=t.applyNext,i=t.block,s=t.content,o=t.js,n=t.BEM;i("m-suggest-item").mod("type","cluster-search")(o()((function(){return this.extend(e(),{value:this.ctx.data.cluster})})),s()((function(){return{elem:"info-wrapper",content:[{elem:"selected",content:this.ctx.inputData.text}," - ",n.I18N("m-suggest-item","search-in-cluster")," «"+this.ctx.data.cluster+"»"]}})))}},function(t,e){t.exports=function(t){(0,t.block)("sidebar").mod("full-height","yes").mix()((function(){return[{block:"mi-sticky",mods:{"full-height":"yes"},js:{placeholder:{width:""},offset:{top:0,bottom:0}}}].concat(this.ctx.mix)}))}},function(t,e){t.exports=function(t){var e=t.applyNext,i=t.block,s=t.BEM;i("sidebar").elem("tab").elemMod("type","toc").def()((function(){return e({_label:s.I18N("sidebar","toc-label"),_icon:"list"})}))}},function(t,e){t.exports=function(t){(0,t.block)("sidebar").elem("tab-content").elemMod("tab","toc").content()((function(){return{block:"b-toc",mods:{type:"sidebar"},data:this.ctx.preLoad}}))}},function(t,e){t.exports=function(t){(0,t.block)("link").match((function(){return"string"==typeof this.ctx.content})).content()((function(){return this.xmlEscape(this.ctx.content)}))}},function(t,e){t.exports=function(t){var e=t.block,i=t.BEM;e("w-comment").mod("removed","yes").elem("content").content()((function(){return i.I18N("w-comment","comment_removed")}))}},function(t,e){t.exports=function(t){var e=t.block,i=t.replace,s=t.BEM;e("w-access-button")(i()((function(){return{block:"button2",mods:{theme:"normal",size:"s"},mix:[{block:"w-access-button",mods:this.mods,js:!0}].concat(this.ctx.mix),text:s.I18N("w-access-button","button_type_"+this.mods.type),iconLeft:{mods:{type:"lock"}}}})))}},function(t,e){t.exports=function(t){(0,t.block)("w-attach").elem("drag-hint").tag()("span")}},function(t,e){t.exports=function(t){(0,t.block)("b-grid-table-code").mod("type","sidebar").js()((function(){return this.ctx.js||!0}))}},function(t,e){t.exports=function(t){(0,t.block)("b-widget").mod("type","request-access").elem("content").content()([{block:"b-request-access",mods:{type:"loading"},js:!0,content:[{elem:"content",content:[{block:"spin2",mods:{size:"xs",progress:"yes"}}]},{elem:"buttons",content:[]}]}])}},function(t,e){t.exports=function(t){var e=t.attrs,i=t.block,s=t.elem,o=t.BEM;i("w-page-setting").mod("type","redirect")(e()((function(){return{title:o.I18N("w-page-setting","setup-redirect")}})),s("header").content()((function(){return o.I18N("w-page-setting","redirect")})),s("data-preview").content()((function(){return this.ctx.data||o.I18N("w-page-setting","no-redirect")})),s("form").content()((function(){return[{block:"m-suggest",mods:{type:"cluster",size:"s"},hint:o.I18N("w-page-setting","clusters-search"),value:this.ctx.data},{block:"button2",mods:{theme:"normal",size:"s",disabled:"yes",role:"save-redirect"},text:o.I18N("w-page-setting","save")}]})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.content,s=t.BEM;e("multiple-suggest-item").mod("type","people")(i()((function(){var t=this.ctx.data;return[{block:"w-username",user:t},(t.is_external_employee||"external"===t.affiliation)&&{block:"awesome-icon",mods:{icon:"warning"},attrs:{title:s.I18N("w-access-button","external_user")},mix:{block:this.block,elem:"external-warning"}},this.ctx.active&&{block:"awesome-icon",mods:{icon:"remove"},mix:{block:this.block,elem:"remove"}}]})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.BEM;e("b-widget").mod("type","page-copy").elem("content").content()((function(){var t=this.ctx.parentCtx.js.type;return[["grid"===t&&{elem:"additional-text",content:i.I18N("b-widget","copy_table")},{elem:"current-address-title",content:"grid"===t?i.I18N("b-widget","current_address_table")+":":i.I18N("b-widget","current_address_of_cluster")+":"},{elem:"current-address-url"},{elem:"current-address-page"}],{elem:"current-page"},{elem:"controls",content:[{elem:"current-address-title",elemMods:{type:"subpage"},content:"grid"===t?i.I18N("b-widget","set_page_name_to_copy_table"):i.I18N("b-widget","set_page_name_to_copy_cluster")},{block:"m-suggest",mods:{type:"cluster",size:"s"},inputMods:{size:"m"}},"grid"===t&&{elem:"copy-data",content:{block:"checkbox",mods:{theme:"normal",size:"s",type:"copy-data"},text:i.I18N("b-widget","copy-data")}},{elem:"page-rename",content:[{block:"checkbox",mods:{theme:"normal",size:"s",type:"page-title"},text:"grid"===t?i.I18N("b-widget","rename_table"):i.I18N("b-widget","rename_page")},{elem:"page-rename-controls",content:[{elem:"page-rename-title",content:"grid"===t?i.I18N("b-widget","input_new_table_address"):i.I18N("b-widget","input_new_cluster_address")},{block:"input",js:!0,mods:{size:"s",type:"page-title"},content:{elem:"control"}}]}]}]},{elem:"current-address-title",content:"grid"===t?i.I18N("b-widget","table_new_address")+":":i.I18N("b-widget","cluster_new_address")+":"},{elem:"new-url"},{elem:"new-url-page"},{elem:"buttons",content:[{block:"spin2",mods:{size:"xs",type:"copy-load"}},{block:"button2",mods:{size:"m",role:"copy-cluster-cancel",theme:"normal"},tabindex:1,text:i.I18N("b-widget","cancel")},{block:"button2",mods:{size:"m",role:"copy-cluster",theme:"action"},tabindex:0,text:"grid"===t?i.I18N("b-widget","copy_the_table"):i.I18N("b-widget","copy_the_cluster")}]}]}))}},function(t,e){t.exports=function(t){var e=t.block,i=t.content,s=t.js,o=t.BEM;e("w-grid-preview").mod("great","yes")(s()((function(){return{data:this.ctx.data}})),i()((function(){var t=[],e=this.ctx.data,i=[{elem:"lines-headers",content:[{elem:"line-header",mix:{elem:"to-import"},content:o.I18N("w-grid-preview","importing")},{elem:"line-header",mix:{elem:"col-to-import"},content:o.I18N("w-grid-preview","in_column")},{elem:"line-header",mix:{elem:"data-type"},content:o.I18N("w-grid-preview","data_type")},{elem:"line-header",mix:{elem:"strings-example"},content:o.I18N("w-grid-preview","strings_example")}]},{elem:"table-wrapper",content:{elem:"table",content:t}}],s=0;e.column_data_types.forEach((function(t,e){"string"===t[0]&&(s=e)}));var n="",a=e.column_data_types.map((function(t,e){return e===s&&(n=t[0]),{val:t[0],text:t[1]}}),this);return t.push({elem:"head",content:{elem:"row",content:e.import_columns.map((function(t,e){return{elem:"col",elemMods:{index:e,head:"yes"},content:{block:"checkbox",mods:{theme:"normal",size:"s",index:e,checked:"yes"},text:t.title}}}),this)}}),t.push({elem:"row",content:e.import_columns.map((function(t,i){return{elem:"col",elemMods:{index:i,body:"yes"},content:[{block:"select2",mods:{size:"s",theme:"normal",type:"radiocheck",role:"col-to-import",index:i,text:"vary"},val:"new",text:o.I18N("w-grid-preview","new"),items:[{val:"new",text:o.I18N("w-grid-preview","new")}].concat(e.existing_columns.map((function(t){return{val:t[0],text:t[1]}})))},{block:"select2",mods:{size:"s",theme:"normal",role:"data-type",type:"radiocheck",text:"vary"},text:e.column_data_types[s][1],val:n,items:a},{elem:"existing-rows",content:e.existing_rows.map((function(t){var e=t[i].value;return e?JSON.parse(e):{elem:"preview-item"}}),this)},{elem:"imported-rows",content:e.imported_rows.map((function(t){var e=t[i].value;return e?JSON.parse(e):{elem:"preview-item"}}),this)}]}}),this)}),i})))}},function(t,e){t.exports=function(t){(0,t.block)("b-wiki-tree-page").mod("expandable","yes").elem("expand").content()([{block:"awesome-icon",mods:{type:"expand",icon:"angle-right"}},{block:"awesome-icon",mods:{type:"unexpand",icon:"angle-down"}},{block:"spin2",mods:{size:"xxs",type:"expand"}}])}},function(t,e){t.exports=function(t){(0,t.block)("b-wiki-tree-page").mod("type","n").elem("type-icon").content()({block:"awesome-icon",mods:{icon:"plus-circle"}})}},function(t,e){t.exports=function(t){(0,t.block)("w-page-info").mod("important","yes").elem("right").content()("")}},function(t,e){t.exports=function(t){var e=t.block,i=t.BEM;e("w-page-info").mod("type","dismissed-authors").elem("content").content()((function(){return[i.I18N("w-page-info",this.ctx.parentCtx.single?"dismissed_author_message":"dismissed_authors_message"),{block:"button2",mods:{theme:"normal",size:"xs",role:"get-authorship"},text:i.I18N("w-page-info","dismissed_authors_get_authorship")}]}))}},function(t,e){t.exports=function(t){(0,t.block)("popup").mod("related","panel").match((function(){return!this.ctx.replaced})).replace()((function(){var t=this.ctx;return t.content=t.content[1]?t.content[1]:"",t.replaced=!0,t.js={directions:[{to:"bottom",axis:"left",offset:{top:11}}]},t}))}},function(t,e){t.exports=function(t){var e=t.applyNext;(0,t.block)("m-head-action").content()((function(){var t=e();return t.mix=t.mix||[],t.mix=Array.isArray(t.mix)?t.mix:[t.mix],t.mix.push({block:"b-readonly-item",js:!0}),t.mods=t.mods||{},t.mods.type="new-page",t.mods.pseudo="yes",t}))}},function(t,e){t.exports=function(t){var e=t.block,i=t.mode;e("m-popup").mod("drafts","yes")(i("buttons")((function(){})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.elem,s=t.js,o=t.replace,n=t.BEM;e("w-old-page-mark")(s()(!0),o()({block:"link",mods:{theme:"normal",pseudo:"yes"},mix:{block:"w-old-page-mark",js:!0},content:[{block:"icon",mods:{type:"info"}},{elem:"text",tag:"span",content:n.I18N("w-old-page-mark","old_page")}]}),i("popup-content").replace()((function(t){var e=t.ctx.data,i=e.marked_at,s=e.user,o=e.comment,a=e.links,r=[];return i&&s&&r.push({block:"w-old-page-mark",elem:"user-date",content:[{block:"w-username",user:s},": "+n.I18N("w-old-page-mark","marked_obsolete")+" ",{block:"m-date",format:"full",timestamp:i}]}),o&&r.push({block:"w-old-page-mark",elem:"comment",content:o}),a&&a.length&&(r.push({block:"w-old-page-mark",elem:"links-title",content:n.I18N("w-old-page-mark","actual_pages")+":"}),a.forEach((function(t){r.push({block:"w-old-page-mark",elem:"link",content:{block:"link",mods:{theme:"normal"},url:t,text:t}})}))),r.push({block:"w-old-page-mark",elem:"button",content:{block:"button2",mods:{size:"s",role:"unmark",theme:"normal"},mix:[{block:"w-action",mods:{type:"old-page"},js:{actuality:"obsolete"}}],text:n.I18N("w-old-page-mark","unmark")}}),r})))}},function(t,e){t.exports=function(t){var e=t.apply,i=t.block,s=t.js,o=t.mode,n=t.replace,a=t.BEM;i("w-fav-button")(s()(!0),o("button-text")(a.I18N("w-fav-button","to_fav")),o("icon-type")("bookmark-o"),n()((function(t){return{block:"button2",mods:{theme:"normal",size:"s","small-screen-shrink":"yes"},mix:[{block:"w-fav-button",mods:t.mods,js:!0},{block:"w-mixed-tooltip",js:{screenWidthToShow:1200,tooltip:{block:"tooltip",mods:{size:"s",theme:"normal"},js:{to:"bottom"},content:e("button-text")}}}].concat(t.ctx.mix),text:e("button-text"),iconLeft:{mods:{type:e("icon-type")}}}})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.replace,s=t.BEM;e("w-subscribe-button")(i()((function(t){var e=s.I18N("w-subscribe-button","button_type_"+t.mods.type);return{block:"dropdown2",mods:{switcher:"button2",theme:"normal",autoclosable:"yes",role:"subscribe"},mix:[{block:"w-subscribe-button",mods:t.mods,js:!0},{block:"w-mixed-tooltip",js:{screenWidthToShow:1200,tooltip:{block:"tooltip",mods:{size:"s",theme:"normal"},js:{to:"bottom"},content:e}}}].concat(t.ctx.mix),switcher:{block:"button2",mods:{theme:"normal",size:"s","small-screen-shrink":"yes"},text:e,iconLeft:{mods:{type:"eye-main"}}},popup:{block:"popup2",mods:{role:"subscribe"},directions:["bottom-right"],content:{block:"menu",mods:{type:"radio",theme:"normal",size:"m",view:"classic"},val:t.mods.type,items:[{icon:{mods:{type:"eye"}},text:s.I18N("w-subscribe-button","item_page"),val:"page"},{icon:{mods:{type:"eye"}},text:s.I18N("w-subscribe-button","item_cluster"),val:"cluster"},{icon:{mods:{type:"eye-slash"}},text:s.I18N("w-subscribe-button","item_none"),val:"none"}]}}}})))}},function(t,e){t.exports=function(t){var e=t.applyNext;(0,t.block)("m-editor").mod("split",!0).content()((function(){var t=e();return Object.assign({},t,{attrs:{id:"split-editor"},cls:"split"})}))}},function(t,e){t.exports=function(t){var e=t.block,i=t.BEM;e("b-widget").mod("type","page-move").elem("content").content()((function(){var t=this.ctx.parentCtx.js.type;return[[{elem:"additional-text",content:"grid"===t?i.I18N("b-widget","move_table"):i.I18N("b-widget","move_page")},{elem:"current-address-title",content:"grid"===t?i.I18N("b-widget","current_address_table"):i.I18N("b-widget","current_address_of_cluster")},{elem:"current-state",content:[{elem:"current-address-url"},{elem:"current-address-page"}]}],{elem:"current-page"},{elem:"controls",content:[{elem:"current-address-title",elemMods:{type:"subpage"},content:"grid"===t?i.I18N("b-widget","set_page_name_to_move_table"):i.I18N("b-widget","set_page_name_to_move_cluster")},{block:"m-suggest",mods:{type:"cluster",size:"s"},inputMods:{size:"m"}},{elem:"current-address-subpages",content:{block:"checkbox",mods:{theme:"normal",size:"s",checked:"yes",type:"clusters"},text:""}},{elem:"page-rename",content:[{block:"checkbox",mods:{theme:"normal",size:"s",type:"page-title"},text:"grid"===t?i.I18N("b-widget","rename_table"):i.I18N("b-widget","rename_page")},{elem:"page-rename-controls",content:[{elem:"page-rename-title",content:"grid"===t?i.I18N("b-widget","input_new_table_address"):i.I18N("b-widget","input_new_cluster_address")},{block:"input",js:!0,mods:{size:"s",type:"page-title"},content:{elem:"control"}}]}]}]},{elem:"current-address-title",content:"grid"===t?i.I18N("b-widget","table_new_address"):i.I18N("b-widget","cluster_new_address")},{elem:"new-url"},{elem:"new-url-page"},{elem:"buttons",content:[{block:"spin2",mods:{size:"xs",type:"move-load"}},{block:"button2",mods:{theme:"normal",size:"m",role:"move-cluster-cancel"},tabindex:1,text:i.I18N("b-widget","cancel")},{block:"button2",mods:{size:"m",role:"move-cluster",theme:"action"},tabindex:0,text:"grid"===t?i.I18N("b-widget","move_the_table"):i.I18N("b-widget","move_the_cluster")}]}]}))}},function(t,e){t.exports=function(t){var e=t.applyNext;(0,t.block)("m-head-search").match((function(){return this.ctx.search&&this.ctx.search.supertag&&"/"!==this.ctx.search.pathname})).content()((function(){var t=e();return t.content.push({elem:"hidden",attrs:{type:"hidden",name:"from.cluster",value:this.ctx.search.supertag},tag:"input"}),t}))}},function(t,e){t.exports=function(t){var e=t.block,i=t.content,s=t.js,o=t.BEM;e("m-head-search")(s()((function(){return!0})),i()((function(){return{elem:"search",attrs:{action:this.ctx.search&&this.ctx.search.action||"https://search.yandex-team.ru/search",autocomplete:"off"},content:[{block:"m-suggest",js:this.ctx.search.clusterSearch?{pathname:this.ctx.search.pathname}:{},mods:{type:"intranet-suggest",size:"s"},mix:{block:this.block,elem:"field"},inputMods:{size:"m"},hint:this.ctx.search.hint||o.I18N("m-head-search","hint"),inHeader:!0,types:this.ctx.search.suggest&&this.ctx.search.suggest.types||["staff"],url:this.ctx.search.suggest&&this.ctx.search.suggest.url||null},{block:"button2",mix:{block:this.block,elem:"button"},mods:{size:"m",theme:"normal",type:"submit",pin:"clear-round"},tabindex:2,text:o.I18N("m-head-search","find")},this.ctx.search&&this.ctx.search.formParams&&{elem:"form-params",params:this.ctx.search.formParams}]}})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.content,s=t.elem,o=t.js,n=t.oninit,a=t.BEM;n((function(t){t.BEMContext.prototype["w-page-main-info"]={getFirstAuthor:function(t){var e,i=t.sort((function(t,e){return t.uid>e.uid})),s=i[i.length-1];if(i.length>1)for(e=i.length-2;e>=0;e--)i[e].is_dismissed||(s=i[e]);return s}}})),e("w-page-main-info")(o()(!0),i()((function(t){var e=t.ctx.isOfficial,i=t["w-page-main-info"].getFirstAuthor(t.ctx.authors);return[{elem:"left",isOfficial:e,firstAuthor:i},{elem:"right",content:[{elem:"first-author",isOfficial:e,firstAuthor:i,authors:t.ctx.authors},{elem:"modified",isOld:t.ctx.isOld,modifiedAt:t.ctx.modifiedAt}]}]})),s("left").content()((function(t){var e=t.ctx.firstAuthor||t["w-page-main-info"].getFirstAuthor(t.ctx.authors);return t.ctx.isOfficial?{elem:"official-pic",mix:{elem:"avatar"}}:{block:"w-userpic",mix:{block:"w-page-main-info",elem:"avatar"},size:32,user:e}})),s("first-author").content()((function(t){return[{block:"w-page-main-info",elem:"first-author-link",isOfficial:t.ctx.isOfficial,firstAuthor:t.ctx.firstAuthor,authors:t.ctx.authors},{block:"link",mix:{block:"w-page-main-info",elem:"open-authors"},mods:{theme:"black",pseudo:"yes"},content:{block:"awesome-icon",mods:{icon:"angle-down",role:"show-authors"}}}]})),s("first-author-link").replace()((function(t){return t.ctx.isOfficial?{block:"link",mix:[{block:"w-page-main-info",elem:"first-author-link"},{block:"w-page-official",js:!0}],mods:{theme:"black",pseudo:"yes"},text:a.I18N("w-page-main-info","official_page")}:{block:"w-username",mix:{block:"w-page-main-info",elem:"first-author-link"},user:t.ctx.firstAuthor||t["w-page-main-info"].getFirstAuthor(t.ctx.authors)}})),s("modified").content()((function(t){return t.ctx.isOld?{block:"w-old-page-mark"}:{elem:"updated",modifiedAt:t.ctx.modifiedAt}})),s("updated").content()((function(t){return[a.I18N("w-page-main-info","updated")+" ",t["mi-helpers"].dateFormat(t.ctx.modifiedAt,"d mmmm, yyyy в HH:MM").toLowerCase()]})))}},function(t,e){t.exports=function(t){var e=t.block,i=t.mode,s=t.BEM;e("w-fav-button").mod("fav","yes")(i("button-text")(s.I18N("w-fav-button","in_fav")),i("icon-type")("bookmark"))}},function(t,e){t.exports=function(t){(0,t.block)("b-footer").js()(!0)}},function(t,e){t.exports=function(t){var e=t.applyNext,i=t.block,s=t.content;i("attach").mod("role","export-page")(s()((function(){return[e(),{elem:"desc",content:"Страница будет создана из документа"},{block:"tooltip",mods:{size:"s",theme:"error",type:"attach"}}]})))}},function(t,e){t.exports=function(t){(0,t.block)("m-head-menu").elem("item").match((function(){return this.ctx.customParams&&this.ctx.customParams.favs})).replace()((function(){return{elem:"item",mix:{block:"b-favs",js:!0},content:this.ctx.content[0]||this.ctx.content}}))}},function(t,e){t.exports=function(t){var e=t.block,i=t.elem,s=t.js,o=t.BEM;e("w-page-panel")(s()((function(t,e){return{editUrl:e.editUrl}})),i("access").replace()((function(t){var e=t.ctx.data.type;return"inherited"===e&&(e=t.ctx.data.parent_access),t.ctx.data.opened_to_external_flag&&(e="restricted-with-external"),{block:"w-access-button",mods:{type:e},mix:{block:"w-page-panel",elem:"access"}}})),i("fav").replace()((function(t){return{block:"w-fav-button",mods:{fav:t.ctx.isFav?"yes":""},mix:{block:"w-page-panel",elem:"fav"}}})),i("edit").replace()((function(t,e){var i=e.canEdit,s=e.editUrl,n="",a={block:"button2",mods:{theme:"normal",size:"s",disabled:i?"":"yes",role:"edit-page"},js:{type:"edit"},mix:[{block:"w-page-panel",elem:"edit"}],iconLeft:{mods:{type:"pencil"}}};return s?(a.mods.type="link",a.url=s,a.target="_blank",n=o.I18N("w-page-panel","edit-in-cloud")):(a.mix.push({block:"w-action",mods:{type:"edit",theme:"normal"},js:!0}),n=o.I18N("w-page-panel","edit")),i||(n=o.I18N("w-page-panel","readonly")),a.text=n,a})))}},function(t,e){t.exports=function(t){var e=t.apply,i=t.applyNext,s=t.block,o=t.content,n=t.elem,a=t.mode,r=t.BEM;s("b-widget").mod("type","new-page")(n("content")(a("type-radio-items")([{elem:"radio",controlAttrs:{value:"page"},content:r.I18N("b-widget","page")},{elem:"radio",controlAttrs:{value:"grid"},content:r.I18N("b-widget","grid")},{elem:"radio",controlAttrs:{value:"note"},content:r.I18N("b-widget","note")}]),o()((function(){var t=i();return Array.isArray(t)||(t=[t]),t.push({elem:"label",content:r.I18N("b-widget","create_page")},{block:"radio-button",mods:{theme:"normal",size:"m",type:"new-page"},name:"new-page",value:"page",content:e("type-radio-items")},{elem:"page-title",content:[{elem:"field-label",content:r.I18N("b-widget","page_title")},{block:"input",mods:{theme:"normal",size:"s",type:"new-page-title"},content:{elem:"control"}}]},{elem:"page-address",content:[{elem:"field-label",content:r.I18N("b-widget","page_address")},{elem:"field",content:[{block:"input",mods:{theme:"normal",size:"s",type:"new-page-url"},content:{elem:"control"}},{block:"select2",mods:{type:"radio",text:"vary",theme:"normal",size:"s",role:"cluster-type",width:"fixed"},text:r.I18N("b-widget","sub"),items:["sub","cluster","root"].map((function(t){return{val:t,text:r.I18N("b-widget",t)}}))}]},{elem:"description"}]},{elem:"note",content:[{elem:"field-label",content:r.I18N("b-widget","note_text")},{block:"input",mods:{size:"s",type:"textarea",role:"note"},content:[{elem:"control",attrs:{placeholder:r.I18N("b-widget","note-placeholder")}}]}]},{elem:"attach",content:[{elem:"field-label",mix:{elem:"attach"},content:r.I18N("b-widget","create_page_from_doc")},{elem:"attach",content:[{block:"attach",mods:{theme:"normal",size:"s",use:"button2",role:"import-page"},text:r.I18N("b-widget","import"),controlAttrs:{accept:".docx,.txt"},button:{iconLeft:{mods:{type:"file",direction:"bottom"}}},holder:r.I18N("b-widget","only_supported_formats")}]}]},e("ms"),{elem:"buttons",content:[{block:"spin2",mods:{size:"xxs",type:"create-load"}},{block:"button2",mods:{size:"s",role:"new-page-cancel",theme:"normal"},tabindex:1,text:r.I18N("b-widget","cancel_new")},{block:"button2",mods:{size:"s",theme:"action",role:"new-page-save"},tabindex:0,text:r.I18N("b-widget","create")}]}),t}))))}},function(t,e){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}t.exports=function(t){var e=t.block,s=t.content,o=t.js,n=t.tag;e("m-head")(n()("header"),o()(!0),s()((function(){var t=null!==this.ctx.notifier&&"object"===i(this.ctx.notifier);return[{block:"m-head-arrow",mix:[{block:"m-head",elem:"min"}],js:{type:this.ctx.service||"none",host:this.ctx.navigationApiHost},title:this.ctx.title||"Service Name"},{block:this.blockName,elem:"main",content:this.ctx.menuItems&&{block:"m-head-menu",mods:{type:"main"},headTypeMod:this.ctx.mods&&this.ctx.mods.type,menuItems:this.ctx.menuItems}},this.ctx.action&&{block:"m-head-action",mix:[{block:"m-head",elem:"min"}],action:this.ctx.action},this.ctx.search&&{block:"m-head-search",mix:[{block:"m-head",elem:"min"}],search:this.ctx.search},{block:"m-head",elem:"right",content:[!1!==this.ctx.messenger&&{block:"m-head",elem:"min",content:{block:"messenger",js:this.ctx.messenger,mods:{internal:"yes"}}},t&&{block:"m-head",elem:"min",content:{block:"notifier",mix:[{block:"m-head",elem:"notifier"}],mods:{"has-close":"yes",size:"m"},js:this.ctx.notifier}},{block:"m-head-user",user:this.ctx.user,customUserLinks:this.ctx.customUserLinks}]}]})))}},,,,,function(t,e,i){var s,o,n;n=this,s=[i(48)],void 0===(o=function(t){return n.returnExportsGlobal=function(t){"use strict";var e,i,s,o,n,a,r,l;e=function(){function e(t){this.$inputor=t,this.domInputor=this.$inputor[0]}return e.prototype.setPos=function(t){var e,i,s,o;return(o=r.getSelection())&&(s=0,i=!1,(e=function(t,n){var r,l,c,d,h,u;for(u=[],c=0,d=(h=n.childNodes).length;c<d&&(r=h[c],!i);c++)if(3===r.nodeType){if(s+r.length>=t){i=!0,(l=a.createRange()).setStart(r,t-s),o.removeAllRanges(),o.addRange(l);break}u.push(s+=r.length)}else u.push(e(t,r));return u})(t,this.domInputor)),this.domInputor},e.prototype.getIEPosition=function(){return this.getPosition()},e.prototype.getPosition=function(){var t,e;return e=this.getOffset(),t=this.$inputor.offset(),e.left-=t.left,e.top-=t.top,e},e.prototype.getOldIEPos=function(){var t,e;return e=a.selection.createRange(),(t=a.body.createTextRange()).moveToElementText(this.domInputor),t.setEndPoint("EndToEnd",e),t.text.length},e.prototype.getPos=function(){var t,e,i;return(i=this.range())?((t=i.cloneRange()).selectNodeContents(this.domInputor),t.setEnd(i.endContainer,i.endOffset),e=t.toString().length,t.detach(),e):a.selection?this.getOldIEPos():void 0},e.prototype.getOldIEOffset=function(){var t,e;return(t=a.selection.createRange().duplicate()).moveStart("character",-1),{height:(e=t.getBoundingClientRect()).bottom-e.top,left:e.left,top:e.top}},e.prototype.getOffset=function(e){var i,s,o,n,l;return r.getSelection&&(o=this.range())?(o.endOffset-1>0&&o.endContainer!==this.domInputor&&((i=o.cloneRange()).setStart(o.endContainer,o.endOffset-1),i.setEnd(o.endContainer,o.endOffset),s={height:(n=i.getBoundingClientRect()).height,left:n.left+n.width,top:n.top},i.detach()),s&&0!==(null!=s?s.height:void 0)||(i=o.cloneRange(),l=t(a.createTextNode("|")),i.insertNode(l[0]),i.selectNode(l[0]),s={height:(n=i.getBoundingClientRect()).height,left:n.left,top:n.top},l.remove(),i.detach())):a.selection&&(s=this.getOldIEOffset()),s&&(s.top+=t(r).scrollTop(),s.left+=t(r).scrollLeft()),s},e.prototype.range=function(){var t;if(r.getSelection)return(t=r.getSelection()).rangeCount>0?t.getRangeAt(0):null},e}(),i=function(){function e(t){this.$inputor=t,this.domInputor=this.$inputor[0]}return e.prototype.getIEPos=function(){var t,e,i,s,o,n;return e=this.domInputor,s=0,(o=a.selection.createRange())&&o.parentElement()===e&&(i=e.value.replace(/\r\n/g,"\n").length,(n=e.createTextRange()).moveToBookmark(o.getBookmark()),(t=e.createTextRange()).collapse(!1),s=n.compareEndPoints("StartToEnd",t)>-1?i:-n.moveStart("character",-i)),s},e.prototype.getPos=function(){return a.selection?this.getIEPos():this.domInputor.selectionStart},e.prototype.setPos=function(t){var e,i;return e=this.domInputor,a.selection?((i=e.createTextRange()).move("character",t),i.select()):e.setSelectionRange&&e.setSelectionRange(t,t),e},e.prototype.getIEOffset=function(t){var e;return e=this.domInputor.createTextRange(),t||(t=this.getPos()),e.move("character",t),{left:e.boundingLeft,top:e.boundingTop,height:e.boundingHeight}},e.prototype.getOffset=function(e){var i,s,o;return i=this.$inputor,a.selection?((s=this.getIEOffset(e)).top+=t(r).scrollTop()+i.scrollTop(),s.left+=t(r).scrollLeft()+i.scrollLeft(),s):(s=i.offset(),o=this.getPosition(e),{left:s.left+o.left-i.scrollLeft(),top:s.top+o.top-i.scrollTop(),height:o.height})},e.prototype.getPosition=function(t){var e,i,o,n,a;return e=this.$inputor,o=function(t){return t=t.replace(/<|>|`|"|&/g,"?").replace(/\r\n|\r|\n/g,"<br/>"),/firefox/i.test(navigator.userAgent)&&(t=t.replace(/\s/g,"&nbsp;")),t},void 0===t&&(t=this.getPos()),a=e.val().slice(0,t),i=e.val().slice(t)||".",n="<span style='position: relative; display: inline;'>"+o(a)+"</span>",n+="<span id='caret' style='position: relative; display: inline;'>"+o(i)+"</span>",new s(e).create(n).rect()},e.prototype.getIEPosition=function(t){var e,i;return i=this.getIEOffset(t),e=this.$inputor.offset(),{left:i.left-e.left,top:i.top-e.top,height:i.height}},e}(),s=function(){function e(t){this.$inputor=t}return e.prototype.css_attr=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopStyle","borderRightStyle","borderBottomStyle","borderLeftStyle","borderTopWidth","boxSizing","fontFamily","fontSize","fontWeight","height","letterSpacing","lineHeight","marginBottom","marginLeft","marginRight","marginTop","outlineWidth","overflow","overflowX","overflowY","paddingBottom","paddingLeft","paddingRight","paddingTop","textAlign","textOverflow","textTransform","whiteSpace","wordBreak","wordWrap"],e.prototype.mirrorCss=function(){var e,i=this;return e={position:"absolute",left:-9999,top:0,zIndex:-2e4},"TEXTAREA"===this.$inputor.prop("tagName")&&this.css_attr.push("width"),t.each(this.css_attr,(function(t,s){return e[s]=i.$inputor.css(s)})),e},e.prototype.create=function(e){return this.$mirror=t("<div></div>"),this.$mirror.css(this.mirrorCss()),this.$mirror.html(e),this.$inputor.after(this.$mirror),this},e.prototype.rect=function(){var t,e,i;return t=this.$mirror[0].getBoundingClientRect(),i={left:(e=this.$mirror.find("#caret")[0].getClientRects()[0]).left-t.left,top:e.top-t.top,height:e.height},this.$mirror.remove(),i},e}(),o={contentEditable:function(t){return!(!t[0].contentEditable||"true"!==t[0].contentEditable)}},n={pos:function(t){return t||0===t?this.setPos(t):this.getPos()},position:function(t){return a.selection?this.getIEPosition(t):this.getPosition(t)},offset:function(t){var e;return e=this.getOffset(t),e}},a=null,r=null,l=function(t){var e;return(e=null!=t?t.iframe:void 0)?(r=e.contentWindow,a=e.contentDocument||r.document):(r=window,a=document)},t.fn.caret=function(s,a,r){var c;return n[s]?(t.isPlainObject(a)?(l(a),a=void 0):l(r),c=o.contentEditable(this)?new e(this):new i(this),n[s].apply(c,[a])):t.error("Method "+s+" does not exist on jQuery.caret")},t.fn.caret.EditableCaret=e,t.fn.caret.InputCaret=i,t.fn.caret.Utils=o,t.fn.caret.apis=n}(t)}.apply(e,s))||(t.exports=o)},function(t,e){!function(){function t(t,e){var a=t[0],r=t[1],l=t[2],c=t[3];a=i(a,r,l,c,e[0],7,-680876936),c=i(c,a,r,l,e[1],12,-389564586),l=i(l,c,a,r,e[2],17,606105819),r=i(r,l,c,a,e[3],22,-1044525330),a=i(a,r,l,c,e[4],7,-176418897),c=i(c,a,r,l,e[5],12,1200080426),l=i(l,c,a,r,e[6],17,-1473231341),r=i(r,l,c,a,e[7],22,-45705983),a=i(a,r,l,c,e[8],7,1770035416),c=i(c,a,r,l,e[9],12,-1958414417),l=i(l,c,a,r,e[10],17,-42063),r=i(r,l,c,a,e[11],22,-1990404162),a=i(a,r,l,c,e[12],7,1804603682),c=i(c,a,r,l,e[13],12,-40341101),l=i(l,c,a,r,e[14],17,-1502002290),a=s(a,r=i(r,l,c,a,e[15],22,1236535329),l,c,e[1],5,-165796510),c=s(c,a,r,l,e[6],9,-1069501632),l=s(l,c,a,r,e[11],14,643717713),r=s(r,l,c,a,e[0],20,-373897302),a=s(a,r,l,c,e[5],5,-701558691),c=s(c,a,r,l,e[10],9,38016083),l=s(l,c,a,r,e[15],14,-660478335),r=s(r,l,c,a,e[4],20,-405537848),a=s(a,r,l,c,e[9],5,568446438),c=s(c,a,r,l,e[14],9,-1019803690),l=s(l,c,a,r,e[3],14,-187363961),r=s(r,l,c,a,e[8],20,1163531501),a=s(a,r,l,c,e[13],5,-1444681467),c=s(c,a,r,l,e[2],9,-51403784),l=s(l,c,a,r,e[7],14,1735328473),a=o(a,r=s(r,l,c,a,e[12],20,-1926607734),l,c,e[5],4,-378558),c=o(c,a,r,l,e[8],11,-2022574463),l=o(l,c,a,r,e[11],16,1839030562),r=o(r,l,c,a,e[14],23,-35309556),a=o(a,r,l,c,e[1],4,-1530992060),c=o(c,a,r,l,e[4],11,1272893353),l=o(l,c,a,r,e[7],16,-155497632),r=o(r,l,c,a,e[10],23,-1094730640),a=o(a,r,l,c,e[13],4,681279174),c=o(c,a,r,l,e[0],11,-358537222),l=o(l,c,a,r,e[3],16,-722521979),r=o(r,l,c,a,e[6],23,76029189),a=o(a,r,l,c,e[9],4,-640364487),c=o(c,a,r,l,e[12],11,-421815835),l=o(l,c,a,r,e[15],16,530742520),a=n(a,r=o(r,l,c,a,e[2],23,-995338651),l,c,e[0],6,-198630844),c=n(c,a,r,l,e[7],10,1126891415),l=n(l,c,a,r,e[14],15,-1416354905),r=n(r,l,c,a,e[5],21,-57434055),a=n(a,r,l,c,e[12],6,1700485571),c=n(c,a,r,l,e[3],10,-1894986606),l=n(l,c,a,r,e[10],15,-1051523),r=n(r,l,c,a,e[1],21,-2054922799),a=n(a,r,l,c,e[8],6,1873313359),c=n(c,a,r,l,e[15],10,-30611744),l=n(l,c,a,r,e[6],15,-1560198380),r=n(r,l,c,a,e[13],21,1309151649),a=n(a,r,l,c,e[4],6,-145523070),c=n(c,a,r,l,e[11],10,-1120210379),l=n(l,c,a,r,e[2],15,718787259),r=n(r,l,c,a,e[9],21,-343485551),t[0]=d(a,t[0]),t[1]=d(r,t[1]),t[2]=d(l,t[2]),t[3]=d(c,t[3])}function e(t,e,i,s,o,n){return e=d(d(e,t),d(s,n)),d(e<<o|e>>>32-o,i)}function i(t,i,s,o,n,a,r){return e(i&s|~i&o,t,i,n,a,r)}function s(t,i,s,o,n,a,r){return e(i&o|s&~o,t,i,n,a,r)}function o(t,i,s,o,n,a,r){return e(i^s^o,t,i,n,a,r)}function n(t,i,s,o,n,a,r){return e(s^(i|~o),t,i,n,a,r)}function a(t){var e,i=[];for(e=0;e<64;e+=4)i[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return i}var r="0123456789abcdef".split("");function l(t){for(var e="",i=0;i<4;i++)e+=r[t>>8*i+4&15]+r[t>>8*i&15];return e}function c(e){return function(t){for(var e=0;e<t.length;e++)t[e]=l(t[e]);return t.join("")}(function(e){txt="";var i,s=e.length,o=[1732584193,-271733879,-1732584194,271733878];for(i=64;i<=e.length;i+=64)t(o,a(e.substring(i-64,i)));e=e.substring(i-64);var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(i=0;i<e.length;i++)n[i>>2]|=e.charCodeAt(i)<<(i%4<<3);if(n[i>>2]|=128<<(i%4<<3),i>55)for(t(o,n),i=0;i<16;i++)n[i]=0;return n[14]=8*s,t(o,n),o}(e))}function d(t,e){return t+e&4294967295}if("5d41402abc4b2a76b9719d911017c592"!=c("hello"));$.md5=$.md5||c}(window,$)},function(t,e,i){var s=i(484);s.locale("ru"),window.moment=s},,,function(t,e){
/*!
 * jQuery outside events - v1.1 - 3/16/2010
 * http://benalman.com/projects/jquery-outside-events-plugin/
 *
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
!function(t,e,i){function s(i,s){s=s||i+"outside";var o=t(),n=i+"."+s+"-special-event";function a(e){t(o).each((function(){var i=t(this);this===e.target||i.has(e.target).length||i.triggerHandler(s,[e.target])}))}t.event.special[s]={setup:function(){1===(o=o.add(this)).length&&t(e).bind(n,a)},teardown:function(){0===(o=o.not(this)).length&&t(e).unbind(n)},add:function(t){var e=t.handler;t.handler=function(t,i){t.target=i,e.apply(this,arguments)}}}}t.map("click dblclick mousemove mousedown mouseup mouseover mouseout change select submit keydown keypress keyup".split(" "),(function(t){s(t)})),s("focusin","focusoutside"),s("focusout","bluroutside"),t.addOutsideEvent=s}(jQuery,document)},function(t,e){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var s;s={_hashBangRegEx:/\#!\//,_filter:[],_safeUnescapeParams:[],_validUrlRegEx:/^(([\w]+:)?\/\/)?(([\d\w]|%[a-fA-f\d]{2,2})+(:([\d\w]|%[a-fA-f\d]{2,2})+)?@)?([\d\w][-\d\w]{0,253}[\d\w]\.)+[\w]{2,4}(:[\d]+)?(\/([-+_~.\d\w]|%[a-fA-f\d]{2,2})*)*(\?(&?([-+_~.\d\w]|%[a-fA-f\d]{2,2})=?)*)?(#([-+_~.\d\w]|%[a-fA-f\d]{2,2})*)?$/,isValid:function(t){return this._validUrlRegEx.test(t)},isAbsolute:function(t){var e=(t||location.href).trim().toLowerCase();return/[a-z:]*\/\//.test(e)},getRoot:function(){return location.protocol+"//"+(location.hostname||location.host)+"/"},getPage:function(t){return t||(t=location.href),t+t.charAt(t.length-1)==="/"?"":"/"},getBasePage:function(t){return t||(t=location.href),this.clearHashSymbol(t).replace(/[^\/]+$/,"").replace(/\/+$/,"")+"/"},getFull:function(t){var e=t,i=t.charAt(0);if(!this.isAbsolute(t))switch(i){case"/":e=s.getRoot()+t.replace(/^\/+/,"");break;case"#":e=s.getPage().replace(/#.*/,"")+t;break;case"?":e=s.getPage().replace(/[\?#].*/,"")+t;break;default:e=s.getBasePage()+t.replace(/^(\.\/)+/,"")}return e.replace(/\#$/,"")},getShort:function(t){if(!t)return"/";if(!this.isAbsolute(t))return t;var e=t,i=(s.getBasePage(),s.getRoot());return e=e.replace(i,"/"),this.isTraditionalAnchor(e)&&(e="/"+e),e=e.replace(/^(\.\/)+/g,"./").replace(/\#$/,"").replace(s._hashBangRegEx,"").replace("//","/")},isTraditionalAnchor:function(t){return!/[\/\?\.]/.test(t)},setSafeUnescapeParams:function(t){t&&(this._safeUnescapeParams=t)},safeUnescape:function(t){t=t||location.href;var e=this.getParams(t,this._safeUnescapeParams);return t=this.unescape(this.delParams(t,this._safeUnescapeParams)),this.setParams(t,e)},unescape:function(t){for(var e,i=t;(e=$.decodeURI(i))!==i;)i=e;return i},unescapeHash:function(t){return s.unescape(s.normalizeHash(t))},normalizeHash:function(t){return t.replace(/[^#]*#!?/,"").replace(/#.*/,"")},getHash:function(t){return t||(t=location.href),/#/.test(t)||(t=""),s.unescapeHash(t)},setHash:function(t){location.hash=t.replace("#","")},escapeHash:function(t){var e=encodeURI(s.normalizeHash(t));return e=e.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?")},clearHashSymbol:function(t){return(t||location.href).replace(this._hashBangRegEx,"")},parseParams:function(t){t||(t=location.href),t=this.clearHashSymbol(t);var e={};return t.indexOf("?&")>-1&&(t=t.replace(/\?&/g,"?")),(t=t.replace(/[^?]*\??/,""))&&t.replace(/(?:^|&|;)([^&=;]*)=?([^&;]*)/g,function(t,i,s){i&&(e[i]=s.replace(/\+/g," ")),~this._safeUnescapeParams.indexOf(i)||(e[i]=$.decodeURIComponent(e[i]))}.bind(this)),e},normalize:function(t){return(t||location.href).replace(/\+/g,"%20")},mergeFilters:function(t){return $.merge($.url._filter,t)},filter:function(t,e){void 0===e&&t instanceof Array&&(e=t,t=location.href);var i=this.parseParams(t);return $.merge($.merge([],this._filter),e||[]).forEach((function(t){i[t]&&delete i[t]})),this.build(this.getPath(t),i)},build:function(t,e){if(void 0===e&&"object"===i(t)&&(e=t,t=location.href),!e||!Object.keys(e).length)return t;if(e=e instanceof Array?[].concat(e):$.extend({},e),this._safeUnescapeParams.length){var s="";this._safeUnescapeParams.forEach((function(t){e[t]&&(s+="&"+t+"="+e[t],delete e[t])})),e=$.param(e)+s}else e=$.param(e);return this.normalize(t+"?"+e)},getPath:function(t){return this.clearHashSymbol(t).match(/([^\?&]*)/)[0]},setParam:function(t,e,i){void 0===e&&(e=t,t=location.href);var s=this.parseParams(t);return void 0===i||""===i?delete s[e]:s[e]=i,this.build(this.getPath(t),s)},setParams:function(t,e){"object"===i(t)&&(e=t,t=location.href);var s=$.extend({},this.parseParams(t));return $.each(e,(function(t,e){void 0===e||""===e?delete s[t]:s[t]=e})),this.build(this.getPath(t),s)},delParam:function(t,e){return this.setParam(t,e)},delParams:function(t,e){void 0===e&&"string"!=typeof t&&(e=t,t=location.href);var i={};return e.forEach((function(t){i[t]=""})),this.setParams(t,i)},clearFromParams:function(t){return this.getPath(t)},getParam:function(t,e){return void 0===e&&"string"==typeof t&&(e=t,t=location.href),this.parseParams(t)[e]},getParams:function(t,e){"undefined"==typeof withoutDecoding&&"boolean"==typeof e&&t instanceof Array&&(withoutDecoding=e,e=t,t=location.href),e||(e=[]);var i=this.parseParams(t),s={};return e.forEach((function(t){s[t]=i[t]})),s},getAllParams:function(t){return this.parseParams(t)}},$.extend({url:s})},function(t,e){BEM.DOM.decl("page-layout",{onSetMod:{js:function(){this._sidebar=this.findBlockOn("sidebar","sidebar"),this._sidebar&&this._sidebar.on("toggle",this._setSidebarState.bind(this,!1)),this._sidebar&&this._sidebar.on("shown hide",this._setSidebarState.bind(this,!0)),this._sidebar&&this._setSidebarState()}},_setSidebarState:function(t){this.setMod("sidebar",this._sidebar.getMod("state")),t&&BEM.channel("layout").trigger("change")}},{})},function(t,e){BEM.DOM.decl("wiki-sidebar",{_lastAccessedTab:{},_currentView:null,onSetMod:{js:function(){this._tabs=this.params.tabs,this._currentView=this.params.view||"view",this._lastAccessedTab[this._currentView]=this.params.selected,this._sidebar=this.findBlockOn("sidebar"),this._filesDropper=this.findBlockOn("wi-files-dropper"),this._appStore=BEM.WISTORE.get("app"),this._pageStore=BEM.WISTORE.get("page"),this._sessionStore=BEM.WISTORE.get("session"),this._bindEvents()}},_bindEvents:function(){this._appStore.on("change:view",this._onPageStateChange,this),this._sidebar.on("toggle",this._onSidebarToggle,this),this._sidebar.on("tab-change",this._onSidebarTabChange,this),this._filesDropper.on("drop",this._onFilesDrop,this)},_onPageStateChange:function(t,e){var i=e;"grid"===this._pageStore.get("type")&&(i="grid"),this._currentView=i,this._sidebar.setTabs(this._tabs[i],null,this._lastAccessedTab[this._currentView])},_onSidebarToggle:function(t,e){var i={sidebarState:"open"===e?"open":""};i.sidebarState||(i.sidebarTab=""),this._sessionStore.set(i)},_onSidebarTabChange:function(t,e){this._lastAccessedTab[this._currentView]=e,this._sessionStore.set("sidebarTab",e)},_onFilesDrop:function(t,e){this._sidebar.open("files"),this.channel("attachments").trigger("add",e)}},{})},function(t,e){BEM.DOM.decl("sidebar",{_readyTabs:[],onSetMod:{js:function(){if(this._container=this.elem("content-container"),this._tabs=Array.prototype.map.call(this.findElem("tab"),(function(t){return this.getMod($(t),"type")}),this),this.hasMod("state","open")){var t=this.getMod("selected");-1===this._tabs.indexOf(t)?this.open():this._readyTabs.push(t)}this._bindEvents()},state:{open:function(){this.trigger("toggle","open"),BEM.WISTORE.get("app").set("sidebar","opening"),this._animateTimeout=setTimeout((function(){BEM.WISTORE.get("app").set("sidebar","opened")}),250)},close:function(){this._unSelectTabs(),this.setMod("selected",""),this.setMod("ready",""),this.delMod("hovered"),this.trigger("toggle","close"),BEM.WISTORE.get("app").set("sidebar","closing"),this._animateTimeout=setTimeout((function(){BEM.WISTORE.get("app").set("sidebar","closed")}),250)},"*":function(){this.bindTo("transitionend",this._onTransitionEnd.bind(this))}},selected:function(t,e){if(-1!==this._readyTabs.indexOf(e))this.setMod("ready","yes");else{var i=$(BEMHTML.apply({block:"sidebar",elem:"tab-content",elemMods:{tab:e},redirect:BEM.WISTORE.get("page").get("redirect")}));this.setMod("ready",""),this._readyTabs.push(e),BEM.DOM.append(this._container,i)}this.trigger("tab-change",e)},hovered:{yes:function(){this.trigger("hovered")},"":function(){this.trigger("blur")}}},destruct:function(){this.__base.apply(this,arguments),clearTimeout(this._animateTimeout)},open:function(t){t===this.getMod("selected")&&this.hasMod("state","open")||(t&&-1!==this._tabs.indexOf(t)||(t=this._getFirstTab()),this._selectTab(t),this._openTabContent(t),this.hasMod("state","open")||this.setMod("state","open"))},close:function(){this.setMod("state","close")},toggle:function(){this.hasMod("state","open")?this.close():this.open()},setTabs:function(t,e,i){var s=this.getMod("selected"),o=BEMHTML.apply({block:"sidebar",elem:"tabs",tabs:t});e&&(s=e),-1===t.indexOf(s)&&(s=null),this._tabs=t,this._readyTabs=[],this.delMod("selected"),BEM.DOM.replace(this.findElem("tabs"),o),BEM.DOM.destruct(!1,this.findElem("tab-content")),this.hasMod("state","open")&&this.open(s||i),this.redraw()},redraw:function(){},_bindEvents:function(){this.channel("sidebar").on("tab:select",(function(t,e){this.open(e.tabName)}),this),this.channel("sidebar").on("tab:ready",this._onTabReady,this),BEM.channel("common").on("sidebar.diff",(function(t,e){this.open("events"),this.findBlockInside(this.findElem("tab-content"),"b-events-log").setDiff(e.params)}),this)},_onTabReady:function(){this.setMod("ready","yes")},_selectTab:function(t){var e=this.findElem("tab","type",t);this._unSelectTabs(),this.setMod(e,"selected","yes")},_unSelectTabs:function(){var t=this.findElem("tab");this.setMod(t,"selected","")},_getFirstTab:function(){var t=this.findElem("tab").get(0);return this.getMod($(t),"type")},_openTabContent:function(t){this.setMod("selected",t)},_onTransitionEnd:function(t){this.domElem.is(t.data.domElem)&&(this.unbindFrom("transitionend"),this.trigger(this.hasMod("state","open")?"shown":"hide"))},_onMouseenter:function(){this.setMod("hovered","yes").bindTo("mouseleave",this._onMouseleave)},_onMouseleave:function(){this.delMod("hovered").unbindFrom("mouseleave")}},{live:function(){this.liveBindTo("tab","click",(function(t){var e=this.getMod(t.data.domElem,"type");this.getMod("selected")===e&&this.hasMod("state","open")?this.close():this.open(e)})),this.liveBindTo("click",(function(t){this.hasMod("state","close")&&this.domElem.is(t.target)&&this.open()})),this.liveBindTo("close","click",(function(){this.close()})),this.liveBindTo("mouseover",(function(t){var e=this.domElem.is(t.relatedTarget)||$.contains(this.domElem[0],t.relatedTarget);this.hasMod("disabled")||e||this._onMouseenter(t)}))}})},function(t,e){BEM.DOM.decl("b-toc",{onSetMod:{js:function(){this.hasMod("load")&&(this.setMod("load",""),this.afterCurrentEvent(this._loadToc))}},destruct:function(){this._request&&this._request.abort(),this.__base.apply(this,arguments)},_loadToc:function(){if(BEM.WISTORE.get("page").get("withNewWf")){var t={block:"w-toc",toc:this.findBlockOutside({block:"b-page",modName:"type",modVal:"article"}).getToc()};BEM.DOM.update(this.domElem,BEMHTML.apply(t)),this.channel("sidebar").trigger("tab:ready"),this.bindTo(this.domElem,"click",(function(t){t.target.classList.contains("link")&&yaCounter&&yaCounter.reachGoal("tocitem_click")}))}else this._request=BEM.create("wi-api-request",{apiPath:".toc",method:"GET",data:!1,path:BEM.blocks["wi-history"].getPath()}),this._request.run().then(this._onTocGetData.bind(this),BEM.blocks["wi-notification"].errorHandler()).always(function(){this._request=null,this.trigger("ready")}.bind(this))},_onTocGetData:function(t){var e=t.data.toc;e.content[0].mods={type:"sidebar"},BEM.DOM.update(this.domElem,BEMHTML.apply(e))}},{})},function(t,e){BEM.DOM.decl("wiki-toc",{_goToHeader:function(t){location.hash="#"+t}})},function(t,e){BEM.decl("i-routes",{},{getRoute:function(t){var e,i,s=BEM.blocks["wi-history"].getRoute(),o=!!s&&this.actions[s.route];if(o){i=o.page?o.page[t]:o,e=i&&BEM.DOM.blocks[i.block];var n=function(){BEM.channel("common").trigger(i.block+"."+i.event,_.extend({},{route:s.route,params:s.params},i.data,{initial:!0}))};if(!e)return;i.triggerBeforeInit?n():e.on("init",(function(t){i.modName&&!t.block.hasMod(i.modName,i.modVal)||(n(),e.un("init"))}))}},actions:{".log":{block:"sidebar",event:"diff"},".settings":{block:"w-action",modName:"type",modVal:"settings",event:"create-settings"},".delete":{page:{article:{block:"w-action",modName:"type",modVal:"delete",event:"delete"},grid:{block:"w-action",modName:"type",modVal:"delete",event:"delete"},cloud:{block:"w-action",modName:"type",modVal:"delete",event:"delete"}}},".tree":{page:{article:{block:"w-action",modName:"type",modVal:"tree",event:"create-tree"},grid:{block:"w-action",modName:"type",modVal:"tree",event:"create-tree"},cloud:{block:"w-action",modName:"type",modVal:"tree",event:"create-tree"}}},".files":{page:{article:{block:"w-action",modName:"type",modVal:"files",event:"open-sidebar-files"},grid:{block:"w-action",modName:"type",modVal:"files",event:"open-sidebar-files"},cloud:{block:"w-action",modName:"type",modVal:"files",event:"open-sidebar-files"}}},".import":{page:{grid:{block:"w-action",modName:"type",modVal:"import",event:"create-import"}}},".move":{page:{article:{block:"w-action",modName:"type",modVal:"move",event:"create-move"},grid:{block:"w-action",modName:"type",modVal:"move",event:"create-move"}}},".copy":{page:{article:{block:"w-action",modName:"type",modVal:"copy",event:"create-copy"},grid:{block:"w-action",modName:"type",modVal:"copy",event:"create-copy"}}},".authors":{block:"w-action",modName:"type",modVal:"settings",event:"create-settings",data:{tab:"authors"}},".subpages-change-author":{page:{article:{block:"w-action",modName:"type",modVal:"subpages-change-author",event:"create-subpages-change-author"},grid:{block:"w-action",modName:"type",modVal:"subpages-change-author",event:"create-subpages-change-author"},cloud:{block:"w-action",modName:"type",modVal:"subpages-change-author",event:"create-subpages-change-author"}}},".request_page_author":{page:{article:{block:"w-action",modName:"type",modVal:"request-page-author",event:"create-request-page-author"},grid:{block:"w-action",modName:"type",modVal:"request-page-author",event:"create-request-page-author"},cloud:{block:"w-action",modName:"type",modVal:"request-page-author",event:"create-request-page-author"}}},".requestauthorship":{page:{article:{block:"w-action",modName:"type",modVal:"authorship",event:"create-request-authorship"},grid:{block:"w-action",modName:"type",modVal:"authorship",event:"create-request-authorship"},cloud:{block:"w-action",modName:"type",modVal:"authorship",event:"create-request-authorship"}}},".unwatch":{page:{article:{block:"w-action",modName:"type",modVal:"unsubscribe",event:"create-unsubscribe"},grid:{block:"w-action",modName:"type",modVal:"unsubscribe",event:"create-unsubscribe"},cloud:{block:"w-action",modName:"type",modVal:"unsubscribe",event:"create-unsubscribe"}}},".subscribe":{page:{article:{block:"w-action",modName:"type",modVal:"subscribe",event:"create-subscribe"},grid:{block:"w-action",modName:"type",modVal:"subscribe",event:"create-subscribe"},cloud:{block:"w-action",modName:"type",modVal:"subscribe",event:"create-subscribe"}}},".referrers":{page:{article:{block:"w-action",modName:"type",modVal:"referrers",event:"create-referrers"},grid:{block:"w-action",modName:"type",modVal:"referrers",event:"create-referrers"},cloud:{block:"w-action",modName:"type",modVal:"referrers",event:"create-referrers"}}},".links":{page:{article:{block:"w-action",modName:"type",modVal:"referrers",event:"create-referrers"},grid:{block:"w-action",modName:"type",modVal:"referrers",event:"create-referrers"},cloud:{block:"w-action",modName:"type",modVal:"referrers",event:"create-referrers"}}},".watchers":{page:{article:{block:"w-action",modName:"type",modVal:"subscribe",event:"create-subscribe",data:{subscribersTab:!0}},grid:{block:"w-action",modName:"type",modVal:"subscribe",event:"create-subscribe",data:{subscribersTab:!0}},cloud:{block:"w-action",modName:"type",modVal:"subscribe",event:"create-subscribe",data:{subscribersTab:!0}}}},".obsolete":{page:{article:{block:"w-action",modName:"type",modVal:"old-page",event:"create-old-page"},grid:{block:"w-action",modName:"type",modVal:"old-page",event:"create-old-page"},cloud:{block:"w-action",modName:"type",modVal:"old-page",event:"create-old-page"}}},".create":{block:"b-head",event:"newPageCreate"},".access":{block:"w-action",modName:"type",modVal:"access",event:"create-access"},".edit":{block:"w-action",modName:"type",modVal:"edit",event:"open-editor"},".requestaccess":{block:"b-page",event:"accessRequest"},".ru-en":{block:"w-translate-content",event:"translate",triggerBeforeInit:!0},".en-ru":{block:"w-translate-content",event:"translate",triggerBeforeInit:!0},".ru-tr":{block:"w-translate-content",event:"translate",triggerBeforeInit:!0},".tr-ru":{block:"w-translate-content",event:"translate",triggerBeforeInit:!0}}})},,,function(t,e){function i(t){return function(t){if(Array.isArray(t))return n(t)}(t)||a(t)||o(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t){return function(t){if(Array.isArray(t))return t}(t)||a(t)||o(t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){if(t){if("string"==typeof t)return n(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(t,e):void 0}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function a(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}BEM.DOM.decl("w-translate-content",{onSetMod:{js:{inited:function(){this._bPage=this.findBlockOutside("b-page")}},progress:function(t,e){this._popup&&(this._popupSpinner.setMod("progress",e),this.setMod(this.findElem(this._popup.domElem,"paranja"),"visibility","yes"===e?"visible":""))}},_translateFromAction:function(t,e){var i=/\.(\w\w)-(\w\w)/.exec(e.route),s=i[1],o=i[2];this._initPopup(),this._translateItems.forEach((function(t){t.params.from===s&&t.params.to===o&&this._translate(t,!0)}),this)},_onMouseOver:function(){this._initPopup(),this._popup.setMod("visible","yes"),this._closePopupTimeout&&(clearTimeout(this._closePopupTimeout),this._closePopupTimeout=null)},_initPopup:function(){this._popup||(this._popup=BEM.DOM.append(BEM.DOM.scope,BEMHTML.apply(this.__self._getPopupBEMJSON())).bem("popup2").setAnchor(this.domElem).bindTo("mouseover",this._onPopupMouseOver.bind(this)).bindTo("mouseout",this._onPopupMouseOut.bind(this)),this._popupSpinner=this._popup.findBlockInside("spin2"),this._translateItems=this._popup.findBlocksInside("w-translate-item"),BEM.blocks["w-translate-item"].on(this._popup.domElem,"click",this._onTranslateClick,this))},_onMouseOut:function(){this._closePopupTimeout&&clearTimeout(this._closePopupTimeout),this._closePopupTimeout=setTimeout(this._hidePopup.bind(this),700)},_onPopupMouseOver:function(){this._closePopupTimeout&&(clearTimeout(this._closePopupTimeout),this._closePopupTimeout=null)},_onPopupMouseOut:function(){this._closePopupTimeout&&clearTimeout(this._closePopupTimeout),this._closePopupTimeout=setTimeout(this._hidePopup.bind(this),700)},_hidePopup:function(){this._popup&&this._popup.delMod("visible")},_onTranslateClick:function(t){this._translate(t.block)},_translate:function(t,e){var i=this,s=t.params.from+"-"+t.params.to;t.hasMod("selected")||(this.setMod("progress","yes"),this._request(s).then(this._onSuccessGetData.bind(this,t,Boolean(e)),this._onErrorGetData.bind(this)).finally((function(){i.delMod("progress")})))},_selectItem:function(t){this._unselectItems(),t.setMod("selected","yes")},_processContentResult:function(t){return t},_onSuccessGetData:function(t,e,o){var n=s(o),a=n[0],r=n.slice(1),l=this._processContentResult(a);this._selectItem(t),this._updateContent.apply(this,[l].concat(i(r))),this.setMod("lang-selected","yes"),e||BEM.blocks["wi-history"].pushState("."+t.params.from+"-"+t.params.to),BEM.WISTORE.get("page").set("translation",{from:t.params.from,to:t.params.to})},_onErrorGetData:function(t){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,BEM.blocks["wi-notification"].createErrorMessage(t)))},_onSuccessSkipTranslate:function(t,e){this._unselectItems(),this.delMod("lang-selected"),this.channel("content").trigger("update",e),t&&BEM.blocks["wi-history"].removeState(),BEM.WISTORE.get("page").set("translation",null)},_onErrorSkipTranslate:function(t){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,BEM.blocks["wi-notification"].createErrorMessage(t)))},_unselectItems:function(){this._translateItems&&this._translateItems.forEach((function(t){t.delMod("selected")}),this)},_onActionReplaced:function(t,e){/\.\w\w-\w\w/.exec(e.from)&&this._resetTranslate(!1)}},{live:function(){this.liveBindTo("click",(function(){this._resetTranslate(!0)})),this.liveBindTo("mouseover",(function(){this._onMouseOver()})),this.liveBindTo("mouseout",(function(){this._onMouseOut()})),this.liveInitOnChannelEvent("wiki-states","replace-state",(function(){this._onActionReplaced.apply(this,arguments)})),this.liveInitOnChannelEvent("common","w-translate-content.translate",(function(){this._translateFromAction.apply(this,arguments)}))},_getPopupBEMJSON:function(){return{block:"popup2",mix:{block:"w-translate-content",elem:"items"},mods:{target:"anchor",theme:"normal",autoclosable:"yes"},directions:["right-center"],content:[{block:"w-translate-item",from:"ru",to:"us"},{block:"w-translate-item",from:"us",to:"ru"},{block:"w-translate-item",from:"ru",to:"tr"},{block:"w-translate-item",from:"tr",to:"ru"},{block:"w-translate-content",elem:"paranja"},{block:"spin2",mods:{size:"xs"}}]}}})},function(t,e){BEM.DOM.decl("w-translate-item",{onSetMod:{js:function(){this.bindTo("click",function(){this.trigger("click")}.bind(this))}}})},function(t,e){function i(t,e,i,s,o,n,a){try{var r=t[n](a),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(s,o)}function s(t){return function(){var e=this,s=arguments;return new Promise((function(o,n){var a=t.apply(e,s);function r(t){i(a,o,n,r,l,"next",t)}function l(t){i(a,o,n,r,l,"throw",t)}r(void 0)}))}}BEM.DOM.decl("w-comments",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._commentsCount=this.params.commentsCount,this._commentsCount||(this._commentsLoaded=!0),this._loadedCount=0,this._initBlocks(),this.__self._domElem=this.domElem},"":function(){this.__base.apply(this,arguments),BEM.blocks["w-comment"].un(this.domElem,"reply",this._onCommentReplied,this),BEM.blocks["w-comment"].un(this.domElem,"active",this._onCommentActive,this),BEM.blocks["w-comment"].un(this.domElem,"remove",this._onCommentRemoved,this),BEM.blocks["w-comment"].un(this.domElem,"edit",this._onCommentEdited,this)}},"loading-comments":function(t,e){this._switchVisionButton.setMod("disabled",e),this._loadCommentsListSpinner.setMod("progress",e),this._showMoreSpinner.setMod("progress",e)},"add-comment":function(t,e){this._addCommentCancelButton.setMod("disabled",e),this._addCommentSubmitButton.setMod("disabled",e),this._addCommentSpinner.setMod("progress",e)},commenting:function(t,e){var i=this._getAddCommentEditor();"yes"===e&&(i.val(""),this.afterCurrentEvent((function(){i.findBlockInside("textarea").elem("control").focus(),BEM.DOM.win.scrollTop(BEM.DOM.doc.height())})),this._addCommentSubmitButton.setMod("disabled","yes"))},short:function(t,e){this._switchVisionButton.elem("text").text(BEM.I18N("w-comments","yes"===e?"expand":"turn"))}},destruct:function(){this.delMod("js"),this.__base.apply(this,arguments)},_initBlocks:function(){this.findBlockInside({block:"button2",modName:"role",modVal:"add-comment"}).on("click",this._onAddCommentButtonClick,this),this.findBlockInside({block:"button2",modName:"role",modVal:"add-comment-header"}).on("click",this._onAddCommentButtonClick,this),this.findBlockInside({block:"button2",modName:"role",modVal:"short-switch"}).on("click",this._switchVisionMode,this),this._loadCommentsListSpinner=this.findBlockInside({block:"spin2",modName:"type",modVal:"load-comments"}),this._addCommentCancelButton=this.findBlockInside({block:"button2",modName:"role",modVal:"cancel-new-comment"}).on("click",this._onAddCommentCancelButtonClick,this),this._addCommentSubmitButton=this.findBlockInside({block:"button2",modName:"role",modVal:"submit-new-comment"}).on("click",this._onAddCommentSubmitButtonClick,this),this._addCommentSpinner=this.findBlockInside({block:"spin2",modName:"type",modVal:"add-comment"}),this._switchVisionButton=this.findBlockInside({block:"button2",modName:"role",modVal:"short-switch"}),this._showMoreButton=this.findBlockInside({block:"button2",modName:"role",modVal:"show-more"}).on("click",this._getComments,this),this._showMoreSpinner=this.findBlockInside({block:"spin2",modName:"role",modVal:"show-more"}),BEM.blocks["w-comment"].on(this.domElem,"reply",this._onCommentReplied,this),BEM.blocks["w-comment"].on(this.domElem,"active",this._onCommentActive,this),BEM.blocks["w-comment"].on(this.domElem,"remove",this._onCommentRemoved,this),BEM.blocks["w-comment"].on(this.domElem,"edit",this._onCommentEdited,this)},_switchVisionMode:function(){this.hasMod("loading-comments")||(this._commentsLoaded?this.toggleMod("short","yes","").delMod("commenting"):this._getComments())},_getComments:function(){this.setMod("loading-comments","yes"),BEM.create("wi-api-request",{apiPath:".comments",method:"GET",urlParams:["limit=100","start="+this._loadedCount],path:"/"+this.params.supertag}).run().then(this._onSuccessGetComments.bind(this),this._onErrorGetComments.bind(this)).always(function(){this.delMod("loading-comments")}.bind(this))},_onSuccessGetComments:function(t){var e=this;return s(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return e._commentsLoaded=!0,i.t0=BEM.DOM,i.t1=e.elem("comments-list"),i.t2=BEMHTML,i.next=6,Promise.all(e.__self._formComments(t.data).map((function(t){return e.__self._getCommentBEMJSON(t,e.params.supertag,e.params.user.login)})));case 6:i.t3=i.sent,i.t4=i.t2.apply.call(i.t2,i.t3),i.t0.append.call(i.t0,i.t1,i.t4),e.setMod("more",t.data.length>99?"yes":""),e._loadedCount+=t.data.length,e.delMod("short"),e.channel("comments").trigger("updated");case 13:case"end":return i.stop()}}),i)})))()},_onErrorGetComments:function(){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,BEM.I18N("w-comments","get_comments_list_error")))},_onAddCommentCancelButtonClick:function(){this.delMod("commenting")},_onAddCommentSubmitButtonClick:function(){var t=this._getAddCommentEditor().val();this.setMod("add-comment","yes"),BEM.create("wi-api-request",{apiPath:".comments",method:"POST",data:{body:t},urlParams:!1,path:"/"+this.params.supertag}).run().then(this._onSuccessAddComment.bind(this),this._onErrorAddComment.bind(this)).always(function(){this.delMod("add-comment")}.bind(this))},_onSuccessAddComment:function(t){var e=this;return s(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return e.delMod("commenting").delMod("no-comments").delMod("short")._changeCommentsCount(!0),t.data.level=1,i.t0=BEM.DOM,i.t1=e.elem("comments-list"),i.t2=BEMHTML,i.next=7,e.__self._getCommentBEMJSON(t.data,e.params.supertag,e.params.user.login);case 7:i.t3=i.sent,i.t4=i.t2.apply.call(i.t2,i.t3),i.t0.append.call(i.t0,i.t1,i.t4),e.channel("comments").trigger("updated");case 11:case"end":return i.stop()}}),i)})))()},_onErrorAddComment:function(t){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(this._addCommentSubmitButton.domElem,BEM.blocks["wi-notification"].createErrorMessage(t)))},_getAddCommentEditor:function(){return this._addCommentEditor||(BEM.DOM.update(this.elem("add-comment-editor"),BEMHTML.apply(this.__self._getEditorBEMJSON())),this._addCommentEditor=this.findBlockInside(this.elem("add-comment-form"),"m-editor"),this._addCommentEditor.init(this.findBlockInside(this.elem("add-comment-form"),"m-editor-buttons")),this._addCommentEditor.on("change",this._onAddCommentEditorChange,this)),this._addCommentEditor},_onAddCommentEditorChange:function(t){this._addCommentSubmitButton.setMod("disabled",t.block.val()?"":"yes")},_onAddCommentButtonClick:function(){this.setMod("commenting","yes")},_onCommentEdited:function(){this.channel("comments").trigger("updated")},_onCommentRemoved:function(){this._changeCommentsCount(!1),this._commentsCount||(this.setMod("no-comments","yes").setMod("short","yes"),BEM.DOM.update(this.elem("comments-list"),""))},_onCommentReplied:function(t,e){var i=this;return s(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return i._changeCommentsCount(!0),e.level=t.block.params.data.level+1,s.t0=BEM.DOM,s.t1=i.findElem("childrens","id",String(t.block.params.data.id)),s.t2=BEMHTML,s.next=7,i.__self._getCommentBEMJSON(e,i.params.supertag,i.params.user.login);case 7:s.t3=s.sent,s.t4=s.t2.apply.call(s.t2,s.t3),s.t0.append.call(s.t0,s.t1,s.t4),i.channel("comments").trigger("updated");case 11:case"end":return s.stop()}}),s)})))()},_onCommentActive:function(t){this.findBlocksInside("w-comment").forEach((function(e){t.block!==e&&e.delMod("editing").delMod("replying")}),this)},_changeCommentsCount:function(t){this._commentsCount+=t?1:-1,BEM.DOM.replace(this.findElem("caption"),BEMHTML.apply({block:"w-comments",elem:"caption",count:this._commentsCount}))}},{live:function(){this.liveBindTo("show-comments","click"),this.liveBindTo("add-comment","click")},_MAX_LEVELS:6,_formComments:function(t){var e=[];return t.forEach((function(t){t.parent||(t.level=1)})),t.forEach((function(i){i.parent?t.forEach((function(t){t.id===i.parent&&(t.childrens||(t.childrens=[]),t.childrens.push(i),i.level=t.level+1)}),this):e.push(i)}),this),e},_getEditorBEMJSON:function(){var t=BEM.blocks["wi-history"].getCorrectPath(),e=BEM.blocks["i-global"].param("hosts").wikiApi.v1+"/pages"+t+".files?format=json";return[{block:"m-editor-buttons",mix:[{block:"m-editor",js:{id:"add-comment-editor"}}]},{block:"m-editor",mix:{block:"w-editor-suggest",js:{url:BEM.blocks["i-global"].param("hosts").suggest.url,layers:{people:{itemType:"staff",keywords:["@","staff:","кто:","укого:","ского:","кому:","кого:","кем:","ком:","оком:"],valueField:"login"}}}},mods:{type:"add-comment"},js:{id:"add-comment-editor",uploadParams:{reqParams:{type:"PUT",url:e,xhrFields:{withCredentials:!0}},URLPath:"data.data.url"},buttons:[["bold","italic","underline","strikethrough"],["ul","ol"],["indent","outdent"],["quote","link","picture","code","table","readmore","help"]]}}]},_getCommentContentBEMJSON:function(t){var e=this;return s(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return e.formatter||(e.formatter=new Ya.FormatterViewPort({domElem:e._domElem[0],settings:{extensions:{"wiki-doc":null,"wiki-head":null},remark:{woofmd:{actions:!1}}}})),i.next=3,e.formatter.renderToString(t.body);case 3:return i.t0=i.sent,i.abrupt("return",{html:i.t0});case 5:case"end":return i.stop()}}),i)})))()},_getCommentBEMJSON:function(t,e,i){var o=this;return s(regeneratorRuntime.mark((function s(){var n;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.t0={data:t,supertag:e},s.t1={editable:i===t.user.login?"yes":"","max-level":t.level>o._MAX_LEVELS?"yes":"",removed:t.is_deleted?"yes":""},s.t2=t,s.next=5,o._getCommentContentBEMJSON(t);case 5:if(s.t3=s.sent,n={block:"w-comment",js:s.t0,mods:s.t1,data:s.t2,bemjson:s.t3},s.t4=n,s.t5={id:t.id},s.t6=t.childrens,!s.t6){s.next=14;break}return s.next=13,Promise.all(t.childrens.map((function(t){return o._getCommentBEMJSON(t,e,i)})));case 13:s.t6=s.sent;case 14:return s.t7=s.t6,s.t8={block:"w-comments",elem:"childrens",elemMods:s.t5,content:s.t7},s.abrupt("return",[s.t4,s.t8]);case 17:case"end":return s.stop()}}),s)})))()}})},,function(t,e){function i(t,e,i,s,o,n,a){try{var r=t[n](a),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(s,o)}function s(t){return function(){var e=this,s=arguments;return new Promise((function(o,n){var a=t.apply(e,s);function r(t){i(a,o,n,r,l,"next",t)}function l(t){i(a,o,n,r,l,"throw",t)}r(void 0)}))}}BEM.DOM.decl("w-comment",{onSetMod:{js:function(){this._body=this.params.data.body,this._initBlocks(),Ya.FormatterViewPort.BEM.DOM.init(this.domElem)},editing:function(t,e){var i=this._getEditor();"yes"===e?(i.val(this._body),this.afterCurrentEvent((function(){i.findBlockInside("textarea").elem("control").focus()})),this._cancelEditorButton.on("click",this._cancelEditComment,this),this._submitEditorButton.delMod("disabled").on("click",this._saveEditedComment,this).elem("text").text(BEM.I18N("w-comment","save"))):(this._submitEditorButton.un("click"),this._cancelEditorButton.un("click"))},replying:function(t,e){var i=this._getEditor();"yes"===e?(i.val(""),this.afterCurrentEvent((function(){i.findBlockInside("textarea").elem("control").focus()})),this._cancelEditorButton.on("click",this._cancelReplyComment,this),this._submitEditorButton.setMod("disabled","yes").on("click",this._saveReplyToComment,this).elem("text").text(BEM.I18N("w-comment","send"))):(this._submitEditorButton.un("click"),this._cancelEditorButton.un("click"))},"editor-progress":function(t,e){this._cancelEditorButton.setMod("disabled",e),this._submitEditorButton.setMod("disabled",e),this._submitEditorSpinner.setMod("progress",e)},"remove-progress":function(t,e){this._removePopupCancelButton.setMod("disabled",e),this._removePopupSubmitButton.setMod("disabled",e),this._removePopupSpinner.setMod("progress",e)},removed:function(t,e){"yes"===e&&this.elem("content").text(BEM.I18N("w-comment","comment_removed"))}},_initBlocks:function(){this._cancelEditorButton=this.findBlockInside({block:"button2",modName:"role",modVal:"cancel"}),this._submitEditorButton=this.findBlockInside({block:"button2",modName:"role",modVal:"submit"}),this._submitEditorSpinner=this.findBlockInside({block:"spin2",modName:"type",modVal:"editor-submit"}),this.bindTo(this.findElem("edit"),"click",this._onEditClick.bind(this)).bindTo(this.findElem("reply"),"click",this._onReplyClick.bind(this)).bindTo(this.findElem("remove"),"click",this._onRemoveClick.bind(this))},_onEditClick:function(){this.trigger("active").setMod("editing","yes")},_onReplyClick:function(){this.trigger("active").setMod("replying","yes")},_onRemoveClick:function(){var t=this._getRemovePopup();this._removePopupCancelButton.on("click",(function(){t.delMod("visible")})),this._removePopupSubmitButton.on("click",this._removeComment,this),t.on("afterClose",this._onRemovePopupHide,this),this.trigger("active"),t.setMod("visible","yes")},_removeComment:function(){this.setMod("remove-progress","yes"),BEM.create("wi-api-request",{apiPath:".comments/"+this.params.data.id,method:"DELETE",urlParams:!1,path:"/"+this.params.supertag}).run().then(this._onSuccessRemoveComment.bind(this),this._onErrorRemoveComment.bind(this)).always(function(){this.delMod("remove-progress")}.bind(this))},_onSuccessRemoveComment:function(){this._getRemovePopup().delMod("visible"),this.setMod("removed","yes"),this.trigger("remove")},_onErrorRemoveComment:function(t){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,BEM.blocks["wi-notification"].createErrorMessage(t)))},_onRemovePopupHide:function(){this._removePopupCancelButton.un("click"),this._removePopupSubmitButton.un("click"),this._getRemovePopup().un("afterClose")},_getRemovePopup:function(){return this.__self._removePopup||(this.__self._removePopup=BEM.DOM.append(BEM.DOM.scope,BEMHTML.apply(this.__self._getRemovePopupBEMJSON())).bem("modal")),this._removePopupCancelButton||(this._removePopupCancelButton=this.__self._removePopup.findBlockInside({block:"button2",modName:"role",modVal:"remove-cancel"}),this._removePopupSubmitButton=this.__self._removePopup.findBlockInside({block:"button2",modName:"role",modVal:"remove-submit"}),this._removePopupSpinner=this.__self._removePopup.findBlockInside("spin2")),this.__self._removePopup},_getEditor:function(){return this._editor||(BEM.DOM.update(this.elem("comment-editor"),BEMHTML.apply(this.__self._getEditorBEMJSON(this.params.data.id))).bem("m-editor"),this._editor=this.findBlockInside(this.elem("form"),"m-editor"),this._editor.init(this.findBlockInside(this.elem("form"),"m-editor-buttons")),this._editor.on("change",this._onEditorChange,this)),this._editor},_cancelEditComment:function(){this.delMod("editing")},_saveEditedComment:function(){var t=this._getEditor().val();this.setMod("editor-progress","yes"),BEM.create("wi-api-request",{apiPath:".comments/"+this.params.data.id,method:"POST",data:{body:t},urlParams:!1,path:"/"+this.params.supertag}).run().then(this._onSuccessEditComment.bind(this,t),this._onErrorEditComment.bind(this)).always(function(){this.delMod("editor-progress")}.bind(this))},_updateEditCommentContent:function(t){var e=this;return s(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=BEM.DOM,i.t1=e.elem("content"),i.t2=BEMHTML,i.next=5,BEM.blocks["w-comments"].formatter.renderToString(t.body);case 5:i.t3=i.sent,i.t4={html:i.t3},i.t5=i.t2.apply.call(i.t2,i.t4),i.t0.update.call(i.t0,i.t1,i.t5),Ya.FormatterViewPort.BEM.DOM.init(e.elem("content"));case 10:case"end":return i.stop()}}),i)})))()},_onSuccessEditComment:function(t,e){var i=this;return s(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,i._updateEditCommentContent(e.data);case 2:i.delMod("editing"),i._body=t,i.trigger("edit");case 5:case"end":return s.stop()}}),s)})))()},_onErrorEditComment:function(t){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(this._submitEditorButton.domElem,BEM.blocks["wi-notification"].createErrorMessage(t)))},_cancelReplyComment:function(){this.delMod("replying")},_saveReplyToComment:function(){this.setMod("editor-progress","yes"),BEM.create("wi-api-request",{apiPath:".comments",method:"POST",data:{body:this._getEditor().val(),parent:this.params.data.id},urlParams:!1,path:"/"+this.params.supertag}).run().then(this._onSuccessReplyToComment.bind(this),this._onErrorReplyToComment.bind(this)).always(function(){this.delMod("editor-progress")}.bind(this))},_onSuccessReplyToComment:function(t){this.trigger("reply",t.data),this.delMod("replying")},_onErrorReplyToComment:function(t){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(this._submitEditorButton.domElem,BEM.blocks["wi-notification"].createErrorMessage(t)))},_onEditorChange:function(t){this._submitEditorButton.setMod("disabled",t.block.val()?"":"yes")}},{_getEditorBEMJSON:function(t){var e=BEM.blocks["wi-history"].getCorrectPath();return[{block:"m-editor-buttons",mix:[{block:"m-editor",js:{id:"comment-editor#"+t}}]},{block:"m-editor",js:{id:"comment-editor#"+t,uploadParams:{reqParams:{type:"PUT",url:BEM.blocks["i-global"].param("hosts").wikiApi.v1+"/pages"+e+".files?format=json",xhrFields:{withCredentials:!0}},URLPath:"data.data.url"},buttons:[["bold","italic","underline","strikethrough"],["ul","ol"],["indent","outdent"],["quote","link","picture","code","table","readmore","help"]]}}]},_getRemovePopupBEMJSON:function(){return{block:"modal",mods:{theme:"normal",autoclosable:"yes"},mix:{block:"w-comment",elem:"remove-popup"},content:[{block:"w-comment",elem:"header",content:BEM.I18N("w-comment","remove-confirm")},{block:"w-comment",elem:"right",content:[{block:"spin2",mods:{size:"xs",type:"remove-submit"}},{block:"button2",mods:{size:"s",role:"remove-cancel",theme:"normal"},text:BEM.I18N("w-comment","cancel")},{block:"button2",mods:{size:"s",theme:"action",role:"remove-submit"},text:BEM.I18N("w-comment","remove")}]}]}}})},,,,,function(t,e){BEM.DOM.decl("m-editor-popup",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._onCmdEnter=this._onCmdEnter.bind(this),this._addCmdEnterListener=this._addCmdEnterListener.bind(this),this._delCmdEnterListener=this._delCmdEnterListener.bind(this),this._submitButton=this.findBlockOutside("m-popup").findBlockInside({block:"button2",modName:"action",modVal:"add"}),this._outerPopup=this.findBlockOutside("popup2"),this._addCmdEnterListener()},"":function(){this._delCmdEnterListener(),this.__base.apply(this,arguments)}}},destruct:function(){this.delMod("js"),this.__base.apply(this,arguments)},_addCmdEnterListener:function(){this._delCmdEnterListener(),document.body.addEventListener("keydown",this._onCmdEnter),this._outerPopup.on({modName:"visible",modVal:"yes"},this._addCmdEnterListener).on({modName:"visible",modVal:""},this._delCmdEnterListener)},_delCmdEnterListener:function(){document.body.removeEventListener("keydown",this._onCmdEnter),this._outerPopup.un({modName:"visible",modVal:"yes"},this._addCmdEnterListener).un({modName:"visible",modVal:""},this._delCmdEnterListener)},_onCmdEnter:function(t){"Enter"===t.code&&(t.ctrlKey||t.metaKey)&&(t.stopPropagation(),t.preventDefault(),this._submitButton.domElem.click())}})},,,,,,,,,,,,,,,,function(t,e){BEM.DOM.decl("mi-staff-card",{_buildMStaffCard:function(t){t&&t.gap&&t.gap.time&&(t.gap.time=t.gap.time.replace(/\&nbsp;/g," ")),this.__base.apply(this,[t])}},{live:!1})},,function(t,e){BEM.DOM.decl({block:"m-editor-popup",modName:"type",modVal:"form"},{_bindEvents:function(){this.__base.apply(this,arguments),this.on("error",this._onError,this)},_onError:function(t,e){BEM.channel("notification").trigger("error",e)},_setIframeSrc:function(){var t=this._formOptions.adminUrl+this._formId+"/edit";this.elem("iframe").attr("src",t)}})},,,,,,function(t,e){BEM.DOM.decl("b-page-more",{onSetMod:{js:{inited:function(){this._createPageMorePanel(),this.findBlockOn("button2").on("click",this._toggle,this)}}},_toggle:function(){this._popup.toggleMod("visible","yes","")},_createPageMorePanel:function(){var t=this.params.pageData;if(!this._popup){var e=BEM.WISTORE.get("page"),i=e.get("currentUser").uid,s=!e.get("isReadonly")||Boolean(e.get("authors").find((function(t){return t.uid===i})));this._popup=BEM.DOM.after(this.domElem,BEMHTML.apply({block:"popup2",mods:{theme:"normal",target:"anchor",autoclosable:"yes"},directions:["bottom-right"],content:{block:"b-page-more-panel",actuality:BEM.blocks["i-global"].getbPage().getMod("actuality"),user:t.user,breadcrumbs:t.data.breadcrumbs,redirect:e.get("redirect"),canCopy:s,disable:this.params.disable}})).bem("popup2").setAnchor(this.domElem),this._popup.findBlockInside("b-page-more-panel").bindTo("click",function(){this._popup.delMod("visible")}.bind(this))}}})},function(t,e){BEM.DOM.decl("w-action",{onSetMod:{js:function(){this.bindTo(this.domElem,"mouseup",this._onClick.bind(this))},progress:{yes:function(){var t=this._getProgressBlocks();t.paranja.open(),t.spinner.setMod("progress","yes")},"":function(){var t=this._getProgressBlocks();t.paranja.close(),t.spinner.delMod("progress")}}},_onClick:function(t){this._run(t)},_run:function(){var t=!0,e=BEM.WISTORE.get("page");return!e||!e.get("redirect")||-1!==this.__self._allowWidgetsOnRedirectPage.indexOf(this.getMod("type"))||this.params&&this.params.isAction||(t=!1,this._redirectMessageWidget||(this._redirectMessageWidget=BEM.DOM.append(BEM.DOM.scope,BEMHTML.apply({block:"b-widget",mods:{type:"redirect-message"}})).bem("b-widget")),this._redirectMessageWidget.show()),t},_showOutside:function(t,e){var i=!0;return this.params.isAction?this.__self._isNewTabClick(t)?window.open(this.params.source+"/"+e,"_blank").focus():location.href=this.params.source+"/"+e:this.__self._isNewTabClick(t)?window.open(BEM.blocks["wi-history"].getCorrectPath()+e,"_blank").focus():i=!1,i},_getProgressBlocks:function(){return this.__self._progressBlocks||(this.__self._progressBlocks={paranja:BEM.DOM.append(BEM.DOM.scope,BEMHTML.apply({block:"paranja",mods:{type:"widget-progress"}})).bem("paranja"),spinner:BEM.DOM.append(BEM.DOM.scope,BEMHTML.apply({block:"spin2",mods:{size:"m",type:"widget-progress"}})).bem("spin2")}),this.__self._progressBlocks},_pushState:function(t,e){BEM.blocks["wi-history"].pushState(e)}},{_isNewTabClick:function(t){return t&&"mouseup"===t.type&&(keymaster.command||keymaster.ctrl||2===t.which)},_allowWidgetsOnRedirectPage:["settings","sub","tree"]})},,function(t,e){BEM.DOM.decl({block:"w-action",modName:"type",modVal:"delete"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.params&&this.params.isAction||BEM.channel("common").on("w-action.delete",this._run,this)}},_onGetData:function(t,e,i){this._widget=BEM.DOM.append(BEM.DOM.scope,BEMHTML.apply({block:"b-widget",mods:{type:"page-delete"},js:{pages:e.data.wiki_pages,users:i.data,breadcrumbs:this.params.breadcrumbs}})).bem("b-widget"),this._widget.show(),this._pushState(t,".delete")},_onGetDataError:function(t){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,BEM.I18N("w-action","cant_load_data"),t))},_run:function(t,e){var i=this.__base.apply(this,arguments);i&&BEM.WISTORE.get("page").get("canEdit")&&(this._showOutside(t,".delete")||(this._widget?(this._widget.show(),this._pushState(e,".delete")):(this.setMod("progress","yes"),$.when(BEM.create("wi-api-request",{apiPath:".referrers",method:"GET",data:!1,urlParams:"",path:BEM.blocks["wi-history"].getCorrectPath()}).run(),BEM.create("wi-api-request",{apiPath:".watchers",method:"GET",data:!1,urlParams:!1,path:BEM.blocks["wi-history"].getCorrectPath()}).run()).then(this._onGetData.bind(this,e),this._onGetDataError.bind(this)).always(function(){this.delMod("progress")}.bind(this)))))}})},function(t,e){BEM.DOM.decl({block:"w-action",modName:"type",modVal:"move"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._bPage=BEM.blocks["i-global"].getbPage(),this._path=this.params.source||BEM.blocks["wi-history"].getCorrectPath(),this.params&&this.params.isAction||BEM.channel("common").on("w-action.create-move",this._run,this)}},_movePage:function(t){var e;this._moveWidget?(this._moveWidget.show(),this._pushState(t,".move")):(e=BEMHTML.apply({block:"b-widget",mods:{type:"page-move","page-move":this.params.type},js:{type:this.params.type}}),BEM.DOM.append(this._bPage.domElem,e),this._initWidget(t))},_initWidget:function(t){BEM.create("wi-api-request",{apiPath:".move",method:"GET",data:!1,urlParams:!1,path:this._path}).run().then(this._onSuccess.bind(this,t),BEM.blocks["wi-notification"].errorHandler())},_onSuccess:function(t,e){this._moveWidget=this._bPage.findBlockInside({block:"b-widget",modName:"page-move",modVal:this.params.type}),this._moveWidget.params.data=e.data,this._moveWidget.params.ajaxPath=this._path,this._moveWidget.show(),this._pushState(t,".move")},destruct:function(){BEM.channel("common").un("w-action.create-move"),this.__base.apply(this,arguments)},_run:function(t,e){var i=this.__base.apply(this,arguments);i&&(this._showOutside(t,".move")||this._movePage(e))}})},function(t,e){BEM.DOM.decl({block:"w-action",modName:"type",modVal:"old-page"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.__self._bPage||(this.__self._bPage=BEM.blocks["i-global"].getbPage()),this.params&&this.params.isAction||BEM.channel("common").on("w-action.create-old-page",this._run,this)}},_initWidget:function(){var t=this,e=this.__self._widget;this.__self._linksContainer=e.findElem("links"),this.__self._addLinksButton=e.findBlockInside("link"),this.__self._cancelButton=e.findBlockInside({block:"button2",modName:"role",modVal:"old-page-cancel"}),this.__self._sendButton=e.findBlockInside({block:"button2",modName:"role",modVal:"old-page"}),this.__self._spinner=e.findBlockInside({block:"spin2",modName:"type",modVal:"old-page"}),this.__self._addLinksButton.bindTo("click",(function(){BEM.DOM.append(t.__self._linksContainer,BEMHTML.apply({block:"b-widget",elem:"link",content:{block:"input",mods:{size:"s"},placeholder:BEM.I18N("w-action","link_wiki_page"),content:[{elem:"control"}]}}))})),this.__self._cancelButton.on("click",(function(){e.hide()})),this.__self._sendButton.on("click",(function(){var i=e.findBlockInside(e.elem("comment"),"input"),s=e.findBlocksInside(t.__self._linksContainer,"input"),o=e.getMod("actuality"),n=[];s.forEach((function(t){var e=t.val();e&&n.push(e)}));var a={actual:"actual"!==o,comment:i.val(),links:n};t.__self._spinner.setMod("progress","yes"),BEM.create("wi-api-request",{apiPath:".actuality",method:"POST",data:a,urlParams:!1,path:BEM.blocks["wi-history"].getCorrectPath()}).run().then(t._onSuccess.bind(t),BEM.blocks["wi-notification"].errorHandler(t.__self._sendButton.domElem,BEM.I18N("w-action","mark_failed"))).always((function(){t.__self._spinner.delMod("progress")}))}))},_onSuccess:function(){var t="actual"===this.__self._widget.getMod("actuality")?"obsolete":"actual";BEM.WISTORE.get("page").set("isOld","obsolete"===t);var e,i=this.__self._bPage.findBlockInside({block:"b-page-more-panel-item",modName:"type",modVal:"old-page"}),s=this.__self._bPage.findBlockInside({block:"b-grid-table-options-item",modName:"action",modVal:"old-page"}),o=i||s;this.__self._widget.hide(),this._refreshWidgetForm(),"possibly-obsolete"===this.__self._bPage.getMod("actuality")&&(e=this.__self._bPage.findBlockInside({block:"w-page-info",modName:"type",modVal:"possibly-obsolete"}))&&e.hide(),this.__self._bPage.setMod("actuality",t),o&&(o.domElem.text("obsolete"===t?BEM.I18N("w-action","mark_as_actual"):BEM.I18N("w-action","mark_as_obsolete")),o.findBlockOn({block:"w-action",modName:"type",modVal:"old-page"}).params.actuality=t)},_refreshWidgetForm:function(){var t=this.__self._widget,e=t.findBlockInside(t.elem("comment"),"input"),i=t.findBlocksInside(this.__self._linksContainer,"input");e.val(""),i.forEach((function(t,e){t.val(""),e>0&&t.destruct()}))},destruct:function(){BEM.channel("common").un("w-action.create-old-page"),this.__base.apply(this,arguments)},_run:function(t,e){var i=this.__base.apply(this,arguments);i&&this.afterCurrentEvent((function(){var i;this.__self._isNewTabClick(t)?window.open(BEM.blocks["wi-history"].getCorrectPath()+".obsolete","_blank").focus():(this._pushState(e,".obsolete"),this.__self._widget||(i=BEMHTML.apply({block:"b-widget",mods:{type:"old-page"}}),BEM.DOM.append(this.__self._bPage.domElem,i),this.__self._widget=this.__self._bPage.findBlockInside({block:"b-widget",modName:"type",modVal:"old-page"}),this._initWidget()),this.__self._widget.setMod("actuality",this.params.actuality),this.__self._widget.show())}))}})},function(t,e){BEM.DOM.decl("b-old-page-mark",{onSetMod:{js:function(){this.bPage=BEM.blocks["i-global"].getbPage(),this._popup=this.findBlockInside("popup2").setAnchor(this.domElem)}},_onClick:function(){this._popup.hasMod("visible","yes")?this._popup.delMod("visible"):this._showPopup()},_showPopup:function(){this._loaded?this._popup.setMod("visible","yes"):BEM.create("wi-api-request",{apiPath:".actuality",path:BEM.blocks["wi-history"].getCorrectPath(),urlParams:["format=json"]}).run().then(this._onGotData.bind(this),this._onFailedData.bind(this))},_onGotData:function(t){var e=BEMHTML.apply(this._getContentBEMJSON(t.data)),i=this;BEM.DOM.append(this._popup.elem("content"),e),this._button=this._popup.findBlockInside({block:"button2",modName:"type",modVal:"old-page-mark"}),this._button.on("click",(function(){i._popup.delMod("visible")}),this),this._popup.setMod("visible","yes"),this._loaded=!0},_getContentBEMJSON:function(t){var e=t.marked_at,i=t.user,s=t.comment,o=t.links,n=[];return e&&i&&n.push({block:"b-old-page-mark",elem:"user-date",content:[{block:"m-username",mods:{dismissed:i.is_dismissed?"yes":""},mix:[{block:"mi-staff-card",js:{user:i.login}}],url:"//staff.yandex-team.ru/"+i.login,content:i.display},": "+BEM.I18N("b-old-page-mark","marked_obsolete")+" ",{block:"m-date",format:"full",timestamp:e}]}),s&&n.push({block:"b-old-page-mark",elem:"comment",content:s}),o&&o.length&&(n.push({block:"b-old-page-mark",elem:"links-title",content:BEM.I18N("b-old-page-mark","actual_pages")+":"}),o.forEach((function(t){n.push({block:"b-old-page-mark",elem:"link",content:{block:"link",url:t,content:t}})}))),n.push({block:"b-old-page-mark",elem:"button",content:{block:"button2",mods:{size:"s",type:"old-page-mark",theme:"normal"},mix:[{block:"w-action",mods:{type:"old-page"},js:{actuality:"obsolete"}}],text:BEM.I18N("b-old-page-mark","unmark")}}),n},_onFailedData:function(t){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,null,t)),this._popup.setMod("visible","yes")}},{live:function(){this.liveBindTo("click",(function(t){this._onClick(t)}))}})},function(t,e){BEM.DOM.decl({block:"w-action",modName:"type",modVal:"settings"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._path=this.params.source||BEM.blocks["wi-history"].getCorrectPath(),this.params&&this.params.isAction||BEM.channel("common").on("w-action.create-settings",this._run,this)}},_onGotSettingsData:function(t,e,i,s,o,n){var a=BEM.WISTORE.get("page"),r=a&&a.get("redirect");Array.isArray(o)||(o=o.data.authors),this._settingsWidget=BEM.DOM.append(BEM.DOM.scope,BEMHTML.apply({block:"b-widget",mods:{type:"page-settings"},js:{redirect:e.data.redirect_to_tag,keywords:i.data.keywords,authors:o,canEdit:this.params.user.is_admin||o.some((function(t){return t.login===this.params.user.login}),this),ajaxPath:this._path,isRedirectPage:r,comments:s.data,readonly:n.data.is_readonly}})).bem("b-widget"),this._settingsWidget.show(t&&t.tab),this._pushState(t,".settings")},_onFailedSettingsData:function(){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,BEM.I18N("w-action","cant_get_settings")))},destruct:function(){BEM.channel("common").un("w-action.create-settings"),this.__base.apply(this,arguments)},_run:function(t,e){var i=this.__base.apply(this,arguments),s=e&&e.tab,o=BEM.WISTORE.get("page"),n=o&&o.get("authors");i&&(this.params.isAction?this.__self._isNewTabClick(t)?window.open(this.params.source+"/.settings","_blank").focus():location.href=this.params.source+"/.settings":this.__self._isNewTabClick(t)?window.open(BEM.blocks["wi-history"].getCorrectPath()+".settings","_blank").focus():this._settingsWidget?(this._pushState(e,".settings"),this._settingsWidget.show(s)):(this.setMod("progress","yes"),$.when(BEM.create("wi-api-request",{apiPath:".redirect",method:"GET",path:this._path}).run(),BEM.create("wi-api-request",{apiPath:".keywords",method:"GET",path:this._path}).run(),BEM.create("wi-api-request",{apiPath:".comments/status",method:"GET",data:!1,urlParams:!1,path:BEM.blocks["wi-history"].getCorrectPath()}).run(),n||BEM.create("wi-api-request",{apiPath:".authors",method:"GET",path:this._path}).run(),BEM.create("wi-api-request",{apiPath:".readonly",method:"GET",data:!1,urlParams:!1,path:BEM.blocks["wi-history"].getCorrectPath()}).run()).then(this._onGotSettingsData.bind(this,e),this._onFailedSettingsData.bind(this)).always(function(){this.delMod("progress")}.bind(this))))}})},function(t,e){BEM.DOM.decl({block:"w-action",modName:"type",modVal:"sub"},{_run:function(){var t=this.__base.apply(this,arguments);t&&(yaCounter&&yaCounter.reachGoal("create_subpage"),BEM.channel("common").trigger("b-head.newPageCreate"))}})},function(t,e){BEM.DOM.decl({block:"w-action",modName:"type",modVal:"subscribe"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.params&&this.params.isAction||BEM.channel("common").on("w-action.create-subscribe",this._run,this)}},_run:function(t,e){var i=this.__base.apply(this,arguments);i&&(this.__self._isNewTabClick(t)?window.open(BEM.blocks["wi-history"].getCorrectPath()+".subscribe","_blank").focus():(this.setMod("progress","yes"),BEM.create("wi-api-request",{apiPath:".watchers",method:"GET",data:!1,urlParams:!1,path:BEM.blocks["wi-history"].getCorrectPath()}).run().then(this._onGetSubscribers.bind(this,e),this._onFailGetSubscribers.bind(this)).always(function(){this.delMod("progress")}.bind(this))))},_onGetSubscribers:function(t,e){var i=e.data,s=t&&t.subscribersTab;this._pushState(t,".subscribe"),this._widget||(this._widget=BEM.DOM.append(BEM.DOM.scope,BEMHTML.apply({block:"b-widget",mods:{type:"subscribe",subscribers:s?"yes":""},subscribers:i})).bem("b-widget")),this._widget.show(!1,i,s)},_onFailGetSubscribers:function(t){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,BEM.I18N("w-action","cant_load_subscribers"),t))},_pushState:function(t,e){t&&t.subscribersTab||BEM.blocks["wi-history"].pushState(e)}})},function(t,e){BEM.DOM.decl({block:"w-action",modName:"type",modVal:"tree"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.params&&this.params.isAction||BEM.channel("common").on("w-action.create-tree",this._run,this)}},destruct:function(){BEM.channel("common").un("w-action.create-tree"),this.__base.apply(this,arguments)},_run:function(t,e){var i=this.__base.apply(this,arguments);i&&(this._showOutside(t,".tree")||(this._treeWidget?(this._treeWidget.show(e),this._pushState(e,".tree")):(this.setMod("progress","yes"),BEM.create("wi-api-request",{apiPath:".tree",method:"GET",data:!1,urlParams:["depth=3","show_redirects=True","show_grids=True","show_titles=True","nomark=True"],path:BEM.blocks["wi-history"].getCorrectPath()}).run().then(this._onGotTreeData.bind(this,e),this._onFailGotTreeData.bind(this)).always(function(){this.delMod("progress")}.bind(this)))))},_onGotTreeData:function(t,e){e.data?(this._treeWidget=BEM.DOM.append(BEM.DOM.scope,BEMHTML.apply({block:"b-widget",mods:{type:"tree"},data:e.data})).bem("b-widget"),this._treeWidget.show(t),this._pushState(t,".tree")):this._onFailGotTreeData()},_onFailGotTreeData:function(t){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,BEM.I18N("w-action","cant_get_tree"),t))}})},function(t,e){BEM.DOM.decl({block:"w-action",modName:"type",modVal:"unsubscribe"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.params&&this.params.isAction||BEM.channel("common").on("w-action.create-unsubscribe",this._run,this)}},destruct:function(){BEM.channel("common").un("w-action.create-unsubscribe"),this.__base.apply(this,arguments)},_run:function(){var t=this.__base.apply(this,arguments);t&&(this._unsubscribeWidget||(this._unsubscribeWidget=BEM.DOM.append(BEM.DOM.scope,BEMHTML.apply({block:"b-widget",mods:{type:"unsubscribe"}})).bem("b-widget")),this._unsubscribeWidget.show())}})},function(t,e){BEM.DOM.decl({block:"w-action",modName:"type",modVal:"referrers"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.params&&this.params.isAction||BEM.channel("common").on("w-action.create-referrers",this._run,this)}},_onGetData:function(t){this._widget=BEM.DOM.append(BEM.DOM.scope,BEMHTML.apply({block:"b-widget",mods:{type:"referrers"},js:{pages:t.data.wiki_pages}})).bem("b-widget"),this._widget.show(),BEM.blocks["wi-history"].pushState(".referrers")},_onGetDataError:function(t){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,BEM.I18N("w-action","cant_load_data"),t))},_run:function(t){var e=this.__base.apply(this,arguments);e&&(this._showOutside(t,".referrers")||(this._widget?(this._widget.show(),BEM.blocks["wi-history"].pushState(".referrers")):(this.setMod("progress","yes"),BEM.create("wi-api-request",{apiPath:".referrers",method:"GET",data:!1,urlParams:"",path:BEM.blocks["wi-history"].getCorrectPath()}).run().then(this._onGetData.bind(this),this._onGetDataError.bind(this)).always(function(){this.delMod("progress")}.bind(this)))))}})},function(t,e){BEM.DOM.decl({block:"w-action",modName:"type",modVal:"files"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.params&&this.params.isAction||BEM.channel("common").on("w-action.open-sidebar-files",this._run,this)}},_run:function(){var t=this.__base.apply(this,arguments);t&&BEM.channel("sidebar").trigger("tab:select",{tabName:"files"})}})},function(t,e){BEM.DOM.decl({block:"w-action",modName:"type",modVal:"authors"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this.params&&this.params.isAction||BEM.channel("common").on("w-action.create-authors",this._run,this)}}},destruct:function(){BEM.channel("common").un("w-action.create-authors"),this.__base.apply(this,arguments)},_run:function(t){var e=this.__base.apply(this,arguments);e&&(this._showOutside(t,".authors")||(this._authorsWidget?(this._authorsWidget.show(),this._pushState(null,".authors")):(this.setMod("progress","yes"),BEM.create("wi-api-request",{apiPath:".authors",method:"GET",data:!1,urlParams:!1,path:BEM.blocks["wi-history"].getCorrectPath()}).run().then(this._onGetAuthorsData.bind(this),this._onFailGetAuthorsData.bind(this)).always(function(){this.delMod("progress")}.bind(this)))))},_onGetAuthorsData:function(t){this._authorsWidget=BEM.DOM.append(BEM.DOM.scope,BEMHTML.apply({block:"b-widget",mods:{type:"authors"},user:t.user,authors:t.data.authors})).bem("b-widget"),this._authorsWidget.show(),this._pushState(null,".authors")},_onFailGetAuthorsData:function(t){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,BEM.I18N("w-action","cant_get_authors"),t))}})},function(t,e){BEM.DOM.decl({block:"w-action",modName:"type",modVal:"request-page-author"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.params&&this.params.isAction||BEM.channel("common").on("w-action.create-request-page-author",this._run,this)}},_run:function(t,e){var i=this.__base.apply(this,arguments);i&&(this._widget||(this._widget=BEM.DOM.append(BEM.DOM.scope,BEMHTML.apply({block:"b-widget",mods:{type:"request-page-author"},request_login:e.params&&e.params.new_author})).bem("b-widget")),this._widget.show())}})},,,,,,function(t,e){BEM.DOM.decl("b-page-more-panel-item",{},{live:function(){this.liveBindTo("click",(function(){this.trigger("click")}))}})},function(t,e){BEM.DOM.decl({block:"w-action",modName:"type",modVal:"edit"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._bPage=BEM.blocks["i-global"].getbPage(),this._button=this.findBlockOn("button2"),this._localStorage=BEM.blocks["mi-storage"],this._appStore=BEM.WISTORE.get("app"),this._bindEvents()},progress:{yes:function(){this._button.setMod("disabled","yes")},"":function(){this._button.delMod("disabled")}}},destruct:function(){BEM.channel("common").un("w-action.open-editor",this._run,this),this.__base.apply(this,arguments)},_bindEvents:function(){this.params&&this.params.isAction||BEM.channel("common").on("w-action.open-editor",this._run,this),BEM.WISTORE.get("app").on("change:view",this._onPageViewChange,this)},_run:function(t,e){var i=e.params||{},s=this.__base.apply(this,arguments);s&&BEM.WISTORE.get("page").get("canEdit")&&(yaCounter&&yaCounter.reachGoal("edit"),this.params.revisionId&&(i.revision=this.params.revisionId),this.setMod("progress","yes"),this._getDataForEditor(i).then(function(t){var s=t.data,o=this._getEditor(),n=location.search||"?";if(s.redirect_to_tag)location.href="/"+s.redirect_to_tag+"/.edit";else{switch(i.revision&&(n=$.url.setParam(n,"revision",i.revision)),s.version&&(BEM.blocks["i-global"].pageVersion=s.version),o.open({type:this._button.params.type,body:s.body,title:s.title}),this._bPage.setMod("editor","visible"),this.delMod("progress"),1===n.length&&(n=""),this._button.params.type){case"edit":n&&!i.section?this._pushState(e,".edit"+n):-1===location.pathname.indexOf(".edit")&&this._pushState(e,".edit");break;case"create":this._bPage.setMod("new-page","visible"),this._subPagePreview()}BEM.channel("common").trigger("update",{type:"page-title",data:s.title}),this._appStore.set({action:"edit",view:"edit"})}}.bind(this)).done())},_getDataForEditor:function(t){var e=["_for_update"],i=BEM.blocks["wi-history"].getCorrectPath();return t&&(t.section&&!t.revision&&e.push("section_id="+t.section),t.revision&&(this._bPage.setMod("revision","edit"),e.push("revision="+t.revision)),t.path&&(i.toLocaleLowerCase()!==t.path.toLocaleLowerCase()&&history.replaceState({url:location.pathname+location.search+"&originpath="+t.path},null,location.pathname+location.search+"&originpath="+t.path),i=t.path),t.originpath&&(i=t.originpath)),BEM.create("wi-api-request",{apiPath:".raw",method:"GET",data:!1,urlParams:e,path:i}).run().then(this._onGetEditorData.bind(this),this._onGetEditorDataError.bind(this))},_onGetEditorData:function(t){return t},_onGetEditorDataError:function(t){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,BEM.I18N("b-editor-open-button","cant_load_wiki_text"),t))},_subPagePreview:function(){this._subPageHint&&this._subPageHint.domElem.text(this._editor.params.url+"'"+BEM.I18N("b-editor-open-button","subpage_address")+"'"),this._subpageBlock||(this._subpageBlock=this._editor.findBlockInside({block:"input",modName:"type",modVal:"subpage"}),this._subPageHint=this._editor.findBlockInside("b-subpage-hint"),this._subpageBlock.on("change",(function(){this._subPageHint.domElem.text(this._editor.params.url+"/"+this._subpageBlock.elem("control").val())}),this))},_getEditor:function(){if(!this.__self._editor){var t=this._bPage.findBlockInside("b-content").domElem,e=BEMHTML.apply(this.__self._getEditorBemjson());BEM.DOM.after(t,e),this.__self._editor=this._bPage.findBlockInside("page-editor"),BEM.channel("common").trigger("created",{type:"editor"})}return this.__self._editor},_onPageViewChange:function(t,e){"edit"===e?this._setEditTitle():"view"===e&&"edit"===t._previousAttributes.view&&this._removeEditTitle(),BEM.WISTORE.get("page").get("canSwitchWf")&&("edit"===e?(this._getEditor().showPromoWf(),this._getEditor().changeWfTumbler(BEM.WISTORE.get("page").get("withNewWf"))):"view"===e&&"edit"===t._previousAttributes.view&&this._getEditor().hidePromoWf())},_setEditTitle:function(){0!==document.title.indexOf("* ")&&(document.title="* "+document.title)},_removeEditTitle:function(){0===document.title.indexOf("* ")&&(document.title=document.title.replace("* ",""))},_onClick:function(t){if(t.ctrlKey||t.metaKey)return!0;t.preventDefault(),this._run(t,{params:BEM.blocks["wi-history"].parseQueryParams()})}},{_getEditorBemjson:function(){var t=BEM.WISTORE.get("page");return{block:"page-editor",withNewWf:t.get("withNewWf"),canSwitchWf:t.get("canSwitchWf")}}})},function(t,e,i){function s(t,e,i,s,o,n,a){try{var r=t[n](a),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(s,o)}function o(t){return function(){var e=this,i=arguments;return new Promise((function(o,n){var a=t.apply(e,i);function r(t){s(a,o,n,r,l,"next",t)}function l(t){s(a,o,n,r,l,"throw",t)}r(void 0)}))}}BEM.DOM.decl("page-editor",{_currentKey:"",onSetMod:{js:function(){this._buttons=this.findBlockInside("m-editor-buttons"),this._saveBtn=this.findBlockInside("b-editor-save-button"),this._title=this.findBlockInside("m-replacer"),this._debouncedSave=this.__self._debounce(this._saveBtn._onClick.bind(this._saveBtn),2e3,{leading:!0,trailing:!1}),this._wfTumbler=this.findBlockInside("wf-switcher","tumbler"),this._wfTumbler&&this._wfTumbler.on("change",this._onWfTumblerChange,this);var t="true"===(BEM.blocks["mi-storage"].getItem("split-enabled")||"true");this._splitTumbler=this.findBlockInside("split-switcher","tumbler").setMod("checked",t?"yes":"").on("change",this._onSplitTumblerChange,this),this._debouncedOnEditorChange=this.__self._debounce(this._renderSplitPreview.bind(this),500)},preview:function(t,e){var i=e?"yes":"";this._wfTumbler&&this._wfTumbler.setMod("disabled",i),this._splitTumbler&&this._splitTumbler.setMod("disabled",i)},newwf:{true:function(){this.setMod("split",this._splitTumbler.hasMod("checked","yes"))},"":function(){this.delMod("split")}},split:{true:function(){var t=this;return o(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t._split?t._currentSizes&&t._split.setSizes(t._currentSizes):t._initSplit(),t._bindSplitEvents(),e.next=4,t._renderSplitPreview();case 4:case"end":return e.stop()}}),e)})))()},"":function(){this._editorInput.domElem.attr({style:"width: 100%"}),this._editor.un("change"),this.unbindFrom(this._editorInput.elem("control"),"input",this._debouncedOnEditorChange)}}},destruct:function(){return this._debouncedSave.cancel(),this._debouncedOnEditorChange.cancel(),this.__base.apply(this,arguments)},open:function(t){var e=this;return o(regeneratorRuntime.mark((function i(){var s;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(s=BEM.blocks["wi-history"].getSuperTag(),e._openEditor(s),e._saveBtn.setMod("status",t.type),e._editor.setText(t.body||""),e._title.setText(t.title||""),i.t0=e.hasMod("split"),!i.t0){i.next=9;break}return i.next=9,e._renderSplitPreview();case 9:case"end":return i.stop()}}),i)})))()},setText:function(t){this._editor.setText(t)},getText:function(){return this._editor.val()},onSuccessSubmit:function(){this._editor.revert(),this._editor.close(),keymaster.unbind("ctrl+enter, command+enter","all")},changeWfTumbler:function(t){this._wfTumbler&&this._wfTumbler.val(String(t))},isNewWf:function(){return this._wfTumbler?"true"===this._wfTumbler.val():BEM.WISTORE.get("page").get("withNewWf")},showPromoWf:function(){var t=BEM.blocks["mi-storage"].getItem("wf-promo");t?t=JSON.parse(t):(t={shown:!1},BEM.blocks["mi-storage"].setItem("wf-promo",JSON.stringify(t))),t.shown||(this._wfTooltip||(this._wfTooltip=BEM.DOM.append(BEM.DOM.scope,BEMHTML.apply(this.__self._getTooltipBemjson())).bem("tooltip")),this._wfTooltip.setOwner(this._wfTumbler).setMod("shown","yes"),this._wfTooltip.elem("close").on("click",this._onPromoWfClose),this._wfTooltip.findBlocksInside("link").forEach((function(t){t.bindTo("click",(function(t){t.stopPropagation()}))})))},hidePromoWf:function(){this._wfTooltip&&this._wfTooltip.setMod("shown","")},_initSplit:function(){var t=this;BEM.DOM.append(this._editor.domElem,BEMHTML.apply({block:"page-editor",elem:"split-preview",attrs:{id:"split-preview"},cls:"split"})),this._split=this.__self.Split(["#split-editor","#split-preview"],{sizes:[100,0],minSize:[200,200],expandToMin:!0,direction:"horizontal",onDragEnd:function(e){BEM.blocks["mi-storage"].setItem("split-sizes",JSON.stringify(e)),t._currentSizes=e}}),this._splitFormatter=new Ya.FormatterViewPort({domElem:this.findElem("split-preview")[0],settings:{renderActionsByClick:!0,extensions:{"wiki-head":null}}});var e=BEM.blocks["mi-storage"].getItem("split-sizes");return this._currentSizes=e?JSON.parse(e):[70,30],this._split.setSizes(this._currentSizes),this},_bindSplitEvents:function(){return this._editor.on("change",this._debouncedOnEditorChange),this.bindTo(this._editorInput.elem("control"),"input",this._debouncedOnEditorChange),this},_onPromoWfClose:function(){BEM.blocks["mi-storage"].setItem("wf-promo",JSON.stringify({shown:!0}))},_onWfTumblerChange:function(t,e){this.setMod("newwf",e.checked)},_onSplitTumblerChange:function(t,e){BEM.blocks["mi-storage"].setItem("split-enabled",e.checked),this.setMod("split",e.checked)},_renderSplitPreview:function(){var t=this;return o(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._splitFormatter.render(t._editor.val());case 2:BEM.DOM.init(t.findElem("split-preview"));case 3:case"end":return e.stop()}}),e)})))()},_openEditor:function(t){var e=this._currentKey&&this._currentKey!==t;return this._currentKey!==t&&this._renderEditor(t),this._debouncedSave.cancel(),keymaster.unbind("ctrl+enter, command+enter"),keymaster("ctrl+enter, command+enter",this._debouncedSave),this._editor.hasNewDraft=!1,this._editorInput=this._editor.findBlockInside("textarea"),this.setMod("newwf",this.isNewWf()),e&&(this._split=null,this.hasMod("split")&&this._initSplit()._bindSplitEvents()),this._editor},_renderEditor:function(t){var e=BEM.blocks["wi-history"].getCorrectPath(),i=BEM.blocks["i-global"].param("hosts").wikiApi.v1+"/pages"+e+".files?format=json",s=BEM.blocks["i-global"].param("hosts").formsApi+"/surveys/",o=BEM.blocks["i-global"].param("hosts").formsAdmin,n=BEMHTML.apply({block:"page-editor",elem:"editor",key:t,uploadUrl:i,formsApiUrl:s,formsAdminUrl:o,user:BEM.blocks["i-global"].param("login")});BEM.DOM.replace(this.findElem("editor"),n),this._editor=this.findBlockInside("m-editor"),this._editor.init(this._buttons),this._currentKey=t}},{Split:i(1111).default,_debounce:i(1112),_getTooltipBemjson:function(){return{block:"tooltip",mix:{block:this.getName(),elem:"wf-promo"},mods:{size:"l",theme:"promo",view:"classic",tone:"default"},js:{to:["top-right","top-left"]},content:[{elem:"close"},{elem:"description",content:{html:BEM.I18N("page-editor","wf_tooltip",{markdown:BEMHTML.apply({block:"link",mods:{theme:"dark"},url:"https://daringfireball.net/projects/markdown/syntax",target:"_blank",text:"Markdown"}),more:BEMHTML.apply({block:"link",mods:{theme:"dark"},url:"https://clubs.at.yandex-team.ru/tools/15544",target:"_blank",text:BEM.I18N("page-editor","more")+"..."})})}}]}}})},,function(t,e){BEM.DOM.decl("m-replacer",{onSetMod:{js:function(){}},setText:function(t){return this.elem("text").text(t),this},getValue:function(){return this._input?this._input.val():this.elem("text").text()},closeInput:function(t){return this._input?this._input.val()||t?(this.setMod("state","view"),this.trigger("change"),this):(this._input.elem("control").focus(),this):(this.setMod("state","view"),this.trigger("change"),this)},_onClick:function(){var t=this._getInput();this.setMod("state","edit"),t.val(this.elem("text").text()),t.elem("control").focus()},_getInput:function(){return this._input||(BEM.DOM.after(this.elem("text"),BEMHTML.apply({block:this.__self._name,elem:"field",placeholder:this.params.placeholder})),this._input=this.findBlockInside("input"),this._input.on("blur",this._closeInput,this),this._input.bindTo("keypress",this._onInputKeypress.bind(this))),this._input},_onInputKeypress:function(t){13===t.keyCode&&this._closeInput()},_closeInput:function(){var t=this._input.val().trim();this.setMod("state","view");var e=t||BEM.WISTORE.get("page").get("title");this.elem("text").text(e),this._input.val(e),this.setMod(this.elem("text"),"empty",Boolean(!t)),this.trigger("change")}},{live:function(){this.liveBindTo("text","click",(function(t){this.hasMod("disabled","yes")||this._onClick(t)}))}})},function(t,e){function i(t,e,i,s,o,n,a){try{var r=t[n](a),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(s,o)}function s(t){return function(){var e=this,s=arguments;return new Promise((function(o,n){var a=t.apply(e,s);function r(t){i(a,o,n,r,l,"next",t)}function l(t){i(a,o,n,r,l,"throw",t)}r(void 0)}))}}BEM.DOM.decl("b-editor-actions",{onSetMod:{js:function(){this._bPage=this.findBlockOutside("b-page"),this._button=this.findBlockOn("radio-button"),this._pageEditor=this._bPage.findBlockInside("page-editor"),this._preview=this._pageEditor.elem("preview"),this._spinner=this.findBlockInside(this._preview,"spin2"),this._previewContent=this._pageEditor.elem("preview-content"),this._replacer=this._bPage.findBlockInside({block:"m-replacer",modName:"type",modVal:"page-title"}),this._button.on("change",this._onChange,this),this._bindEvents(),this._formatterViewPort=new Ya.FormatterViewPort({domElem:this._previewContent[0],settings:{extensions:{"wiki-doc":null,"wiki-head":null}}})}},_bindEvents:function(){BEM.channel("common").on("reset",(function(t,e){"editor-action-buttons"===e.type&&this._button.setMod(this._button.elem("radio").eq(0),"checked","yes")}),this)},_onChange:function(t){var e=this;return s(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:e.channel("errors").trigger("errorHide"),e._replacer.delMod("disabled"),i.t0=t.block._val,i.next="view"===i.t0?5:"edit"===i.t0?9:12;break;case 5:return e._pageEditor.setMod("preview"),i.next=8,e._getDataForPreview();case 8:return i.abrupt("break",12);case 9:return e._abortPreviewRequest(),e._pageEditor.delMod("preview"),i.abrupt("break",12);case 12:case"end":return i.stop()}}),i)})))()},_abortPreviewRequest:function(){this._previewRequest&&(this._previewRequest.abort(),this._spinner.delMod("progress")),BEM.DOM.destruct(this.findBlockInside(this._previewContent,"wiki-doc").domElem)},_getDataForPreview:function(){var t=this;return s(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t._pageEditor.isNewWf()){e.next=6;break}return e.next=3,t._formatterViewPort.render(t._pageEditor.getText());case 3:BEM.DOM.init(t._previewContent),e.next=11;break;case 6:t._isError&&(delete t._isError,t.channel("errors").trigger("errorHide")),t._pageData=t._pageEditor.getText(),t._spinner.setMod("progress","yes"),t._previewRequest=BEM.create("wi-api-request",{apiPath:".preview",method:"POST",data:{body:t._pageData},urlParams:!1,path:BEM.blocks["wi-history"].getCorrectPath()}),t._previewRequest.run().then(t._onGetData.bind(t),t._onGetDataError.bind(t)).always(function(){this._spinner.setMod("progress","")}.bind(t));case 11:case"end":return e.stop()}}),e)})))()},_onGetData:function(t){this._replacer.setMod("disabled","yes"),BEM.DOM.update(this._previewContent,BEMHTML.apply(t.data.bemjson)),this._previewRequest=null,this.findBlocksInside(this._previewContent,{block:"button2",modName:"type",modVal:"form-submit"}).forEach((function(t){t.setMod("disabled","yes")}))},_onGetDataError:function(t){this._isError=!0,this._previewRequest=null,BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(this.domElem,null,t))}})},function(t,e){BEM.DOM.decl("w-editor-suggest",{onSetMod:{js:{inited:function(){var t=this.params.layers;return Object.keys(t).forEach((function(e){t[e].regexp=t[e].keywords.map((function(t){return new RegExp("(?:\\s|^)("+t+"(\\S+))$","i")}))})),this._editor=this.findBlockOn("m-editor").on("change",this._onEditorChange,this),this._textarea=this._editor.elem("textarea","editor","wiki").bem("textarea").elem("control"),this._popup=BEM.DOM.append(BEM.DOM.scope,BEMHTML.apply(this.__self._getPopupBEMJSON())).bem("popup2").on({modName:"visible",modVal:""},this._onPopupHide,this),this._lastXHR=null,this._hoveredItem=null,this._inputData=null,this.__base.apply(this,arguments)}},opened:{yes:function(){this._popup.setMod("visible","yes"),BEM.blocks["m-suggest-item"].on(this._popup.domElem,{click:this._onItemClick,mouseover:this._onItemMouseOver,mouseout:this._onItemMouseOut},this),this.bindTo("keydown",this._onKeyDown)},"":function(){this._popup.delMod("visible"),BEM.blocks["m-suggest-item"].un(this._popup.domElem,{click:this._onItemClick,mouseover:this._onItemMouseOver,mouseout:this._onItemMouseOut},this),this.unbindFrom("keydown",this._onKeyDown),this._hoveredItem=null}}},_onEditorChange:function(t,e){this._inputData=this._getInputData(e),this._inputData?this._sendRequest():this.delMod("opened")},_getInputData:function(t){var e=this._textarea[0].selectionEnd;t=t.substr(0,e);for(var i=Object.keys(this.params.layers),s=0;s<i.length;s++)for(var o=this.params.layers[i[s]].regexp,n=0;n<o.length;n++){var a=t.match(o[n]);if(a)return{pattern:a[1],text:a[2],layer:i[s],start:e-a[2].length,end:e}}return null},_getRequestParams:function(){return{type:"GET",url:this.params.url,crossDomain:!0,xhrFields:{withCredentials:!0},dataType:"json",data:Object.assign({version:2,text:this._inputData.text,layers:this._inputData.layer},this.params.addRequestParams),context:this}},_sendRequest:function(){if(this._lastXHR&&"pending"===this._lastXHR.state())try{this._lastXHR.abort()}catch(t){}this._lastXHR=$.ajax(this._getRequestParams()).done(this._onRequestDone).fail(this._onRequestFail)},_onRequestDone:function(t){if(this._hoveredItem=null,this._inputData){var e=t[this._inputData.layer].result||[];if(e.length){var i=this._getPopupPosition();this._popup.setPosition(i.left,i.top).setContent(BEMHTML.apply({block:this.__self.getName(),elem:"items",content:this._getItems(e)})),this._items=this._popup.findBlocksInside("m-suggest-item"),this.setMod("opened","yes")}else this.delMod("opened")}},_onRequestFail:function(){throw new Error("w-editor-suggest:request failed")},_getPopupPosition:function(){this._textarea[0].selectionStart-=this._inputData.pattern.length;var t=this._textarea.caret("offset");return this._textarea[0].selectionStart+=this._inputData.pattern.length,{left:t.left,top:t.top+t.height/2}},_getItems:function(t){var e=this.params.layers[this._inputData.layer].itemType;return t.map((function(t){return{block:"m-suggest-item",mods:{type:e},inputData:{text:this._inputData.text},data:this.__self.transformData(e,t)}}),this)},_setVal:function(t){var e=this._inputData.start,i=this._inputData.end,s=this._textarea.val();this._textarea.val(s.substr(0,e)+t+s.substr(i)),this._textarea[0].selectionEnd=e+t.length,this.delMod("opened")},_onItemClick:function(t){var e=this.params.layers[this._inputData.layer].valueField;this._setVal(e?t.block.params.fullData[e]:t.block.params.value)},_onItemMouseOut:function(){this._hoveredItem&&this._hoveredItem.delMod("hovered")},_onItemMouseOver:function(t){this._hoverItem(t.block)},_hoverItem:function(t){this._hoveredItem&&this._hoveredItem.delMod("hovered"),this._hoveredItem=t,this._hoveredItem.setMod("hovered","yes")},_toggleItem:function(t){var e=this._items.length;if(e){var i=this._items.indexOf(this._hoveredItem)+t;i>=e&&(i=0),i<0&&(i=e-1),this._hoverItem(this._items[i])}},_onKeyDown:function(t){var e=BEM.blocks.keycodes;if(this.hasMod("opened")&&(t.keyCode!==e.UP&&t.keyCode!==e.DOWN||(t.preventDefault(),this._toggleItem(t.keyCode===e.UP?-1:1)),t.keyCode===e.ENTER&&this._hoveredItem)){t.preventDefault();var i=this.params.layers[this._inputData.layer].valueField,s=i?this._hoveredItem.params.fullData[i]:this._hoveredItem.params.value;this._setVal(s)}},_onPopupHide:function(){this.delMod("opened")},destruct:function(){return this.delMod("opened"),this._popup&&this._popup.destruct(),this.__base.apply(this,arguments)}},{_getPopupBEMJSON:function(){return{block:"popup2",mods:{target:"position",theme:"normal",autoclosable:"yes",role:"editor-suggest"},mainOffset:12,directions:["bottom-left","bottom-right","top-left","top-right"]}},transformData:function(t,e){switch(t){case"b2b-people":return $.extend(e,{fields:["avatar_url","department_name","is_dismissed","login"].map((function(t){return{type:t,value:e[t]}}))});case"maillist":return $.extend(e,{email:e.id,name:e.title});case"group":return $.extend(e,{name:e.title});case"staff":return $.extend(e,{department:e.department_name});default:return e}}})},,function(t,e){BEM.DOM.decl("b-editor-close-button",{onSetMod:{js:{inited:function(){this._bPage=BEM.blocks["i-global"].getbPage(),this._pageTitle=this._bPage.findBlockInside({block:"m-replacer",modName:"type",modVal:"page-title"}),this._localStorage=BEM.blocks["mi-storage"],this._appStore=BEM.WISTORE.get("app"),this.bindTo("click",this._onClick.bind(this)),keymaster("esc",this._closeOnESC.bind(this))}}},_getEditor:function(){return this._bPage.findBlockInside({block:"m-editor",modName:"type",modVal:"edit-page"})},_onClick:function(){this._getEditor().hasNewDraft?confirm(BEM.I18N("b-editor-close-button","want_to_close"))&&(this._getEditor().revert(),this._closeEditor()):this._closeEditor()},_closeOnESC:function(){var t=this._bPage.findBlockInside({block:"popup2",modName:"role",modVal:"editor-suggest"}),e=this._bPage.findBlockInside({block:"popup2",modName:"editor",modVal:"yes"});(this._bPage.hasMod("editor")||this._bPage.hasMod("new-page"))&&(e&&e.getMod("visible")||t&&t.getMod("visible")||this._onClick())},_closeEditor:function(){this._getEditor().close(),this._pageTitle.closeInput(!0),this._appStore.set({action:"view",view:"view"}),keymaster.unbind("ctrl+enter, command+enter"),this._bPage.delMod("revision"),BEM.channel("common").trigger("reset",{type:"editor-action-buttons"})}})},function(t,e){BEM.DOM.decl("b-editor-save-button",{onSetMod:{js:function(){this._appStore=BEM.WISTORE.get("app"),this._pageStore=BEM.WISTORE.get("page"),this._button=this.findBlockOn("button2"),this._bPage=this.findBlockOutside("b-page"),this._bEditor=this._bPage.findBlockInside("page-editor"),this._pageTitle=this._bPage.findBlockInside({block:"m-replacer",modName:"type",modVal:"page-title"}),this._spinner=this._bPage.findBlockInside({block:"spin2",modName:"editor",modVal:"save"}),this._closeButton=this._bPage.findBlockInside("b-editor-close-button").findBlockOn("button2"),this._editorActions=this._bPage.findBlockInside("b-editor-actions").findBlockOn("radio-button"),this.bindTo("click",this._onClick.bind(this))}},_onClick:function(){yaCounter&&yaCounter.reachGoal("save"),this._urlParams=BEM.blocks["wi-history"].parseQueryParams(),this._status=this.getMod("status"),this._showSpinner(),this._savePage(),this._disableElements()},_showSpinner:function(){this._spinner.setMod("show","yes"),this._spinner.setMod("progress","yes")},_hideSpinner:function(){this._spinner.setMod("show","no"),this._spinner.delMod("progress")},_savePage:function(){var t="",e={},i=BEM.blocks["wi-history"].getCorrectPath(),s=/^\/{0,}(.+[^/])\/{0,}$/.exec(i)[1],o=BEM.WISTORE.get("page").get("withNewWf"),n=this._bEditor.isNewWf();n&&!o&&yaCounter&&yaCounter.reachGoal("go_to_new_WF"),!n&&o&&yaCounter&&yaCounter.reachGoal("go_to_old_WF"),"edit"===this._pageTitle.getMod("state")&&this._pageTitle.closeInput();var a={body:this._bEditor.getText(),title:this._pageTitle.getValue(),page_type:"article",version:BEM.blocks["i-global"].pageVersion,showpage:decodeURIComponent(s)};BEM.WISTORE.get("page").get("canSwitchWf")&&o!==n&&(a.with_new_wf=n),this._urlParams&&(this._urlParams.section&&(a.section_id=this._urlParams.section),this._urlParams.originpath&&(i=this._urlParams.originpath)),"create"===this._status&&(t=this._subpageBlock.elem("control").val()),n||(e.fields="bemjson"),BEM.create("wi-api-request",{apiPath:t,method:"POST",data:a,urlParams:e,path:i,timeout:5e4}).run().then(this._onSaveData.bind(this),(function(t){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,BEM.I18N("b-editor-save-button","save_error"),t,2e3))})).always(function(){this._hideSpinner(),this._enableElements()}.bind(this))},_updateDocumentContent:function(t){var e=t.data,i=e.body;t.data.raw=i,this._pageStore.set({withNewWf:this._bEditor.isNewWf(),raw:i,title:e.title}),this.channel("content").trigger("update",t);var s=t.data,o=BEM.blocks["wi-history"].parseQueryParams();this._bEditor.onSuccessSubmit(),o&&o.gopage?location.href=o.gopage+(o.goanchor?"#"+o.goanchor:""):(document.title=(s.title||BEM.I18N("b-editor-save-button","page_title_prefix"))+" @ Wiki",BEM.blocks["i-explainer"].explainAllLinks(this._bPage),this._bPage.delMod("editor"),this._bPage.setMod("revision",""),BEM.channel("common").trigger("reset",{type:"editor-action-buttons"}),keymaster.unbind("ctrl+enter, command+enter"),this.hideRevisionInfo(),this._pageStore.set({type:s.page_type,superTag:s.supertag,version:parseInt(s.version)}),this._appStore.set({action:"view",view:"view"}),BEM.blocks["wi-history"]._clearUrl())},_onSaveData:function(t){"edit"===this._status?this._updateDocumentContent(t):this._redirectOnSave(t)},hideRevisionInfo:function(){var t,e,i,s=this._bPage.findBlockInside({block:"b-revision-info",modName:"type",modVal:"view"});this.pageType=this._pageStore.get("type"),s&&("article"===this.pageType&&(t=this._bPage.findBlockInside({block:"w-action",modName:"type",modVal:"edit"}),e=this._bPage.findBlockInside("b-page-more"),i=t.findBlockOn("button2"),e.domElem.show(),BEM.DOM.before(e.domElem,t.domElem),t.params.revisionId=null,i.setMod("size","m"),i.setMod("side","left"),i.setMod("pseudo","yes"),i.setMod("theme","pseudo"),i.elem("text").text(BEM.I18N("b-events-log","page_edit"))),BEM.DOM.destruct(s.domElem))},_redirectOnSave:function(t){window.location.pathname=t.data.supertag},_disableElements:function(){this._button.setMod("disabled","yes"),this._closeButton.setMod("disabled","yes"),this._editorActions.setMod("disabled","yes")},_enableElements:function(){this._button.delMod("disabled"),this._closeButton.delMod("disabled"),this._editorActions.delMod("disabled")}})},function(t,e){BEM.DOM.decl("b-readonly-item",{onSetMod:{js:function(){this.__self._isReadOnly&&this.setMod("disabled","yes")}},_enable:function(){this._isTable||(this._isTable=this.findBlockOn("b-grid-table")),this._isTable?(this._isTable.readOnly=!0,this._isTable.setMod("readonly",!0),this._isTable.rebuild()):(this.setMod("disabled","yes"),this.__self._isReadOnly=!0)},_disable:function(){this._isTable||(this._isTable=this.findBlockOn("b-grid-table")),this._isTable?(this._isTable.readOnly=!1,this._isTable.setMod("readonly",!1),this._isTable.rebuild()):(this.delMod("disabled"),this.__self._isReadOnly=!1)}},{live:function(){this.liveInitOnChannelEvent("readonly","enable",(function(){this._enable()})),this.liveInitOnChannelEvent("readonly","disable",(function(){this._disable()}))},_isReadOnly:!1})},,,function(t,e){BEM.blocks["mi-storage"]._errorHandler=function(t){throw t}},function(t,e){BEM.DOM.decl("b-cluster-tree",{onSetMod:{js:function(){this._localStorage=BEM.blocks["mi-storage"],this.sortBy=this._localStorage.getItem("wiki-ct-sort"),this.sortBy&&"undefined"!==this.sortBy||(this.sortBy="title"),"supertag"===this.sortBy&&(this.sortBy="tag"),this.pageTypes=this._localStorage.getItem("wiki-ct-filter")||"G",this._clusterTreeSort=this.findBlockInside("b-cluster-tree-sort"),this._clusterTreeFilter=this.findBlockInside("b-cluster-tree-filter"),this._closePopupsThrottle=$.throttle(this._closePopups,100,this),this._parents=this.domElem.parents(),this.afterCurrentEvent(this.initBlock)}},destruct:function(){this.unbindFromDoc("scroll",this._closePopupsThrottle,this),this.unbindFrom(this._parents,"scroll",this._closePopupsThrottle,this),this._request&&this._request.abort(),this._request=null,this.__base.apply(this,arguments)},initBlock:function(){this._getClusterTree(),this._clusterTreeSort.initBlock(),this._clusterTreeFilter.initBlock(),this.bindToDoc("scroll",this._closePopupsThrottle,this),this.bindTo(this._parents,"scroll",this._closePopupsThrottle.bind(this))},_getClusterTree:function(){var t="&sort_order="+this.sortBy;this.pageTypes&&(t+="&page_types="+this.pageTypes),this._request=BEM.create("wi-api-request",{apiPath:".treecluster",path:BEM.blocks["wi-history"].getCorrectPath(),urlParams:["format=json"+t]}),this._request.run().then(this._onGotData.bind(this),this._onFailedData.bind(this)).always(function(){this._request=null,this.trigger("ready")}.bind(this))},_onGotData:function(t){BEM.DOM.update(this.elem("total-count"),t.data.length),this.setMod("sort",this.sortBy.replace("_","-"));var e=BEMHTML.apply(this._getClusterTreeBEMJSON(t.data));BEM.DOM.update(this.elem("list"),e),this.elem("item").on("click",(function(){yaCounter&&yaCounter.reachGoal("from_sidebar")}))},_getClusterTreeBEMJSON:function(t){var e=this,i=[];return t.forEach((function(t){var s={block:"link",url:t.url,content:[],mods:{type:t.page_type},mix:[{block:"b-cluster-tree",elem:"item"},{block:"clearfix"}]};switch("P"===t.page_type&&(s.mods["no-icon"]=!0),t.page_type){case"G":s.content.push({block:"b-cluster-tree",elem:"type",content:{block:"awesome-icon",mods:{icon:"table"}}});break;case"R":s.content.push({block:"b-cluster-tree",elem:"type",content:{block:"awesome-icon",mods:{icon:"share"}}});break;case"403":s.content.push({block:"b-cluster-tree",elem:"type",content:{block:"awesome-icon",mods:{icon:"lock"}}});break;case"404":s.content.push({block:"b-cluster-tree",elem:"type",content:{block:"awesome-icon",mods:{icon:"plus-circle"}}})}s.content.push({block:"b-cluster-tree",elem:"title",content:t.title||t.tag,attrs:{title:t.url}}),t.children_count&&s.content.push({block:"b-cluster-tree",elem:"count",content:t.children_count}),s.content.push({block:"b-cluster-tree",elem:"url",content:t.url.slice(1).replace(e.params.supertag,"")}),s.content.push({block:"b-cluster-tree",elem:"date",elemMods:{type:"created-at"},timestamp:t.created_at||""},{block:"b-cluster-tree",elem:"date",elemMods:{type:"modified-at"},timestamp:t.modified_at||""}),i.push(s)})),i},_onFailedData:function(t){this._request&&!this._request.aborted&&BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,BEM.I18N("b-cluster-tree","cant_load_cluster_tree"),t))},changeSorting:function(t){this.sortBy=t,this._localStorage.setItem("wiki-ct-sort",t),this._getClusterTree()},changeFilter:function(t){this.pageTypes=t,this._localStorage.setItem("wiki-ct-filter",t),this._getClusterTree()},_closePopups:function(){this._clusterTreeSort.findBlockInside("select2").popup.delMod("visible"),this._clusterTreeFilter.findBlockInside("select2").popup.delMod("visible")}})},function(t,e){BEM.DOM.decl("b-cluster-tree-sort",{initBlock:function(){this.clusterTree=this.findBlockOutside("b-cluster-tree"),BEM.DOM.update(this.domElem,BEMHTML.apply({block:"b-cluster-tree-sort",elem:"select",val:this.clusterTree.sortBy})),this.findBlockInside("select2").on("change",this._onSelect,this)},_onSelect:function(t,e){this.clusterTree.changeSorting(e.currVal)}})},function(t,e){BEM.DOM.decl("b-cluster-tree-filter",{initBlock:function(){this.filters=[{val:"G",text:BEM.I18N("b-cluster-tree-filter","tables")},{val:"R",text:BEM.I18N("b-cluster-tree-filter","redirects")},{val:"404",text:BEM.I18N("b-cluster-tree-filter","non_existent")},{val:"403",text:BEM.I18N("b-cluster-tree-filter","closed_pages")}],this.clusterTree=this.findBlockOutside("b-cluster-tree");var t=this.clusterTree.pageTypes.split(",");this.setOptions(t)},setOptions:function(t){var e=[],i=this;return this.filters.forEach((function(i){t.indexOf(i.val)>-1&&e.push(i.val)})),BEM.DOM.update(this.domElem,BEMHTML.apply({block:"b-cluster-tree-filter",elem:"select",items:this.filters,val:e}),(function(){i.findBlockInside("select2").on("change",i._onSelect,i)})),this.clusterTree.changeFilter(e.join(",")),this},_onSelect:function(t,e){this.clusterTree.changeFilter(e.currVal.join(","))}})},,function(t,e){BEM.DOM.decl("b-events-log",{loaded:0,currentEvent:null,diffEvent:null,firstLoad:!0,currentRevisionId:null,_latestRevisionId:null,onSetMod:{js:function(){this._pageStore=BEM.WISTORE.get("page"),this.bPage=this.findBlockOutside("b-page"),this.pageType=this._pageStore.get("type"),this.spinner=this.findBlockInside("spin2"),this._eventsSelect=this.findBlockInside("b-events-select"),this.mask=this.elem("mask"),this._parents=this.domElem.parents(),this._closePopupsThrottle=$.throttle(this._closePopups,100,this),this.bindToDoc("scroll",this._closePopupsThrottle.bind(this)),this.bindTo(this._parents,"scroll",this._closePopupsThrottle.bind(this)),this._getEvents(!1),this.channel("content").on("updated",this._onContentUpdated,this)}},destruct:function(){BEM.blocks["b-event"].bPage=null,BEM.blocks["b-event"].bEventsLog=null,BEM.blocks["b-event"].bGridTable=null,BEM.blocks["b-event"].bContent=null,BEM.blocks["b-event"].wikiDoc=null,BEM.blocks["b-revision-diff"].bEventsLog=null,BEM.blocks["b-revision-diff"].bPage=null,BEM.blocks["b-revision-diff"].bContent=null,BEM.blocks["b-revision-diff"].wikiDoc=null,this.unbindFromDoc("scroll",this._closePopupsThrottle,this),this.unbindFrom(this._parents,"scroll",this._closePopupsThrottle,this),this.__base.apply(this,arguments)},_closePopups:function(){this._eventsSelect.isOpened()&&this._eventsSelect.close()},setDiff:function(t){t.revision_1&&t.revision_2&&t.revision_1!==t.revision_2?(this._diffFromURL=t,void 0!==this.total&&this._showDiff(t)):this._showIncorrectDiffDataError()},_showDiff:function(t){var e,i;this.findBlocksInside("b-event").forEach((function(s){String(s.params.revisionId)===t.revision_1&&(e=s),String(s.params.revisionId)===t.revision_2&&(i=s)}),this),e&&i?(e.select(!0),i.setDiffEvent(),this._customDiffShowed=!0):this._loadedAll?this._showIncorrectDiffDataError():this._getEvents(!0,!0)},_showIncorrectDiffDataError:function(){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,BEM.I18N("b-events-log","diff_not_found")))},_getEvents:function(t,e){t?this.spinner.setMod("progress","yes"):this.loaded=0,BEM.create("wi-api-request",{apiPath:".events",path:"/"+this._pageStore.get("superTag"),urlParams:["format=json","event_types="+this.__self._types,"start="+this.loaded,e?"":"limit="+this.__self._limit]}).run().then(this._onGotData.bind(this,t,e),this._onFailedData.bind(this,t))},_onMoreClick:function(){this._getEvents(!0)},_getRevisionsBEMJSON:function(t){return t.map((function(t){var e=t.event_type,i={block:"b-events-log",elem:"item",mix:[],content:[]};return"edit"!==e&&"create"!==e&&"edit_structure"!==e||!t.revision?i.mix.push({block:"b-event",mods:{type:e,theme:this.getMod("theme")}}):(i.mix.push({block:"b-event",mods:{compared:"edit"===e||"create"===e?"yes":"",type:e,selectable:"yes",theme:this.getMod("theme")},js:{revisionId:t.revision.id,timestamp:t.created_at,user:t.author.display}}),i.content.push({block:"checkbox",mods:{size:"m",theme:this.getMod("theme"),visibility:BEM.WISTORE.get("page").get("redirect")?"hidden":""},mix:[{block:"b-event",elem:"check"},{block:"b-revision-diff",js:!0}],js:{revisionId:t.revision.id}})),i.content.push({block:"b-event",elem:"user",login:t.author.login,isDismissed:t.author.is_dismissed,theme:this.getMod("theme")},": ",{block:"b-event",elem:"action",elemMods:{type:"subscribe_other_user"===e||"change_owner"===e?e.replace(/_/g,"-"):"default"},type:e,data:t.additional_fields,theme:this.getMod("theme")},{block:"b-event",elem:"date",timestamp:t.created_at}),i}),this)},_getNoRevisionsBEMJSON:function(){var t={block:"b-events-log",elem:"item",mix:[],content:BEM.I18N("b-events-log","no_events")};return this.elem("more-link").hide(),[t]},_onContentUpdated:function(){if("article"===this.pageType&&this._latestRevisionId!==this.currentEvent.params.revisionId){this.bContent||(this.bContent=this.bPage.findBlockInside("b-content"));var t=this.bContent.findBlockInside("wiki-doc").findBlocksInside("b-wiki-form");t.length&&t.forEach((function(t){var e=t.findBlockInside({block:"button2",modName:"role",modVal:"form-submit"});e&&e.setMod("disabled","yes")}))}},_onGotData:function(t,e,i){this._loadedAll=e,this.total=i.data.total,!this._latestRevisionId&&i.data.data&&i.data.data.length&&i.data.data[0].revision?this._latestRevisionId=i.data.data[0].revision.id:this._latestRevisionId=this._pageStore.get("version");var s=BEMHTML.apply(this.total?this._getRevisionsBEMJSON(i.data.data):this._getNoRevisionsBEMJSON());this.loaded=this.loaded+i.data.data.length,this.total-this.loaded?this.elem("more-link").show():this.elem("more-link").hide(),t?(this.spinner.delMod("progress"),BEM.DOM.append(this.elem("list"),s)):BEM.DOM.update(this.elem("list"),s),BEM.blocks["b-event"].on(this.domElem,"disable-compare",this._disableCompare,this),BEM.blocks["b-event"].on(this.domElem,"enable-compare",this._enableCompare,this),this.currentEvent=this._getCurrentEvent(),!this._latestRevisionId&&i.data.data&&i.data.data.length?this._latestRevisionId=i.data.data[0].revision.id:this._latestRevisionId=this._pageStore.get("version"),this.currentEvent&&this.currentEvent.setSelection(),this.firstLoad&&this.currentEvent&&(this.currentRevisionId=this.currentEvent.params.revisionId),this.currentEvent&&!t&&this.currentEvent._getRevisionBEMJSON(),this.trigger("ready"),this._diffFromURL&&!this._customDiffShowed&&this._showDiff(this._diffFromURL)},_disableCompare:function(){this.findBlocksInside("checkbox").forEach((function(t){t.setMod("disabled","yes")}),this)},_enableCompare:function(){this.findBlocksInside("checkbox").forEach((function(t){t.delMod("disabled")}),this)},_onFailedData:function(t,e){t?this.spinner.delMod("progress"):this.trigger("ready"),BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,BEM.I18N("b-events-log","cant_load_revision"),e))},showRevisionInfo:function(){var t,e,i,s=this.bPage.findBlockInside("b-page-title-info"),o=this.bPage.findBlockInside({block:"b-revision-info",modName:"type",modVal:"view"});o?(BEM.DOM.update(o.elem("text"),BEMHTML.apply(this.getRevisionInfoTextBEMJSON())),"grid"===this.pageType&&((i=o.findBlockInside("button2")).params.revisionId=this.currentEvent.params.revisionId),"article"===this.pageType&&((t=this.bPage.findBlockInside({block:"w-action",modName:"type",modVal:"edit"})).params.revisionId=this.currentEvent.params.revisionId)):(BEM.DOM.after(s.domElem,BEMHTML.apply(this.getRevisionInfoBEMJSON())),o=this.bPage.findBlockInside({block:"b-revision-info",modName:"type",modVal:"view"}),"grid"!==this.pageType||BEM.WISTORE.get("page").get("redirect")||(BEM.DOM.append(o.elem("button"),BEMHTML.apply(this.getRevisionInfoGridButtonBEMJSON())),(i=o.findBlockInside("button2")).params.revisionId=this.currentEvent.params.revisionId,i.on("click",this.returnGridRevision,this)),"article"!==this.pageType||BEM.WISTORE.get("page").get("redirect")||(t=this.bPage.findBlockInside({block:"w-action",modName:"type",modVal:"edit"}),e=this.bPage.findBlockInside("b-page-more"),BEM.DOM.append(o.elem("button"),t.domElem),(t=this.bPage.findBlockInside({block:"w-action",modName:"type",modVal:"edit"})).params.revisionId=this.currentEvent.params.revisionId,(i=t.findBlockOn("button2")).delMod("side"),i.delMod("pseudo"),i.setMod("size","s"),i.setMod("theme","clear"),i.elem("text").text(BEM.I18N("b-events-log","edit_version")),e.domElem.hide()))},getRevisionInfoBEMJSON:function(){return{block:"b-revision-info",mods:{type:"view"},content:[{elem:"text",content:this.getRevisionInfoTextBEMJSON()},{elem:"button",content:""}]}},getRevisionInfoTextBEMJSON:function(){return["article"===this.pageType?BEM.I18N("b-events-log","old_page_version"):BEM.I18N("b-events-log","old_table_version"),{block:"m-date",format:"full",timestamp:this.currentEvent.params.timestamp},". "+BEM.I18N("b-events-log","author")+" "+this.currentEvent.params.user+"."]},getRevisionInfoGridButtonBEMJSON:function(){return{block:"button2",mods:{size:"s",theme:"clear"},text:BEM.I18N("b-events-log","return_this_version")}},returnGridRevision:function(t){var e=t.target.params.revisionId;e&&BEM.create("wi-api-request",{apiPath:".grid/revisions/"+e+"/rollback",path:BEM.blocks["wi-history"].getCorrectPath(),method:"POST",urlParams:["format=json"]}).run().then(this._onReturnGridSuccess.bind(this),this._onReturnGridError.bind(this,t.target))},_onReturnGridSuccess:function(){window.location.reload()},_onReturnGridError:function(t,e){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,null,e))},hideRevisionInfo:function(){var t,e,i,s=this.bPage.findBlockInside({block:"b-revision-info",modName:"type",modVal:"view"});s&&("article"===this.pageType&&(t=this.bPage.findBlockInside({block:"w-action",modName:"type",modVal:"edit"}),e=this.bPage.findBlockInside("b-page-more"),i=t.findBlockOn("button2"),e.domElem.show(),BEM.DOM.before(e.domElem,t.domElem),t.params.revisionId=null,i.setMod("size","m"),i.setMod("side","left"),i.setMod("pseudo","yes"),i.setMod("theme","pseudo"),i.elem("text").text(BEM.I18N("b-events-log","page_edit"))),BEM.DOM.destruct(s.domElem))},_getCurrentEvent:function(){var t=null,e=this._pageStore.get("version");return this.findBlocksInside({block:"b-event",modName:"selectable",modVal:"yes"}).some((function(i){return i.revisionId===e&&(t=i,!0)})),t||(t=this.findBlockInside({block:"b-event",modName:"selectable",modVal:"yes"}))&&this._pageStore.set("version",t.revisionId),t}},{_limit:10,_types:"create,edit",live:function(){return this.liveBindTo("more-link","click",(function(){this._onMoreClick()})),!1}})},function(t,e){BEM.DOM.decl("b-events-select",{onSetMod:{js:function(){this.bEventsLog=this.findBlockOutside("b-events-log"),this._select=this.findBlockInside("select2"),this._select.on("change",this._onSelect,this)}},close:function(){return this._getPopup().delMod("visible"),this},isOpened:function(){return this._getPopup().hasMod("visible","yes")},_getPopup:function(){return this._popup||(this._popup=this.findBlockOn(this._select.elem("popup"),"popup2")),this._popup},_onSelect:function(t,e){this.bEventsLog.__self._types=e.currVal,this.bEventsLog._getEvents(!1)}})},,function(t,e){BEM.DOM.decl("b-event",{revisionId:null,revisionCache:null,onSetMod:{js:function(){this.revisionId=this.params.revisionId,this._pageStore=BEM.WISTORE.get("page"),this.__self.bPage||(this.__self.bPage=BEM.blocks["i-global"].getbPage()),this.__self.bEventsLog||(this.__self.bEventsLog=this.findBlockOutside("b-events-log")),this.checkbox=this.findBlockInside("checkbox"),this.channel("update-diff").on("showDiff",this._onShowDiff,this),this.channel("update-diff").on("uncheckDiff",this._onUncheckDiff,this)}},destruct:function(){this.channel("update-diff").un("showDiff",this._onShowDiff,this),this.channel("update-diff").un("uncheckDiff",this._onUncheckDiff,this),this.__base.apply(this,arguments)},setDiffEvent:function(){this.setMod("selected","yes"),this.checkbox.setMod("checked","yes")},setSelection:function(){this.setMod("selected","yes"),this.checkbox.setMod("checked","yes"),this.checkbox.setMod("disabled","yes")},removeSelection:function(){this.delMod("selected"),this.checkbox.delMod("disabled"),this.checkbox.delMod("checked")},_getRevisionApiPath:function(t){return("grid"===this.__self.bEventsLog.pageType?".grid/revisions/":".revisions/")+t},_getRevisionBEMJSON:function(){this.revisionCache?this._showRevision():BEM.create("wi-api-request",{apiPath:this._getRevisionApiPath(this.__self.bEventsLog.currentEvent.params.revisionId),path:BEM.blocks["wi-history"].getCorrectPath(),urlParams:["format=json"]}).run().then(this._onGotData.bind(this),this._onFailedData.bind(this))},_onGotData:function(t){this.revisionCache=t,this.__self.bEventsLog.firstLoad?(this.isCurrentRevision()?this.__self.bEventsLog.hideRevisionInfo():this.__self.bEventsLog.showRevisionInfo(),this.__self.bEventsLog.firstLoad=!1):this._showRevision()},_onFailedData:function(t){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(this.domElem,BEM.I18N("b-event","cant_load_revision"),t))},_showRevision:function(){"grid"===this.__self.bEventsLog.pageType&&(this.__self.bGridTable||(this.__self.bGridTable=this.__self.bPage.findBlockInside("b-grid-table")),this.isCurrentRevision()?(this.__self.bGridTable.delMod("readonly"),this.__self.bGridTable.delMod("revision"),this.__self.bGridTable.readOnly=!1):(this.__self.bGridTable.setMod("readonly","true"),this.__self.bGridTable.setMod("revision","true"),this.__self.bGridTable.readOnly=!0),this.__self.bGridTable._onGotData(this.revisionCache)),"article"===this.__self.bEventsLog.pageType&&this.channel("content").trigger("update",this.revisionCache),this.isCurrentRevision()?this.__self.bEventsLog.hideRevisionInfo():this.__self.bEventsLog.showRevisionInfo(),this._pageStore.set("version",this.revisionId)},isCurrentRevision:function(){return this.__self.bEventsLog._latestRevisionId===this.__self.bEventsLog.currentEvent.params.revisionId},select:function(t){var e=this.hasMod("compared","yes");BEM.blocks["wi-history"].pushState(""),e&&this.trigger("enable-compare"),this.__self.bEventsLog.diffEvent&&(this.__self.bEventsLog.diffEvent.removeSelection(),this.__self.bEventsLog.diffEvent=null),this.__self.bEventsLog.currentEvent&&this.__self.bEventsLog.currentEvent.removeSelection(),this.__self.bEventsLog.currentEvent=this,this.setSelection(),!t&&this._getRevisionBEMJSON(),!e&&this.trigger("disable-compare")},_onShowDiff:function(){this.__self.bEventsLog.currentEvent.findBlockInside("checkbox").delMod("disabled")},_onUncheckDiff:function(){this.__self.bEventsLog.currentEvent._getRevisionBEMJSON(),this.__self.bEventsLog.currentEvent.findBlockInside("checkbox").setMod("disabled","yes")}},{live:function(){this.liveBindTo("click",(function(){this.hasMod("selectable")&&this.select()})),this.liveBindTo("check","click",(function(t){t.stopPropagation()}))}})},function(t,e){function i(t,e,i,s,o,n,a){try{var r=t[n](a),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(s,o)}BEM.DOM.decl("b-revision-diff",{onSetMod:{js:function(){this.__self.bEventsLog||(this.__self.bEventsLog=this.findBlockOutside("b-events-log"))}},destruct:function(){this.__base.apply(this,arguments)},_onCheckboxChange:function(t,e){var i=this.findBlockOutside("b-event");if(!this.__self.bEventsLog.currentEvent)return!1;if(e.checked){if(this.__self.bEventsLog.currentEvent===i)return!1;this.__self.bEventsLog.diffEvent&&this.__self.bEventsLog.diffEvent!==i&&this.__self.bEventsLog.diffEvent.removeSelection(),this.__self.bEventsLog.diffEvent=i,this._getDiff(this.__self.bEventsLog.currentEvent.params.revisionId,this.__self.bEventsLog.diffEvent.params.revisionId),this.__self.bEventsLog.diffEvent.setMod("selected","yes"),this.channel("update-diff").trigger("showDiff")}else{if(this.__self.bEventsLog.currentEvent!==i&&this.__self.bEventsLog.diffEvent!==i)return!1;this.__self.bEventsLog.currentEvent===i&&(this.__self.bEventsLog.currentEvent.delMod("selected"),this.__self.bEventsLog.currentEvent=this.__self.bEventsLog.diffEvent),this.__self.bEventsLog.diffEvent===i&&this.__self.bEventsLog.diffEvent.delMod("selected"),this.__self.bEventsLog.diffEvent=null,this.__self.bEventsLog.currentEvent&&(this.__self.bEventsLog.currentEvent._getRevisionBEMJSON(),this.__self.bEventsLog.currentEvent.findBlockInside("checkbox").setMod("disabled","yes"))}},_showDiff:function(t,e){e.params&&(this.channel("update-diff").trigger("showDiff"),e.params.revision_1&&e.params.revision_2&&this._getDiff(e.params.revision_1,e.params.revision_2))},_getDiff:function(t,e){this.__self.bPage||(this.__self.bPage=this.findBlockOutside("b-page")),BEM.blocks["wi-history"].pushState(".log?revision_1="+t+"&revision_2="+e),BEM.create("wi-api-request",{apiPath:".diff",path:BEM.blocks["wi-history"].getCorrectPath(),urlParams:["format=json","a="+t,"b="+e]}).run().then(this._onGotData.bind(this),BEM.blocks["wi-notification"].errorHandler(null,BEM.I18N("b-revision-diff","cant_load_diff")))},_onGotData:function(t){var e,s=this;return(e=regeneratorRuntime.mark((function e(){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s.__self.bContent||(s.__self.bContent=s.__self.bPage.findBlockInside("b-content")),"article"!==s.__self.bEventsLog.pageType){e.next=5;break}s._showArticleDiffData(BEMHTML.apply({block:"b-diff-content",content:s._buildDiffStringBEMJSON(t.data.diff)})),e.next=12;break;case 5:if((i=s.__self.bContent.findBlockInside("b-grid-table")).setMod("readonly","true"),i.readOnly=!0,e.t0=i,!e.t0){e.next=12;break}return e.next=12,i.showDiff(t.data);case 12:case"end":return e.stop()}}),e)})),function(){var t=this,s=arguments;return new Promise((function(o,n){var a=e.apply(t,s);function r(t){i(a,o,n,r,l,"next",t)}function l(t){i(a,o,n,r,l,"throw",t)}r(void 0)}))})()},_buildDiffStringBEMJSON:function(t){var e=[];return t.forEach((function(t){var i={block:"b-diff-string",mods:{"diff-type":t.changes},content:[]};t.chunks.forEach((function(t){i.content.push({elem:"chunk",elemMods:{"diff-type":t.action},content:t.substring})}),this),e.push(i)}),this),e},_showArticleDiffData:function(t){this.__self.bContent||(this.__self.bContent=this.__self.bPage.findBlockInside("b-content")),BEM.DOM.update(this.__self.bContent.findBlockInside("w-content").domElem,t)}},{live:function(){this.liveInitOnBlockEvent("change","checkbox",(function(t,e){this._onCheckboxChange(t,e)}))}})},function(t,e){BEM.DOM.decl("w-attachments",{_filesIndex:0,onSetMod:{js:function(){this._uploader=BEM.create("wi-uploader",{url:"/.upload"}),this._attachBtn=this.findBlockInside("attach"),this._moreBtn=this.findBlockInside(this.elem("more"),"link"),this._attachBtn.elem("control")[0].multiple=!0,this._events(),this._getFiles()},loading:function(t,e){this._moreBtn.setMod("disabled",e?"yes":"")}},destruct:function(){this._filesRequest&&this._filesRequest.abort(),this.channel("attachments").un("add",this._onAddFiles,this),BEM.blocks["w-attach"].un("open",this._onAttachOpen,this),this.__base.apply(this,arguments)},_events:function(){this.channel("attachments").on("add",this._onAddFiles,this),this._uploader.on("progress",this._onUploadProgress,this),this._uploader.on("success",this._onUploadSuccess,this),this._uploader.on("error",this._onUploadError,this),this.bindTo("more","click",(function(){this._getFiles()})),this._attachBtn.on("change",(function(t){var e=this._attachBtn.elem("control")[0].files;this._onAddFiles(t,e),this._attachBtn.resetFile()}),this),BEM.blocks["w-attach"].on("open",this._onAttachOpen,this)},_getFiles:function(){this.setMod("loading","yes"),this._filesRequest=BEM.create("wi-api-request",{apiPath:".files",path:BEM.blocks["wi-history"].getCorrectPath(),urlParams:["format=json","start="+this._filesIndex,"limit="+this.__self._filesPerPage]}),this._filesRequest.run().then(this._onGotFiles.bind(this),(function(t){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,BEM.I18N("w-attachments","filed-to-load-files"),t))})).always(function(){this.setMod("loading",""),this.trigger("ready"),"rejected"===this._filesRequest.promise.state()&&this.elem("more").hide(),this._filesRequest=null}.bind(this))},_onGotFiles:function(t){var e=t.data.data,i=this.elem("attachments"),s=t.data.total,o=this.getMod("theme");this.elem("more").show();var n=this;BEM.DOM.append(i,BEMHTML.apply(e.map((function(t){var e=Object.assign({},t);return e.upload_date=n.__self._processDate(e.upload_date),{block:"w-attachments",elem:"attach",elemMods:{theme:o},attach:e,redirect:BEM.WISTORE.get("page").get("redirect")}})))),this._filesIndex+=e.length,this._filesIndex>=s&&this.elem("more").hide(),this.elem("more-count").html(s-this._filesIndex)},_onAddFiles:function(t,e){var i=this._normalizeFiles(e),s=this.__self._getFileLoadersJSON(i);BEM.DOM.prepend(this.elem("attachments"),BEMHTML.apply(s)),this.elem("overall-progress").css("width",0),this._uploader.setData(i),this._uploader.send()},_onUploadProgress:function(t,e){var i=this.findElem("attach-loader").filter("[id="+e.id+"]"),s=t.block.getSummary();100===s.percent&&setTimeout(function(){this.elem("overall-progress").css("width",0)}.bind(this),2e3),this.elem("overall-progress").css("width",s.percent+"%"),this.findElem(i,"percent").html(e.progress),this.findElem(i,"meter").css("width",e.progress+"%")},_onUploadSuccess:function(t,e){var i=this.findElem("attach-loader").filter("[id="+e.file.id+"]"),s=e.data.data.storage_id;BEM.create("wi-api-request",{apiPath:".attach",method:"POST",data:{files:[s]},path:BEM.blocks["wi-history"].getCorrectPath()}).run().then(function(t){this._onAttachSuccess(i,e,t)}.bind(this),function(t){this._onUploadError(t,e.file)}.bind(this))},_onAttachSuccess:function(t,e,i){if(i.error)this._onUploadError(null,e.file);else{var s=i.data.data[0];s.upload_date=this.__self._processDate(s.upload_date),t.length&&BEM.DOM.replace(t,BEMHTML.apply({block:"w-attachments",elemMods:{theme:this.getMod("theme")},elem:"attach",attach:s}))}},_onUploadError:function(t,e){var i=this.findElem("attach-loader").filter("[id="+e.id+"]"),s=this.__self._getErrorMessage(e.response,e.raw);this.findElem(i,"percent").html(0),this.findElem(i,"meter").css("width",0),this.setMod(i,"error","yes"),BEM.channel("notification").trigger("error",{message:s}),this.bindTo(this.findElem(i,"repeat"),"click",this._onRetry.bind(this,e,i)),this.bindTo(this.findElem(i,"cancel"),"click",(function(){BEM.DOM.destruct(i)}))},_onRetry:function(t,e){this.delMod(e,"error"),this._uploader.send(t)},_onAttachOpen:function(t,e){Array.prototype.slice.call(this.findBlocksInside("w-attach")).forEach((function(t){t.setMod("open",e?"yes":"")}))},_normalizeFiles:function(t){return Array.prototype.slice.apply(t).map((function(t){return{raw:t,id:this.__self._generateFileId(t)}}),this)}},{_processDate:function(t){var e=moment(t),i=moment();return this._isSameDay(e,i)?e.format("HH:mm"):e.format("DD.MM.YYYY")},_isSameDay:function(t,e){var i=moment(t),s=moment(e);return i.startOf("day").valueOf()===s.startOf("day").valueOf()},_getFileLoadersJSON:function(t){return t.map((function(t){return{block:"w-attachments",elem:"attach-loader",name:t.raw.name,id:t.id}}),this)},_getErrorMessage:function(t,e){return t&&t.responseJSON&&t.responseJSON.error?BEM.blocks["wi-notification"].createErrorMessage(t.responseJSON.error):413===t.status?BEM.I18N("w-attachments","filed-to-load")+" "+e.name+"<br/>"+BEM.I18N("w-attachments","body_to_large"):BEM.I18N("w-attachments","filed-to-load")+" "+e.name},_generateFileId:function(t){return $.md5(t.name+"?"+Date.now())},_filesPerPage:10})},function(t,e){BEM.DOM.decl("w-attach",{onSetMod:{js:function(){this._appStore=BEM.WISTORE.get("app"),this._pageStore=BEM.WISTORE.get("page"),this._tooltip=this.findBlockInside("tooltip"),"edit"!==this._appStore.get("view")&&"grid"!==this._pageStore.get("type")||this.setMod("dragable","yes"),this._attachWfUrl=this.params.attach.url.replace(".files/",""),this._events()},hovered:function(){this._tooltip.setMod("shown","")},open:function(t,e){var i=e?BEM.I18N("w-attach","show_options_hint"):BEM.I18N("w-attach","hide_options_hint");this.elem("hider").attr("title",i)}},_events:function(){this.bindTo("mouseenter",function(){this.setMod("hovered","yes")}.bind(this)),this.bindTo("mouseleave",function(){this.setMod("hovered","")}.bind(this)),this.bindTo(this.elem("control","type","remove"),"click",this._onAttachRemove.bind(this)),this.bindTo(this.elem("control","type","copy"),"click",this._onAttachCopy.bind(this)),this.bindTo(this.elem("hider"),"click",this._onHideShowControls,this),this._appStore.on("change:view",(function(t,e){"edit"===e?this.setMod("dragable","yes"):this.setMod("dragable","")}),this)},_onAttachCopy:function(){var t="file:"+this._attachWfUrl,e=BEM.create("wi-clipboard");e.isSupported()&&e.copy(t)?this._tooltip.setOwner(this.elem("control","type","copy")).setMod("shown","yes"):window.prompt(BEM.I18N("w-attach","copy_clipboard_message"),t)},_onAttachRemove:function(){confirm(BEM.I18N("w-attach","remove_link")+"?")&&(this.setMod("loading","yes"),this.setMod(this.elem("control","type","remove"),"loading","yes"),BEM.create("wi-api-request",{method:"DELETE",apiPath:"",path:this.params.attach.url,urlParams:!1}).run().then(this._onFileRemoveDone.bind(this),BEM.blocks["wi-notification"].errorHandler(this.domElem,BEM.I18N("w-attach","remove_attach_error"))).always(function(){this.setMod("loading",""),this.setMod(this.elem("control","type","remove"),"loading","")}.bind(this)))},_onFileRemoveDone:function(){BEM.DOM.destruct(this.domElem)},_onHideShowControls:function(){var t=this.hasMod("open","yes");this.setMod("open",t?"":"yes"),this.trigger("open",!t)}},{live:function(){this.liveInitOnEvent("mouseover",(function(){this.setMod("hovered","yes")}))}})},function(t,e){BEM.decl("wi-clipboard",{onSetMod:{js:function(){}},copy:function(t){var e=document.createElement("textarea");e.style.position="fixed",e.style.top=0,e.style.left=0,e.style.width="2em",e.style.height="2em",e.style.padding=0,e.style.border="none",e.style.outline="none",e.style.boxShadow="none",e.style.background="transparent",e.value=t,document.body.appendChild(e),e.select();var i=!1;try{i=document.execCommand("copy")}catch(t){i=!1}return document.body.removeChild(e),i},isSupported:function(){return document.queryCommandSupported("copy")}})},function(t,e){BEM.decl("wi-uploader",{_files:[],_summary:{},onSetMod:{js:function(){}},getSummary:function(){return this._updateSummary()},getFiles:function(){return this._files},setData:function(t){return t instanceof Array?t.forEach((function(t){t.raw&&t.raw instanceof File&&this._append(t)}),this):t.raw&&t.raw instanceof File&&this._append(t),this},send:function(t){arguments.length?t.send():this._files.forEach((function(t){t.send()}))},convertToOptimalSize:function(t){for(var e=["B","Kb","Mb","Gb"],i=0;i<e.length;i++){var s=t/1024;if(!(s>1))return t.toFixed(2)+e[i];t=s}},clear:function(){return this._files=[],this},_append:function(t){this._files.push(this._createFileObject(t))},_createFileObject:function(t){var e=$.extend({},t,{size:this.convertToOptimalSize(t.raw.size),response:null,status:{uploaded:!1,inProgress:!1},total:t.raw.size,loaded:0,send:this._sendFile});return e.req=this._req(e),t.raw.type.match(/image.*/)&&this._createThumbnail(e),e},_createThumbnail:function(t){var e=this,i=new FileReader,s=e.params.thumbnail;i.onloadend=function(){s&&(s.height||s.width)?e._getThumbImage(i.result,t):t.thumbnail=i.result},i.readAsDataURL(t.raw)},_getThumbImage:function(t,e){var i=new Image,s=e.raw.type,o=this.params.thumbnail;i.onload=function(){var t=o.height||null,n=o.width||null,a=i.width,r=i.height,l=document.createElement("canvas"),c=new Image,d=null,h=a>r&&a>n,u=r>a&&r>t,m=r===a&&r>t;!function o(){var p=h&&i.width>>1>n||u&&i.height>>1>t||m&&i.height>>1>t;c.onload=function(){i=c,o()},p?(a>>=1,r>>=1):(h?(r*=n/a,a=n,t&&r>t&&(a*=t/r,r=t)):(u||m)&&(a*=t/r,r=t,n&&a>n&&(r*=n/a,a=n)),a=Math.round(a),r=Math.round(r)),l.width=a,l.height=r,l.getContext("2d").drawImage(i,0,0,a,r),d=l.toDataURL(s),p?c.src=d:e.newthumbnail=d}()},i.src=t},_req:function(t){var e=this,i=new FormData;i.append("data",t.raw);var s={xhr:function(){var i=new window.XMLHttpRequest;return i.upload.addEventListener("progress",(function(i){i.lengthComputable&&(t.progress=i.loaded/i.total*100<<0,t.loaded=i.loaded,t.total=i.total,e._updateSummary(),e.trigger("progress",t))}),!1),i},type:"POST",url:this.params.url,data:i,processData:!1,contentType:!1,beforeSend:function(){t.status.inProgress=!0,e.trigger("beforeSend",t)},success:function(i){e._onSuccess(i,t)},error:function(i){e._onError(i,t)}};return this.params.hasOwnProperty("ajaxExtend")&&$.extend(s,this.params.ajaxExtend),s},_onSuccess:function(t,e){e.status.uploaded=!0,e.status.inProgress=!1,e.response=t,this.trigger("success",{file:e,data:t})},_onError:function(t,e){e.status.inProgress=!1,e.response=t,this.trigger("error",e)},_updateSummary:function(){var t=this,e=0,i=0;return this._summary.filesUploaded=0,this._summary.filesTotal=this._files.length,this._summary.percent=this._getOverallPercent(),this._files.forEach((function(s){s.status.uploaded&&t._summary.filesUploaded++,e+=s.total,i+=s.loaded})),this._summary.total=e,this._summary.loaded=i,this._summary},_getOverallPercent:function(){var t=0,e=0,i=0,s=0;return this._files.length&&(this._files.forEach((function(i){t+=i.total||0,e+=i.loaded||0})),s=t/100,i=Math.round(e/s)),i},_sendFile:function(){this.status.uploaded||this.status.inProgress||$.ajax(this.req)}})},function(t,e){BEM.DOM.decl("b-grid-table-code-form",{onSetMod:{js:function(){this.params.data.url=BEM.WISTORE.get("page").get("url"),this._initBlock()}},_initBlock:function(){BEM.DOM.update(this.domElem,BEMHTML.apply(this._getBEMJSON())),this._bindEvents(),this._updateCode(),this.afterCurrentEvent((function(){this.trigger("ready")}))},_bindEvents:function(){var t=this,e=this._getControls();Object.keys(e).forEach((function(e){t._controls[e].on("change",t._updateCode,t)})),this._textarea||(this._textarea=this.findBlockInside(this.elem("code"),"input")),this._textarea.on("focus",this._onTextareaFocus,this)},_updateCode:function(){this._textarea||(this._textarea=this.findBlockInside(this.elem("code"),"input")),this._textarea.val(this._getCode())},_onTextareaFocus:function(){this._textarea.elem("control").select()},_getCode:function(){var t=this._getControls(),e='"'+this.params.data.url+'" ',i=t.width.val(),s=t.width_units.getVal();return i&&(i='width="'+i+s+'" '),"{{grid page="+e+(t.readonly.isChecked()?'readonly="1" ':"")+i+(t.sorting.isChecked()?"":'sort="0" ')+(t.numbers.isChecked()?"":'num="0" ')+"}}"},_getControls:function(){return this._controls||(this._controls={width:this.findBlockInside(this.elem("width"),"input"),width_units:this.findBlockInside(this.elem("width"),"select2"),readonly:this.findBlockInside(this.elem("readonly"),"checkbox"),sorting:this.findBlockInside(this.elem("show-sorting"),"checkbox"),numbers:this.findBlockInside(this.elem("show-numbers"),"checkbox")}),this._controls},_getBEMJSON:function(){return[{block:this.__self.getName(),elem:"code",content:{block:"input",mods:{type:"textarea",size:"s",theme:this.getMod("theme")},content:{elem:"control",attrs:{readonly:"readonly",rows:5}}}},{block:this.__self.getName(),elem:"width",content:{block:"b-grid-table-width-controll",mods:{theme:this.getMod("theme")},width:this.params.data.width,width_units:this.params.data.width_units,label:BEM.I18N("b-grid-table-code-form","width"),size:"m"}},{block:this.__self.getName(),elem:"readonly",content:{block:"checkbox",mods:{size:"m",checked:!!this.params.data.read_only&&"yes",theme:this.getMod("theme")},text:BEM.I18N("b-grid-table-code-form","read_only")}},{block:this.__self.getName(),elem:"show-numbers",content:{block:"checkbox",mods:{size:"m",checked:!!this.params.data.show_numbers&&"yes",theme:this.getMod("theme")},text:BEM.I18N("b-grid-table-code-form","show_line_nums")}},{block:this.__self.getName(),elem:"show-sorting",content:{block:"checkbox",mods:{size:"m",checked:!!this.params.data.show_sorting&&"yes",theme:this.getMod("theme")},text:BEM.I18N("b-grid-table-code-form","can_sort")}}]}})},function(t,e){BEM.DOM.decl("b-grid-table-settings",{onSetMod:{js:function(){this.bPage=BEM.blocks["i-global"].getbPage(),this._table=this.bPage.findBlockInside("b-grid-table"),this._title=this.findBlockInside(this.elem("grid-title"),"input"),this._sorting=this.findBlockInside("b-grid-table-sorting-controll"),this._saveButton=this.findBlockInside(this.elem("submit"),"button2"),this._saveButton.on("click",this._onSave,this),this._buildSettings()}},_buildSettings:function(){return BEM.create("wi-api-request",{apiPath:".grid",path:"/"+BEM.WISTORE.get("page").get("superTag"),urlParams:["format=json"]}).run().then(this._onGotData.bind(this),BEM.blocks["wi-notification"].errorHandler()).always(function(){this.trigger("ready")}.bind(this))},_onGotData:function(t){var e=t.data.structure;this._title.val(e.title),this._sorting.sortings=e.sorting,this._sorting.fields=e.fields,this._sorting._buildBlock()},_onSave:function(){this._table._saveTitle(this._title.val()),this._sorting.changed&&(this._table._saveSorting(this._sorting.getSortingValue()),this._sorting.changed=!1)}})},function(t,e){BEM.DOM.decl("b-grid-table-sorting-controll",{onSetMod:{js:function(){this._addSortingLink=this.findBlockInside(this.elem("add-sorting"),"link"),this._addSortingLink.on("click",this._onAddSortingClick,this),this.sortings=[],this.fields=[],this.changed=!1,this.bindTo("click",this._onClick.bind(this))}},_onRemoveSorting:function(t){var e=this.findBlockInside(t.data.domElem.closest(this.elem("sorting")),"select2").params.defaultValue;this.sortings=this.getCurrentSortings(),this.sortings=this.sortings.filter((function(t){return t.name!==e})),this._buildBlock(),this.elem("sortings")[0].className=this.elem("sortings")[0].className},_onAddSortingClick:function(){var t=!1;this.sortings=this.getCurrentSortings();for(var e=0;e<this.fields.length;e++){for(var i=0;i<this.sortings.length;i++){if(this.fields[e].name===this.sortings[i].name){t=!0;break}t=!1}if(!t){this.sortings.push({type:"asc",name:this.fields[e].name});break}}this._buildBlock()},_buildBlock:function(){BEM.DOM.update(this.elem("sortings"),BEMHTML.apply(this._getBEMJSON())),this.dropElemCache(),this.bindTo(this.elem("delete"),"click",this._onRemoveSorting),this.sortings&&this.sortings.length===this.fields.length?this._addSortingLink.setMod("disabled","yes"):this._addSortingLink.delMod("disabled")},_getBEMJSON:function(){var t=this;return this.sortings&&this.sortings.map((function(e,i){return{block:t.__self.getName(),elem:"sorting",content:[{elem:"title",content:[{elem:"title-text",tag:"span",content:0===i?BEM.I18N("b-grid-table-sorting-controll","sort"):BEM.I18N("b-grid-table-sorting-controll","then")},{elem:"delete",tag:"span",content:[{block:"awesome-icon",attrs:{title:BEM.I18N("b-grid-table-sorting-controll","remove_sort")},mods:{icon:"remove"}}]}]},{block:t.__self.getName(),elem:"sorting-field",content:{block:"b-grid-table-fields-list",mods:{theme:t.getMod("theme")},fields:t.fields,selected:e.name}},{block:t.__self.getName(),elem:"sorting-type",content:{block:"b-grid-table-sorting-list",mods:{theme:t.getMod("theme")},selected:e.type}}]}}))},_onClick:function(){this.changed=!0},getSortingValue:function(){var t=this,e=[];return this.findElem("sorting").each((function(){var i=t.findBlockInside($(this),"select2").getVal(),s=t.findBlockInside($(this),"radio-button").val(),o={};o[i]=s,e.push(o)})),e},getCurrentSortings:function(){var t=this;return this.findElem("sorting").map((function(){return{name:t.findBlockInside($(this),"select2").getVal(),type:t.findBlockInside($(this),"radio-button").val()}})).toArray()}})},,function(t,e){BEM.DOM.decl("mi-sticky",{onSetMod:{js:function(){"complete"===BEM.DOM.doc[0].readyState?this.__base.apply(this,arguments):this.bindToWin("load",this.__base.bind(this))}}})},function(t,e){BEM.DOM.decl("wi-files-dropper",{onSetMod:{js:function(){BEM.WISTORE.get("page").get("redirect")||this._events()},drag:function(t,e){if(e){var i=this._getDropZone();BEM.DOM.append(this.domElem,i)}else BEM.DOM.destruct(this.findElem("drop-zone"))}},_events:function(){this.bindTo("dragover",(function(t){var e=t.originalEvent;-1!==e.dataTransfer.types.indexOf("Files")&&(t.preventDefault(),t.stopPropagation(),e.dataTransfer.dropEffect="copy",this.setMod("drag","over"))})),this.bindTo("dragleave",(function(t){t.preventDefault(),t.stopPropagation(),this.delMod("drag")})),this.bindTo("drop",(function(t){var e=t.originalEvent.dataTransfer;t.preventDefault(),t.stopPropagation(),this.delMod("drag"),this.trigger("drop",e.files)}))},_getDropZone:function(){return this.__self._dropZone||(this.__self._dropZone=BEMHTML.apply({block:"wi-files-dropper",elem:"drop-zone"})),this.__self._dropZone}},{})},function(t,e){BEM.DOM.decl("b-readonly",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._timer=null,this._localStorage=BEM.blocks["mi-storage"],this.READ_ONLY_TIMEOUT=3e4,this.READ_ONLY_TIMEOUT_WAIT=5e3,this._onReadonlyEnable=this._onReadonlyEnable.bind(this),this._onReadonlyDisable=this._onReadonlyDisable.bind(this),this._onDocumentVisibilityChange=this._onDocumentVisibilityChange.bind(this),"closed"===this._localStorage.getItem("readonly")&&this.setMod("close","yes"),BEM.channel("readonly").on("enable",this._onReadonlyEnable).on("disable",this._onReadonlyDisable),this._setDocumentVisibilityChangeListener(),document.hidden||this._startCheckReadonlyStatusPoll(this.READ_ONLY_TIMEOUT)}},"":function(){this.__base.apply(this,arguments),this._pauseCheckReadonlyStatusPoll(),this._delDocumentVisibilityChangeListener(),BEM.channel("readonly").un("enable",this._onReadonlyEnable).un("disable",this._onReadonlyDisable)}},_onReadonlyEnable:function(){this.setMod("visibility","visible")},_onReadonlyDisable:function(){this.delMod("visibility")},_onDocumentVisibilityChange:function(){document.hidden?this._pauseCheckReadonlyStatusPoll():this._startCheckReadonlyStatusPoll(this.READ_ONLY_TIMEOUT)},_setDocumentVisibilityChangeListener:function(){this._delDocumentVisibilityChangeListener(),document.addEventListener("visibilitychange",this._onDocumentVisibilityChange)},_delDocumentVisibilityChangeListener:function(){document.removeEventListener("visibilitychange",this._onDocumentVisibilityChange)},_startCheckReadonlyStatusPoll:function(t){this._pauseCheckReadonlyStatusPoll(),this._timer=setInterval(this._isReadOnlyRequest.bind(this),t)},_pauseCheckReadonlyStatusPoll:function(){clearInterval(this._timer)},_isReadOnlyRequest:function(){BEM.create("wi-api-request",{apiPath:".is_readonly",path:""}).run().then(this._onIsReadOnly.bind(this),this._onIsReadOnlyError.bind(this))},_onIsReadOnly:function(t){t.data.service_is_readonly?this._readOnlyStatus||(this._readOnlyStatus=!0,BEM.channel("readonly").trigger("enable"),this._startCheckReadonlyStatusPoll(this.READ_ONLY_TIMEOUT_WAIT)):this._readOnlyStatus&&(this._readOnlyStatus=!1,BEM.channel("readonly").trigger("disable"),this._startCheckReadonlyStatusPoll(this.READ_ONLY_TIMEOUT))},_onIsReadOnlyError:function(t){console.error("Проблемы с readonly: ",t)}},{live:function(){return this.liveBindTo("icon","click",(function(){this.delMod("close"),this._localStorage.removeItem("readonly")})),this.liveBindTo("close","click",(function(){this.setMod("close","yes"),this._localStorage.setItem("readonly","closed")})),!1}})},function(t,e){BEM.DOM.decl("w-breadcrumbs",{onSetMod:{js:function(){"complete"===BEM.DOM.doc[0].readyState?this.init():this.bindToWin("load",this.init,this)}},init:function(){this._contentWidth=this.findElem("content").width(),this.bindToWin("resize",this._onPageLayoutChanged,this),BEM.channel("layout").on("change",this._onPageLayoutChanged,this),this.setMod("roll",this._isNeedRoll()?"yes":"")},destruct:function(){BEM.channel("layout").un("change",this._onPageLayoutChanged,this),this.unbindFromWin("resize",this._onPageLayoutChanged,this),this.__base.apply(this,arguments)},_onPageLayoutChanged:function(){var t=this.hasMod("roll");this._isNeedRoll()?t||this.setMod("roll","yes"):t&&this.delMod("roll")},_isNeedRoll:function(){return this.domElem.width()<=this._contentWidth}})},function(t,e){BEM.DOM.decl("w-page-info",{onSetMod:{js:function(){var t=this.findBlockInside({block:"awesome-icon",mods:{type:"hide"}});t&&t.bindTo("click",this.hide.bind(this))}},hide:function(){BEM.DOM.destruct(this.domElem)}})},function(t,e,i){function s(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return o(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return o(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var s=0,n=function(){};return{s:n,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,l=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return r=t.done,t},e:function(t){l=!0,a=t},f:function(){try{r||null==i.return||i.return()}finally{if(l)throw a}}}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function n(t,e,i,s,o,n,a){try{var r=t[n](a),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(s,o)}function a(t){return function(){var e=this,i=arguments;return new Promise((function(s,o){var a=t.apply(e,i);function r(t){n(a,s,o,r,l,"next",t)}function l(t){n(a,s,o,r,l,"throw",t)}r(void 0)}))}}BEM.DOM.decl("b-grid-table",{readOnly:!1,_rowsToRemove:[],onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._setHeaderPositionQueue=0}},mode:{edit:function(){this._rowsToRemove=[],this._editButton.elem("text").text(BEM.I18N("b-grid-table","finish")),this._bindEvents(),this.trigger("start-edit"),this.bindToDomElem(this.elem("row-delete"),"click",this._onRowDeleteClick),this._newRow.setMod("ready","yes")},"":function(){this.syncGrid().then(function(){this.dropElemCache(),this._editButton.elem("text").text(BEM.I18N("b-grid-table","edit")),this._unbindEvents(),this.trigger("stop-edit"),this.unbindFromDomElem(this.elem("row-delete"),"click"),this._newRow.setMod("ready","no"),this.elem("row-dragger").css({top:0,height:0})}.bind(this))}},panels:{"":function(){this.updatePanelsPosition()}}},onElemSetMod:{"row-delete":{restore:function(t,e,i){var s=this.findBlockInside("row-delete","awesome-icon");i?s.setMod("icon","repeat"):s.setMod("icon","remove")}}},_initGrid:function(){this.readOnly=!0===this.params.readonly,this.showNumbers=!1!==this.params.num,this.noSorting=!1===this.params.sort,this.bPage=BEM.blocks["i-global"].getbPage(),this.setMod("readonly",this.readOnly?"true":"false"),this.noSorting&&this.setMod("no-sorting",this.noSorting?"true":"false"),this.tableId="id_"+Date.now(),this.params.gridData&&(this._gridData=this.params.gridData),this.buildGrid(),BEM.blocks["b-grid-table-cell"].on(this.domElem,"save",this._onCellSave,this),BEM.blocks["b-grid-table-head"].on(this.domElem,"sort",this._onSort,this),this.channel("getting-started").on("showaddcolpopup",this._showAddColPopup,this)},destruct:function(){BEM.blocks["b-grid-table-cell"].un(this.domElem,"save",this._onCellSave,this),BEM.blocks["b-grid-table-head"].un(this.domElem,"sort",this._onSort,this),this.__base.apply(this,arguments)},updatePanelsPosition:function(){this._setHeaderPosition(),this._tableBar&&this._tableBar.setPosition()},rebuild:function(t,e){var i=this,s=this;t&&(this._gridData=t),this.params.isAction?this.params.width&&this.domElem.css({width:this.params.width}):this.domElem.css({width:"100%"}),this._notNew&&(this.delMod("mode"),this.dropElemCache()),BEM.blocks["b-grid-table-token"].un(this.domElem,"remove"),BEM.blocks["b-grid-table-cell"].un(this.domElem,"start-edit"),BEM.blocks["b-grid-table-row"].un(this.domElem,"start-edit"),BEM.blocks["b-grid-table-cell"].un(this.domElem,"save"),this.unbindFrom(this.elem("table-wrapper"),"scroll"),this.unbindFrom(this.elem("scroll-left"),"click"),this.unbindFrom(this.elem("scroll-right"),"click"),BEM.blocks["b-grid-table-cell"].on(this.domElem,"save",this._onCellSave,this),this.afterCurrentEvent(a(regeneratorRuntime.mark((function t(){var o,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s._buildGridBEMJSON();case 2:o=t.sent,n=BEMHTML.apply(o),BEM.DOM.update(s.findElem("i"),n),s._afterUpdate(e),BEM.WISTORE.get("app").set("contentLoaded",!0),i._updateColsWidth(),i._dequeueSetHeaderPosition(),i.params.isAction||(i.unbindFromDoc("scroll.bar",i._setHeaderPosition),i.unbindFromWin("resize.bar",i._setHeaderPosition),i.bindToDoc("scroll.bar",i._setHeaderPosition),i.bindToWin("resize.bar",i._setHeaderPosition));case 10:case"end":return t.stop()}}),t)}))))},_enqueueSetHeaderPosition:function(){this._setHeaderPositionQueue+=1},_dequeueSetHeaderPosition:function(){this._setHeaderPositionQueue>0&&(this._setHeaderPositionQueue=0,this._setHeaderPosition())},_setHeaderPosition:function(){var t=this.findElem("head");if(0!==t.length){var e=BEM.DOM.win.scrollTop(),i=t.offset().top,s=this.findElem("table-wrapper").height(),o=t.height(),n=e>i-this.__self._pageInfoPanelWidth&&e-i+this.__self._pageInfoPanelWidth+o<s;this.findBlocksInside("b-grid-table-head").forEach((function(t){n?t.domElem.css({position:"relative",top:e-i+this.__self._pageInfoPanelWidth}):t.domElem.css({position:"initial",top:"auto"})}),this)}else this._enqueueSetHeaderPosition()},_updateColsWidth:function(){var t=this._gridData.structure.fields,e=this.hasMod("fixed-columns-width","yes"),i=this.findBlocksInside(this.findElem("body"),"b-grid-table-row").length,s=10*(String(i).length-1)+1;this._sumPXColsWidth=0,t.forEach((function(t){"px"===t.width_units&&(this._sumPXColsWidth+=parseInt(t.width)+this.__self._colPadding)}),this),this.showNumbers&&(this._sumPXColsWidth+=s+this.__self._colPadding),e?(this.findElem("table").width(this._sumPXColsWidth+"px"),this.findElem("counter-cell").width(s+"px"),this.findElem("new-col-cell").width("25px")):(this.findElem("table").width(""),this.findElem("counter-cell").width(""),this.findElem("new-col-cell").width(""))},_afterUpdate:function(t){this._notNew=!0,this._editButton=this.findBlockInside({block:"button2",modName:"role",modVal:"edit"}),this._editButton&&this._editButton.on("click",this._onEdit,this),this._newRow=this.findBlockInside("b-grid-table-new-row"),this._setEditAfterRebuild&&(this._onEdit(),this._setEditAfterRebuild=!1),window.localStorage["wiki-new-grid"]&&(this._onEdit(),this.findBlockInside({block:"b-grid-table-head",modName:"type",modVal:"new-col"})._onEditClick("create"),window.localStorage.removeItem("wiki-new-grid")),this._content||(this._content=this.bPage.findBlockInside("b-content")&&this.bPage.findBlockInside("b-content").domElem||this.bPage.findBlockInside("page-editor").elem("preview-content")),this.recalculateScroll(),this.bindTo(this.findElem("table-wrapper"),"scroll",this.recalculateScroll.bind(this)),this.bindTo(this.findElem("scroll-left"),"click",this.scrollTable.bind(this,"left")),this.bindTo(this.findElem("scroll-right"),"click",this.scrollTable.bind(this,"right")),"add"===t&&this.elem("table-wrapper").scrollLeft(this.elem("table").width()),this.params.isAction&&this.channel("common").trigger("reset-hash"),this._tableBar=this.findBlockInside("b-grid-table-bar"),Ya.FormatterViewPort.BEM.DOM.init(this.domElem),this.setMod("loaded","yes"),BEM.blocks["b-grid-table"].needColAddTimeEnd&&Ya.Rum.timeEnd(BEM.blocks["b-grid-table"].COUNTERS.colAdd),BEM.blocks["b-grid-table"].needColAddTimeEnd=!1,BEM.blocks["b-grid-table"].needColDeleteTimeEnd&&Ya.Rum.timeEnd(BEM.blocks["b-grid-table"].COUNTERS.colDelete),BEM.blocks["b-grid-table"].needColDeleteTimeEnd=!1,BEM.blocks["b-grid-table"].needSortTimeEnd&&Ya.Rum.timeEnd(BEM.blocks["b-grid-table"].COUNTERS.sort),BEM.blocks["b-grid-table"].needSortTimeEnd=!1,BEM.blocks["b-grid-table"].needColMoveTimeEnd&&Ya.Rum.timeEnd(BEM.blocks["b-grid-table"].COUNTERS.colMove),BEM.blocks["b-grid-table"].needColMoveTimeEnd=!1},showDiff:function(t){var e=this;return a(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=BEM.DOM,i.t1=e.elem("i"),i.t2=BEMHTML,i.next=5,e._buildGridDiffBEMJSON(t);case 5:i.t3=i.sent,i.t4=i.t2.apply.call(i.t2,i.t3),i.t0.update.call(i.t0,i.t1,i.t4),e.setMod("fixed-columns-width","no");case 9:case"end":return i.stop()}}),i)})))()},syncGrid:function(){return this.removeRows()},_getRowMaxCellVersion:function(t){var e=-1;return t&&t.findBlocksInside("b-grid-table-cell").forEach((function(t){var i=parseInt(t.getVersion());e=e<i?i:e}),this),e},createRowAfter:function(t,e,i){var s=this;return a(regeneratorRuntime.mark((function o(){var n,a,r,l,c,d;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(a=s,r=s._getRowMaxCellVersion(t),l=s._getRowMaxCellVersion(e),c=r>l?r:l,!s._newRow.hasMod("ready","no")){o.next=6;break}return o.abrupt("return");case 6:if(s._newRow.setMod("ready","no"),d={version:c>=0?c:s._gridData.version,changes:[{added_row:{after_id:t?t.params.row_id:"-1",before_id:e?e.params.row_id:"-1",data:{}}}]},!t){o.next=22;break}return o.t0=BEM.DOM,o.t1=t.domElem,o.t2=BEMHTML,o.next=14,s._getEmptyRow();case 14:o.t3=o.sent,o.t4=o.t2.apply.call(o.t2,o.t3),o.t0.after.call(o.t0,o.t1,o.t4),t.delMod("state"),t._activeCell&&t._activeCell.delMod("state"),n=t.domElem.next().bem("b-grid-table-row"),o.next=31;break;case 22:return o.t5=BEM.DOM,o.t6=s.elem("body"),o.t7=BEMHTML,o.next=27,s._getEmptyRow();case 27:o.t8=o.sent,o.t9=o.t7.apply.call(o.t7,o.t8),o.t5.prepend.call(o.t5,o.t6,o.t9),n=s.findBlockInside(s.elem("body"),"b-grid-table-row");case 31:n.setMod("state","edit").delMod("type"),i||setTimeout((function(){n.findBlocksInside("b-grid-table-cell")[a.showNumbers?1:0].setMod("state","edit")}),0),BEM.create("wi-api-request",{apiPath:".grid/rows",path:"/"+s.params.supertag,method:"POST",data:d,apiTimeout:s.__self._apiTimeout,urlParams:s.gridOptionsUrlParams()}).run().then(s._onAddRow.bind(s,n),s._onAddRowFailed.bind(s,n)).always(function(){this._newRow.setMod("ready","yes")}.bind(s));case 34:case"end":return o.stop()}}),o)})))()},buildGrid:function(){this._notNew||BEM.DOM.update(this.domElem,BEMHTML.apply({block:this.__self.getName(),elem:"i",content:{block:"spin2",mods:{size:"s",progress:"yes",type:"data-load"}}}),this._buildContent,this)},removeRows:function(){var t={changes:this._rowsToRemove.map((function(t){return{removed_row:{id:t.params.row_id}}}))};return t.changes.length?BEM.create("wi-api-request",{apiPath:".grid/change",path:"/"+this.params.supertag,method:"POST",data:t,apiTimeout:this.__self._apiTimeout,urlParams:this.gridOptionsUrlParams()}).run().then(this._onRowDelete.bind(this),BEM.blocks["wi-notification"].errorHandler()):Promise.resolve()},_onSort:function(t,e){this._gridData=e,this.rebuild(),this.trigger("sorted")},_onAddRow:function(t,e){t.params.row_id=e.data.id,t.findBlocksInside("b-grid-table-cell").forEach((function(t){t.version=e.data.version}),this),t._activeCell&&t._activeCell.setRowId(e.data.id),this.trigger("row-added"),this._rebindEvents(),this.delMod("empty"),this._updateColsWidth(),Ya.Rum.timeEnd(BEM.blocks["b-grid-table"].COUNTERS.rowAdd)},_onAddRowFailed:function(t,e){t.destruct(),BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,null,e))},_buildGridDiffBEMJSON:function(t){var e=this;return a(regeneratorRuntime.mark((function i(){var s,o,n,a,r,l,c,d,h,u,m,p,_,b,g,f;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:s=[],o=e._getRowBEMJSON(),n=t.diff,a=t.titles,r=e.__self.getName(),l={block:r,elem:"table",content:[o,{block:r,elem:"body",tag:"tbody",content:s}]},Object.keys(a).length&&o.content.push({block:"b-grid-table-head",mods:{type:"settings"},tag:"th"}),o.mods={type:"head"},Object.keys(a).forEach((function(t){var e={base:a[t]};this._formDiffCol(e);var i={block:"b-grid-table-head",mods:{state:e.state},tag:"th",content:{elem:"i",content:{elem:"text",content:e.content}}};o.content.push(i)}),e),c=0,d=Object.keys(n);case 10:if(!(c<d.length)){i.next=32;break}h=d[c],(u=e._getRowBEMJSON()).content.push({block:"b-grid-table-cell",mods:{type:"counter",state:e._getDiffCounterState(n[h])},mix:{elem:"custom-counter"},tag:"td",content:h}),m=0,p=Object.keys(n[h]);case 15:if(!(m<p.length)){i.next=28;break}return _=p[m],b={name:_,type:"diff"},g={base:n[h][_]},e._formDiffCol(g),i.next=22,e._getCell(b.type,g,b);case 22:(f=i.sent).mods.state=g.state,u.content.push(f);case 25:m++,i.next=15;break;case 28:s.push(u);case 29:c++,i.next=10;break;case 32:return i.abrupt("return",l);case 33:case"end":return i.stop()}}),i)})))()},_getDiffCounterState:function(t){var e=0,i=0,s="",o=Object.keys(t),n=o.length;return o.forEach((function(s){var o=t[s];null!==o&&(void 0!==o.new&&void 0===o.old&&e++,void 0!==o.old&&void 0===o.new&&i++)}),this),e===n&&(s="new"),i===n&&(s="old"),s},_formDiffCol:function(t){null===t.base?t.content="":void 0!==t.base.old&&void 0!==t.base.new?(t.state="change",t.content=[{elem:"old-changed",content:t.base.old}," ",{elem:"new-changed",content:t.base.new}]):void 0!==t.base.old?(t.state="old",t.content={elem:"old-deleted",content:t.base.old}):void 0!==t.base.new?(t.state="new",t.content={elem:"old-added",content:t.base.new}):t.base.current&&(t.state="current",t.content={elem:"current",content:t.base.current})},_onEdit:function(){!this.readOnly&&BEM.WISTORE.get("page").get("canEdit")&&(this._currentRow&&this.elem("row-delete").css({height:0}),this.toggleMod("mode","edit"),this.trigger("grid-edit"))},_buildContent:function(t){if(!0===t&&(this._setEditAfterRebuild=!0),!this._gridData){var e=BEM.WISTORE.get("page").get("translation");return(e?BEM.create("wi-api-request",{apiPath:".translate/"+e.from+"-"+e.to,method:"GET",urlParams:!1,path:"/"+this.params.supertag}):BEM.create("wi-api-request",{apiPath:".grid",path:"/"+this.params.supertag,apiTimeout:this.__self._apiTimeout,urlParams:this.gridOptionsUrlParams(["format=json","noredirect=true"])})).run().then(this._onGotData.bind(this),this._onFailedData.bind(this))}this.rebuild()},_onGotData:function(t){this._gridData=t.data,this._gridData.structure?this.rebuild():this._showGridError(BEM.I18N("b-grid-table","incorrect_format"))},_onFailedData:function(t){this._showGridError(BEM.I18N("b-grid-table","cant_load_table"),t,!0)},_showGridError:function(t,e,i){var s=[t,{html:"<br/>"},BEM.blocks["wi-notification"].createErrorMessage(e)];i&&s.push({block:"button2",mods:{size:"s",theme:"normal",role:"build"},text:BEM.I18N("b-grid-table","try_more")}),BEM.DOM.update(this.domElem,BEMHTML.apply({block:"b-grid-error",content:{elem:"message",content:s}}),this._onGridErrorMessage,this)},scrollTable:function(t){var e=this.findElem("table"),i=this.findElem("table-wrapper"),s=Math.round(i.width()/3),o="left"===t?i.scrollLeft()-s:i.scrollLeft()+s,n=Math.round(e.width()/10);"left"===t&&o<n&&(o=0),"right"===t&&e.width()-o-i.width()<n&&(o=e.width()),i.animate({scrollLeft:o},300)},recalculateScroll:function(){this._recalculateScrollTimeout||(this._recalculateScrollTimeout=setTimeout(function(){var t=this.findElem("table-wrapper"),e=this.findElem("table");e.width()>t.width()?this.setMod("left-scroll",t.scrollLeft()>0?"yes":"").setMod("right-scroll",t.scrollLeft()+t.width()<=e.width()?"yes":""):this.delMod("left-scroll").delMod("right-scroll"),this._recalculateScrollTimeout=null}.bind(this),100))},_bindEvents:function(){this.bindTo(this.findElem("body","tr"),"mouseenter",this._onRowMouseEnter),BEM.blocks["b-grid-table-head"].on(this.domElem,"delete",this._onColDelete,this),this.bindTo(this.domElem,"clickoutside",this._onTableOutsideClick)},_unbindEvents:function(){this.unbindFrom(this.elem("tr"),"mouseenter"),BEM.blocks["b-grid-table-head"].un(this.domElem,"delete"),this.unbindFrom(this.domElem,"clickoutside")},_rebindEvents:function(){this._unbindEvents(),this.dropElemCache(),this._bindEvents()},_onColDelete:function(t,e){var i;return this.syncGrid().then(function(){e.table===this.tableId&&(i={version:this._gridData.version,changes:[{removed_column:{name:t.block.params.id}}]},BEM.create("wi-api-request",{apiPath:".grid/change_and_get_document",path:"/"+this.params.supertag,method:"POST",data:i,apiTimeout:this.__self._apiTimeout,urlParams:this.gridOptionsUrlParams()}).run().then(this._onColDeleteSuccess.bind(this),BEM.blocks["wi-notification"].errorHandler()))}.bind(this))},_onColDeleteSuccess:function(t){this.dropElemCache(),this._setEditAfterRebuild=!0,this._gridData=t.data.grid,this.rebuild()},_onCellSave:function(t,e){var i={version:t.block.getVersion(),changes:[{edited_row:{id:e.rowId,data:{}}}]};i.changes[0].edited_row.data[t.block.params.name]=e.val?e.val:"",BEM.create("wi-api-request",{apiPath:".grid/change_get_cell",path:"/"+this.params.supertag,method:"POST",data:i,apiTimeout:this.__self._apiTimeout,urlParams:this.gridOptionsUrlParams()}).run().then(this._onCellSaveSuccess.bind(this,t),this._onCellSaveFail.bind(this,t))},_onCellSaveSuccess:function(t,e){t.block.trigger("saved",e)},_onCellSaveFail:function(t,e){t.block.trigger("save-error"),BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(t.block.domElem,null,e))},_onRowDeleteClick:function(){var t=this._currentRow.next(),e=this._currentRow.bem("b-grid-table-row");if(e.hasMod("removed","yes")){var i=this._rowsToRemove.indexOf(e);return-1!==i&&this._rowsToRemove.splice(i,1),this.delMod(this.elem("row-delete"),"restore"),void e.delMod("removed")}this._rowsToRemove.push(e),e.setMod("removed","yes"),this._currentRow=t,0===this._currentRow.prev().length&&0===this._currentRow.next().length&&this.setMod("empty","body"),this.elem("row-delete").css({top:0,height:0}),this.trigger("row-delete")},_onRowDelete:function(){this._rowsToRemove.forEach((function(t){BEM.DOM.destruct(t.domElem)})),this._rowsToRemove=[],this._updateColsWidth(),this.trigger("grid-synced")},_onRowMouseEnter:function(t){var e=$(t.currentTarget),i=e.bem("b-grid-table-row"),s=this.elem("row-delete");this._currentRow=e,s.css({right:-22,top:this._currentRow.offset().top-this.domElem.offset().top,height:this._currentRow.outerHeight()}),i.hasMod("removed","yes")?this.setMod(s,"restore","yes"):this.setMod(s,"restore","")},_onGridErrorMessage:function(){this._buildButton=this.findBlockInside({block:"button2",modName:"role",modVal:"build"}),this._buildButton&&this._buildButton.on("click",this._onBuildButtonClick,this),this.setMod("loaded","yes")},_onBuildButtonClick:function(){this.buildGrid()},_onTableOutsideClick:function(){this._preventCellOutside||this._preventRowOutside||this._lockOutsideClicks||this._onEdit()},_saveTitle:function(t){if(this._gridData.structure.title!==t){var e={version:this._gridData.version,changes:[{title_changed:{title:t}}]};BEM.create("wi-api-request",{apiPath:".grid/change",path:"/"+this.params.supertag,method:"POST",data:e,apiTimeout:this.__self._apiTimeout,urlParams:this.gridOptionsUrlParams()}).run().then(this._onTitleSaveSuccess.bind(this,t),BEM.blocks["wi-notification"].errorHandler())}},_onTitleSaveSuccess:function(t,e){var i=this.bPage.findBlockInside("b-grid-table-settings");this._gridData.version=e.data.version,document.title=(t||BEM.I18N("b-grid-table","page"))+" @ Wiki",this.bPage.findBlockInside("b-page-title").domElem.text(t),this._gridData.structure.title=t,i.findBlockInside(i.elem("grid-title"),"input").val(t)},_saveSorting:function(t){var e={version:this._gridData.version,changes:[{sorting_changed:{sorting:t}}]};BEM.create("wi-api-request",{apiPath:".grid/change_and_get_document",path:"/"+this.params.supertag,method:"POST",data:e,apiTimeout:this.__self._apiTimeout,urlParams:this.gridOptionsUrlParams()}).run().then(this._onSortingSaveSuccess.bind(this),BEM.blocks["wi-notification"].errorHandler())},_onSortingSaveSuccess:function(t){this.dropElemCache(),this._gridData=t.data.grid,this.rebuild()},_buildGridBEMJSON:function(){var t=this;return a(regeneratorRuntime.mark((function e(){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0={block:t.__self.getName(),elem:"scroll-left"},e.t1={block:t.__self.getName(),elem:"scroll-right"},e.t2={block:t.__self.getName(),elem:"head-indicator"},e.t3={block:t.__self.getName(),elem:"row-indicator"},e.t4={block:t.__self.getName(),elem:"row-dragger",attrs:{draggable:"true"},content:{block:"awesome-icon",mods:{icon:"ellipsis-v"}}},e.t5={block:t.__self.getName(),elem:"drag-image"},e.t6={block:t.__self.getName(),elem:"row-delete",content:{block:"awesome-icon",mods:{icon:"remove"}}},e.t7=t.__self.getName(),e.t8={block:"b-page",elem:"js",content:{html:"Ya.Rum.sendRaf('2876');"}},e.t9=t.__self.getName(),e.t10=[t._buildGridHeadBEMJSON()],e.next=13,t._buildGridBodyBEMJSON();case 13:return e.t11=e.sent,e.t12=e.t10.concat.call(e.t10,e.t11),e.t13={block:e.t9,elem:"table",content:e.t12},e.t14=[e.t8,e.t13],e.t15={block:e.t7,elem:"table-wrapper",content:e.t14},(i=[e.t0,e.t1,e.t2,e.t3,e.t4,e.t5,e.t6,e.t15]).push({block:"b-grid-table-bar",mods:{visibility:t.readOnly?"hidden":""},gridUrl:t.params.supertag,isAction:t.params.isAction,actuality:t.bPage.getMod("actuality"),fieldsCount:t._gridData.structure.fields.length,user:t.params.user,breadcrumbs:t.params.breadcrumbs||[],redirect:BEM.WISTORE.get("page").get("redirect")}),e.abrupt("return",i);case 21:case"end":return e.stop()}}),e)})))()},_buildGridHeadBEMJSON:function(){var t=this._gridData.structure.fields,e=this._getRowBEMJSON(),i=!0,s=!1;return e.mods={type:"head"},this.showNumbers&&e.content.push({block:"b-grid-table-head",mods:{type:"settings"},mix:{block:"b-grid-table",elem:"counter-cell"},tag:"th"}),t.forEach((function(t){"px"!==t.width_units&&(i=!1),t.width_units||(s=!0)})),t.forEach((function(t){var s=t.type,o=t.sorting?"asc"===t.sorting?"sort-down":"sort-up":"angle-down",n={block:"b-grid-table-head",attrs:{draggable:"true"},mix:[{block:"b-grid-table-head-draggable",js:!0}],tag:"th",js:{id:t.name,required:Boolean(t.required),value:t.title,width:!!t.width&&t.width,width_units:!!t.width&&t.width_units,markdone:Boolean(t.markdone),options:!!t.options&&t.options},content:{elem:"i",content:[{elem:"text",content:t.title},{elem:"edit",content:{block:"awesome-icon",mods:{icon:"reorder"}}},{elem:"sort",content:{block:"awesome-icon",mods:{icon:o,type:"sort"}}}]}};t.width&&(n.attrs.style="width: "+t.width+t.width_units,i&&(n.content.attrs={style:"width: "+Number(t.width)+"px"})),"select"===t.type&&!0===t.multiple&&(s="multiselect"),"staff"===t.type&&!0===t.multiple&&(s="multistaff"),n.js.type=s,e.content.push(n)})),this.setMod("fixed-columns-width",i?"yes":"no"),this.setMod("auto-width-columns",s?"yes":"no"),this._newColId=Date.now(),e.content.push({block:"b-grid-table-head",js:{id:this._newColId},mods:{type:"new-col"},mix:{block:"b-grid-table",elem:"new-col-cell"},tag:"th",content:{elem:"edit",content:{block:"awesome-icon",mods:{icon:"plus"}}}}),{block:this.__self.getName(),elem:"head",tag:"thead",content:e}},_buildGridBodyBEMJSON:function(){var t=this;return a(regeneratorRuntime.mark((function e(){var i,o,n,a,r,l,c,d,h,u,m,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=t,o={block:t.__self.getName(),elem:"body",tag:"tbody",content:[]},n=t._gridData.rows||[],t._gridData.structure.fields.forEach((function(t){"ticket"===t.type&&(this.isTicket=!0)}),t),a=s(n),e.prev=5,a.s();case 7:if((r=a.n()).done){e.next=36;break}l=r.value,c={raw:[]},d=i._getRowBEMJSON(),i.showNumbers&&d.content.push({block:"b-grid-table-cell",mods:{type:"counter"},tag:"td"}),d.mix.push({block:"b-grid-table-row-draggable",js:!0}),h=0;case 14:if(!(h<l.length)){e.next=30;break}return u=l[h],m=i._gridData.structure.fields[h],p=m.type,c.raw.push(u.raw),"checkbox"===p&&m.markdone&&!0===u.raw&&(d=i._markRowChecked(d)),"select"===p&&!0===m.multiple&&(p="multiselect"),"staff"===p&&!0===m.multiple&&(p="multistaff"),e.t0=d.content,e.next=25,i._getCell(p,u,m);case 25:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 27:h+=1,e.next=14;break;case 30:c.row_id=l[0]?l[0].row_id:-1,d.js=c,d.content.push(i._getNewColCell()),o.content.push(d);case 34:e.next=7;break;case 36:e.next=41;break;case 38:e.prev=38,e.t2=e.catch(5),a.e(e.t2);case 41:return e.prev=41,a.f(),e.finish(41);case 44:return o.content.push(t._getNewRow()),n.length||t.setMod("empty","body"),e.abrupt("return",o);case 47:case"end":return e.stop()}}),e,null,[[5,38,41,44]])})))()},_getNewColCell:function(){return{block:"b-grid-table-cell",mods:{type:"new-col"},tag:"td"}},_getCell:function(t,e,i){var s=this;return a(regeneratorRuntime.mark((function o(){var n;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.t0={type:t},o.t1={raw:e.raw,name:i.name},o.t2=i.width&&{width:i.width+i.width_units},o.next=5,s._getContentByType(t,e,i);case 5:return o.t3=o.sent,n={block:"b-grid-table-cell",mods:o.t0,js:o.t1,tag:"td",attrs:o.t2,content:o.t3},i.required&&(n.mods.required="yes",e._isEmpty&&(n.mods["required-empty"]="yes"),n.content=[n.content,{block:"b-grid-table-required-info",content:BEM.I18N("b-grid-table","this_required")}]),-1===t.search(/^ticket-/)&&(n.mods.editable="yes"),i.options&&(n.js.options=i.options),"staff"!==t&&"multistaff"!==t||(n.js.transformed=e.transformed),o.abrupt("return",n);case 12:case"end":return o.stop()}}),o)})))()},_swapStructure:function(t,e,i){var s=this._gridData.structure[i];s.splice(e,0,s.splice(t,1)[0])},_getNewRow:function(){return{block:"b-grid-table-new-row",js:!0,tag:"tr",content:{elem:"cell",attrs:{colspan:this._gridData.structure.fields.length+2},tag:"td",content:BEM.I18N("b-grid-table","add_line")}}},_getEmptyRow:function(){var t=this;return a(regeneratorRuntime.mark((function e(){var i,s,o,n,a,r,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o={raw:[]},n=t._gridData.structure.fields.length,a=t._getRowBEMJSON(),r=t._gridData.structure.fields,a.mods={type:"new"},t.showNumbers&&a.content.push({block:"b-grid-table-cell",mods:{type:"counter"},tag:"td"}),a.mix.push({block:"b-grid-table-row-draggable",js:!0}),l=0;case 8:if(!(l<n)){e.next=25;break}return i=r[l].type,"select"===r[l].type&&!0===r[l].multiple&&(i="multiselect"),"staff"===r[l].type&&!0===r[l].multiple&&(i="multistaff"),s={raw:""},"number"===r[l].type&&(s.raw=null),"checkbox"===r[l].type&&(s.raw=!1),"select"!==r[l].type&&"staff"!==r[l].type||(s.raw=[],s.transformed=[]),o.raw.push(s),e.t0=a.content,e.next=20,t._getCell(i,s,r[l]);case 20:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 22:l++,e.next=8;break;case 25:return a.js=o,a.content.push(t._getNewColCell()),e.abrupt("return",a);case 28:case"end":return e.stop()}}),e)})))()},_getRowBEMJSON:function(){return{block:"b-grid-table-row",mix:[{block:this.__self.getName(),elem:"tr"}],tag:"tr",content:[]}},_getContentByType:function(t,e,i){var s=this;return a(regeneratorRuntime.mark((function o(){var n,a;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:o.t0=t,o.next="diff"===o.t0?3:"string"===o.t0?5:"number"===o.t0?9:"checkbox"===o.t0?11:"date"===o.t0?13:"select"===o.t0?15:"multiselect"===o.t0?17:"staff"===o.t0?19:"multistaff"===o.t0?21:"ticket"===o.t0?23:"ticket-subject"===o.t0?25:"ticket-type"===o.t0?27:"ticket-assignee"===o.t0?29:"ticket-reporter"===o.t0?31:"ticket-status"===o.t0?33:"ticket-priority"===o.t0?35:"ticket-createdat"===o.t0?37:"ticket-updatedat"===o.t0?39:"ticket-originalestimation"===o.t0?41:"ticket-fixversions"===o.t0?43:"ticket-components"===o.t0?45:"ticket-storypoints"===o.t0?47:49;break;case 3:return n=e.content||"",o.abrupt("break",50);case 5:return o.next=7,s.__self.getStringBEMJSON(e,s.domElem,s.params.supertag);case 7:return n=o.sent,o.abrupt("break",50);case 9:return n=s.__self.getNumberBEMJSON(e),o.abrupt("break",50);case 11:return n=s.__self.getCheckBoxBEMJSON(e,i,s.readOnly),o.abrupt("break",50);case 13:return n=s.__self.getDateBEMJSON(e),o.abrupt("break",50);case 15:return n=s.__self.getSelectBEMJSON(e),o.abrupt("break",50);case 17:return n=s.__self.getMultiSelectBEMJSON(e),o.abrupt("break",50);case 19:case 21:return n=s.__self.getStaffBEMJSON(e),o.abrupt("break",50);case 23:return n=s.__self.getTicketBEMJSON(e),o.abrupt("break",50);case 25:case 27:return e.view?n=e.view:e.raw?n=e.raw:e._isEmpty=!0,o.abrupt("break",50);case 29:case 31:return e.transformed?n=s.__self.getStaffBEMJSON(e):e._isEmpty=!0,o.abrupt("break",50);case 33:case 35:return e.view?n=e.view:e.raw?n=e.raw:e._isEmpty=!0,o.abrupt("break",50);case 37:case 39:return n=s._getTicketDateString(e),o.abrupt("break",50);case 41:case 43:case 45:case 47:return e.view?n=e.view:e.raw?n=e.raw:e._isEmpty=!0,o.abrupt("break",50);case 49:n=BEM.I18N("b-grid-table","undefined_column");case 50:return-1!==t.indexOf("ticket-")&&"string"==typeof n&&(a=s.__self.filterXSS,n={html:a(n)}),o.abrupt("return",n);case 52:case"end":return o.stop()}}),o)})))()},_getTicketDateString:function(t){var e,i;return t.view&&(i=BEM.blocks["mi-helpers"].getDateFromHumanString(t.view),e={block:"m-date",short:!0,format:"middle",alwaysShowYear:!0,timestamp:i=BEM.blocks["mi-helpers"].getHumanStringFromDate({date:i})}),e||""},_markRowChecked:function(t){return t.mods=t.mods||{},t.mods.checked="yes",t},gridOptionsUrlParams:function(t){var e=t||[];return this.params.sort&&e.push("sort="+this.params.sort),this.params.filter&&e.push("filter="+this.params.filter),this.params.width&&e.push("width="+this.params.width),this.params.num&&e.push("num="+this.params.num),this.params.columns&&e.push("columns="+this.params.columns),!!e.length&&e},_showAddColPopup:function(){if("edit"===this.getMod("mode")){var t=this.findBlockInside({block:"b-grid-table-head",modName:"type",modVal:"new-col"});t&&t.createCol()}}},{filterXSS:i(264),_colPadding:21,_apiTimeout:45e3,_pageInfoPanelWidth:67,isEmpty:function(t){return null===t||(void 0===t||(!t.length||""===t))},getTicketBEMJSON:function(t){var e={block:"b-grid-table-cell",elem:"i"};return t.raw?e.content={block:"link",url:t.url,content:t.raw}:(t._isEmpty=!0,e.content={block:"b-grid-table-cell",elem:"br"}),e},getNumberBEMJSON:function(t){var e={block:"b-grid-table-cell",elem:"i"};return t.raw?e.content=t.raw:(t._isEmpty=!0,e.content={block:"b-grid-table-cell",elem:"br"}),e},getCheckBoxBEMJSON:function(t,e,i){var s={mix:{block:"b-grid-table-checkbox"},block:"checkbox",mods:{size:"m",theme:"normal"}};return e.markdone&&(s.mods.markdone="yes"),!0===t.raw&&(s.mods.checked="yes"),i&&(s.mods.disabled="yes"),{block:"b-grid-table-cell",elem:"edit",content:s}},getDateBEMJSON:function(t){var e={block:"b-grid-table-cell",elem:"i"};return t.raw?e.content={block:"m-date",short:!0,format:"middle",alwaysShowYear:!0,timestamp:t.raw}:(t._isEmpty=!0,e.content={block:"b-grid-table-cell",elem:"br"}),e},getSelectBEMJSON:function(t){var e={block:"b-grid-table-cell",elem:"i"};return t.raw&&t.raw.length?e.content={html:t.raw.join("")}:(t._isEmpty=!0,e.content={block:"b-grid-table-cell",elem:"br"}),e},getMultiSelectBEMJSON:function(t){var e=t.raw,i={block:"b-grid-table-cell",elem:"i"};return e&&e.length?i.content={html:e.join(", ")}:(t._isEmpty=!0,i.content={block:"b-grid-table-cell",elem:"br"}),i},getStaffBEMJSON:function(t){var e=t.transformed,i={block:"b-grid-table-cell",elem:"i",content:{block:"b-grid-table-users",content:""}};return e&&e.length?(i.content.content=[],e.forEach((function(t,e){0!==e&&i.content.content.push(", "),t.title||t.first_name?i.content.content.push({block:"m-username",mods:{dismissed:t.is_dismissed?"yes":""},mix:[{block:"mi-staff-card",js:{user:t.login}}],url:"//staff.yandex-team.ru/"+t.login,content:t.title||t.first_name+" "+t.last_name}):i.content.content.push(t.login)}))):(t._isEmpty=!0,i.content={block:"b-grid-table-cell",elem:"br"}),i},COUNTERS:{cellEditStart:"3223.3144.2818.2154",cellEditSave:"3223.3144.2818.691",rowAdd:"3223.1340.160",rowMove:"3223.1340.2808",colAdd:"3223.2356.160",colDelete:"3223.2356.3231",colMove:"3223.2356.2808",sort:"3223.508"}})},function(t,e){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}BEM.DOM.decl("b-grid-table-cell",{onSetMod:{state:{edit:function(){this._initBlock(),this.trigger("start-edit")},"":function(){this.unbindFrom(this.domElem,"clickoutside"),this.unbindFrom(BEM.DOM.win,"resize.cellWidth"),this.trigger("stop-edit"),this.params.row_id?this._save():this._saveAfterSetRowId=!0}}},val:function(){return this.hasMod("state","edit")||this.hasMod("saving","yes")},getVersion:function(){return this._storage||this._createStorage(),this.version||this._storage._table._gridData.version},setRowId:function(t){this.params.row_id=t,this._saveAfterSetRowId&&(this._save(),this._saveAfterSetRowId=!1)},_initBlock:function(){this._storage||this._createStorage(),this._storage._row=this.findBlockOutside("b-grid-table-row"),this._storage._table.hasMod("mode","edit")&&this._storage._row.setMod("state","edit"),!this.params.row_id&&this._storage._row.params.row_id&&(this.params.row_id=this._storage._row.params.row_id),this.bindTo(this.domElem,"clickoutside",this._onClickOutside),this.on("saved",this._onSaved),this.on("save-error",this._onSaveError),this._storage._row.on("stop-edit",(function(){this.delMod("state")}),this)},_onClick:function(){!this.hasMod("state","edit")&&this.hasMod("editable","yes")&&(this._storage||this._createStorage(),this._storage._table.hasMod("mode","edit")&&(this._needCellEditStartTimeEnd=!0,Ya.Rum.time(BEM.blocks["b-grid-table"].COUNTERS.cellEditStart),this._setSizes(),this.setMod("state","edit")))},_timeEndCellEditStart:function(){this._needCellEditStartTimeEnd&&Ya.Rum.timeEnd(BEM.blocks["b-grid-table"].COUNTERS.cellEditStart),this._needCellEditStartTimeEnd=!1},_timeEndCellEditSave:function(){this._needCellEditSaveTimeEnd&&Ya.Rum.timeEnd(BEM.blocks["b-grid-table"].COUNTERS.cellEditSave),this._needCellEditSaveTimeEnd=!1},_onClickOutside:function(){this._preventExitEditing?this._preventExitEditing=!1:this.delMod("state")},_resetValue:function(t,e){var i=void 0===t?this.val():t,s=void 0===e?this.params.raw:e;return!!this._hasChanges(i,s)||(this._storage._table.delMod("mode"),!1)},_setSizes:function(){this._getSizesInfo(),this.domElem.css({width:this._sizes.outerWidth,"min-width":this._sizes.outerWidth,height:this._sizes.outerHeight})},_getSizesInfo:function(){this._sizes={width:this.domElem.width(),height:this.domElem.height(),outerWidth:this.domElem.outerWidth(),outerHeight:this.domElem.outerHeight()}},_onSaved:function(t,e){this.delMod("saving").delMod("required-empty"),this._clearSize(),this.params.raw=e.data.cell.raw,this._isRequiredAndEmpty()&&this.setMod("required-empty","yes"),this.version=e.data.version},_onSaveError:function(){this.domElem.removeAttr("style"),this._clearSize(),this.afterCurrentEvent((function(){this.delMod("saving")}),this)},_isRequiredAndEmpty:function(){return!!this.hasMod("required")&&(!this.params.raw||Boolean("object"===i(this.params.raw)&&!this.params.raw.length))},_createStorage:function(){var t=this.findBlockOutside("b-grid-table");this.__self[t.tableId]||(this.__self[t.tableId]={_table:t}),this._storage=this.__self[t.tableId]},_setEdit:function(){this._getSizesInfo(),this._resizeEdit(),this.bindTo(BEM.DOM.win,"resize.cellWidth",(function(){this._getSizesInfo(),this._resizeEdit()}),this),this.setMod("state","edit")},_resizeEdit:function(){},_clearSize:function(){this.domElem.removeAttr("style")},_save:function(){return this._needCellEditSaveTimeEnd=!0,Ya.Rum.time(BEM.blocks["b-grid-table"].COUNTERS.cellEditSave),{rowId:this.params.row_id,cellPosition:this.domElem.index()-(this._storage._table.showNumbers?1:0),tableId:this._storage._table.tableId}},_hasChanges:function(t,e){if(BEM.blocks["b-grid-table"].isEmpty(t)&&BEM.blocks["b-grid-table"].isEmpty(e))return!1;if(i(t)!==i(e))return!0;if(e.length!==t.length)return!0;for(var s=0;s<t.length;s++)if(t[s]!==e[s])return!0;return!1},showEditControl:$.noop},{live:function(){this.liveBindTo("click",(function(){if(!this.hasMod("editable","yes"))return this._storage||this._createStorage(),this._storage._row&&this._storage._row.delMod("state"),!1;this._onClick()})),this.liveBindTo("dblclick",(function(){this._storage||this._createStorage(),!this._storage._table.hasMod("mode","edit")&&this.hasMod("editable","yes")&&this._storage._table._onEdit(),this._onClick()}))},_getCellLang:function(){var t=BEM.WISTORE.get("page").get("translation"),e=BEM.I18N.lang(),i=t&&t.to;return i&&"tr"!==i||(i=e),i}})},function(t,e){BEM.DOM.decl("b-grid-table-token",{_onClick:function(){this.trigger("remove")}},{live:function(){this.liveBindTo("remove","click",(function(){return this._onClick(),!1}))}})},,,function(t,e){BEM.DOM.decl("mi-error",{_onError:function(t,e){if(e&&(!e.error||e.error.id)){if(!e.content&&e.error||e.error&&!e.error.message){var i=e.error.meta;e.content={body:[BEM.I18N("mi-error",e.error.id)]},i&&Object.keys(i).forEach((function(t){e.content.body.push({elem:"meta",content:t+": "+i[t]})}))}var s=BEMHTML.apply(this._getErrorBEMJSON(e.content));e.node?(this._getPopup(),this._popup.setContent(s).show(e.node)):(this._getModal(),this._modal.setContent(s).show())}}})},function(t,e){BEM.DOM.decl({block:"b-grid-table-cell",modName:"type",modVal:"checkbox"},{onSetMod:{state:{edit:function(){var t=this;this.__base.apply(this,arguments),this._setEdit(),this._resizeEdit(),setTimeout((function(){keymaster("space",(function(e){e.preventDefault(),t._toggleCheckbox(e)}))}),0)},"":function(){this.domElem.removeAttr("style"),this._checkbox.domElem.blur(),this.unbindFrom(this.domElem,"clickoutside"),this.unbindFrom(BEM.DOM.win,"resize.cellWidth"),keymaster.unbind("space"),this.trigger("stop-edit"),this._clearSize()}}},val:function(){return this._checkbox.hasMod("checked")},_initBlock:function(){this.__base.apply(this,arguments),this._setEdit()},_onClick:function(){this.__base.apply(this,arguments),this._initBlock()},_setEdit:function(){var t=this;this._checkbox||(this._checkbox=this.findBlockInside("checkbox"),this._checkbox.on("change",(function(e,i){t._save(i.checked)}),this),this._timeEndCellEditStart())},_resizeEdit:function(){this.elem("edit").css({width:this._sizes.outerWidth+1,height:this._sizes.outerHeight+1})},_clearSize:function(){this.hasMod("saving","yes")||(this.elem("edit").removeAttr("style"),this.__base.apply(this,arguments))},_toggleCheckbox:function(){this._checkbox.toggleMod("checked","yes")},_onSaved:function(t,e){this.delMod("saving"),this._checkbox.delMod("disabled"),this.params.raw=e.data.cell.raw,this.channel("errors").trigger("errorHide"),this.version=e.data.version,this._timeEndCellEditSave()},_onSaveError:function(){},_save:function(t){var e=this.__base.apply(this,arguments);e.val=t,e.val!==this.params.raw&&(this._checkbox.setMod("disabled","yes"),this._checkbox.hasMod("markdone","yes")&&this._storage._row.setMod("checked",t?"yes":""),this.trigger("save",e))},_resetValue:function(){return!0}})},function(t,e){BEM.DOM.decl({block:"b-grid-table-cell",modName:"type",modVal:"select"},{val:function(){if(this.__base.apply(this,arguments)){var t=this._select.getVal();return t!==BEM.I18N("b-grid-table-cell","select")?t:void 0}},_initBlock:function(){if(this.__base.apply(this,arguments),!this._storage._table.hasMod("mode","edit")||this.hasMod("state","edit"))return!1;this._setEdit()},_resizeEdit:function(){var t=this.findElem("edit"),e=this._sizes.outerWidth;t.width()<=e&&this.setMod(t,"offset","no"),t.css({"min-width":e+1,"min-height":this._sizes.outerHeight+1,"max-width":e<400?400:e})},_clearSize:function(){var t=this.findElem("edit");this.delMod(t,"offset"),t.removeAttr("style"),this.__base.apply(this,arguments)},_onClickOutside:function(){this._preventCellOutside||this.__base.apply(this,arguments),this._preventCellOutside=!1},_onSaved:function(){this.__base.apply(this,arguments),BEM.DOM.destruct(this.findElem("i")),BEM.DOM.append(this.domElem,BEMHTML.apply(BEM.blocks["b-grid-table"].getSelectBEMJSON(this.params))),this._timeEndCellEditSave()},_setEdit:function(){this._select||(BEM.DOM.append(this.domElem,this._getSelect()),this._select=this.findBlockInside("select2"),this._selectButton=this._select.findBlockInside("button2"),this._select.popup.on("beforeOpen",this._onSelectOpen,this),this._select.popup.on("afterClose",this._onSelectClose,this)),this.__base.apply(this,arguments),this._timeEndCellEditStart()},_getSelect:function(){var t=this._getSelectData();return BEMHTML.apply({block:this.__self.getName(),elem:"edit",content:{block:"select2",name:"rand_"+Date.now(),mods:{size:"m",text:"vary",theme:"normal",type:"radiocheck",role:"grid"},text:this.params.raw&&this.params.raw[0]||BEM.I18N("b-grid-table-cell","select"),items:t.items,val:t.val}})},_getSelectData:function(){var t,e=this,i=this.params.options.map((function(i){var s={val:i,text:i};return(e.params.raw&&e.params.raw[0])===i&&(t=i),s}));return i.unshift({text:BEM.I18N("b-grid-table-cell","select"),val:BEM.I18N("b-grid-table-cell","select")}),{items:i,val:t}},_onSelectOpen:function(){this._storage._table._preventEnter=!0,this._storage._table._preventRowOutside=!0,this._preventCellOutside=!0,this._selectButton.setMod("focused","yes")},_onSelectClose:function(){var t=this;setTimeout((function(){t._storage._table._preventEnter=!1,t._storage._table._preventRowOutside=!1,t._preventCellOutside=!1,t._selectButton.delMod("pressed").delMod("focused")}),0)},_save:function(){var t=this.__base.apply(this,arguments);t.val=this.val(),t.val!==this.params.raw[0]?this.setMod("saving","yes").trigger("save",t):(this.delMod("state"),this._clearSize())},_resetValue:function(){!1!==this.__base.call(this,this.val(),this.params.raw[0])&&this.val()!==this.params.raw[0]&&this._select.val(this.params.raw[0]?this.params.raw[0]:BEM.I18N("b-grid-table-cell","select"))},showEditControl:function(t){t.preventDefault(),this._select.isOpened()||this._select.open()}})},function(t,e){BEM.DOM.decl({block:"b-grid-table-cell",modName:"type",modVal:"multiselect"},{val:function(){return this._raw},escaped_val:function(){return this._raw.map(_.escape)},_initRaw:function(){this._raw=[].concat(this.params.raw).map((function(t){return _.unescape(t).replace(/&#39;/g,"'")}))},_removeFromRaw:function(t){var e=this.val().filter((function(e){return e!==t}));this._raw=e},_addToRaw:function(t){this._raw.push(t)},_onClickOutside:function(){this._preventCellOutside||this.__base.apply(this,arguments),this._preventCellOutside=!1},_initBlock:function(){if(this.__base.apply(this,arguments),this._initRaw(),!this._storage._table.hasMod("mode","edit")||this.hasMod("state","edit"))return!1;this._setEdit()},_onSaved:function(){var t=this;this.__base.apply(this,arguments),BEM.blocks["b-grid-table-token"].un(this.domElem,"remove",this._onTokenRemove),BEM.DOM.update(this.domElem,BEMHTML.apply(BEM.blocks["b-grid-table"].getMultiSelectBEMJSON(this.params)),(function(){t._timeEndCellEditSave()}))},_setEdit:function(){this._updateEditState(),this.__base.apply(this,arguments),this._timeEndCellEditStart()},_resizeEdit:function(){var t=this.findElem("edit"),e=this._sizes.outerWidth;t.width()<=e&&this.setMod(t,"offset","no"),t.css({"min-width":e+1,"min-height":this._sizes.outerHeight+1,"max-width":e<400?400:e})},_clearSize:function(){var t=this.findElem("edit");this.delMod(t,"offset"),t.removeAttr("style"),this.__base.apply(this,arguments)},_updateEditState:function(){this._select&&this._select.destruct();var t=this._getTokens(),e=this._getSelect(),i=this,s=BEMHTML.apply({block:this.__self.getName(),elem:"edit",content:e}),o=this.findElem("edit");this._preventCellOutside=!0,o.length?BEM.DOM.replace(o,s):BEM.DOM.append(this.domElem,s),this._select=this.findBlockInside("select2"),this._select&&(this._selectButton=this._select.findBlockInside("button2"),this._select.on("change",this._onSelectChange,this),this._select.on("beforeOpen",this._onSelectOpen,this),this._select.on("afterClose",this._onSelectClose,this));var n=this._getTokensPopup();n.setContent(BEMHTML.apply(t)),this.afterCurrentEvent((function(){n.setMod("visible","yes")})),setTimeout((function(){i._preventCellOutside=!1}),0)},_getTokensPopup:function(){return this._tokensPopup&&this._tokensPopup.domElem||(this._tokensPopup=BEM.DOM.append(BEM.DOM.scope,BEMHTML.apply(this.__self._getPopupBEMJSON())).bem("popup2").setAnchor(this.findElem("edit")),this._tokensPopup.bindTo("click",this._onTokensPopupClick.bind(this)),BEM.blocks["b-grid-table-token"].on(this._tokensPopup.domElem,"remove",this._onTokenRemove,this)),this._tokensPopup},_onTokensPopupClick:function(){this._storage._table._preventCellOutside=!0,this._preventExitEditing=!0},_onTokenRemove:function(t){t.block.hasMod("type","multiselect")&&this.hasMod("state","edit")&&(this._removeFromRaw(t.block.params.raw),this._preventCellOutside=!0,this._storage._table._preventRowOutside=!0,this._updateEditState(),this._resizeEdit())},_onSelectChange:function(){var t=this._select.getVal();this._preventCellOutside=!0,this._storage._table._preventRowOutside=!0,t!==BEM.I18N("b-grid-table-cell","select")&&(this._addToRaw(t),this._updateEditState(),this._resizeEdit())},_onSelectOpen:function(){this._storage._table._preventEnter=!0,this._selectButton.setMod("focused","yes")},_onSelectClose:function(){var t=this;setTimeout((function(){t._storage._table._preventEnter=!1,t._selectButton.domElem&&t._selectButton.delMod("pressed").delMod("focused")}),0)},_getSelect:function(){return this._getSelectContent()?{block:"select2",name:"rand_"+Date.now(),mods:{size:"m",theme:"normal",type:"radiocheck",role:"grid"},text:BEM.I18N("b-grid-table-cell","to_choose"),items:this._getSelectContent()}:""},_getTokens:function(){var t,e=this.val();return e.length&&(t={block:"b-grid-table-tokens",content:e.map((function(t){return{block:"b-grid-table-token",mods:{type:"multiselect"},js:{raw:t},content:[t,{elem:"remove",tag:"span",content:"×"}]}}))}),t},_getSelectContent:function(){var t=this._getOptions();if(t.length)return t.unshift(BEM.I18N("b-grid-table-cell","select")),t.map((function(t){return{val:t,text:t}}))},_getOptions:function(){return _.difference(this.params.options,this.val())},_save:function(){var t=this.__base.apply(this,arguments);t.val=this.val(),this._storage._table._preventRowOutside=!0,this._hasChanges(this.escaped_val(),this.params.raw)?this.setMod("saving","yes").trigger("save",t):(this.delMod("state"),BEM.DOM.update(this.domElem,BEMHTML.apply(BEM.blocks["b-grid-table"].getMultiSelectBEMJSON(this.params))),this._clearSize())},_resetValue:function(){!1!==this.__base.apply(this,arguments)&&this._hasChanges(this.escaped_val(),this.params.raw)&&(this._initRaw(),this._updateEditState(),this._resizeEdit())},showEditControl:function(t){t.preventDefault(),this._select.isOpened()||this._select.open()}},{_getPopupBEMJSON:function(){return{block:"popup2",mix:{block:"b-grid-table-cell",elem:"popup"},mods:{target:"anchor",theme:"normal"}}}})},function(t,e){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}BEM.DOM.decl({block:"b-grid-table-cell",modName:"type",modVal:"number"},{val:function(){var t;if(this.__base.apply(this,arguments))return t=this._input.val(),t.length?t:null},_initBlock:function(){if(this.__base.apply(this,arguments),!this._storage._table.hasMod("mode","edit")||this.hasMod("state","edit")||this.hasMod("saving","yes"))return!1;this._setEdit()},_onSaved:function(){this.__base.apply(this,arguments),BEM.DOM.destruct(this.findElem("i")),BEM.DOM.append(this.domElem,BEMHTML.apply(BEM.blocks["b-grid-table"].getNumberBEMJSON(this.params))),this._timeEndCellEditSave()},_isRequiredAndEmpty:function(){return!!this.hasMod("required")&&(null===this.params.raw||Boolean("object"===i(this.params.raw)&&!this.params.raw.length))},_setEdit:function(){this._input?this._input.val(null!==this.params.raw?this.params.raw:""):(BEM.DOM.append(this.domElem,this._getInput()),this._input=this.findBlockInside("input"),this._input.bindTo("input",BEM.blocks["mi-helpers"].validateNumberOnlyInput)),this.__base.apply(this,arguments),this.afterCurrentEvent((function(){this._input.setMod("focused","yes").elem("control").select(),this._timeEndCellEditStart()}))},_resizeEdit:function(){this._input.elem("box").width(this._sizes.outerWidth-1),this._input.elem("control").height(this._sizes.outerHeight-1)},_clearSize:function(){this._input.elem("box").width(""),this._input.elem("control").height(""),this.__base.apply(this,arguments)},_getInput:function(){return BEMHTML.apply({block:this.__self.getName(),elem:"edit",content:{block:"input",mods:{size:"s"},content:{elem:"control"},value:this.params.raw}})},_save:function(){var t=this.__base.apply(this,arguments);t.val=this.val(),this._hasChanged(t.val)?this.setMod("saving","yes").trigger("save",t):(this.delMod("state"),this._clearSize())},_resetValue:function(){var t=this;!1!==this.__base.apply(this,arguments)&&this._hasChanged(this.val())&&this.afterCurrentEvent((function(){t._input.val(t.params.raw||"")}))},_hasChanged:function(t){return t!==(this.params.raw?this.params.raw.toString():this.params.raw)}})},function(t,e){BEM.DOM.decl({block:"b-grid-table-cell",modName:"type",modVal:"date"},{val:function(){if(this.__base.apply(this,arguments)){var t=this._calendar.getDate();return t?BEM.blocks["mi-helpers"].getHumanStringFromDate({date:t}):""}},_initBlock:function(){if(this.__base.apply(this,arguments),!this._storage._table.hasMod("mode","edit")||this.hasMod("state","edit"))return!1;this._setEdit()},_setEdit:function(){this._calendar||(BEM.DOM.append(this.domElem,this._getCalendar()),this._calendar=this.findBlockInside("m-calendar"),this._calendar.on("show",this._onCalendarShow,this).on("hide",this._onCalendarHide,this)),this.__base.apply(this,arguments),this._timeEndCellEditStart()},_onCalendarShow:function(){this._preventCellOutside=!0,this._storage._table._preventRowOutside=!0},_onCalendarHide:function(){var t=this;setTimeout((function(){t._preventCellOutside=!1,t._storage._table._preventRowOutside=!1}),0)},_onSaved:function(){this.__base.apply(this,arguments),BEM.DOM.destruct(this.findElem("i")),BEM.DOM.append(this.domElem,BEMHTML.apply(BEM.blocks["b-grid-table"].getDateBEMJSON(this.params))),this._timeEndCellEditSave()},_resizeEdit:function(){this.elem("edit").css({"min-width":this._sizes.outerWidth+1,"min-height":this._sizes.outerHeight+1})},_clearSize:function(){this.elem("edit").removeAttr("style"),this.__base.apply(this,arguments)},_onClickOutside:function(){this._preventCellOutside||this.__base.apply(this,arguments),this._preventCellOutside=!1},_getCalendar:function(){var t={block:"m-calendar",mods:{toggler:"button",type:"month",has:"clear"},js:{defaultText:BEM.I18N("b-grid-table-cell","choose_date"),value:this.params.raw,autoclose:!0},size:"m",theme:"grey"};return BEMHTML.apply({block:this.__self.getName(),elem:"edit",content:t})},_save:function(){var t=this.__base.apply(this,arguments);t.val=this.val(),t.val!==this.params.raw?this.setMod("saving","yes").trigger("save",t):(this.delMod("state"),this._clearSize())},_resetValue:function(){!1!==this.__base.apply(this,arguments)&&this.val()!==this.params.raw&&(this.params.raw?this._calendar.setDate(this.params.raw):this._calendar.clearDate())},showEditControl:function(t){t.preventDefault(),this.afterCurrentEvent((function(){this._calendar._onTogglerClick()}))}})},function(t,e){BEM.DOM.decl({block:"b-grid-table-cell",modName:"type",modVal:"staff"},{_initBlock:function(){if(this.__base.apply(this,arguments),!this._storage._table.hasMod("mode","edit")||this.hasMod("state","edit"))return!1;var t=this.params.raw.length?this.params.raw[0]:"";this._cellValue=_.unescape(t).replace(/&#39;/g,"'"),this._controlValue=this._cellValue,this._setEdit()},val:function(){return[this._controlValue]},_setEdit:function(){this._storage._table._preventCurrentRowOutsideClick=!0,this._staffSelect||(BEM.DOM.append(this.domElem,this._getStaffSelect()),this._staffSelect=this.findBlockInside("m-suggest").on("select",this._updateUser,this).on("change",this._onControlChange,this).on("item-highlighted",this._disallowSaveTextFromEnter,this).on("item-unhighlighted",this._allowSaveTextFromEnter,this).on("popup-hidden",this._allowSaveTextFromEnter,this)),this.__base.apply(this,arguments),this._staffSelect.val(this._cellValue),this._setFocus(),this._allowSaveTextFromEnter(),this._timeEndCellEditStart()},_onControlChange:function(t){this._preventSuggestInputChange||(this._controlValue=t.block.val()),this._preventSuggestInputChange=!1},_updateUser:function(t,e){var i=this,s=e.entityData;s&&(this._controlValue=s.login,this._lastSelectedUser=s,this._preventSuggestInputChange=!0,this._staffSelect.val(s.login,!0)),e.fromKeyboard||(this._preventCellOutside=!0,this._storage._table._preventRowOutside=!0),setTimeout((function(){i._preventCellOutside=!1}),150)},_getStaffSelect:function(){return BEMHTML.apply({block:this.__self.getName(),elem:"edit",content:{block:"m-suggest",js:{addRequestParams:{"people.query":"i_is_dismissed:0"}},mods:{type:"intranet-v2",size:"m"},inputMods:{clear:"no"},types:[{name:"people"}],value:this._cellValue||!1}})},_disallowSaveTextFromEnter:function(){this._storage._table._preventEnter=!0},_allowSaveTextFromEnter:function(){var t=this;setTimeout((function(){t._storage._table._preventEnter=!1}),0)},_onClickOutside:function(){this._preventCellOutside||this.__base.apply(this,arguments),this._preventCellOutside=!1},_save:function(){var t=this.__base.apply(this,arguments);t.val=[this._controlValue],t.val[0]!==this._cellValue?this.setMod("saving","yes").trigger("save",t):(this.delMod("state"),this._clearSize())},_onSaved:function(){var t,e="&login="+this._controlValue+"&lang="+this.__self._getCellLang();this.__base.apply(this,arguments),t=this._lastSelectedUser&&this._lastSelectedUser.login===this._controlValue?[this._lastSelectedUser]:[{login:_.escape(this._controlValue)}],BEM.DOM.destruct(this.findElem("i")),BEM.DOM.append(this.domElem,BEMHTML.apply(BEM.blocks["b-grid-table"].getStaffBEMJSON({transformed:t}))),this._cellValue=this._controlValue,this._lastSelectedUser&&this._lastSelectedUser.login===this._controlValue||BEM.create("wi-api-request",{apiPath:".staff",urlParams:["format=json"+e],path:""}).run().then(this._onGetLoginData.bind(this),this._onGetLoginDataError.bind(this))},_onGetLoginData:function(t){BEM.DOM.destruct(this.findElem("i")),BEM.DOM.append(this.domElem,BEMHTML.apply(BEM.blocks["b-grid-table"].getStaffBEMJSON({transformed:[{login:this._cellValue,first_name:t.data.first_name,last_name:t.data.last_name,is_dismissed:t.data.is_dismissed}]}))),this._timeEndCellEditSave()},_onGetLoginDataError:function(t){t.id&&"NOT_FOUND"===t.id||BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,BEM.I18N("b-grid-table-cell","get_user_data_error"),t))},_setFocus:function(){this.afterCurrentEvent((function(){this._staffSelect.findBlockInside("textinput").elem("control").focus()}))},_resizeEdit:function(){this._staffSelect.findBlockInside("textinput").domElem.width(this._sizes.outerWidth-1),this._staffSelect.findBlockInside("textinput").domElem.height(this._sizes.outerHeight-2),this._staffSelect.findBlockInside("textinput").elem("control").height(this._sizes.outerHeight-1)},_clearSize:function(){this._staffSelect.findBlockInside("textinput").domElem.width(""),this._staffSelect.findBlockInside("textinput").domElem.height(""),this._staffSelect.findBlockInside("textinput").elem("control").height(""),this.__base.apply(this,arguments)},_resetValue:function(){!1!==this.__base([this.val()[0],this._cellValue])&&this.afterCurrentEvent((function(){this._staffSelect.val(this._cellValue),this._setFocus()}))}})},function(t,e){BEM.DOM.decl({block:"b-grid-table-cell",modName:"type",modVal:"multistaff"},{val:function(){if(this.__base.apply(this,arguments))return this.params.raw},_onSaved:function(){this.__base.apply(this,arguments),BEM.DOM.destruct(this.elem("edit")),BEM.DOM.destruct(this.elem("i")),BEM.DOM.prepend(this.domElem,BEMHTML.apply(BEM.blocks["b-grid-table"].getStaffBEMJSON(this.params))),this._timeEndCellEditSave(),this.dropElemCache()},_initBlock:function(){if(this.__base.apply(this,arguments),!this._storage._table.hasMod("mode","edit")||this.hasMod("state","edit"))return!1;this._storage._table._preventEnter=!0,this._previousRaw=[].concat(this.params.raw),this._previousTransformed=[].concat(this.params.transformed).map((function(t){var e=t;return e.login=_.unescape(t.login).replace(/&#39;/g,"'"),e})),this._setEdit()},_resizeEdit:function(){var t=this.findElem("edit"),e=this._sizes.outerWidth;t.width()<=e&&this.setMod(t,"offset","no"),t.css({"min-width":e+1,"min-height":this._sizes.outerHeight+1,"max-width":e<400?400:e})},_clearSize:function(){var t=this.findElem("edit");this.delMod(t,"offset"),t.removeAttr("style"),this.__base.apply(this,arguments)},_onClickOutside:function(){this._preventCellOutside||this.__base.apply(this,arguments),this._preventCellOutside=!1},_setEdit:function(){var t=BEMHTML.apply({block:this.__self.getName(),elem:"edit",content:this._getMulticomplete()});BEM.DOM.append(this.domElem,t);var e=this._getUsersPopup();e.setContent(BEMHTML.apply({block:"b-grid-table-tokens",content:this._getUserTokens()})),this.afterCurrentEvent((function(){e.setMod("visible","yes")})),this._staffSelect=this.findBlockInside(this.elem("edit"),"m-suggest").on("select",this._onStaffSelect,this).on("item-highlighted",this._disallowSaveTextFromEnter,this).on("item-unhighlighted",this._allowSaveTextFromEnter,this).on("popup-hidden",this._allowSaveTextFromEnter,this),this._tokens=this.findBlockInside(e.domElem,"b-grid-table-tokens"),this._setFocus(),this._allowSaveTextFromEnter(),this.__base.apply(this,arguments),this._timeEndCellEditStart()},_disallowSaveTextFromEnter:function(){this._staffSelect.unbindFrom("keyup")},_allowSaveTextFromEnter:function(){this._staffSelect.bindTo("keyup",function(t){13===t.keyCode&&(this._saveText(),this._staffSelect.hidePopup())}.bind(this))},_onStaffSelect:function(t,e){var i=this,s=e.entityData;this.params.transformed.push(s),this.params.raw.push(s.login),BEM.DOM.update(this._tokens.domElem,BEMHTML.apply(this._getUserTokens())),this._staffSelect.val(""),e.fromKeyboard||(this._preventCellOutside=!0,this._storage._table._preventRowOutside=!0),setTimeout((function(){i._preventCellOutside=!1}),150)},_saveText:function(){var t=this._staffSelect.val();t&&(this.params.transformed.push({login:_.escape(t)}),this.params.raw.push(t),BEM.DOM.update(this._tokens.domElem,BEMHTML.apply(this._getUserTokens())),this._staffSelect.val(""),BEM.create("wi-api-request",{apiPath:".staff",urlParams:["format=json&login="+t+"&lang="+this.__self._getCellLang()],path:""}).run().then(this._onGetLoginData.bind(this,t),this._onGetLoginDataError.bind(this)))},_onGetLoginData:function(t,e){var i;for(i=0;i<this.params.transformed.length;i++)this.params.transformed[i].login===t&&(this.params.transformed[i]={login:t,first_name:e.data.first_name,last_name:e.data.last_name,is_dismissed:e.data.is_dismissed});BEM.DOM.update(this._tokens.domElem,BEMHTML.apply(this._getUserTokens()))},_onGetLoginDataError:function(t){t.id&&"NOT_FOUND"===t.id||BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,BEM.I18N("b-grid-table-cell","get_user_data_error"),t))},_onTokenRemove:function(t){var e=t.block;if(e.hasMod("type","multistaff")&&this.hasMod("state","edit")){this._preventCellOutside=!0,this._storage._table._preventRowOutside=!0;var i=this.params.raw.filter((function(t){return t!==e.params.user})),s=this.params.transformed.filter((function(t){return t.login!==e.params.user}));this.params.raw=i,this.params.transformed=s,BEM.DOM.update(this._tokens.domElem,BEMHTML.apply(this._getUserTokens()))}},_getMulticomplete:function(){return[{block:"m-suggest",mods:{type:"intranet-v2",size:"m"},js:{addRequestParams:{"people.query":"i_is_dismissed:0"}},inputMods:{clear:"no"},types:[{name:"people"}]}]},_getUserTokens:function(){if(this.params.transformed&&this.params.transformed.length)return this.params.transformed.map((function(t){return{block:"b-grid-table-token",mods:{type:"multistaff"},js:{user:t.login},content:[t.title||t.first_name?{block:"m-username",mods:{dismissed:t.is_dismissed?"yes":""},mix:[{block:"mi-staff-card",js:{user:t.login}}],url:"//staff.yandex-team.ru/"+t.login,content:t.title||t.first_name+" "+t.last_name}:t.login,{elem:"remove",tag:"span",content:"×"}]}}))},_save:function(){var t=this.__base.apply(this,arguments);t.val=this.val(),this._hasChanges(t.val,this._previousRaw)?this.setMod("saving","yes").trigger("save",t):(this.delMod("state"),BEM.DOM.destruct(this.elem("edit")),this.dropElemCache())},_getUsersPopup:function(){return this._usersPopup&&this._usersPopup.domElem||(this._usersPopup=BEM.DOM.append(BEM.DOM.scope,BEMHTML.apply(this._getPopupBEMJSON())).bem("popup2").setAnchor(this.findElem("edit")),this._usersPopup.bindTo("click",this._onUsersPopupClick.bind(this)),BEM.blocks["b-grid-table-token"].on(this._usersPopup.domElem,"remove",this._onTokenRemove,this)),this._usersPopup},_onUsersPopupClick:function(){this._storage._table._preventCellOutside=!0,this._preventExitEditing=!0},_getPopupBEMJSON:function(){return{block:"popup2",mix:{block:"b-grid-table-cell",elem:"popup"},mods:{target:"anchor",theme:"normal"}}},_setFocus:function(){this.afterCurrentEvent((function(){this._staffSelect.findBlockInside("textinput").elem("control").focus()}))},_resetValue:function(){!1!==this.__base([this.val(),this._previousRaw])&&(this.params.raw=[].concat(this._previousRaw),this.params.transformed=[].concat(this._previousTransformed),BEM.DOM.update(this._tokens.domElem,BEMHTML.apply(this._getUserTokens())),this._staffSelect.val(""))}})},function(t,e){BEM.DOM.decl({block:"b-grid-table-cell",modName:"type",modVal:"ticket"},{val:function(){var t;if(this.__base.apply(this,arguments))return t=this._input.val(),t.length?t:null},_initBlock:function(){if(this.__base.apply(this,arguments),!this._storage._table.hasMod("mode","edit")||this.hasMod("state","edit")||this.hasMod("saving","yes"))return!1;this._setEdit()},_onSaved:function(t,e){this.__base.apply(this,arguments),BEM.DOM.destruct(this.findElem("i")),BEM.DOM.prepend(this.domElem,BEMHTML.apply(BEM.blocks["b-grid-table"].getTicketBEMJSON(e.data.cell)))},_setEdit:function(){this._input||(BEM.DOM.append(this.domElem,this._getInput()),this._input=this.findBlockInside("input"),this._input.val(this.params.raw||"")),this.__base.apply(this,arguments),this.afterCurrentEvent((function(){this._input.setMod("focused","yes").elem("control").select(),this._timeEndCellEditStart()}))},_resizeEdit:function(){this._input.elem("box").width(this._sizes.outerWidth-1),this._input.elem("control").height(this._sizes.outerHeight-1)},_clearSize:function(){this._input.elem("box").width(""),this._input.elem("control").height(""),this.__base.apply(this,arguments)},_getInput:function(){return BEMHTML.apply({block:this.__self.getName(),elem:"edit",content:{block:"input",mods:{size:"s"},value:this.params.raw,content:{elem:"control"}}})},_save:function(){var t=this.__base.apply(this,arguments);t.val=this.val(),this._hasChanges(t.val,this.params.raw)?this.setMod("saving","yes").trigger("save",t):this.delMod("state"),this._timeEndCellEditSave()},_resetValue:function(){var t=this;!1!==this.__base.apply(this,[this.val(),this.params.raw])&&this.afterCurrentEvent((function(){t._input.val(t.params.raw)}))}})},function(t,e){BEM.DOM.decl("b-grid-table-head",{_onEditClick:function(t){this._storage||this._createStorage(),"create"===t&&this.createCol(),"edit"===t&&this.editCol()},_onSortClick:function(){if(this._storage||this._createStorage(),!this._storage._table.noSorting){BEM.blocks["b-grid-table"].needSortTimeEnd=!0,Ya.Rum.time(BEM.blocks["b-grid-table"].COUNTERS.sort),this._icon||(this._icon=this.findBlockInside(this.elem("sort"),"awesome-icon"));var t=this._icon.hasMod("icon","angle-down")||this._icon.hasMod("icon","sort-up")?"asc":"desc";BEM.DOM.update(this.elem("sort"),BEMHTML.apply({block:"spin2",mods:{size:"xs",progress:"yes"}})),BEM.create("wi-api-request",{apiPath:".grid",path:"/"+this._storage._table.params.supertag,urlParams:this._storage._table.gridOptionsUrlParams(["sort_"+this.params.id+"="+t])}).run().then(this._onSortSuccess.bind(this),BEM.blocks["wi-notification"].errorHandler(this.elem("sort")))}},_onSortSuccess:function(t){this.trigger("sort",t.data)},_createStorage:function(){var t=this.findBlockOutside("b-grid-table");this.__self[t.tableId]||(this.__self[t.tableId]={_table:t}),this._storage=this.__self[t.tableId]},editCol:function(){var t=this._getPopup(),e={action:"edit",isTicket:Boolean(this._storage._table.isTicket),id:this.params.id,required:this.params.required,value:this.params.value,type:this.params.type,markdone:this.params.markdone,options:this.params.options,width:this.params.width,width_units:this.params.width_units};t.delMod("visible").setAnchor(this.elem("edit")).setContent(this._getPopupContent(e)).setMod("visible","yes"),this._form=t.findBlockInside("b-grid-table-edit-col-form"),this._form.on("edit",this._sendData.bind(this,"edit")),this._form.on("delete-col",this._deleteCol,this),this._form.on("close",this._hideEditPopup,this)},_hideEditPopup:function(){this._getPopup().delMod("visible")},_deleteCol:function(){this._getPopup().delMod("visible"),this.trigger("delete",{table:this._storage._table.tableId,index:this.domElem.index()-(this._storage._table.showNumbers?1:0)})},createCol:function(){this._storage||this._createStorage();var t=this._getPopup(),e={action:"add",isTicket:Boolean(this._storage._table.isTicket),width_units:"%",newCol:!0,markdone:!0};t.delMod("visible").setAnchor(this.elem("edit")).setContent(this._getPopupContent(e)).setMod("visible","yes"),this._form=t.findBlockInside("b-grid-table-edit-col-form"),this._form.on("add",this._sendData.bind(this,"add"))},_sendData:function(t,e,i){var s={version:this._storage._table._gridData.version,changes:[{}]};this._storage._table.syncGrid().then(function(){"edit"===e.type?(s.changes[0].edited_column=i,s.changes[0].edited_column.name=this.params.id):s.changes[0].added_column=i,BEM.create("wi-api-request",{apiPath:".grid/change_and_get_document",path:"/"+this._storage._table.params.supertag,method:"POST",data:s,urlParams:this._storage._table.gridOptionsUrlParams()}).run().then(this._onEditCol.bind(this,t),BEM.blocks["wi-notification"].errorHandler())}.bind(this)),this._getPopup().delMod("visible")},_onEditCol:function(t,e){this.dropElemCache(),this._storage._table._setEditAfterRebuild=!0,this._storage._table.rebuild(e.data.grid,t)},_getTitleBEMJSON:function(t){var e={elem:"title",content:{block:"input",mods:{size:"s"},content:{elem:"control"}}};return t.value&&(e.content.value=t.value),e},_getTypeBEMJSON:function(t){var e,i;if(t.type&&t.id){switch(t.type){case"string":i=BEM.I18N("b-grid-table-head","text");break;case"number":i=BEM.I18N("b-grid-table-head","number");break;case"checkbox":i=BEM.I18N("b-grid-table-head","checkbox");break;case"date":i=BEM.I18N("b-grid-table-head","date");break;case"select":i=BEM.I18N("b-grid-table-head","list");break;case"multiselect":i=BEM.I18N("b-grid-table-head","multiple_list");break;case"staff":i=BEM.I18N("b-grid-table-head","employee");break;case"multistaff":i=BEM.I18N("b-grid-table-head","several_employees");break;case"ticket":i=BEM.I18N("b-grid-table-head","ticket_in_tracker");break;default:i=t.type}e={block:"b-grid-table-edit-col-form",elem:"type-view",content:[i+". ",{elem:"id",content:"Id-"+t.id}]}}else e={block:"select2",name:"coltypes",mods:{size:"s",theme:"normal",type:"radiocheck",text:"vary"},text:BEM.I18N("b-grid-table-head","text"),val:"string",items:[{items:[{val:"string",text:BEM.I18N("b-grid-table-head","text")},{val:"number",text:BEM.I18N("b-grid-table-head","number")},{val:"checkbox",text:BEM.I18N("b-grid-table-head","checkbox")},{val:"date",text:BEM.I18N("b-grid-table-head","date")},{val:"select",text:BEM.I18N("b-grid-table-head","list")},{val:"multiple_select",text:BEM.I18N("b-grid-table-head","multiple_list")},{val:"staff",text:BEM.I18N("b-grid-table-head","employee")},{val:"multiple_staff",text:BEM.I18N("b-grid-table-head","several_employees")},!t.isTicket&&{val:"ticket",text:BEM.I18N("b-grid-table-head","ticket_in_tracker")}]},t.isTicket&&this._getTicketOptions(t)]};return e},_getTicketOptions:function(){return{title:BEM.I18N("b-grid-table-head","tickets"),items:[{val:"ticket",text:BEM.I18N("b-grid-table-head","ticket_in_tracker")},{val:"ticket-subject",text:BEM.I18N("b-grid-table-head","title")},{val:"ticket-type",text:BEM.I18N("b-grid-table-head","type")},{val:"ticket-assignee",text:BEM.I18N("b-grid-table-head","executor")},{val:"ticket-reporter",text:BEM.I18N("b-grid-table-head","author")},{val:"ticket-status",text:BEM.I18N("b-grid-table-head","status")},{val:"ticket-priority",text:BEM.I18N("b-grid-table-head","priority")},{val:"ticket-createdat",text:BEM.I18N("b-grid-table-head","date_created")},{val:"ticket-updatedat",text:BEM.I18N("b-grid-table-head","updated")},{val:"ticket-originalestimation",text:BEM.I18N("b-grid-table-head","original_estimation")},{val:"ticket-fixversions",text:BEM.I18N("b-grid-table-head","fix_versions")},{val:"ticket-components",text:BEM.I18N("b-grid-table-head","components")},{val:"ticket-storypoints",text:BEM.I18N("b-grid-table-head","story_points")}]}},_getOptionsBEMJSON:function(t){var e=[{elem:"option-necessary",content:{block:"checkbox",mods:{size:"s",theme:"normal"},text:BEM.I18N("b-grid-table-head","mandatory")}},{elem:"option-markdone",content:{block:"checkbox",mods:{size:"s",theme:"normal"},text:BEM.I18N("b-grid-table-head","mark_made")}}];return t.required&&(e[0].content.mods.checked="yes"),t.markdone&&(e[1].content.mods.checked="yes"),e},_getDeleteBEMJSON:function(t){var e="";return t.newCol||(e={elem:"delete",content:{block:"button2",mods:{size:"s",theme:"pseudo","pseudo-pressed":"yes"},text:BEM.I18N("b-grid-table-head","remove_column")}}),e},_getOkBEMJSON:function(t){return{block:"button2",mods:{theme:"action",type:"submit",size:"s",disabled:!t.newCol&&"yes"},text:t.newCol?BEM.I18N("b-grid-table-head","add"):BEM.I18N("b-grid-table-head","change")}},_getSelectListBEMJSON:function(){return{block:"b-grid-table-list-options",options:this.params.options||[]}},_getPopupContent:function(t){var e={block:"b-grid-table-edit-col-form",mods:{action:t.action,type:t.type},tag:"form",js:!0,content:[this._getTitleBEMJSON(t),{elem:"type",content:this._getTypeBEMJSON(t)},{elem:"select-list",content:this._getSelectListBEMJSON(t)},{elem:"size",content:{block:"b-grid-table-width-controll",width:t.width,width_units:t.width_units,label:BEM.I18N("b-grid-table-head","width"),size:"s"}},{elem:"options",content:this._getOptionsBEMJSON(t)},this._getDeleteBEMJSON(t),{elem:"ok",content:this._getOkBEMJSON(t)}]};return"select"!==t.type&&"multiselect"!==t.type||(e.mods.show="select-list"),BEMHTML.apply(e)},_getPopup:function(){return this._storage._popup&&this._storage._popup.domElem||(this._storage._popup=$(BEMHTML.apply({block:"popup2",directions:["bottom-center","bottom-left","bottom-right"],mods:{type:"grid-edit-col",target:"anchor",theme:"normal",autoclosable:"yes"}})),this._storage._popup=this._storage._popup.bem("popup2"),this._storage._popup.setAnchor(this.elem("edit")),this._storage._popup.on("beforeOpen",this._onPopupShow,this),this._storage._popup.on("afterClose",this._onPopupHide,this)),this._storage._popup},_onPopupShow:function(){this._storage._table._lockOutsideClicks=!0},_onPopupHide:function(){this._storage._table._lockOutsideClicks=!1}},{live:function(){this.liveBindTo("edit","click",(function(){this.hasMod("type","new-col")?this._onEditClick("create"):this._onEditClick("edit")})),this.liveBindTo("sort","click",(function(){this._onSortClick()}))}})},function(t,e){BEM.DOM.decl("b-grid-table-edit-col-form",{onSetMod:{js:function(){this._submit=this.findBlockInside(this.elem("ok"),"button2"),this._submit.on("click",this._onSubmit,this),this.bindTo(this.domElem,"submit",(function(){return!1})),this._delete=this.findBlockInside(this.elem("delete"),"button2"),this._delete&&this._delete.on("click",this._onDeleteCol,this),this.hasMod("action","edit")&&this._bindChange(),this.hasMod("action","add")&&this._buildSelectList()}},_onDeleteCol:function(){Ya.Rum.time(BEM.blocks["b-grid-table"].COUNTERS.colDelete),BEM.blocks["b-grid-table"].needColDeleteTimeEnd=!0,this.trigger("delete-col")},_buildSelectList:function(){this._controls||this._findControls(),this._controls.type.on("change",this._onTypeChange,this)},_onTypeChange:function(){var t=this._controls.type.getVal();"select"===t||"multiple_select"===t?this.setMod("show","select-list"):this.delMod("show"),this.setMod("type",t)},_bindChange:function(){this._controls||this._findControls(),this._controls.title.on("change",this._onFormChange,this),this._controls.width.on("change",this._onFormChange,this),this._controls.width_units.on("change",this._onFormChange,this),this._controls.required&&this._controls.required.on("change",this._onFormChange,this),this._controls.markdone&&this._controls.markdone.on("change",this._onFormChange,this),this._controls.options&&this._controls.options.on("change",this._onFormChange,this)},_onFormChange:function(){this._controls.title.un("change",this._onFormChange),this._controls.width.un("change",this._onFormChange),this._controls.width_units.un("change",this._onFormChange),this._controls.required&&this._controls.required.un("change",this._onFormChange),this._controls.markdone&&this._controls.markdone.un("change",this._onFormChange),this._controls.options&&this._controls.options.un("change",this._onFormChange),this._submit.delMod("disabled")},_onSubmit:function(){var t=this._getChanges();!this.hasMod("show","select-list")||this._controls.options.getValue().length?(this.hasMod("action","add")&&(Ya.Rum.time(BEM.blocks["b-grid-table"].COUNTERS.colAdd),BEM.blocks["b-grid-table"].needColAddTimeEnd=!0),this.trigger(this.hasMod("action","add")?"add":"edit",t)):(BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,BEM.I18N("b-grid-table","options_list_empty"))),this.trigger("close"))},_getChanges:function(){var t={};return this._controls||this._findControls(),t.title=this._controls.title.val(),this.hasMod("action","add")&&(t.type=this._controls.type.getVal()),this.hasMod("show","select-list")&&(t.options={changes:this._controls.options.getChanges()}),this.hasMod("type","checkbox")?t.markdone=this._controls.markdone.hasMod("checked"):t.required=this._controls.required.hasMod("checked"),this._updateSize(t),t},_updateSize:function(t){var e=this._controls.width.val();""!==e&&(t.width=e,t.width_units="px"===this._controls.width_units.getVal()?"pixel":"percent")},_findControls:function(){this._controls={title:this.findBlockInside(this.elem("title"),"input"),width:this.findBlockInside(this.elem("size"),"input"),width_units:this.findBlockInside(this.elem("size"),"select2"),required:this.findBlockInside(this.elem("option-necessary"),"checkbox"),markdone:this.findBlockInside(this.elem("option-markdone"),"checkbox"),options:this.findBlockInside(this.elem("select-list"),"b-grid-table-list-options")},this.hasMod("action","add")&&(this._controls.type=this.findBlockInside(this.elem("type"),"select2"))}})},function(t,e){BEM.DOM.decl("b-grid-table-list-options",{onSetMod:{js:function(){this._changes=[],this._duplicateTooltip=this.findBlockInside({block:"tooltip",modName:"type",modVal:"duplicate"}),BEM.blocks["b-grid-table-list-options-item"].on(this.elem("items-container"),"edit",this._onItemEdit,this),BEM.blocks["b-grid-table-list-options-item"].on(this.elem("items-container"),"dragstart",this._onItemDragStart,this),BEM.blocks["b-grid-table-list-options-item"].on(this.elem("items-container"),"dragover",this._onItemDragOver,this),BEM.blocks["b-grid-table-list-options-item"].on(this.elem("items-container"),"dragend",this._onItemDrop,this),BEM.blocks["b-grid-table-list-options-item"].on(this.elem("items-container"),"press-enter",this._onItemPressEnter,this),BEM.blocks["b-grid-table-list-options-item"].on(this.elem("items-container"),"remove",this._onItemRemove,this),BEM.blocks["b-grid-table-list-options-item"].on(this.elem("items-container"),"change",this._onItemChange,this),this.bindTo(this.elem("add-item"),"click",this._addItem.bind(this))}},getChanges:function(){return this._changes},getValue:function(){return this.findBlocksInside(this.findElem("items-container"),"b-grid-table-list-options-item").filter((function(t){return Boolean(t.getValue())}))},_onItemPressEnter:function(t){var e,i=t.block.domElem.next();this.hasMod("disabled","yes")||(i.length?(e=this.findBlockOn(i,"b-grid-table-list-options-item"),t.block.delMod("edit"),e.setMod("edit","yes")):this._addItem())},_onItemEdit:function(t){this.findBlocksInside(this.elem("items-container"),"b-grid-table-list-options-item").forEach((function(e){t.block!==e&&e.delMod("edit")}))},_onItemDragStart:function(t){this._dragData={block:t.block}},_onItemDragOver:function(t,e){this._dragData.on=t.block,this._dragData.direction=e,this.setMod(this.elem("drag-delimiter"),"visibility","visible"),this.elem("drag-delimiter").css({top:26*t.block.domElem.index()+("top"===e?-26:0)})},_onItemDrop:function(){var t,e,i;this.delMod(this.elem("drag-delimiter"),"visibility"),this._dragData.on&&this._dragData.block!==this._dragData.on&&(t=this._dragData.block.domElem.index()-1,BEM.DOM.destruct(this._dragData.block.domElem),i=BEMHTML.apply({block:"b-grid-table-list-options-item",text:this._dragData.block.params.text}),e="bottom"===this._dragData.direction?BEM.DOM.after(this._dragData.on.domElem,i).index()-1:BEM.DOM.before(this._dragData.on.domElem,i).index()-1,this._duplicateTooltip.delMod("shown"),this._tryPushChanges({move_option:{old_index:t,new_index:e}}),this.trigger("change"))},_addItem:function(){this._duplicateTooltip.delMod("shown"),BEM.DOM.append(this.elem("items-container"),BEMHTML.apply({block:"b-grid-table-list-options-item",mods:{empty:"yes",is_new:"yes"},text:""})).bem("b-grid-table-list-options-item").setMod("edit","yes"),this.setMod("disabled","yes")},_onItemRemove:function(t,e){this._duplicateTooltip.delMod("shown"),t.block.hasMod("is_new","yes")?this.delMod("disabled"):(this._tryPushChanges({remove_option:{index:e}}),this.trigger("change"))},_onItemChange:function(t,e){this._duplicateTooltip.delMod("shown"),t.block.hasMod("is_new","yes")&&e.val?this._tryPushChanges({add_option:{value:e.val}},t.block)&&(t.block.delMod("is_new").delMod("empty"),this.delMod("disabled").trigger("change")):t.block.hasMod("empty","yes")&&e.val?this._tryPushChanges({rename_option:{index:e.index,new_value:e.val}},t.block)&&(t.block.delMod("empty"),this.delMod("disabled").trigger("change")):e.val?this._tryPushChanges({rename_option:{index:e.index,new_value:e.val}},t.block)&&this.trigger("change"):(t.block.setMod("empty","yes"),this.setMod("disabled","yes"))},_tryPushChanges:function(t,e){var i=this.params.options,s=_.extend([],i);if(t.add_option&&s.push(t.add_option.value),t.rename_option){if(s[t.rename_option.index]===t.rename_option.new_value)return!1;s[t.rename_option.index]=t.rename_option.new_value}return t.remove_option&&s.splice(t.remove_option.index,1),t.move_option&&this._moveArrayElem(s,t.move_option.old_index,t.move_option.new_index),!this._haveDuplicates(s)||t.remove_option?(this.params.options=s,this._changes.push(t),!0):!!e&&(this._duplicateTooltip.setOwner(e.domElem).setMod("shown","yes"),!1)},_moveArrayElem:function(t,e,i){var s=t[e];t.splice(e,1),t.splice(i,0,s)},_haveDuplicates:function(t){return _.uniq(t).length!==t.length}})},function(t,e){BEM.DOM.decl("b-grid-table-list-options-item",{onSetMod:{js:function(){this._valueInput=this.findBlockInside("input"),this.bindTo(this.elem("item-content-wrapper"),"click",this._onContentWrapperClick.bind(this)),this.findBlockInside({block:"awesome-icon",modName:"type",modVal:"sort"}).bindTo({dragstart:this._onDragStart.bind(this),dragend:this._onDragEnd.bind(this)}),this.bindTo("dragover",this._onDragOver.bind(this)),this.findBlockInside({block:"awesome-icon",modName:"type",modVal:"remove"}).bindTo("mouseup",this._removeSelf.bind(this)),this.findBlockInside({block:"input",modName:"type",modVal:"item-val"}).on("change",this._onValueInputChange,this).bindTo("keyup",this._onValueInputKeyUp.bind(this))},edit:{yes:function(){this.afterCurrentEvent(function(){this._valueInput.elem("control").focus(),this.trigger("edit")}.bind(this))},"":function(){this.elem("item-content").text(this._valueInput.val())}}},getValue:function(){return this._valueInput.val()},_onContentWrapperClick:function(){this.setMod("edit","yes")},_onDragStart:function(t){t.originalEvent.dataTransfer.setData("text/plain","Data to Drag"),t.originalEvent.dataTransfer.setDragImage(this.domElem[0],10,15),this.trigger("dragstart")},_onDragOver:function(t){var e=t.originalEvent.pageY,i=this.domElem.offset().top+12>e?"top":"bottom";this.trigger("dragover",i)},_onDragEnd:function(){this.trigger("dragend")},_removeSelf:function(){this.trigger("remove",this.domElem.index()-1),BEM.DOM.destruct(this.domElem)},_onValueInputKeyUp:function(t){13===t.keyCode&&this.trigger("press-enter")},_onValueInputChange:function(t){this._changeInputTimeout&&(clearTimeout(this._changeInputTimeout),this._changeInputTimeout=null),this._changeInputTimeout=setTimeout(this._onValueChange.bind(this,t),200)},_onValueChange:function(t){this._changeInputTimeout=null,this.trigger("change",{index:this.domElem.index()-1,val:t.block.val().trim()}),this.params.text=t.block.val()}})},function(t,e){BEM.DOM.decl("b-grid-table-head-draggable",{onSetMod:{js:function(){var t=this.findBlockOutside("b-grid-table");this.tableId=t.tableId,this.__self[this.tableId]||(this.__self[this.tableId]={_table:t}),this._storage=this.__self[this.tableId],this._storage._counter?this._storage._counter++:this._storage._counter=1,this._storage._table.on("start-edit",this._bindEvents,this),this._storage._table.on("stop-edit",this._unbindEvents,this)}},destruct:function(){this._storage._table.un("start-edit"),this._storage._table.un("stop-edit"),this._unbindEvents(),this._storage._counter?this._storage._counter--:delete this.__self[this.tableId],this.__base.apply(this,arguments)},_bindEvents:function(){this._storage.parentRow=this.findBlockOutside("b-grid-table-row"),this._storage.headers=this._storage.parentRow.findBlocksInside("b-grid-table-head-draggable"),this.bindToDomElem(this.domElem,{dragstart:this._onDragStart,dragend:this._onDragEnd,drop:this._onDragDrop,dragenter:this._onDragEnter,dragover:this._onDragOver,dragleave:this._onDragLeave})},_unbindEvents:function(){this.unbindFromDomElem(this.domElem,"dragstart, dragend, drop, dragenter, dragover, dragleave")},_isMouseOnRow:function(t,e){var i=!1,s=BEM.DOM.win.scrollLeft(),o=BEM.DOM.win.scrollTop(),n=this._storage.parentRow.domElem,a=n.offset().top,r=n.offset().left+n.outerWidth(),l=n.offset().top+n.outerHeight(),c=n.offset().left;t+=s,e+=o;var d=Boolean(t>c&&t<r);return Boolean(e>a&&e<l)&&d&&(i=!0),i},_onDragStart:function(t){var e=t.originalEvent.dataTransfer;if(this._storage._table.draggingRow)return!1;this._isDragging=!0,this._storage._table.draggingHead=!0,this._storage.prev=this.domElem.prev(),this._storage.next=this.domElem.next(),this._storage.move={from:this.domElem.index(),movedId:this.findBlockOn(this.domElem,"b-grid-table-head").params.id},this.setMod("dragging","yes"),e.setData("text/plain"," "),e.effectAllowed="move",e.setDragImage(this.domElem[0],0,0)},_onDragEnd:function(){if(this._storage.move)return this._storage._table.draggingHead=!1,this._storage._dropAvailable&&this._moveCols(),this._isDragging?(this._isDragging=!1,this._onStopDragging(),!1):void 0},_onDragEnter:function(){if(this._storage.move)return!this._isDragging&&!this._storage._table.draggingRow&&void 0},_onDragLeave:function(t){if(this._storage.move)return this._isMouseOnRow(t.originalEvent.clientX,t.originalEvent.clientY)||this._storage._table.elem("head-indicator").hide(),!this._isDragging&&void 0},_onDragDrop:function(t){if(t.preventDefault(),this._storage.move){if(this._storage._table.draggingHead=!1,this._isDragging)return this._isDragging=!1,!1;this._storage._dropAvailable&&this._moveCols(),this._onStopDragging()}},_onDragOver:function(t){if(this._storage.move){if(this._isDragging||this._storage._table.draggingRow)return!1;var e=t.originalEvent;return this._handleDropPosition(e.clientX),t.preventDefault(),!1}},_onStopDragging:function(){this.delMod("dragging"),this._storage._dropAvailable=!1,this._storage._table.elem("head-indicator").hide().css({left:0})},_handleDropPosition:function(t){var e=this.domElem.offset().left+this.domElem.outerWidth()/2;this._storage._table.elem("head-indicator").css({height:this.domElem.outerHeight(),top:this.domElem.offset().top-BEM.DOM.win.scrollTop()}),t>e?this.domElem[0]!==(this._storage.prev&&this._storage.prev[0])&&this._setIndicatorPosition(this._storage._table.elem("head-indicator"),"right"):this.domElem[0]!==(this._storage.next&&this._storage.next[0])&&this._setIndicatorPosition(this._storage._table.elem("head-indicator"),"left")},_setIndicatorPosition:function(t,e){var i,s=this.domElem.offset().left,o=this.domElem.outerWidth(),n=parseInt(t.css("left"));if(t.show(),"right"===e)i=Math.abs(n-(s+o)),this._storage.move.to={after:this.domElem.index(),afterId:this.findBlockOn(this.domElem,"b-grid-table-head").params.id},i>1&&(this._storage._dropAvailable=!0,t.css({left:s+o}));else{i=Math.abs(n-s);var a=this.findBlockOn(this.domElem.prev(),"b-grid-table-head");this._storage.move.to={before:this.domElem.index(),afterId:a&&a.params.id?a.params.id:"-1"},i>1&&(this._storage._dropAvailable=!0,t.css({left:s}))}},_moveCols:function(){var t,e,i;BEM.blocks["b-grid-table"].needColMoveTimeEnd=!0,Ya.Rum.time(BEM.blocks["b-grid-table"].COUNTERS.colMove);var s=this._storage._table.findElem("tr"),o=this._storage.move;s.each((function(){e=$(this),i=e.children("th, td"),t=i.eq(o.from).detach(),void 0!==o.to.before?t.insertBefore(i.eq(o.to.before)):t.insertAfter(i.eq(o.to.after))})),this._sendMoveData()},_sendMoveData:function(){this.sendData={version:this._storage._table._gridData.version,changes:[{column_moved:{id:this._storage.move.movedId,after_id:this._storage.move.to.afterId}}]},BEM.create("wi-api-request",{apiPath:".grid/change_and_get_document",path:"/"+this._storage._table.params.supertag,method:"POST",data:this.sendData,urlParams:this._storage._table.gridOptionsUrlParams()}).run().then(this._onPostedColumnReorder.bind(this),this._onFailedColumnReorder.bind(this))},_onPostedColumnReorder:function(t){this._storage._table._setEditAfterRebuild=!0,this._storage._table.rebuild(t.data.grid)},_onFailedColumnReorder:function(t){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,null,t)),this._storage._table._buildContent(!0)}})},function(t,e){function i(t,e,i,s,o,n,a){try{var r=t[n](a),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(s,o)}function s(t){return function(){var e=this,s=arguments;return new Promise((function(o,n){var a=t.apply(e,s);function r(t){i(a,o,n,r,l,"next",t)}function l(t){i(a,o,n,r,l,"throw",t)}r(void 0)}))}}BEM.DOM.decl("b-grid-table-row",{onSetMod:{js:function(){this.hasMod("type","head")||(this._storage||this._createStorage(),this._storage._table.on("stop-edit",(function(){this.delMod("state")}),this),BEM.blocks["b-grid-table-cell"].on(this.domElem,"start-edit",this._onCellEditStart,this),BEM.blocks["b-grid-table-row"].on(this.domElem,"start-edit",this._onRowEditStart,this))},state:{edit:function(){var t=this;this.hasMod("removed","yes")?this.afterCurrentEvent((function(){this.delMod("state")})):(this.trigger("start-edit"),this.findBlockOn("b-grid-table-row-draggable")._onMouseEnter(),setTimeout((function(){t._storage._table.setMod("edit","row"),keymaster("ctrl+enter, command+enter",function(){var e=s(regeneratorRuntime.mark((function e(i){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.preventDefault(),e.next=3,t._storage._table.createRowAfter(t,t.getNextRow());case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),keymaster("shift+enter",(function(e){t._activeCell.showEditControl(e)})),keymaster("tab",(function(e){e.preventDefault(),t._onTab(e)})),keymaster("shift+tab",(function(e){e.preventDefault(),t._onShiftTab(e)})),t.bindTo(t.domElem,"clickoutside",t._onClickOutside),keymaster("ctrl+left, command+left",(function(e){e.preventDefault(),t._onArrowLeft(e)})),keymaster("ctrl+right, command+right",(function(e){e.preventDefault(),t._onArrowRight(e)})),keymaster("ctrl+down, command+down",function(){var e=s(regeneratorRuntime.mark((function e(i){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.preventDefault(),e.next=3,t._onArrowDown(i);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),keymaster("ctrl+up, command+up",function(){var e=s(regeneratorRuntime.mark((function e(i){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.preventDefault(),e.next=3,t._onArrowUp(i);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),keymaster("return",function(){var e=s(regeneratorRuntime.mark((function e(i){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t._storage._table._preventEnter){e.next=5;break}return t._storage._table._preventRowOutside=!1,t._activeCell._preventCellOutside=!1,e.next=5,t._onReturn(i);case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),keymaster("esc",(function(e){e.preventDefault(),t._onEsc(e)}))}),0))},"":function(){this.trigger("stop-edit"),this._storage._table.delMod("edit"),keymaster.unbind("ctrl+enter, command+enter"),keymaster.unbind("tab"),keymaster.unbind("shift+tab"),keymaster.unbind("shift+enter"),keymaster.unbind("ctrl+left, command+left"),keymaster.unbind("ctrl+right, command+right"),keymaster.unbind("ctrl+down, command+down"),keymaster.unbind("ctrl+up, command+up"),keymaster.unbind("return"),keymaster.unbind("esc"),this.unbindFrom(this.domElem,"clickoutside")}}},destruct:function(){BEM.blocks["b-grid-table-cell"].un(this.domElem,"start-edit"),BEM.blocks["b-grid-table-row"].un(this.domElem,"start-edit"),this.__base.apply(this,arguments)},_onCellEditStart:function(t){this._activeCell=t.block},_onRowEditStart:function(t){t.block===this||this.hasMod("type","new")||this.hasMod("type","head")||this.delMod("state")},_onClickOutside:function(){this._storage._table._preventCellOutside||this._storage._table._preventRowOutside||this._storage._table._lockOutsideClicks||this.delMod("state"),this._storage._table._preventRowOutside=!1,this._storage._table._preventCellOutside=!1},_onTab:function(){return this._hightlightOnTab("next"),!1},_onShiftTab:function(){return this._hightlightOnTab("prev"),!1},_hightlightOnTab:function(t,e){var i,s,o;if(o=(e=e||this._activeCell)&&e.domElem[t](),e.params.row_id||!e.hasMod("editable","yes"))if(o=!(!o||!o.length)&&o.bem("b-grid-table-cell")){if(!o.hasMod("editable","yes"))return this._hightlightOnTab(t,o);this._activeCell._onClickOutside(),o._onClick()}else(i=!!(i=this.domElem[t]()).length&&i.bem("b-grid-table-row"))&&(o="next"===t?i.findBlockInside({block:"b-grid-table-cell",modName:"editable",modVal:"yes"}):!!(s=i.findBlocksInside({block:"b-grid-table-cell",modName:"editable",modVal:"yes"}))&&s[s.length-1])&&(this.delMod("state"),i.setMod("state","edit"),this._activeCell._onClickOutside(),o._onClick())},_onArrowLeft:function(){return this._hightlightOnLeftRight("left"),!1},_onArrowRight:function(){return this._hightlightOnLeftRight("right"),!1},_onArrowUp:function(){var t=this;return s(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t._hightlightOnUpDown("up"),e.abrupt("return",!1);case 2:case"end":return e.stop()}}),e)})))()},_onArrowDown:function(){var t=this;return s(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._hightlightOnUpDown("down");case 2:return e.abrupt("return",!1);case 3:case"end":return e.stop()}}),e)})))()},_onReturn:function(){var t=this;return s(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._hightlightOnUpDown("down",!0);case 2:return e.abrupt("return",!1);case 3:case"end":return e.stop()}}),e)})))()},_hightlightOnLeftRight:function(t){var e=this._activeCell,i=e.domElem["left"===t?"prev":"next"]();if(e.params.row_id&&(i=!(!i||!i.length)&&i.bem("b-grid-table-cell"))){if(!i.hasMod("editable","yes"))return;this._activeCell._onClickOutside(),i._onClick()}},getNextRow:function(){var t=this.domElem.next();return t.next().length?t.bem("b-grid-table-row"):null},_hightlightOnUpDown:function(t,e){var i=this;return s(regeneratorRuntime.mark((function s(){var o,n,a,r;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if((r=i._activeCell).params.row_id){s.next=3;break}return s.abrupt("return");case 3:if((o=i.getNextRow())||!e||"up"===t){s.next=8;break}return s.next=7,i._storage._table.createRowAfter(i,null,!0);case 7:o=i.domElem.next().bem("b-grid-table-row");case 8:o&&(a=o.findBlocksInside({block:"b-grid-table-cell"}),(n=!!a&&a[r.domElem.index()])&&(i.delMod("state"),o.setMod("state","edit"),setTimeout((function(){r._onClickOutside(),n._onClick()}),0)));case 9:case"end":return s.stop()}}),s)})))()},_onEsc:function(){var t=this._activeCell;t&&t._resetValue()},_createStorage:function(){var t=this.findBlockOutside("b-grid-table");this.__self[t.tableId]||(this.__self[t.tableId]={_table:t}),this._storage=this.__self[t.tableId]}})},function(t,e){function i(t,e,i,s,o,n,a){try{var r=t[n](a),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(s,o)}BEM.DOM.decl("b-grid-table-new-row",{onSetMod:{ready:{yes:function(){this.bindTo(this.domElem,"click",(function(){this._onClick()}))},no:function(){this.unbindFrom(this.domElem,"click")}}},_onClick:function(){var t,e=this;return(t=regeneratorRuntime.mark((function t(){var i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Ya.Rum.time(BEM.blocks["b-grid-table"].COUNTERS.rowAdd),i=e.domElem.prev(),e._table||(e._table=e.findBlockOutside("b-grid-table")),!i.length){t.next=8;break}return t.next=6,e._table.createRowAfter(i.bem("b-grid-table-row"),null);case 6:t.next=10;break;case 8:return t.next=10,e._table.createRowAfter(null,null);case 10:case"end":return t.stop()}}),t)})),function(){var e=this,s=arguments;return new Promise((function(o,n){var a=t.apply(e,s);function r(t){i(a,o,n,r,l,"next",t)}function l(t){i(a,o,n,r,l,"throw",t)}r(void 0)}))})()}})},function(t,e){BEM.DOM.decl("b-grid-table-row-draggable",{onSetMod:{js:function(){var t=this.findBlockOutside("b-grid-table");this.tableId=t.tableId,this.__self[this.tableId]||(this.__self[this.tableId]={_table:t}),this._storage=this.__self[this.tableId],this._storage._counter?this._storage._counter++:this._storage._counter=1,this._storage._table.hasMod("mode","edit")&&this._initBlock(),this._storage._table.on("start-edit",this._initBlock,this),this._storage._table.on("stop-edit",this._unbindEvents,this)}},destruct:function(){this._storage._table.un("start-edit"),this._storage._table.un("stop-edit"),this._unbindEvents(),this._storage._counter?this._storage._counter--:delete this.__self[this.tableId],this.__base.apply(this,arguments)},_initBlock:function(){this._dragger||(this._dragger=this._storage._table.elem("row-dragger"),this._dragImage=this._storage._table.elem("drag-image")),setTimeout(this._setSizes.bind(this),0),this._bindToEvents()},_bindToEvents:function(){this._binded=!0,this.bindTo(this.domElem,"mouseenter",this._onMouseEnter),this.bindToWin("resize",this._setSizes),this.bindToDomElem(this._dragger,"dragstart",this._onDragStart),this.bindToDomElem(this._dragger,"dragend",this._onDragEnd),this.bindTo(this.domElem,{drop:this._onDragDrop,dragenter:this._onDragEnter,dragover:this._onDragOver,dragleave:this._onDragLeave}),this._storage._table.on("rows-reorder",this._setSizes,this),this._storage._table.on("row-added",this._setSizes,this),this._storage._table.on("row-added",this._setSizes,this),this._storage._table.on("grid-synced",this._setSizes,this),BEM.blocks["b-grid-table-cell"].on(this.domElem,"saved",this._setSizes,this)},_unbindEvents:function(){this._binded&&(this.unbindFrom(this.domElem,"mouseenter"),this.unbindFrom(this.domElem,"drop"),this.unbindFrom(this.domElem,"dragenter"),this.unbindFrom(this.domElem,"dragover"),this.unbindFrom(this.domElem,"dragleave"),this.unbindFromWin("resize"),this.unbindFromDomElem(this._dragger,"dragstart"),this.unbindFromDomElem(this._dragger,"dragend"),this._storage._table.un("rows-reorder",this._setSizes,this),this._storage._table.un("row-delete",this._setSizes,this),this._storage._table.un("row-added",this._setSizes,this),BEM.blocks["b-grid-table-cell"].un(this.domElem,"saved",this._setSizes))},_onDragStart:function(t){if(this===this._storage._draggableThis){var e=t.originalEvent.dataTransfer,i=$.throttle(this._onDrag,100);this._storage._table.setMod("dragging","yes"),this.setMod("dragging","yes"),this._storage._table.draggingRow=!0,this._storage.prev=this.domElem.prev(),this._storage.next=this.domElem.next(),this._storage.move={from:this.domElem.index(),draggingThis:this},e.setData("text/plain"," "),e.effectAllowed="move",this._storage._table.setMod(this._dragImage,"visibility","visible"),this._dragImage.css({top:this._sizes.top});var s=this._dragImage[0];e.setDragImage&&e.setDragImage(s,0,0),this.bindToDoc("dragover",i)}},_onDrag:function(t){if(this._storage.move){var e=BEM.DOM.win.scrollTop(),i=e+BEM.DOM.win.height(),s=e+t.originalEvent.clientY,o=this._storage._table.elem("body"),n=o.offset().top,a=o.offset().top+o.outerHeight();return this===this._storage._draggableThis&&(n-e<100&&s-e<80&&window.scrollBy(0,-20),i-a<75&&i-s<80&&window.scrollBy(0,20),this._isMouseOnBody(t.originalEvent.clientX,t.originalEvent.clientY)||this._storage._table.elem("row-indicator").hide()),!0}},_onDragDrop:function(t){if(t.originalEvent.preventDefault(),this._storage.move){if(this._storage._table.draggingRow=!1,this.hasMod("dragging","yes")||this._storage._table.draggingHead||!this._dropAvailable)return this._dropAvailable=!1,!1;Ya.Rum.time(BEM.blocks["b-grid-table"].COUNTERS.rowMove),this._moveRows(),this._onStopDragging()}},_onDragEnter:function(){if(this._storage.move)return!this.hasMod("dragging","yes")&&!this._storage._table.draggingHead&&void 0},_onDragOver:function(t){if(this._storage.move){if(this.hasMod("dragging","yes")||this._storage._table.draggingHead)return!1;var e=t.originalEvent;return this._handleDropPosition(e.clientY),t.preventDefault(),!1}},_handleDropPosition:function(t){var e=this.domElem.offset().top+this.domElem.outerHeight()/2;this._storage._table.elem("row-indicator").css({width:this.domElem.outerWidth(),left:this.domElem.offset().left}),(t+=BEM.DOM.win.scrollTop())>e?this.domElem[0]!==(this._storage.prev&&this._storage.prev[0])&&this._setIndicatorPosition(this._storage._table.elem("row-indicator"),"after"):this.domElem[0]!==(this._storage.next&&this._storage.next[0])&&this._setIndicatorPosition(this._storage._table.elem("row-indicator"),"before")},_setIndicatorPosition:function(t,e){var i=this.domElem.offset().top-BEM.DOM.win.scrollTop(),s=this.domElem.outerHeight();t.show(),"after"===e?(this._storage.move.to={after:this.domElem.index()},this._dropAvailable=!0,t.css({top:i+s-1})):(this._storage.move.to={before:this.domElem.index()},this._dropAvailable=!0,t.css({top:i-1}))},_onDragLeave:function(t){return this._isMouseOnBody(t.originalEvent.clientX,t.originalEvent.clientY)||this._storage._table.elem("row-indicator").hide(),this._dropAvailable=!1,!1},_isMouseOnBody:function(t,e){var i=!1,s=BEM.DOM.win.scrollLeft(),o=BEM.DOM.win.scrollTop(),n=this._storage._table.elem("body"),a=n.offset().top,r=n.offset().left+n.outerWidth(),l=n.offset().top+n.outerHeight(),c=n.offset().left;t+=s,e+=o;var d=Boolean(t>c&&t<r),h=Boolean(e>a&&e<l);return d&&h&&(i=!0),i},_onDragEnd:function(){if(this._storage._table.delMod("dragging"),!this.hasMod("dragging","yes"))return!1;this._dropAvailable&&this._moveRows(),this._storage._table.draggingRow=!1,this._onStopDragging(),this.unbindFromDoc("dragover")},_onStopDragging:function(){this.delMod("dragging"),this._dropAvailable=!1,this._storage._table.elem("row-indicator").hide().css({top:0}),this._dragger.css({top:0,height:0}),this._storage._table.delMod(this._dragImage,"visibility")},_setSizes:function(){this.domElem&&(this._sizes={height:this.domElem.outerHeight(),top:this.domElem.offset().top-this._storage._table.domElem.offset().top})},_onMouseEnter:function(){this._storage._draggableThis=this,this._sizes||this._setSizes(),this.domElem.bem("b-grid-table-row").hasMod("removed","yes")?this.setMod(this._dragger,"restore","yes"):this.delMod(this._dragger,"restore"),this._dragger.css({top:this._sizes.top,height:this._sizes.height})},_moveRows:function(){var t,e,i,s,o=this._storage.move,n={id:o.draggingThis.findBlockOn("b-grid-table-row").params.row_id},a=this._storage._table.findElem("body","tr"),r=a.eq(o.from).detach();void 0!==o.to.before?(i=(e=(t=a.eq(o.to.before)).prev()).length?e.bem("b-grid-table-row"):null,n.after_id=i?i.params.row_id:"-1",s=i?i.getNextRow():null,n.before_id=s?s.params.row_id:"-1",r.insertBefore(t)):(e=(t=a.eq(o.to.after)).bem("b-grid-table-row"),n.after_id=e.params.row_id,s=e.getNextRow(),n.before_id=s?s.params.row_id:"-1",r.insertAfter(t)),this._storage._table.trigger("rows-reorder"),this._sendMoveData(n)},_sendMoveData:function(t){this.sendData={changes:[{row_moved:t}]},BEM.create("wi-api-request",{apiPath:".grid/change",path:"/"+this._storage._table.params.supertag,method:"POST",data:this.sendData,urlParams:this._storage._table.gridOptionsUrlParams()}).run().then(this._onPostedRowsReorder.bind(this),this._onFailedRowsReorder.bind(this))},_onPostedRowsReorder:function(){var t=this._storage.move,e={from:t.from,to:void 0!==t.to.before?t.to.before:t.to.after};this._storage._table._swapStructure(e.from,e.to,"rows"),Ya.Rum.timeEnd(BEM.blocks["b-grid-table"].COUNTERS.rowMove)},_onFailedRowsReorder:function(t){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,null,t)),this._storage._table._buildContent(!0)}})},function(t,e){BEM.DOM.decl("b-grid-table-bar",{onSetMod:{js:function(){this._table||(this._table=this.findBlockOutside("b-grid-table")),(this._content||(this._content=this.findBlockOutside("b-content")&&this.findBlockOutside("b-content").domElem||this.findBlockOutside("page-editor").elem("preview-content"),this._content))&&(this.setPosition(),this._subscribe())}},setPosition:function(){var t=this._table.findElem("table"),e=this._table.findElem("table-wrapper"),i=e.offset(),s=t.width(),o=BEM.DOM.win.scrollTop();this._coords={tableWrapperTop:i.top,tableWrapperBottom:i.top+t.height(),tableWrapperLeft:i.left,tableWidth:s,tableWrapperWidth:e.width(),winTop:o,winBottom:o+BEM.DOM.win.height()},this._coords.tableWrapperBottom>this._coords.winBottom&&this._coords.tableWrapperTop<this._coords.winBottom?(this.setMod("position","fixed").domElem.removeAttr("style"),this.domElem.css({left:this._coords.tableWrapperLeft,width:this._coords.tableWrapperWidth})):this.delMod("position").domElem.removeAttr("style"),this._table.recalculateScroll(),this._updateScrollState()},destruct:function(){this._table.domElem&&(this.unbindFromDoc("scroll.bar"),this.unbindFromWin("resize.bar"),this._table&&this.unbindFrom(this._table.findElem("table"),"resize"),this._content.off("scroll"),this._content.off("resize"),this._table.un("grid-edit",this.setPosition,this)),this._table.dropElemCache(),this.dropElemCache(),this._content=null,this._table=null,this.__base.apply(this,arguments)},_updateScrollState:function(){this.setMod("scroll-controls",this._table.findElem("table").width()>this._table.findElem("table-wrapper").width()?"yes":"")},_subscribe:function(){this.params.isAction||(this.bindToDoc("scroll.bar",this.setPosition),this.bindToWin("resize.bar",this.setPosition)),this.bindTo(this._table.findElem("table"),"resize",this.setPosition),this._content.on("scroll",this.setPosition.bind(this)),this._content.on("resize",this.setPosition.bind(this)),this._table.on("grid-edit",this.setPosition,this),BEM.channel("layout").on("change",this.setPosition,this),this.findBlockInside({block:"awesome-icon",modName:"type",modVal:"scroll-left"}).bindTo("click",this._table.scrollTable.bind(this._table,"left")),this.findBlockInside({block:"awesome-icon",modName:"type",modVal:"scroll-right"}).bindTo("click",this._table.scrollTable.bind(this._table,"right"))}})},function(t,e){BEM.DOM.decl("b-grid-table-editors",{onSetMod:{js:function(){this._table=this.findBlockOutside("b-grid-table"),this._interval=setInterval(this.updateEditors.bind(this),this.__self.UPDATE_INTERVAL),this.updateEditors()}},destruct:function(t){this._request&&this._request.abort(),clearInterval(this._interval),this.__base(t)},updateEditors:function(){!document.hidden&&this._table._gridData&&(this._request=BEM.create("wi-api-request",{apiPath:"/"+this.params.supertag+"/.changes/"+this._table._gridData.version,path:"",urlParams:!1}),this._request.run().then(this._onGetCurrentEditors.bind(this),this._onGetCurrentEditorsFail.bind(this)))},_onGetCurrentEditors:function(t){this.setMod("invisible","yes"),setTimeout(this._updateEditors.bind(this,t.data.editors),200)},_updateEditors:function(t){this._editors=t,BEM.DOM.update(this.domElem,BEMHTML.apply(this.__self._getEditorsBEMJSON(this._editors))),this.delMod("invisible")},_onGetCurrentEditorsFail:function(t){console.log(BEM.I18N("b-grid-table-editors","cant_load_editors")+" :",t)}},{UPDATE_INTERVAL:15e3,_getEditorsBEMJSON:function(t){var e=t.slice(0,3),i=t.slice(3,t.length);return[{block:"b-grid-table-editors",elem:"viewed",content:e.map((function(t){return this._getEditorBEMJSON(t)}),this)},i.length>0?{block:"b-grid-table-editors",elem:"hidden",content:[{block:"b-grid-table-editors",elem:"count",content:"+"+i.length},i.map((function(t){return this._getEditorBEMJSON(t)}),this)]}:""]}})},function(t,e){BEM.DOM.decl("b-grid-table-options-item",{onSetMod:{js:function(){this._table=this.findBlockOutside("b-grid-table"),this.hasMod("disabled","true")||this.bindTo("click",this._onClick),this._gridUrl="/"+this._table.params.supertag}},_getPopup:function(){return this._popup||(this._popup=this.findBlockOutside({block:"popup2",modName:"role",modVal:"table-options"})),this._popup},_onClick:function(t){switch(this._getPopup().delMod("visible"),this.getMod("action")){case"export":location.href=this._gridUrl+"/.xls";break;case"parent":keymaster.command||keymaster.ctrl||2===t.which?window.open(this._gridUrl,"_blank").focus():location.href=this._gridUrl}}})},function(t,e){BEM.DOM.decl({block:"w-action",modName:"type",modVal:"copy"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._bPage=BEM.blocks["i-global"].getbPage(),this._path=this.params.source||BEM.blocks["wi-history"].getCorrectPath(),this.params&&this.params.isAction||BEM.channel("common").on("w-action.create-copy",this._run,this)}},destruct:function(){BEM.channel("common").un("w-action.create-copy"),this.__base.apply(this,arguments)},_run:function(t,e){var i=this.__base.apply(this,arguments),s=BEM.WISTORE.get("page"),o=s.get("currentUser").uid,n=!s.get("isReadonly")||Boolean(s.get("authors").find((function(t){return t.uid===o})));i&&n&&(this._showOutside(t,".copy")||(this._pushState(e,".copy"),this._copyWidget||(BEM.DOM.append(BEM.DOM.scope,BEMHTML.apply({block:"b-widget",mods:{type:"page-copy","page-copy":this.params.type},js:{type:this.params.type}})),this._copyWidget=this._bPage.findBlockInside({block:"b-widget",modName:"page-copy",modVal:this.params.type}),this._copyWidget.params.data={},this._copyWidget.params.ajaxPath=this._path),this._copyWidget.show()))}})},function(t,e){BEM.DOM.decl({block:"w-action",modName:"type",modVal:"import"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._path=this.params.source||BEM.blocks["wi-history"].getCorrectPath(),this.params&&this.params.isAction||BEM.channel("common").on("w-action.create-import",this._run,this)}},destruct:function(){BEM.channel("common").un("w-action.create-import"),this.__base.apply(this,arguments)},_run:function(t,e){var i=this.__base.apply(this,arguments);i&&(this._showOutside(t,".import")||(this._pushState(e,".import"),this._importWidget||(this._importWidget=BEM.DOM.append(BEM.DOM.scope,BEMHTML.apply({block:"b-widget",mods:{type:"page-import","page-import":this.params.type},js:{type:this.params.type,fieldsCount:this.params.fieldsCount}})).bem("b-widget"),this._importWidget.params.data={},this._importWidget.params.ajaxPath=this._path),this._importWidget.show()))}})},function(t,e){BEM.DOM.decl({block:"w-action",modName:"type",modVal:"authorship"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.params&&this.params.isAction||BEM.channel("common").on("w-action.create-request-authorship",this._run,this)}},destruct:function(){BEM.channel("common").un("w-action.create-request-authorship"),this.__base.apply(this,arguments)},_run:function(t,e){var i=this.__base.apply(this,arguments);i&&(this.params.isAction?location.href=this.params.source+"/.requestauthorship":this._widget?(this._widget.show(),this._pushState(e,".requestauthorship")):(this._widget=BEM.DOM.append(BEM.DOM.scope,BEMHTML.apply({block:"b-widget",mods:{type:"authorship"}})).bem("b-widget"),this._widget.show(),this._pushState(e,".requestauthorship")))}})},function(t,e){BEM.DOM.decl({block:"w-translate-content",modName:"type",modVal:"grid"},{_resetTranslate:function(t){this.hasMod("lang-selected")&&!this.hasMod("progress")&&(this.setMod("progress","yes"),BEM.create("wi-api-request",{apiPath:".grid",path:"/"+this.params.supertag,urlParams:["format=json"]}).run().then(this._onSuccessSkipTranslate.bind(this,t),this._onErrorSkipTranslate.bind(this)).always(function(){this.delMod("progress")}.bind(this)))},_request:function(t){return Promise.resolve(BEM.create("wi-api-request",{apiPath:".translate/"+t,method:"GET",urlParams:!1,path:"/"+this.params.supertag}).run()).then((function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return e}))},_updateContent:function(t){this.channel("content").trigger("update",t)}})},function(t,e,i){BEM.DOM.decl({block:"react",modName:"component",modVal:"grid"},{loadComponent:function(){return Promise.all([i.e(0),i.e(5),i.e(13),i.e(25),i.e(35),i.e(1),i.e(6),i.e(38)]).then(i.bind(null,1307))}})},function(t,e){BEM.DOM.decl("w-user-settings",{onSetMod:{js:function(){this._initBlocks(),this._subscribe()},progress:function(t,e){var i="yes"===e;this._submitButton.setMod("disabled",i?"yes":""),this._spinner.setMod("progress",i?"yes":"")}},_initBlocks:function(){this._languageRadioButton=this.findBlockInside({block:"radio-button",modName:"type",modVal:"language"}),this._translateRadioButton=this.findBlockInside({block:"radio-button",modName:"type",modVal:"show-translate"}),this._useFullWidthContent=this.findBlockInside({block:"tumbler",modName:"type",modVal:"use_full_width_content"}),this._submitButton=this.findBlockInside({block:"button2",modName:"role",modVal:"submit"}),this._spinner=this.findBlockInside("spin2")},_subscribe:function(){this._submitButton.on("click",this._submitForm,this)},_submitForm:function(){this.setMod("progress","yes"),BEM.create("wi-api-request",{apiPath:".settings",method:"POST",data:this._getDataForSubmit(),urlParams:!1,path:""}).run().then(this._onSuccessSave.bind(this),this._onFailedSave.bind(this))},_getDataForSubmit:function(){return{language:this._languageRadioButton.val(),propose_content_translation:"true"===this._translateRadioButton.val(),use_full_width_content:"true"!==this._useFullWidthContent.val()}},_onSuccessSave:function(){this.delMod("progress")},_onFailedSave:function(){this.delMod("progress"),BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(this._submitButton.domElem,BEM.I18N("w-user-settings","save_error")))}})},function(t,e){BEM.decl("wi-copytracker",{onSetMod:{js:function(){keymaster("ctrl+c, command+c",this._onCopy.bind(this))}},_onCopy:function(){var t=this._getSelectionText();t&&BEM.create("wi-api-request",{apiPath:".stats",method:"POST",data:{source:location.protocol+"//"+location.host+location.pathname,symbols:t.length,text:t},urlParams:!1,path:""}).run()},_getSelectionText:function(){var t="",e=BEM.DOM.win[0],i=BEM.DOM.doc[0];return e.getSelection?t=e.getSelection().toString():i.selection&&"Control"!==i.selection.type&&(t=i.selection.createRange().text),t}})},,,,function(t,e){BEM.DOM.decl("wiki-head",{onSetMod:{js:function(){var t=this;this.__self._bPage||(this.__self._bPage=this.findBlockOutside("b-page")),this.__base.apply(this,arguments),this._editLink=this.findElem("link","type","edit"),this.bindTo(this._editLink,"click",(function(e){var i=this._editLink.attr("href"),s=/(?:\/)(\.\S+)/g.exec(i);e.preventDefault(),s&&s[1]&&(s=s[1]);var o=t._getQueryParameters(s),n=/(.+)\/\.\w+\?/.exec(this._editLink.attr("href"));n&&(o.path=n[1]),BEM.blocks["wi-history"].pushState(s),BEM.channel("common").trigger("w-action.open-editor",{params:o})})),BEM.channel("common").on("created",(function(e,i){var s;"editor"===i.type&&(s=t.__self._bPage.findBlockInside("b-editor-save-button"),keymaster("ctrl+enter, command+enter",s._onClick.bind(s)))}))}},_getQueryParameters:function(t){return t.replace(/(.+\?)/,"").split("&").map(function(t){return this[(t=t.split("="))[0]]=t[1],this}.bind({}))[0]}})},function(t,e){BEM.DOM.decl("wiki-math",{_anchor:null,_ready:!1,destruct:function(){this._anchor&&this._anchor.is(this.__self._currentAnchor)&&this.__self._getPopup().setAnchor(BEM.DOM.scope),this.__base.apply(this,arguments)},loaded:function(){this._ready||(this.afterCurrentEvent((function(){MathJax.Hub.Queue(function(){this._anchor=this.__self._getAnchor(this.domElem),this.bindTo(this._anchor,"click",this._onTexShow.bind(this))}.bind(this))})),this._ready=!0)},_onTexShow:function(){var t=this.__self._getPopup(),e=this._getTexContent(this.params.tex);t.setContent(e),t.setAnchor(this._anchor),t.hasMod("visible","yes")&&this._anchor.is(this.__self._currentAnchor)?t.setMod("visible",""):t.setMod("visible","yes"),this.__self._currentAnchor=this._anchor},_getTexContent:function(){if(!this._texContent){var t=BEMHTML.apply({block:"wiki-math",elem:"tex-view",content:this.params.tex});this._texContent=$(t)}return this._texContent}},{_popup:null,_currentAnchor:null,_getAnchor:function(t){var e=t,i=t.find(".MathJax_SVG");return i.length&&(e=i).attr("data-bem","{}"),e},_getPopup:function(){if(!this._popup){var t=BEMHTML.apply(this._getPopupJson());this._popup=$(t).bem("popup2"),this._popup.on("beforeClose",this._onBeforePopupClose,this)}return this._popup},_onBeforePopupClose:function(){this.afterCurrentEvent((function(){this._popup.setAnchor(BEM.DOM.scope)}),this)},_getPopupJson:function(){return{block:"popup2",mods:{target:"anchor",autoclosable:"yes",theme:"normal"},directions:["right-top","left-top","bottom-left","bottom-right","top-left","top-right"],content:""}}})},function(t,e){BEM.DOM.decl({block:"wf-doc"},{onSetMod:{js:{inited:function(){this._includesLoadedCheckInterval=setInterval(this._checkIsIncludesLoaded.bind(this),300)}}},_checkIsIncludesLoaded:function(){var t=this.findBlocksInside("wiki-action-include").some((function(t){return!t.getMods().loaded})),e=this.findBlocksInside("wiki-sanitizer").some((function(t){return!t.getMods().loaded}));t||e||(clearInterval(this._includesLoadedCheckInterval),this.findBlocksInside("wf-head").filter((function(t){return!t.hasMod("include-title")})).forEach((function(t,e){t.activateEditLink(e+1)})),BEM.DOM.init(this.domElem))}})},,function(t,e){BEM.DOM.decl({block:"wf-head"},{onSetMod:{js:{inited:function(){this.params=JSON.parse(this.domElem.attr("data-wf")),this._formatter=Ya.FormatterViewPort.getInstance(this.domElem[0]),this._config=this._formatter.getConfig(),this._editLink=BEM.DOM.append(this.findBlockOn(this.domElem,"wiki-head").findElem("anchor-link"),BEMHTML.apply({block:"link",mods:{theme:"normal",role:"edit"},mix:{block:"wf-head",elem:"edit-link"},text:BEM.I18N("wf-head","edit"),url:"#"}))}}},activateEditLink:function(t){if(this.params.section_local){var e=Boolean(this.params.includesPath.length),i=e?this.params.includesPath[this.params.includesPath.length-1]:this._config.page_path;i+="/.edit";var s={section:this.params.section_local,goanchor:"h-"+t};e&&(s.gopage=this._config.page_path);var o=BEM.blocks["wi-history"].formURL({pathname:i,search:s});this._editLink.attr("href",o),this.setMod("active","yes")}},_onEditLinkClick:function(t){var e=this._editLink.attr("href"),i=/(?:\/)(\.\S+)/g.exec(e);t.preventDefault(),i&&i[1]&&(i=i[1]);var s=this.__self._getQueryParameters(i),o=/(.+)\/\.\w+\?/.exec(this._editLink.attr("href"));o&&(s.path=o[1]),BEM.blocks["wi-history"]&&BEM.blocks["wi-history"].pushState(i),BEM.channel("common").trigger("w-action.open-editor",{params:s})}},{_getQueryParameters:function(t){return t.replace(/(.+\?)/,"").split("&").map(function(t){return this[(t=t.split("="))[0]]=t[1],this}.bind({}))[0]},live:function(){this.liveBindTo("edit-link","click",(function(t){this._onEditLinkClick(t)}))}})},function(t,e){BEM.DOM.decl("b-widget",{onSetMod:{js:function(){this._bPage=this.findBlockOutside("b-page")}},show:function(){var t;$(document).on("keydown.widget",this._onKeyUp.bind(this)),(t=this._bPage.findBlockInside({block:"b-widget",modName:"visibility",modVal:"yes"}))&&t.delMod("visibility"),(t=this._bPage.findBlockInside({block:"b-favs-widget",modName:"visibility",modVal:"yes"}))&&t.hide(),this.setMod("visibility","yes"),this.trigger("show"),this._bPage.setMod("scroll","disable"),$(document).scrollTop(0)},hide:function(t){$(document).off("keydown.widget"),this.delMod("visibility"),this.trigger("hide"),this._bPage.delMod("scroll"),t||BEM.blocks["wi-history"].removeState()},_onKeyUp:function(t){27===t.keyCode&&this.hide()}})},function(t,e){BEM.DOM.decl("b-request-access",{onSetMod:{js:function(){this.bPage=this.findBlockOutside("b-page"),this.bWidget=this.findBlockOutside("b-widget"),this.requestID=this.bWidget.params&&this.bWidget.params.data&&this.bWidget.params.data.id,this.requestAction=this.bWidget.params&&this.bWidget.params.data&&this.bWidget.params.data.action,this.requestID?(this.accessData={},this.getData()):this._onGetError({code:"500",message:[BEM.I18N("b-request-access","no_id_for_request")]})}},getData:function(){this.findBlockOutside("i-global"),BEM.create("wi-api-request",{apiPath:".requestaccess/"+this.requestID,path:BEM.blocks["wi-history"].getCorrectPath(),urlParams:["format=json"]}).run().then(this._onGetSuccess.bind(this),this._onGetError.bind(this))},_onGetSuccess:function(t){var e="";switch(this.delMod("type"),this.accessData=t.data,this.accessStatus=this.accessData.status,this.accessStatus){case"pending":this.accessAction="allow_groups","allow"===this.requestAction&&"#grant_access_only_to"===location.hash?this.accessAction="allow_applicant":"deny"===this.requestAction&&(this.accessAction="deny"),BEM.DOM.update(this.elem("content"),BEMHTML.apply(this._getAccessBEMJSON()),this._onShowAccessSuccess,this);break;case"processed":e=BEM.I18N("b-request-access","request_processed"),this.accessData.granted?e+=BEM.I18N("b-request-access","access_granted"):e+=BEM.I18N("b-request-access","access_denied"),BEM.DOM.update(this.elem("content"),e);break;case"obsolete":e=BEM.I18N("b-request-access","request_irrelevant"),BEM.DOM.update(this.elem("content"),e);break;default:e=BEM.I18N("b-request-access","wrong_status"),BEM.DOM.update(this.elem("content"),e)}BEM.DOM.update(this.elem("buttons"),BEMHTML.apply(this._getAccessButtonsBEMJSON()),this._onShowAccessButtonsSuccess,this)},_getAccessBEMJSON:function(){return[{block:"w-username",user:this.accessData.applicant},BEM.I18N("b-request-access","ask_access"),{block:"b-request-access",elem:"reason",content:this.accessData.reason},{block:"b-request-access",elem:"access-action",content:{block:"radio-button",mods:{size:"m",type:"access-action",theme:"normal"},name:"access-action",value:this.accessAction,content:[{elem:"radio",controlAttrs:{value:"allow_groups"},content:BEM.I18N("b-request-access","access_group")},{elem:"radio",controlAttrs:{value:"allow_applicant"},content:BEM.I18N("b-request-access","access_employee")},{elem:"radio",controlAttrs:{value:"deny"},content:BEM.I18N("b-request-access","reject")}]}},{block:"b-request-access",elem:"access-action-unique",content:this._getAccessActionBEMJSON()}]},_getAccessActionBEMJSON:function(){var t={};switch(this.accessAction){case"allow_groups":t=[{block:"wiki-p",content:BEM.I18N("b-request-access","use_this",{login:this.accessData.applicant.login})},{block:"wiki-p",content:BEM.I18N("b-request-access","groups_include",{name:this.accessData.applicant.display})},{block:"allow-groups",content:[{block:"allow-groups-services",content:[{elem:"title",content:BEM.I18N("b-request-access","services")},{elem:"list",content:this._getUserGroups(this.accessData.applicant_services)}]},{block:"allow-groups-departments",content:[{elem:"title",content:BEM.I18N("b-request-access","division")},{elem:"list",content:this._getUserGroups(this.accessData.applicant_departments)}]}]},this.__self._getMSuggestBEMJSON(),{block:"b-request-access",elem:"groups-list"}];break;case"allow_applicant":t=[{block:"wiki-p",content:BEM.I18N("b-request-access","access_will_take")+this.accessData.applicant.display+". "+BEM.I18N("b-request-access","use_this",{login:this.accessData.applicant.login})+"."}];break;case"deny":t=[{block:"wiki-p",content:BEM.I18N("b-request-access","you_want_reject_access")},{block:"input",mods:{type:"textarea",size:"s"},content:{elem:"control",controlAttrs:{placeholder:BEM.I18N("b-request-access","why_you_dont_give_access")}}}]}return{block:"b-request-access",elem:this.accessAction,content:t}},_getUserGroups:function(t){return t.map((function(t){return{block:"checkbox",mods:{size:"m",theme:"normal"},js:{id:t.id},text:t.name}}))},_onShowAccessSuccess:function(){this.accessActionsButton=this.findBlockInside("radio-button"),this.accessActionsButton.on("change",this._onAccessActionChange,this),this._initBlock()},_initBlock:function(){var t=this;switch(this.accessAction){case"allow_groups":this.departmentCheckboxes=this.findBlockInside("allow-groups-departments").findBlocksInside("checkbox"),this.departmentCheckboxes.forEach((function(e){e.on("change",t._onCheckboxChange,t)})),this.otherGroups=[],this.groupsList=this.elem("groups-list"),this.groupsSuggest=this.findBlockInside({block:"m-suggest"}),this.groupsSuggest.on("select",this._onGroupsSuggestSelect,this)}},_onAccessActionChange:function(){this.accessAction=this.accessActionsButton.val();var t=this.findElem(this.accessAction);this.elem("access-action-unique").children().hide(),t.length?t.show():(BEM.DOM.append(this.elem("access-action-unique"),BEMHTML.apply(this._getAccessActionBEMJSON())),this._initBlock())},_onCheckboxChange:function(t,e){var i=this,s=null;t.target.isDisabled()||(e.checked?(this.currentDepartmentCheckbox=t.target,this.departmentCheckboxes.forEach((function(t,e){t!==i.currentDepartmentCheckbox?null!==s&&s<e&&t.setMod("checked","yes").setMod("disabled","yes"):s=e}))):this.departmentCheckboxes.forEach((function(t){t.delMod("disabled"),t.delMod("checked")})))},_onGroupsSuggestSelect:function(t,e){var i=e.entityData;this.otherGroups.includes(i.id)||(this.otherGroups.push(i.id),BEM.DOM.append(this.groupsList,BEMHTML.apply(this._groupBEMJSON(i)))),this.groupsSuggest.clearData()},_groupBEMJSON:function(t){return{block:"b-user-group",mods:{type:"request-access"},js:{id:t.id},content:[t.name,{block:"b-user-group",elem:"remove",content:{block:"awesome-icon",mods:{icon:"remove"}}}]}},_getAccessButtonsBEMJSON:function(t){var e=[],i=BEM.I18N("b-request-access","close");return t||"pending"!==this.accessStatus||(i=BEM.I18N("b-request-access","cancel")),e.push({block:"button2",mods:{size:"m",role:"cancel",theme:"normal"},text:i}),t||"pending"!==this.accessStatus||e.push({block:"button2",mix:[{block:"b-readonly-item",js:!0}],mods:{theme:"action",size:"m",role:"save"},text:BEM.I18N("b-request-access","save")}),e},_onShowAccessButtonsSuccess:function(){this.bCancelButton=this.findBlockInside({block:"button2",modName:"role",modVal:"cancel"}),this.bCancelButton&&this.bCancelButton.on("click",this._closePopup,this),this.bSaveButton=this.findBlockInside({block:"button2",modName:"role",modVal:"save"}),this.bSaveButton&&this.bSaveButton.on("click",this._saveChanges,this)},_closePopup:function(){this.bWidget.hide()},_saveChanges:function(){var t=[],e={action:this.accessAction},i="",s=this.findElem("error");switch(s.length&&s.remove(),this.accessAction){case"allow_groups":if(this.findBlocksInside("checkbox").forEach((function(e){e.isChecked()&&!e.isDisabled()&&t.push(e.params.id)})),!(t=t.concat(this.otherGroups)).length)return i={block:"b-request-access",elem:"error",content:BEM.I18N("b-request-access","no_group_selected")},void BEM.DOM.append(this.elem("allow_groups"),BEMHTML.apply(i));e.groups=t;break;case"allow_applicant":break;case"deny":if(e.verdict_reason=this.findBlockInside("input").val(),i={block:"b-request-access",elem:"error",content:BEM.I18N("b-request-access","reason_is_required_field")},""===e.verdict_reason)return void BEM.DOM.append(this.findBlockInside("input").domElem,BEMHTML.apply(i))}this._sendApprove(e)},_sendApprove:function(t){BEM.create("wi-api-request",{apiPath:".requestaccess/"+this.requestID,path:"",method:"POST",data:t,urlParams:!1}).run().then(this._onSendSuccess.bind(this),this._onGetError.bind(this))},_onSendSuccess:function(){BEM.DOM.update(this.elem("content"),BEM.I18N("b-request-access","access_was_processed")),BEM.DOM.update(this.elem("buttons"),BEMHTML.apply(this._getAccessButtonsBEMJSON(!0)),this._onShowAccessButtonsSuccess,this)},_onGetError:function(t){var e=[{block:"b-request-access",elem:"error",content:BEM.I18N("b-request-access","error")},{block:"wiki-p",content:"UNKNOWN_ERROR"===t.id?BEM.I18N("b-request-access","unknown_error"):t.message[0]}];this.delMod("type"),BEM.DOM.update(this.elem("content"),BEMHTML.apply(e)),BEM.DOM.update(this.elem("buttons"),BEMHTML.apply(this._getAccessButtonsBEMJSON(!0)),this._onShowAccessButtonsSuccess,this)}},{_getMSuggestBEMJSON:function(){return{block:"m-suggest",js:{addRequestParams:{limit:40},maxPopupHeight:250},mods:{size:"m",type:"intranet-v2"},hint:BEM.I18N("b-request-access","another_group"),types:["groups"]}}})},function(t,e){BEM.DOM.decl({name:"b-user-group",modName:"type",modVal:"request-access"},{onSetMod:{js:function(){this.bRequestAccess=this.findBlockOutside("b-request-access")}},_onRemoveClick:function(){var t=this.params.id,e=this.bRequestAccess.otherGroups.indexOf(t);this.bRequestAccess.otherGroups.splice(e,1),this.destruct()}},{live:function(){this.liveBindTo("remove","click",(function(t){this._onRemoveClick(t)}))}})},function(t,e){BEM.DOM.decl({block:"b-widget",modName:"type",modVal:"page-access"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._hasChange=this.params.canChange,this._initBlocks()},"show-users":{yes:function(){this._focusRestrictedSuggestInput()},"":function(){this._restrictedSuggest.clearData()}},progress:{yes:function(){this._saveAccessSpinner.setMod("progress","yes"),this._bSaveButton.setMod("disabled","yes")},"":function(){this._saveAccessSpinner.delMod("progress"),this._bSaveButton.delMod("disabled")}}},show:function(){var t=this._savedData||this.params.data;this.__base.apply(this,arguments),this._initTempData(),this._accessType.val(t.type),this.elem("parent-access").text("("+this.__self._getType(t.parent_access||t.type).text+")"),this.hasMod("show-users","yes")&&this._focusRestrictedSuggestInput()},hide:function(){this.__base.apply(this,arguments),this._accessType.uncheckAll()},_initAccessData:function(t){this._accessData={groups:[],users:[],departments:[],robots:[],type:t}},_setAccessDataRestrictions:function(t){this._accessData.groups=_.map(t.groups,"id"),this._accessData.users=_.map(t.users,"uid")},_initTempData:function(){var t=this._savedData||this.params.data,e=t.authors.map((function(t){return t.uid}));this._initAccessData(t.type),t.restrictions&&(t.restrictions.users=t.restrictions.users.filter((function(t){return-1===e.indexOf(t.uid)})),this._setAccessDataRestrictions(t.restrictions)),"inherited"===t.type?this._inheritedAccessData=this._accessData:this._inheritedAccessData={type:"inherited"}},_initBlocks:function(){this._restrictedSuggest=this.findBlockInside("m-suggest"),this._restrictedSuggestInput=this._restrictedSuggest.findBlockInside("textinput"),this._bGroupsList=this.findBlockInside("b-groups-list"),this._bServiceList=this.findBlockInside("b-services-list"),this._bWikiList=this.findBlockInside("b-wiki-list"),this._multiSelect=this.findBlockInside("m-suggest").on("select",this._onSuggestItemSelect,this),this._saveAccessSpinner=this.findBlockInside({block:"spin2",modName:"type",modVal:"save-access"}),this._bSaveButton=this.findBlockInside({block:"button2",modName:"role",modVal:"save"}).on("click",this._saveAccess,this),this._bCancelButton=this.findBlockInside({block:"button2",modName:"role",modVal:"cancel"}).on("click",this._onCancelClick,this),this._actionLoadSpinner=this.findBlockInside({block:"spin2",modName:"type",modVal:"action-load"}),this._accessType=this.findBlockInside("radiobox").on("change",this._onAccessTypeChange,this),this.bindTo("content","click",this._removeItem.bind(this)),BEM.blocks.link.on(this.elem("restricted-groups"),"click",this._onRestrictedLinkClick,this)},_onCancelClick:function(){this.hide()},_saveAccess:function(){this.setMod("progress","yes"),BEM.create("wi-api-request",{apiPath:".access",method:"POST",headers:{"Content-Type":"application/json"},data:"inherited"===this._accessData.type?this._inheritedAccessData:this._accessData,urlParams:!1,path:BEM.blocks["wi-history"].getCorrectPath(),timeout:this.__self.REQUEST_TIMEOUT}).run().then(this._onSaveAccessData.bind(this),BEM.blocks["wi-notification"].errorHandler(this._bSaveButton.domElem,BEM.I18N("w-access-button","cant_save_changes"))).always(function(){this.delMod("progress")}.bind(this))},_onSaveAccessData:function(t){this.trigger("access-change",t.data),this._savedData=t.data,this.hide(),t.data.rejects&&(t.data.rejects.users.length||t.data.rejects.groups.length)&&BEM.channel("common").trigger("w-action.create-approve-rejected-access",{rejects:t.data.rejects,request_role_url:t.data.request_role_url})},_isAuthor:function(t){return(this._savedData||this.params.data).authors.some((function(e){return e.uid===t.uid}))},_onSuggestItemSelect:function(t){var e,i,s;this._selectedItem=t.block.getData();var o=this._selectedItem.type;if("people"!==this._selectedItem.layer||-1!==this._accessData.users.indexOf(parseInt(this._selectedItem.uid))||this._isAuthor(this._selectedItem)){if("groups"===this._selectedItem.layer&&-1===this._accessData.groups.indexOf(parseInt(this._selectedItem.id))){switch(this._accessData.groups.push(parseInt(this._selectedItem.id)),i=BEMHTML.apply(this._getGroupBEMJSON(this._selectedItem,!1)),o){case"wiki":s=this._bWikiList,this._addHeaderToDom(this._bWikiList,BEM.I18N("w-access-button","wiki-groups"));break;case"service":s=this._bServiceList,this._addHeaderToDom(this._bServiceList,BEM.I18N("w-access-button","services"));break;default:s=this._bGroupsList,this._addHeaderToDom(this._bGroupsList,BEM.I18N("w-access-button","division"))}BEM.DOM.append(s.domElem,i),this._accessData.type="restricted"}}else this._accessData.users.push(parseInt(this._selectedItem.uid)),e=BEMHTML.apply(this._getUserBEMJSON(this._selectedItem)),BEM.DOM.append(this.elem("users-list"),e),this._accessData.type="restricted";this._multiSelect.clearData()},_removeItem:function(t){var e,i,s=$(t.target);-1!==s.attr("class").indexOf("b-acess-remove")&&(this._removeBlock=s.parent().bem("b-acess-remove"),e=parseInt(this._removeBlock.params.id),"user"===this._removeBlock.params.type?-1!==(i=this._accessData.users.indexOf(e))&&this._accessData.users.splice(i,1):"group"===this._removeBlock.params.type&&-1!==(i=this._accessData.groups.indexOf(e))&&this._accessData.groups.splice(i,1),this._accessData.users.length||this._accessData.groups.length?this._accessData.type="restricted":this._accessData.type="owner","user"===this._removeBlock.params.type?this._removeBlock.domElem.closest(".b-widget__user").remove():"group"!==this._removeBlock.params.type&&"department"!==this._removeBlock.params.type||this._removeBlock.domElem.closest(".b-widget__group").remove())},_onRestrictedLinkClick:function(t){t.block.hasMod("group","yes")&&this._showGroupUsers(t.block)},_showGroupUsers:function(t){this._currentGroupLink=t,this._currentGroup=this._currentGroupLink.findBlockOutside("b-access-group"),this._currentGroupList=this._currentGroup.findBlockInside("b-acess-group-users"),this._openedGroupUsersList&&this._openedGroupUsersList.delMod("visibility"),this._currentGroupList.hasMod("filled")?this._openedGroupUsersList!==this._currentGroup?(this._currentGroup.setMod("visibility","yes"),this._openedGroupUsersList=this._currentGroup):(this._currentGroup.delMod("visibility"),this._openedGroupUsersList=null):(BEM.DOM.after(this._currentGroupLink.domElem,this._actionLoadSpinner.domElem),this._actionLoadSpinner.setMod("progress","yes"),BEM.create("wi-api-request",{apiPath:".groups/"+this._currentGroupLink.params.id,method:"GET",data:!1,urlParams:!1,path:""}).run().then(this._onGetGroupData.bind(this),BEM.blocks["wi-notification"].errorHandler(null,BEM.I18N("w-access-button","cant_get_list"))).always(function(){this._actionLoadSpinner.delMod("progress")}.bind(this)))},_onGetGroupData:function(t){var e=this,i=[];t.data.users.data.forEach((function(t){i.push(e._getUserBEMJSON(t,!1,!0))})),BEM.DOM.append(this._currentGroupList.domElem,BEMHTML.apply(i)),this._openedGroupUsersList=this._currentGroup,this._currentGroup.setMod("visibility","yes"),this._currentGroupList.setMod("filled","yes")},_resetRestricted:function(){var t=this._savedData||this.params.data;t.restrictions&&this._setAccessDataRestrictions(t.restrictions),this._drawRestricted(t)},_cleanRestricted:function(){[this.elem("users-list"),this._bWikiList.domElem,this._bGroupsList.domElem,this._bServiceList.domElem].forEach((function(t){BEM.DOM.update(t,"")}))},_drawRestricted:function(t){var e=this,i=[this._getUserBEMJSON(t.authors,"author")];this._cleanRestricted(),t.restrictions&&t.restrictions.users.forEach((function(t){i.push(e._getUserBEMJSON(t))})),BEM.DOM.append(this.elem("users-list"),BEMHTML.apply(i)),t.restrictions&&t.restrictions.groups.forEach((function(t){switch(t.type){case 0:e._addHeaderToDom(e._bWikiList,BEM.I18N("w-access-button","wiki-groups")),BEM.DOM.append(e._bWikiList.domElem,BEMHTML.apply(e._getGroupBEMJSON(t,!0)));break;case 2:e._addHeaderToDom(e._bServiceList,BEM.I18N("w-access-button","services")),BEM.DOM.append(e._bServiceList.domElem,BEMHTML.apply(e._getGroupBEMJSON(t,!0)));break;default:e._addHeaderToDom(e._bGroupsList,BEM.I18N("w-access-button","division")),BEM.DOM.append(e._bGroupsList.domElem,BEMHTML.apply(e._getGroupBEMJSON(t,!0)))}}))},_onAccessTypeChange:function(t){var e=t.block.val();this.setMod("show-users","restricted"===e?"yes":""),this._accessData.type=e,"restricted"===e&&this._resetRestricted()},_focusRestrictedSuggestInput:function(){this.afterCurrentEvent((function(){this._restrictedSuggestInput.elem("control").focus()}),this)},_getUserBEMJSON:function(t,e,i){var s=this;return t instanceof Array||(t=[t]),t.map((function(t){return{block:"b-widget",elem:"user",content:[{block:"m-username",mods:{dismissed:t.is_dismissed?"yes":""},mix:[{block:"mi-staff-card",js:{user:t.login}}],url:"//staff.yandex-team.ru/"+t.login,content:t.title||t.first_name+" "+t.last_name},(t.is_external_employee||"external"===t.affiliation)&&{block:"awesome-icon",mods:{icon:"warning",type:"external"},attrs:{title:BEM.I18N("w-access-button","external_user")}},"author"===e?{elem:"owner",content:{html:"&nbsp;("+BEM.I18N("b-widget","author")+")"}}:!i&&s._hasChange?{block:"b-acess-remove",js:{id:t.uid,type:"user"},content:[{elem:"close"},{elem:"text",content:BEM.I18N("w-access-button","delete")}]}:void 0]}}))},_getGroupBEMJSON:function(t,e){var i;return i=e?t.name+" ("+t.users_total+")":t.name,{block:"b-widget",elem:"group",mix:{block:"b-access-group"},content:[{elem:"group-status"},{block:"link",mods:{pseudo:"yes",type:"black",group:"yes",theme:"pseudo"},js:{id:t.id},content:i},t.externals_count>0&&{block:"awesome-icon",mods:{icon:"warning",type:"external"},attrs:{title:BEM.I18N("w-access-button","external_group")}},this._hasChange&&{block:"b-acess-remove",js:{id:t.id,type:"group"},content:[{elem:"close"}]},{block:"b-acess-group-users"}]}},_addHeaderToDom:function(t,e){t.findBlockInside("b-groups-header")||BEM.DOM.append(t.domElem,BEMHTML.apply({block:"b-groups-header",content:e}))}},{REQUEST_TIMEOUT:4e4,_getType:function(t){switch(t){case"owner":return{type:"lock",text:BEM.I18N("b-widget","lock")};case"restricted":return{type:"key",text:BEM.I18N("b-widget","restricted")};case"common":return{type:"unlock",text:BEM.I18N("b-widget","common")}}}})},,,,,,,,,,function(t,e){BEM.DOM.decl({block:"m-suggest",modName:"type",modVal:"cluster"},{_sendRequest:function(){var t=this;this._input.val()?BEM.create("wi-api-request",{apiPath:".autocomplete",method:"GET",data:!1,urlParams:["tag="+this._getInputValue4Request()+"&offset=0&limit=10"],path:BEM.blocks["wi-history"].getCorrectPath()}).run().then((function(e){t.setState({result:e})}),this._onFailRequest.bind(this)):this._popup&&this._popup.delMod("visible")},_isNotEmptyResult:function(t){return Boolean(t&&t.data&&t.data.data&&t.data.data.length)},_getItemsHTML:function(t){var e=t.data.data,i=this;return BEMHTML.apply(e.map((function(t){return t.tag="/"+t.tag,i._getItemBEMJSON("cluster",t)})))},_selectItem:function(t){this.val(t,!0),this.__base.apply(this,arguments),this._items[this._curItemIndex]&&this._items[this._curItemIndex].delMod("hovered"),this._curItemIndex=-1,this._popup.delMod("visible")}})},function(t,e,i){BEM.decl("wi-long-task-requester",{onSetMod:{js:function(){var t=function(){},e=this.__self.longTaskRequester;this._request=e.create(this.params.progressBarCallback||t,this.params.hideProgressBarCallback||t,this._callForResult.bind(this),this._pollingCall.bind(this))}},run:function(){return this._request.run()},_callForResult:function(){var t=new $.Deferred,e=BEM.create("wi-api-request",this.params.callForResultParams);return e.run().then(this._onMainCallDone.bind(this,t,e)).fail(this._onMainCallFail.bind(this,t,e)),t.promise()},_pollingCall:function(t){var e=this,i=0;return function(){var s=new $.Deferred;i+=1;var o=BEM.create("wi-api-request",{apiPath:".async",method:"POST",urlParams:["n=".concat(i)],path:"",data:{task_id:t}});return o.run().then(e._onPollCallDone.bind(e,s,o)).fail(e._onPollCallFail.bind(e,s,o)),s.promise()}},_onMainCallDone:function(t,e,i){var s=i.data,o=e.statusCode;t.resolve({data:s,statusCode:o})},_onMainCallFail:function(t,e,i){var s=e.statusCode;t.resolve({error:i,statusCode:s})},_onPollCallDone:function(t,e,i){var s=i.data,o=s.status,n=s.data;"processing"===o?e.statusCode=102:"success"===o?e.statusCode=200:"failed"===o&&(e.statusCode=500);var a=e.statusCode;t.resolve({data:n,statusCode:a})},_onPollCallFail:function(t,e,i){var s=e.statusCode;t.resolve({error:i,statusCode:s})}},{longTaskRequester:i(1201).default})},function(t,e){BEM.DOM.decl({block:"b-widget",modName:"type",modVal:"subscribe"},{_subscribeUsersUids:[],onSetMod:{js:function(){this.__base.apply(this,arguments),this._suggestBlock=this.findBlockInside("m-suggest"),this._commentBlock=this.findBlockInside({block:"input",modName:"subscribe",modVal:"comment"}),this._cancel=this.findBlockInside({block:"button2",modName:"role",modVal:"cancel"}),this._close=this.findBlockInside({block:"button2",modName:"role",modVal:"close"}),this._save=this.findBlockInside({block:"button2",modName:"role",modVal:"save"}),this._spinner=this.findBlockInside({block:"spin2",modName:"type",modVal:"subscribe-load"}),this._tabsMenu=this.findBlockInside("tabs-menu").on("change",this._onTabChange,this),this._tabs=this.findBlockInside("tabs"),this._suggestBlock.on("select unselect",this._onSuggestChange,this),this._cancel.on("click",this._onCancelClick,this),this._close.on("click",this._onCancelClick,this),this._save.on("click",this._onSave,this),this._subscribers=this.params.subscribers}},show:function(t,e,i){this.__base.apply(this,arguments),this._suggestBlock._input.val("").elem("control").focus(),this._commentBlock.clearInput(),this._save.setMod("disabled","yes"),this._updateSubscribers(e),this._tabs.activate(i?1:0)},hide:function(){this.__base.apply(this,arguments),this._clearData(),this.delMod("status"),BEM.blocks["wi-history"].removeState()},_onCancelClick:function(){this.hide()},_updateSubscribers:function(t){t&&(this._subscribers=t),this.findBlockInside(this._tabsMenu.findElem("tab","type","subscribers"),"link").domElem.text(BEM.I18N("b-widget","subscribers")+(this._subscribers.length?" "+this._subscribers.length:"")),BEM.DOM.update(this.elem("subscribers"),BEMHTML.apply(this._subscribers.length?this._subscribers.map((function(t){return{block:"b-widget",elem:"subscriber",content:{block:"m-username",mods:{dismissed:t.is_dismissed?"yes":""},mix:[{block:"mi-staff-card",js:{user:t.login}}],url:"//staff.yandex-team.ru/"+t.login,content:t.display}}})):{block:"b-widget",elem:"no-subscribers",content:BEM.I18N("b-widget","no-subscribers")}))},_clearData:function(){this._subscribeUsersUids=[],this._suggestBlock.clearData()},_onSuggestChange:function(t){this._subscribeUsersUids=t.block.getData().map((function(t){return t.fullData.uid})),this._save.setMod("disabled",this._subscribeUsersUids.length?"":"yes")},_getDataForRequest:function(){return{uids:this._subscribeUsersUids,comment:this._commentBlock.val()}},_onSave:function(){this._save.setMod("disabled","yes"),this._spinner.setMod("progress","yes"),BEM.create("wi-api-request",{apiPath:".masswatch",method:"POST",data:this._getDataForRequest(),urlParams:!1,path:BEM.blocks["wi-history"].getCorrectPath()}).run().then(this.onSuccessSubscribe.bind(this),BEM.blocks["wi-notification"].errorHandler(this._save.domElem)).always(function(){this._save.delMod("disabled"),this._spinner.delMod("progress")}.bind(this))},onSuccessSubscribe:function(){this.setMod("status","subscribed");var t=this._suggestBlock.getData();t&&t.map((function(t){var e=!1;this._subscribers.forEach((function(i){i.login===t.fullData.login&&(e=!0)})),e||(t.fullData.display=t.fullData.first_name&&t.fullData.last_name?t.fullData.first_name+" "+t.fullData.last_name:t.fullData.login,this._subscribers.push(t.fullData))}),this),this._suggestBlock.clearData(),this._updateSubscribers()},_onTabChange:function(t,e){this.setMod("subscribers",e.currentIndex?"yes":""),e.currentIndex||this.afterCurrentEvent((function(){this._suggestBlock._input.elem("control").focus()}),this)}})},,,,function(t,e){BEM.DOM.decl({block:"b-widget",modName:"type",modVal:"unsubscribe"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._cancelButton=this.findBlockInside({block:"button2",modName:"role",modVal:"cancel"}).on("click",this._onCancelClick,this),this._unsubscribeButton=this.findBlockInside({block:"button2",modName:"role",modVal:"unsubscribe"}).on("click",this._unsubscribe,this),this._unsubscribeSpinner=this.findBlockInside("spin2")}},_unsubscribe:function(){this._unsubscribeButton.setMod("disabled","yes"),this._unsubscribeSpinner.setMod("progress","yes"),BEM.create("wi-api-request",{apiPath:".massunwatch",method:"POST",urlParams:!1,path:BEM.blocks["wi-history"].getCorrectPath()}).run().then(this._onSuccessUnsubscribe.bind(this),BEM.blocks["wi-notification"].errorHandler(this._unsubscribeButton.domElem)).always(function(){this._unsubscribeButton.delMod("disabled"),this._unsubscribeSpinner.delMod("progress")}.bind(this))},_onSuccessUnsubscribe:function(){BEM.WISTORE.get("page").set("userSubscription","none"),this.hide()},_onCancelClick:function(){this.hide()}})},function(t,e){BEM.DOM.decl({block:"b-widget",modName:"type",modVal:"page-settings"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._settings=this.findBlocksInside("w-page-setting"),BEM.blocks["w-page-setting"].on(this.domElem,"activate",this._onSettingActivate,this),BEM.blocks["w-page-setting"].on(this.domElem,"change",this._onSettingChange,this),BEM.blocks["w-page-setting"].on(this.domElem,"hide",this.hide,this),this._readonlyCheckbox=this.findBlockInside({block:"checkbox",modName:"role",modVal:"readonly"}).on("change",this._onReadonlyChange,this),this._dialog=BEM.DOM.append(BEM.DOM.scope,BEMHTML.apply({block:"modal",mods:{theme:"normal",autoclosable:"yes","agree-settings":"yes"},content:[{block:"b-widget",elem:"header",content:BEM.I18N("b-widget","confirmation-text")},{block:"button2",mods:{size:"s",theme:"action"},mix:{block:"b-widget",elem:"agree-button"},text:BEM.I18N("b-widget","confirm")}]})).bem("modal").on("beforeOpen",this._onDialogShow,this).on("afterClose",this._onDialogHide,this),this._dialog.findBlockInside("button2").on("click",this._onAgreeButtonClick,this)}},show:function(t){this.__base.apply(this,arguments),this.afterCurrentEvent((function(){this.afterCurrentEvent((function(){this.bindToDoc("pointerclick",this._reloadRequest)}))}),this),this._settings.forEach((function(e){t&&e.getMod("type")===t&&this.params.canEdit?e.setMod("active","yes"):e.delMod("active")}),this),BEM.DOM.update(this.elem("redirected-from"),BEMHTML.apply(this._getRedirectedFromMessage())),this._dataChanged=!1},hide:function(){this.__base.apply(this,arguments),this.unbindFromDoc("pointerclick",this._reloadRequest)},_onReadonlyChange:function(t,e){if(this._preventReadonlyChange)this._preventReadonlyChange=!1;else{this._readonlyCheckbox.setMod("disabled","yes");var i=this;BEM.create("wi-api-request",{apiPath:".readonly",method:"POST",data:{is_readonly:e.checked,for_cluster:!1},urlParams:!1,path:BEM.blocks["wi-history"].getCorrectPath()}).run().then((function(){i._readonlyCheckbox.delMod("disabled"),BEM.WISTORE.get("page").set("isReadonly",i._readonlyCheckbox.hasMod("checked","yes"))}),(function(){i._preventReadonlyChange=!0,i._readonlyCheckbox.delMod("disabled").toggleMod("checked","yes","")}))}},_getRedirectedFromMessage:function(){var t=BEM.WISTORE.stores.page&&BEM.WISTORE.stores.page.get("redirectedFrom");return t?[BEM.I18N("b-widget","redirected_from")+" ",{block:"link",url:t,content:t}]:""},_onDialogShow:function(){this.unbindFromDoc("pointerclick",this._reloadRequest),$(document).off("keydown.widget")},_onDialogHide:function(){this.bindToDoc("pointerclick",this._reloadRequest),$(document).on("keydown.widget",this._onKeyUp.bind(this))},_onSettingActivate:function(t){this._settings.forEach((function(e){t.block!==e&&e.delMod("active")}))},_onSettingChange:function(t){-1===["keywords","comments","authors"].indexOf(t.block.getMod("type"))&&(this._dataChanged=!0)},_reloadRequest:function(t){t&&($(t.target).is(this.elem("content"))||this.elem("content").find(t.target).length||this.__self._inPopup($(t.target)))||(this._dataChanged?this._dialog.setMod("visible","yes"):this.hide())},_onAgreeButtonClick:function(){location.href=this.params.ajaxPath},_onKeyUp:function(t){27===t.keyCode&&this._reloadRequest()}},{_inPopup:function(t){for(var e=!1;t.length;){if(t.hasClass("m-suggest-item")||t.hasClass("m-suggest-group")||t.hasClass("menu__text")||t.hasClass("select2__menu")){e=!0;break}t=t.parent()}return e}})},function(t,e){BEM.DOM.decl("w-page-setting",{onSetMod:{js:function(){this.bindTo("click",this._onClick.bind(this)),this._data=this.params.data,this._initBlocks()},progress:function(t,e){this._spinner.setMod("progress","yes"===e?"yes":"")},active:function(t,e){this.domElem.attr({title:"yes"===e?null:this._title})}},_initBlocks:function(){this._spinner=this.findBlockInside("spin2")},_onClick:function(){this.hasMod("active")||this.setMod("active","yes").trigger("activate")}})},function(t,e){BEM.DOM.decl({block:"w-page-setting",modName:"type",modVal:"authors"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._title=BEM.I18N("w-page-setting","setup-authors")},progress:function(t,e){this.__base.apply(this,arguments),this._suggest.setMod("disabled",e),this._saveButton.setMod("disabled",e)}},_initBlocks:function(){this.__base.apply(this,arguments),this._suggest=this.findBlockInside("multiple-suggest"),this._suggest.init({staff:this._data.authors}),this._saveButton=this.findBlockInside({block:"button2",modName:"role",modVal:"save-authors"}).on("click",this._onSaveButtonClick,this),this._massAuthorChangeLink=this.findBlockInside({block:"link",modName:"type",modVal:"mass-change-author"}),this._massAuthorChangeLink.bindTo("click",this._onMassAuthorChangeLinkClick.bind(this)),this._getAuthorshipButton=this.findBlockInside(this.findElem("get-authorship"),"button2"),this._getAuthorshipButton&&this._getAuthorshipButton.on("click",this._onGetAuthorshipButtonClick,this)},_onGetAuthorshipButtonClick:function(){this.trigger("hide"),BEM.channel("common").trigger("w-action.create-request-authorship")},_onMassAuthorChangeLinkClick:function(){this.trigger("hide"),BEM.channel("common").trigger("w-action.create-subpages-change-author",{authors:this._data.authors,path:this.params.path,baseWidgetData:{showEvent:"w-action.create-settings",showData:{tab:"authors"}}})},_onClick:function(t){var e=this.findBlockInside(this.findElem("data-preview"),"button2");e&&$(t.target).is(e.domElem)||this.__base.apply(this,arguments)},_onSaveButtonClick:function(){this._data.authors=this._suggest.get("people"),this._save(this._data.authors.map((function(t){return Number(t.uid)})))},_save:function(t){t.length?(this.setMod("progress","yes"),BEM.create("wi-api-request",{apiPath:".authors",method:"POST",path:this.params.path,data:{authors:t}}).run().then(this._onDataSave.bind(this),this._onDataSaveError.bind(this)).always(function(){this.delMod("progress")}.bind(this))):BEM.channel("notification").trigger("error",BEM.I18N("w-page-setting","no_authors_error"))},_onDataSave:function(){BEM.WISTORE.get("page").set({authors:_.clone(this._data.authors)}),this.trigger("change")},_onDataSaveError:function(){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,BEM.I18N("w-page-setting","cant_set_author")))}})},function(t,e){BEM.DOM.decl("multiple-suggest",{onSetMod:{js:{inited:function(){this._data={},this.params.types.forEach((function(t){this._data[t]=[]}),this),this._suggest=this.findBlockInside("m-suggest").on("select",this._onSuggestItemSelect,this),BEM.blocks["multiple-suggest-item"].on("remove",this._onItemRemove,this)}},disabled:function(t,e){this._suggest.setMod("disabled",e)}},_list:{},destruct:function(){this._suggest.un("select"),BEM.blocks["multiple-suggest-item"].un("remove")},init:function(t){var e=Object.keys(t),i={staff:"people",group:"groups"};e.forEach((function(e){t[e].forEach((function(t){this._addItem(t,i[e]||e)}),this)}),this)},get:function(t){return this._data[t]},_onSuggestItemSelect:function(t,e){var i=this._getItemType(e.entityData),s=this.__self._transformData(e.entityData,i);this._addItem(s,i),this._suggest.clearData()},_getList:function(t){return this._list[t]||(this._list[t]=BEM.DOM.append(this.domElem,BEMHTML.apply({block:"multiple-suggest-list",mods:{type:t},content:[this.params.listHeaders&&{elem:"header",content:BEM.I18N("multiple-suggest",t)},{elem:"items"}]})).bem("multiple-suggest-list")),this._list[t]},_getItemID:function(t){return Number(t.uid||t.id)},_getItemType:function(t){return t.layer},_addItem:function(t,e){var i=this._getItemID(t);-1===this._data[e].map(this._getItemID).indexOf(i)&&(BEM.DOM.append(this._getList(e).findElem("items"),BEMHTML.apply({block:"multiple-suggest-item",mods:{type:e},js:{id:i},data:t,active:this.params.active})),this._data[e].push(t))},_onItemRemove:function(t,e){var i=e.type,s=this._data[i].map(this._getItemID).indexOf(e.id);-1!==s&&(this._data[i].splice(s,1),t.target.destruct())}},{_transformData:function(t,e){return"people"===e&&(t.first_name&&t.last_name?t.display=t.first_name+" "+t.last_name:t.title?t.display=t.title:t.display=t.login),t}})},function(t,e){BEM.DOM.decl("multiple-suggest-item",{_onClick:function(t){t.stopPropagation(),this.trigger("remove",{id:this.params.id,type:this.getMod("type")})}},{live:function(){this.liveBindTo("remove","click",this.prototype._onClick)}})},function(t,e){BEM.DOM.decl({block:"w-action",modName:"type",modVal:"subpages-change-author"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.params&&this.params.isAction||BEM.channel("common").on("w-action.create-subpages-change-author",this._run,this)}},_run:function(t,e){var i=this.__base.apply(this,arguments);i&&(this._pushState(e,".subpages-change-author"),e.baseWidgetData&&(this._baseWidgetData=e.baseWidgetData),this._widget||(this._widget=BEM.DOM.append(BEM.DOM.scope,BEMHTML.apply({block:"b-widget",mods:{type:"subpages-change-author"},authors:BEM.WISTORE.get("page").get("authors"),currentUser:BEM.WISTORE.get("page").get("currentUser"),baseWidgetData:this._baseWidgetData||null})).bem("b-widget")),this._widget.show())}})},function(t,e){BEM.DOM.decl({block:"w-page-setting",modName:"type",modVal:"keywords"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._title=BEM.I18N("w-page-setting","setup-keywords")},progress:function(t,e){this.__base.apply(this,arguments),[this._tagsInput].concat(this.findBlocksInside("w-baloon")).forEach((function(t){t.setMod("disabled","yes"===e?"yes":"")})),this._addTagsButton.setMod("disabled","yes"!==e&&this._tagsInput.val()?"":"yes")},active:function(t,e){this.__base.apply(this,arguments),"yes"===e&&(this._tagsInput.val(""),this._addTagsButton.setMod("disabled","yes"))}},_initBlocks:function(){this.__base.apply(this,arguments),this._tagsInput=this.findBlockInside("input").on("change",this._onTagsInputChange,this),this._tagsInput.bindTo(this._tagsInput.elem("box"),"keyup",this._onTagsInputKeyDown.bind(this)),this._addTagsButton=this.findBlockInside("button2").on("click",this._addTags,this),BEM.blocks["w-baloon"].on(this.domElem,"clear-click",this._onBaloonClearClick,this)},_onBaloonClearClick:function(t,e){var i=this._data.indexOf(e),s=this._data.slice();s.splice(i,1),this.setMod("progress","yes"),this._save(s)},_save:function(t){BEM.create("wi-api-request",{apiPath:".keywords",method:"PUT",path:this.params.path,data:{keywords:t}}).run().then(this._onDataSave.bind(this,t),this._onDataSaveError.bind(this))},_onTagsInputChange:function(t){this._addTagsButton.setMod("disabled",""===t.block.val()?"yes":"")},_onTagsInputKeyDown:function(t){13===t.keyCode&&this._addTags()},_addTags:function(){var t=this.__self._processInputValue(this._tagsInput.val());1===t.length&&""===t[0]&&(t=[]);var e=this._data.concat(t);this.setMod("progress","yes"),this._save(e)},_onDataSave:function(t){this._data=t,this.delMod("progress"),this._tagsInput.val(""),BEM.DOM.update(this.elem("keywords"),BEMHTML.apply(t.map((function(t){return{block:"w-baloon",text:t}}),this))),this.elem("data-preview").text(this._data.join(", ")||BEM.I18N("w-page-setting","no-keywords")),this._tagsInput.elem("control").focus(),this.trigger("change")},_onDataSaveError:function(){this.delMod("progress"),BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(this._addTagsButton.domElem,BEM.I18N("w-page-setting","cant_set_keywords")))}},{_processInputValue:function(t){return t.replace(/ {2}/g,"").replace(/( , )|( ,)|(, )/g,",").split(",")}})},,function(t,e){BEM.DOM.decl("w-baloon",{onSetMod:{js:function(){this._subscribe()},disabled:function(t,e){"yes"===e?this._unsubscribe():this._subscribe()}},_subscribe:function(){this.bindTo(this.elem("clear"),"click",this._onClearClick.bind(this))},_unsubscribe:function(){this.unbindFrom(this.elem("clear"),"click")},_onClearClick:function(){this.trigger("clear-click",this.params.text)}})},function(t,e){BEM.DOM.decl({block:"w-page-setting",modName:"type",modVal:"comments"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._title=BEM.I18N("w-page-setting","setup-comments")},progress:function(t,e){this.__base.apply(this,arguments),this._enabledSelect.setMod("disabled",e),this._setWithSubpagesCheckboxMod("disabled",e)}},_initBlocks:function(){this.__base.apply(this,arguments),this._enabledSelect=this.findBlockInside("select2").on("change",this._onElabledSelectChange,this),this._withSubpagesCheckbox=this.findBlockInside("checkbox"),this._withSubpagesCheckbox&&this._withSubpagesCheckbox.on("change",this._onWithSubpagesCheckboxChange,this),this._saveButton=this.findBlockInside({block:"button2",modName:"role",modVal:"save-comments"}).on("click",this._onSaveButtonClick,this)},_onElabledSelectChange:function(){this._saveButton.delMod("disabled"),this._withSubpagesCheckbox&&this._withSubpagesCheckbox.setMod("checked","yes")},_onSaveButtonClick:function(){this.setMod("progress","yes");var t="off"===this._enabledSelect.getVal();BEM.create("wi-api-request",{apiPath:".comments/status",method:"POST",path:this.params.path,data:{disabled:t,for_cluster:!!this._withSubpagesCheckbox&&this._withSubpagesCheckbox.isChecked()},urlParams:!1}).run().then(this._onDataSave.bind(this,t),this._onDataSaveError.bind(this))},_onDataSave:function(t,e){this.delMod("progress"),this._data=e,this._saveButton.setMod("disabled","yes"),BEM.WISTORE.get("page").set("comments",!t),this.trigger("change")},_onDataSaveError:function(){this.delMod("progress"),BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,BEM.I18N("w-page-setting","cant_set_comments")))},_onWithSubpagesCheckboxChange:function(){this._saveButton.delMod("disabled")},_getWithSubpagesCheckboxVal:function(){return!!this._withSubpagesCheckbox&&this._withSubpagesCheckbox.isChecked()},_setWithSubpagesCheckboxMod:function(t,e){this._withSubpagesCheckbox&&this._withSubpagesCheckbox.setMod(t,e)}})},function(t,e){BEM.DOM.decl({block:"b-widget",modName:"type",modVal:"approve-rejected-access"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.findBlockInside({block:"button2",modName:"role",modVal:"ok"}).on("click",(function(){this.hide()}),this)}}})},function(t,e){BEM.DOM.decl({block:"b-widget",modName:"type",modVal:"authorship"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._cancelButton=this.findBlockInside({block:"button2",modName:"role",modVal:"cancel"}).on("click",this._onCancelClick,this),this._sendButton=this.findBlockInside({block:"button2",modName:"role",modVal:"send"}).on("click",this._sendMessage,this),this._messageInput=this.findBlockInside("input"),this._sendSpinner=this.findBlockInside("spin2")},progress:function(t,e){var i=e?"yes":"";this._sendSpinner.setMod("progress",i),this._sendButton.setMod("disabled",i),this._cancelButton.setMod("disabled",i)}},show:function(){this.__base.apply(this,arguments),this._messageInput.elem("control").focus()},_onCancelClick:function(){this.hide()},_sendMessage:function(){this.setMod("progress","yes"),BEM.create("wi-api-request",{apiPath:".request_page_author",method:"PUT",data:{reason:this._messageInput.val()},path:BEM.blocks["wi-history"].getCorrectPath()}).run().then(this._onRequestSuccess.bind(this),this._onRequestFail.bind(this)).always(function(){this.delMod("progress")}.bind(this))},_onRequestSuccess:function(t){var e;t.data.new_author&&((e=_.clone(BEM.WISTORE.get("page").get("authors"))).push(t.data.new_author),BEM.WISTORE.get("page").set("authors",e),this.hide(),location.reload()),this.hide()},_onRequestFail:function(t){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,null,t))}})},function(t,e){BEM.DOM.decl({block:"b-widget",modName:"type",modVal:"page-delete"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._cancelButton=this.findBlockInside({block:"button2",modName:"role",modVal:"cancel"}).on("click",this._onCancelClick,this),this._pageRemoveButton=this.findBlockInside({block:"button2",modName:"role",modVal:"page-delete"}).on("click",this._removePage,this),this._pageRemoveSpinner=this.findBlockInside({block:"spin2",modName:"type",modVal:"page-delete"})},progress:{yes:function(){this._pageRemoveSpinner.setMod("progress","yes"),this._pageRemoveButton.setMod("disabled","yes"),this._cancelButton.setMod("disabled","yes")},"":function(){this._pageRemoveSpinner.delMod("progress"),this._pageRemoveButton.delMod("disabled"),this._cancelButton.delMod("disabled")}}},_onCancelClick:function(){this.hide()},_removePage:function(){this.setMod("progress","yes"),BEM.create("wi-api-request",{apiPath:"",method:"DELETE",data:!1,urlParams:!1,path:BEM.blocks["wi-history"].getCorrectPath()}).run().then(this._onPageDelete.bind(this),this._onPageDeleteError.bind(this)).always(function(){this.delMod("progress")}.bind(this))},_onPageDelete:function(){var t=null,e=this.params.breadcrumbs;e&&e.forEach((function(i,s){s!==e.length-1&&!0===i.is_active&&(t=i.url)})),window.location.pathname=t||"/"},_onPageDeleteError:function(t){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(this._pageRemoveButton.domElem,BEM.I18N("b-widget","cant_delete_page"),t))}})},function(t,e){BEM.DOM.decl({block:"b-widget",modName:"type",modVal:"page-import"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._attach=this.findBlockInside("attach").on("change",this._onFileChange,this).on("reset",this._onFileReset,this),this._importTooltip=this.findBlockInside({block:"tooltip",modName:"type",modVal:"import"}),this._fieldsSeparatorSelect=this.findBlockInside({block:"select2",modName:"role",modVal:"fields-separator"}).on("change",this._onFormParamsChange,this),this._rowsSeparatorSelect=this.findBlockInside({block:"select2",modName:"role",modVal:"rows-separator"}).on("change",this._onFormParamsChange,this),this._importHeadCheckbox=this.findBlockInside({block:"checkbox",modName:"type",modVal:"import-head"}).on("change",this._onFormParamsChange,this),this._cancelButton=this.findBlockInside({block:"button2",modName:"role",modVal:"import-cancel"}).on("click",this._onCancelClick,this),this._loadButton=this.findBlockInside({block:"button2",modName:"role",modVal:"load"}).on("click",this._load,this),this._importButton=this.findBlockInside({block:"button2",modName:"role",modVal:"import"}).on("click",this._import,this),this._loadAnotherFileButton=this.findBlockInside({block:"button2",modName:"role",modVal:"load-another-file"}).on("click",this._resetForm,this),this._spinner=this.findBlockInside({block:"spin2",modName:"type",modVal:"file-load"})}},show:function(){this.__base.apply(this,arguments),this._resetForm()},hide:function(){this.__base.apply(this,arguments),this._resetForm()},_onCancelClick:function(){this.hide()},_onFileChange:function(){this._abortRequest();var t=new FormData;t.append("file",this._attach.elem("control")[0].files[0]),t.append("delimiter",this._fieldsSeparatorSelect.getVal()),t.append("quotechar",this._rowsSeparatorSelect.getVal()),t.append("omit_first",this._importHeadCheckbox.isChecked()),this._disableFirstForm(),this._spinner.setMod("progress","yes"),BEM.create("wi-api-request",{apiPath:"/.import/grid/upload",method:"POST",data:t,path:"",timeout:this.__self.REQUEST_TIMEOUT}).run().then(this._onUploadSuccess.bind(this),this._onUploadError.bind(this))},_getImportParams:function(){return{key:this._cacheKey,delimiter:this._fieldsSeparatorSelect.getVal(),quotechar:this._rowsSeparatorSelect.getVal(),omit_first:this._importHeadCheckbox.isChecked()}},_onFormParamsChange:function(){this._cacheKey&&(this._abortRequest(),this._disableFirstForm(),this._spinner.setMod("progress","yes"),BEM.create("wi-api-request",{apiPath:".import/grid/parse",method:"GET",urlParams:this._getImportParams(),path:"",timeout:this.__self.REQUEST_TIMEOUT}).run().then(this._onUploadSuccess.bind(this),this._onUploadError.bind(this)))},_onFileReset:function(){this._cacheKey=null,this._abortRequest(),this._resetForm()},_onUploadSuccess:function(t){this._currentRequest=null,this._spinner.delMod("progress"),this._enableFirstForm(),t.data&&BEM.DOM.update(this.elem("preview"),BEMHTML.apply(this.__self._getPreviewBEMJSON(t.data))),this._loadButton.delMod("disabled").delMod("visibility"),this._importButton.setMod("disabled","yes").setMod("visibility","hidden"),this._cacheKey=t.data.cache_key},_onUploadError:function(t){this._currentRequest=null,BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(this._attach.elem("reset"),BEM.I18N("b-widget","file_upload_fail"),t)),this._cacheKey=null,this._enableFirstForm(),this._loadButton.delMod("visibility").setMod("disabled","yes"),this._importButton.setMod("disabled","yes").setMod("visibility","hidden"),this._spinner.delMod("progress"),BEM.DOM.update(this.elem("preview"),"")},_disableFirstForm:function(){[this._fieldsSeparatorSelect,this._rowsSeparatorSelect,this._importHeadCheckbox,this._importButton,this._loadButton].forEach((function(t){t.setMod("disabled","yes")}))},_enableFirstForm:function(){[this._fieldsSeparatorSelect,this._rowsSeparatorSelect,this._importHeadCheckbox].forEach((function(t){t.delMod("disabled")}))},_load:function(){this._spinner.setMod("progress","yes"),this._loadButton.setMod("disabled","yes"),this._currentRequest=BEM.create("wi-api-request",{apiPath:".grid/import",method:"GET",urlParams:this._getImportParams(),path:this.params.ajaxPath,timeout:this.__self.REQUEST_TIMEOUT}),this._currentRequest.run().then(this._onSuccessGreatePreviewLoad.bind(this),this._onErrorGreatPreviewLoad.bind(this))},_onSuccessGreatePreviewLoad:function(t){this._currentRequest=null,this._spinner.delMod("progress"),this._loadButton.delMod("disabled"),this._greatPreviewCacheData=t.data,this._importTooltip.delMod("shown"),BEM.DOM.update(this.elem("preview"),BEMHTML.apply({block:"w-grid-preview",mods:{great:"yes"},data:t.data})),this._greatPreview=this.findBlockInside({block:"w-grid-preview",modNam:"greate",modVal:"yes"}).on("change",this._onGreatPreviewChange,this),this.setMod(this.elem("configs"),"visibility","hidden"),this._loadAnotherFileButton.delMod("visibility"),this._loadButton.setMod("visibility","hidden"),this._importButton.delMod("disabled").delMod("visibility")},_resetForm:function(){this.delMod(this.elem("configs"),"visibility"),this._loadAnotherFileButton.setMod("visibility","hidden"),this._attach.un("reset"),this._attach.un("change"),this._attach.resetFile(),this._attach.on("change",this._onFileChange,this),this._attach.on("reset",this._onFileReset,this),this._abortRequest(),this._loadButton.setMod("disabled","yes").delMod("visibility"),this._importButton.setMod("disabled","yes").setMod("visibility","hidden"),[this._fieldsSeparatorSelect,this._rowsSeparatorSelect,this._importHeadCheckbox].forEach((function(t){t.delMod("disabled")})),BEM.DOM.update(this.elem("preview"),""),this._cacheKey=null,this._greatPreviewCacheData=null,this._cleanError(),this._cleanTooltips(),this._spinner.delMod("progress")},_onErrorGreatPreviewLoad:function(){this._currentRequest=null,this._spinner.delMod("progress"),this._loadButton.delMod("disabled"),this._importTooltip.setOwner(this._loadButton.domElem).setMod("shown","yes")},_onGreatPreviewChange:function(t,e){this._greatPreview.disable(),this._importButton.setMod("disabled","yes"),this._spinner.setMod("progress","yes"),this._currentRequest=BEM.create("wi-api-request",{apiPath:".grid/import",method:"GET",urlParams:_.extend(this._getImportParams(),this.__self._transformDataToGETParams(e.columns)),path:this.params.ajaxPath,timeout:this.__self.REQUEST_TIMEOUT}),this._currentRequest.run().then(this._onSuccessGreatPreviewUpdate.bind(this),this._onErrorGreatPreviewUpdate.bind(this))},_onSuccessGreatPreviewUpdate:function(t){this._spinner.delMod("progress"),this._greatPreviewCacheData=t.data,this._cleanError(),this._greatPreviewCacheData.fields.length&&this._importButton.delMod("disabled"),this._greatPreview.enable(),this._greatPreview.updateContent(t.data)},_onErrorGreatPreviewUpdate:function(t){var e,i={newCol:[],merge:[]};t&&"CLIENT_SENT_INVALID_DATA"===t.id?t.meta?(Object.keys(t.meta).forEach((function(e){var s=t.meta[e];1===s.length?i.newCol.push("'"+s[0]+"'"):i.merge.push("'"+s[1]+"'")}),this),e=BEM.I18N("b-widget","incompatible_data_types")+i.newCol.join(", "),i.newCol.length?i.merge.length?e+=","+BEM.I18N("b-widget","and_on_cols_that_imports")+i.merge.join(", ")+".":e+=".":i.merge.length?e+=BEM.I18N("b-widget","cols_that_imports")+i.merge.join(", ")+".":e=BEM.I18N("b-widget","update_preview_error")):e=BEM.I18N("b-widget","update_preview_error")+" "+BEM.blocks["wi-notification"].createErrorMessage(t):e=BEM.I18N("b-widget","update_preview_error"),this._spinner.delMod("progress"),this._showError(e),this._greatPreview.enable(),this._importButton.setMod("disabled","yes")},_showError:function(t){this.delMod(this.elem("errors"),"visibility"),BEM.DOM.update(this.elem("errors"),t)},_cleanError:function(){this.setMod(this.elem("errors"),"visibility","hidden"),BEM.DOM.update(this.elem("errors"),"")},_cleanTooltips:function(){this._importTooltip.delMod("shown")},_import:function(){this._importButton.setMod("disabled","yes"),this._spinner.setMod("progress","yes"),this._currentRequest=BEM.create("wi-api-request",{apiPath:".grid/import",data:$.extend({key:this._cacheKey,delimiter:this._fieldsSeparatorSelect.getVal(),quotechar:this._rowsSeparatorSelect.getVal(),omit_first:this._importHeadCheckbox.isChecked()},this._greatPreview.getData().columns),method:"POST",urlParams:!1,path:this.params.ajaxPath,timeout:this.__self.REQUEST_TIMEOUT}),this._currentRequest.run().then(this._onFinalImportSuccess.bind(this),this._onFinalImportError.bind(this))},_onFinalImportSuccess:function(){this._currentRequest=null,this._spinner.delMod("progress"),this._importTooltip.delMod("shown"),this.hide(),location.reload()},_onFinalImportError:function(){this._currentRequest=null,this._spinner.delMod("progress"),this._importButton.delMod("disabled"),this._importTooltip.setOwner(this._importButton.domElem).setMod("shown","yes")},_abortRequest:function(){this._currentRequest&&(this._currentRequest.abortRequest?this._currentRequest.abortRequest():this._currentRequest.abort&&this._currentRequest.abort(),this._currentRequest=null)}},{REQUEST_TIMEOUT:12e4,_getPreviewBEMJSON:function(t){var e,i=[];for(e=1;e<=t.column_count;e++)i.push(BEM.I18N("b-widget","col")+" "+e);return{block:"w-grid-preview",content:[{block:"w-grid-preview",elem:"head",content:{block:"w-grid-preview",elem:"row",content:i.map((function(t){return{block:"w-grid-preview",elem:"col",content:t}}),this)}},t.rows.map((function(t){return{block:"w-grid-preview",elem:"row",content:t.map((function(t){return{block:"w-grid-preview",elem:"col",content:t}}),this)}}),this)]}},_transformDataToGETParams:function(t){var e={};return Object.keys(t).forEach((function(i){e[i]=t[i]})),e}})},function(t,e){BEM.DOM.decl({block:"b-widget",modName:"type",modVal:"referrers"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._cancelButton=this.findBlockInside({block:"button2",modName:"role",modVal:"close"}).on("click",this._onCancelClick,this)}},_onCancelClick:function(){this.hide()}})},function(t,e){BEM.DOM.decl({block:"b-widget",modName:"type",modVal:"request-page-author"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._cancelButton=this.findBlockInside({block:"button2",modName:"role",modVal:"cancel"}).on("click",this._onCancelClick,this),this._addButton=this.findBlockInside({block:"button2",modName:"role",modVal:"add"}).on("click",this._addAuthor,this),this._addSpinner=this.findBlockInside("spin2")},progress:function(t,e){this._cancelButton.setMod("disabled",e),this._addButton.setMod("disabled",e),this._addSpinner.setMod("progress",e)}},_addAuthor:function(){this.setMod("progress","yes"),BEM.create("wi-api-request",{apiPath:".request_page_author",method:"POST",urlParams:!1,data:{new_author:this.params.request_login},path:BEM.blocks["wi-history"].getCorrectPath()}).run().then(this._onSuccessAdd.bind(this),BEM.blocks["wi-notification"].errorHandler(this._addButton.domElem)).always(function(){this.delMod("progress")}.bind(this))},_onSuccessAdd:function(t){var e=_.clone(BEM.WISTORE.get("page").get("authors"));e.push(t.data.new_author),BEM.WISTORE.get("page").set("authors",e),this.hide(),location.reload()},_onCancelClick:function(){this.hide()}})},function(t,e){BEM.DOM.decl({block:"b-widget",modName:"type",modVal:"subpages-change-author"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._fromSuggest=this.findBlockInside({block:"m-suggest",modName:"role",modVal:"from"}),this._fromSuggestIsDisabled=this._fromSuggest.getMod("disabled"),this._toSuggest=this.findBlockInside({block:"m-suggest",modName:"role",modVal:"to"}),this._backButton=this.findBlockInside({block:"button2",modName:"role",modVal:"back"}),this._backButton&&this._backButton.on("click",this._goBack,this),this._cancelButton=this.findBlockInside({block:"button2",modName:"role",modVal:"cancel"}),this._cancelButton&&this._cancelButton.on("click",this._cancel,this),this._saveButton=this.findBlockInside({block:"button2",modName:"role",modVal:"save"}).on("click",this._save,this),this._saveSpin=this.findBlockInside({block:"spin2",modName:"role",modVal:"save"}),this._canEditFromSuggest=this.params.currentUser.is_admin||this.params.authors.find(function(t){return t.login===this.params.currentUser.login}.bind(this)),this._fromSuggestValue=this._canEditFromSuggest?null:this.params.currentUser,this._toSuggestValue=null,this._fromSuggest.on("select",this._onFromSuggestSelect,this).on("change",this._onFromSuggestChange,this),this._toSuggest.on("select",this._onToSuggestSelect,this).on("change",this._onToSuggestChange,this),this._updateTree()},progress:function(t,e){var i=e?"yes":"";!this._fromSuggestIsDisabled&&this._fromSuggest.setMod("disabled",i),this._toSuggest.setMod("disabled",i),this._backButton&&this._backButton.setMod("disabled",i),this._cancelButton&&this._cancelButton.setMod("disabled",i),this._saveButton.setMod("disabled",i),this._saveSpin.setMod("progress",i)}},_onFromSuggestChange:function(){this._fromSuggestChangePrevent?this._fromSuggestChangePrevent=!1:(this._fromSuggestValue=null,this._updateTree(),this._updateSaveButton())},_onToSuggestChange:function(){this._toSuggestChangePrevent?this._toSuggestChangePrevent=!1:(this._toSuggestValue=null,this._updateSaveButton())},_onFromSuggestSelect:function(t,e){e.entityData.login=this._getSelectedItemField(e.entityData,"login"),e.entityData.uid=this._getSelectedItemField(e.entityData,"uid"),this._compare(e.entityData,this._toSuggestValue)?this.afterCurrentEvent((function(){this._toSuggest.clearData()}),this):(this._fromSuggestValue=e.entityData,this._fromSuggestChangePrevent=!0,this._updateTree(),this._updateSaveButton())},_getSelectedItemField:function(t,e){var i=t.fields.filter((function(t){return t.type===e}))[0];return i?i.value:null},_onToSuggestSelect:function(t,e){e.entityData.login=this._getSelectedItemField(e.entityData,"login"),e.entityData.uid=this._getSelectedItemField(e.entityData,"uid"),this._compare(e.entityData,this._fromSuggestValue)?this.afterCurrentEvent((function(){this._toSuggest.clearData()}),this):(this._toSuggestValue=e.entityData,this._toSuggestChangePrevent=!0,this._updateSaveButton())},_compare:function(t,e){return!(!t||!e)&&t.uid===e.uid},_updateSaveButton:function(){this._saveButton.setMod("disabled",this._fromSuggestValue&&this._toSuggestValue?"":"yes")},_getFromSuggestLogin:function(){return this._fromSuggestValue?this._fromSuggestValue.login:""},_updateTree:function(){this._fromSuggestValue?(BEM.DOM.update(this.elem("tree"),BEMHTML.apply({block:"spin2",mods:{size:"m",progress:"yes"}})),this._getTreeRequest=BEM.create("wi-api-request",{apiPath:".tree",method:"GET",data:!1,urlParams:["depth=3","show_redirects=True","show_grids=True","show_titles=True","nomark=True","authors="+this._getFromSuggestLogin()],path:BEM.blocks["wi-history"].getCorrectPath()}),this._getTreeRequest.run().then(this._onGetTreeData.bind(this),this._onFailGetTreeData.bind(this))):this._getTreeRequest&&(this._getTreeRequest.abort(),this._getTreeRequest=null,this._getTreeRequestAborted=!0)},_onGetTreeData:function(t){BEM.DOM.update(this.elem("tree"),BEMHTML.apply([{block:"b-widget",elem:"subpages-list",content:BEM.I18N("b-widget","subpages_list")},{block:"b-wiki-tree",js:{totalData:t.data,data:{nomark:!0}}}]))},_onFailGetTreeData:function(){this._getTreeRequestAborted?this._getTreeRequestAborted=!1:BEM.DOM.update(this.elem("tree"),"")},_goBack:function(){this.hide(),this.params.baseWidgetData&&this.afterCurrentEvent((function(){BEM.channel("common").trigger(this.params.baseWidgetData.showEvent,this.params.baseWidgetData.showData||{})}))},_cancel:function(){this.hide()},_save:function(){this.setMod("progress"),BEM.create("wi-api-request",{apiPath:".authors",method:"POST",data:{with_subpages:!0,replace_authors:[this._fromSuggestValue.uid],authors:[this._toSuggestValue.uid]},urlParams:!1,path:BEM.blocks["wi-history"].getCorrectPath(),timeout:6e4}).run().then(this._onSuccessSave.bind(this),this._onFailSave.bind(this)).always(function(){this.delMod("progress")}.bind(this))},_onSuccessSave:function(){this.hide(),this.afterCurrentEvent((function(){location.reload()}))},_onFailSave:function(t){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,null,t))}})},,function(t,e){BEM.DOM.decl({block:"m-suggest",modName:"type",modVal:"b2b"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._requestSettings.dataType="json"}},_getItemBEMJSON:function(t,e){return{block:"m-suggest-item",mods:{type:t,size:this.getMod("size"),link:this.hasMod("multicomplete","yes")?"":"yes",labels:this.params.inHeader||this.params.inSearchHeader?"yes":"","in-search-header":this.params.inSearchHeader&&"yes"},href:e.url,data:e,inputData:{text:this._getInputValue4Request(),offset:this._input.findElem("box").offset(),width:this._input.domElem.outerWidth()},inSearchHeader:this.params.inSearchHeader,intranet:Boolean(this.params.intranet)}},_multicompleteItem:function(t){this.val(t,!0),this._items[this._curItemIndex]&&this._items[this._curItemIndex].delMod("hovered"),this._curItemIndex=-1,this._popup.delMod("visible")}})},function(t,e,i){BEM.DOM.decl("b-wiki-tree",{onSetMod:{js:function(){this._expandAllButton=this.findBlockInside({block:"button2",modName:"role",modVal:"expand-all"}),this._updateTreeSpinner=this.findBlockInside({block:"spin2",modName:"type",modVal:"update-tree"}),this._expandAllButton&&this._expandAllButton.on("click",this._expandAll,this)},"tree-loading":{yes:function(){this._updateTreeSpinner.setMod("progress","yes"),this._expandAllButton.setMod("disabled","yes")},"":function(){this._updateTreeSpinner.delMod("progress"),this._expandAllButton.delMod("disabled")}}},_expandAll:function(){this.setMod("tree-loading","yes");var t=document.createElement("a");t.href=this.params.totalData.expand_all_url;var e=this.__self.urlJoin(window.location.origin,t.pathname,t.search);$.ajax({url:e,success:this._onSuccessLoad.bind(this),error:this._onFailLoad.bind(this)})},_onSuccessLoad:function(t){this.delMod("tree-loading"),t.data?(BEM.DOM.update(this.elem("expand-all"),BEMHTML.apply({block:"b-wiki-tree",elem:"full-loaded"})),BEM.DOM.update(this.elem("tree"),BEMHTML.apply(t.data.subpages.map(BEM.blocks["b-wiki-tree-page"].getPageBEMJSON)))):this._onFailLoad()},_onFailLoad:function(){this.delMod("tree-loading"),BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,BEM.I18N("b-wiki-tree","cant_get_tree")))}},{urlJoin:i(72)})},function(t,e){BEM.DOM.decl("b-wiki-tree-page",{onSetMod:{js:function(){this._cacheBlocks(),this._subscribe()},progress:{yes:function(){this._expandSpinner.setMod("progress","yes")},"":function(){this._expandSpinner.delMod("progress")}}},_cacheBlocks:function(){this._expandIcon=this.findBlockInside(this.findElem("expand").eq(0),{block:"awesome-icon",modName:"type",modVal:"expand"}),this._unexpandIcon=this.findBlockInside(this.findElem("expand").eq(0),{block:"awesome-icon",modName:"type",modVal:"unexpand"}),this._expandSpinner=this.findBlockInside(this.findElem("expand").eq(0),{block:"spin2",modName:"type",modVal:"expand"})},_subscribe:function(){this.findBlockInside(this.findElem("self"),"link").bindTo("click",(function(){yaCounter&&yaCounter.reachGoal("from_tree")})),this._expandIcon&&this._expandIcon.bindTo("click",this._onExpandIconClick.bind(this)),this._unexpandIcon&&this._unexpandIcon.bindTo("click",this._onUnexpandIconClick.bind(this))},_onExpandIconClick:function(){this.hasMod("data-loaded","yes")?this.setMod("expanded","yes"):(this.setMod("progress","yes"),$.ajax({url:this.params.data.expand_url,success:this._onSuccessLoadBranch.bind(this),error:this._onFailLoadBranch.bind(this),complete:this._onLoadBranchComplete.bind(this)}))},_onUnexpandIconClick:function(){this.delMod("expanded")},_onSuccessLoadBranch:function(t){t.data?(BEM.DOM.update(this.findElem("children"),BEMHTML.apply(t.data.subpages.map(this.__self.getPageBEMJSON))),this.setMod("data-loaded","yes"),this.setMod("expanded","yes")):this._onFailLoadBranch()},_onFailLoadBranch:function(){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,BEM.I18N("b-wiki-tree-page","cant_get_branch")))},_onLoadBranchComplete:function(){this.delMod("progress")}},{getPageBEMJSON:function(t){return{block:"b-wiki-tree-page",mods:{expandable:t.expand_url||t.subpages.length?"yes":"",expanded:t.subpages.length?"yes":"","data-loaded":t.subpages.length?"yes":"",type:t.page.type.toLowerCase()},data:t}}})},function(t,e){BEM.DOM.decl({block:"b-widget",modName:"type",modVal:"tree"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.findBlockInside({block:"button2",modName:"role",modVal:"back"}).on("click",this._onBackClick,this),this.findBlockInside({block:"button2",modName:"role",modVal:"close"}).on("click",this._onCloseClick,this)}},show:function(t){this.__base.apply(this,arguments),this.afterCurrentEvent((function(){this.bindToDoc("pointerclick",this._onDocClick)}),this),t&&t.baseWidgetData?(this._baseWidgetData=t.baseWidgetData,this.setMod("show-back","yes")):this.delMod("show-back")},hide:function(){this.__base.apply(this,arguments),this.unbindFromDoc("pointerclick"),this.delMod("show-back")},_onCloseClick:function(){this.hide()},_onDocClick:function(t){$(t.target).is(this.elem("content"))||this.elem("content").find(t.target).length||this.hide()},_onBackClick:function(){this.hide(!0),this._baseWidgetData&&BEM.channel("common").trigger(this._baseWidgetData.showEvent,this._baseWidgetData.showData||{})}})},function(t,e){BEM.DOM.decl({block:"b-widget",modName:"type",modVal:"redirect-message"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.findBlockInside({block:"button2",modName:"role",modVal:"cancel"}).on("click",this._onCancelClick,this),this.findBlockInside({block:"button2",modName:"role",modVal:"settings"}).on("click",this._showSettingsWidget,this)}},_onCancelClick:function(){this.hide()},_showSettingsWidget:function(){var t=BEM.blocks["i-routes"].actions[".settings"];BEM.channel("common").trigger(t.block+"."+t.event)}})},function(t,e){BEM.DOM.decl({block:"w-page-info",modName:"type",modVal:"redirect"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.findBlockInside({block:"button2",modName:"role",modVal:"settings"}).on("click",this._showSettings,this)}},_showSettings:function(){var t=BEM.blocks["i-routes"].actions[".settings"];BEM.channel("common").trigger(t.block+"."+t.event)}})},function(t,e){BEM.DOM.decl({block:"w-page-info",modName:"type",modVal:"redirected-from"},{hide:function(){this.__base.apply(this,arguments),BEM.blocks["wi-history"].removeState()}})},function(t,e){BEM.DOM.decl("b-wiki-form",{_getMainDoc:function(){return this._bContent=this._bPage.findBlockInside("b-content"),this._bContent&&this._bContent.findBlockInside({block:"wiki-doc",modName:"status",modVal:"main"})}})},function(t,e){BEM.DOM.decl({block:"input",modName:"type",modVal:"number"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.bindTo("input",BEM.blocks["mi-helpers"].validateNumberOnlyInput)}}})},,,function(t,e){BEM.DOM.decl("b-head",{onSetMod:{js:function(){this.__base.apply(this,arguments),this._newPageButton=this._getNewPageButton(),this._newPageButton&&this._newPageButton.bindTo("mouseup",function(t){yaCounter&&yaCounter.reachGoal("create"),keymaster.command||keymaster.ctrl||2===t.which?window.open(BEM.blocks["wi-history"].getCorrectPath()+".create","_blank").focus():this.openCreatePageWidget("cluster")}.bind(this)),this._bPage=this.findBlockOutside("b-page"),BEM.channel("common").on("b-head.newPageCreate",(function(t,e){this.openCreatePageWidget("sub",e&&e.initial)}),this)}},_getNewPageButton:function(){return this.findBlockInside({block:"button2",modName:"type",modVal:"new-page"})},openCreatePageWidget:function(t){var e=BEM.blocks["wi-history"].parseURL().params;t=this.params.error?"root":t,this._widget||this._createWidget(),this._widget.open(t,_.unescape(e&&e.title)||null,Boolean(this.params.error)),BEM.blocks["wi-history"].pushState(".create")},_createWidget:function(){BEM.DOM.append(this._bPage.domElem,BEMHTML.apply({block:"b-widget",mods:{type:"new-page"}})),this._widget=this._bPage.findBlockInside({block:"b-widget",modName:"type",modVal:"new-page"})},destruct:function(){BEM.channel("common").un("m-head.newPageCreate"),this.__base.apply(this,arguments)}})},function(t,e){BEM.DOM.decl("b-favs",{onSetMod:{js:function(){this.bPage=this.findBlockOutside("b-page"),this.defaultFolderName=["__INBOX__",BEM.I18N("b-favs","favorite")],this.autoFolders={__OWNER__:BEM.I18N("b-favs","i_am_author"),__WATCHER__:BEM.I18N("b-favs","i_am_observer"),__LAST_EDIT__:BEM.I18N("b-favs","editerd_by_me")},this.linksCache=[],this._initWidget()},mode:{opened:function(){this._showFavsWidget(),this.bPage.setMod("favorites","visible")},"":function(){this._hideFavsWidget(),this.bOptionsButton.delMod("mode"),this.bPage.delMod("favorites")}}},_onClick:function(t){t.preventDefault(),this.toggleMod("mode","opened")},_initWidget:function(){BEM.DOM.append(this.bPage.domElem,BEMHTML.apply({block:"b-favs-widget"})),this.bWidget=this.bPage.findBlockInside("b-favs-widget"),this.bWidget.on("hide",this._onWidgetHide,this),this.bFolders=this.bWidget.findBlockInside("b-favs-folders"),this.bLinks=this.bWidget.findBlockInside("b-favs-links"),this.bOptionsButton=this.bWidget.findBlockInside("b-favs-options-button")},_showFavsWidget:function(){this.bWidget&&this.bWidget.show()},_hideFavsWidget:function(){this.bWidget&&this.bWidget.hide()},_onWidgetHide:function(){this.delMod("mode")},clearLinksCache:function(t){null!==this.linksCache[t]&&void 0!==this.linksCache[t]&&delete this.linksCache[t]},removeLinkCacheFromCurrentFolder:function(t){var e=null;this.currentFolder&&this.currentFolder.params.name&&(this.linksCache[this.currentFolder.params.name].data.forEach((function(i,s){i.id===t&&(e=s)}),this),null!==e&&(this.linksCache[this.currentFolder.params.name].data.splice(e,1),this.linksCache[this.currentFolder.params.name].html=BEMHTML.apply(this.bLinks.__self.getLinksBEMJSON(this.linksCache[this.currentFolder.params.name].data))))},moveLinkInCurrentFolderCache:function(t,e){var i,s=null,o=null;this.currentFolder&&this.currentFolder.params.name&&(this.linksCache[this.currentFolder.params.name].data.forEach((function(n,a){n.id===t&&(s=a,i=n),n.id===e&&(o=a)}),this),null!==s&&(this.linksCache[this.currentFolder.params.name].data.splice(s,1),this.linksCache[this.currentFolder.params.name].data.splice(o,0,i),this.linksCache[this.currentFolder.params.name].html=BEMHTML.apply(this.bLinks.__self.getLinksBEMJSON(this.linksCache[this.currentFolder.params.name].data))))},renameLinkInCurFolderCache:function(t,e){this.currentFolder&&this.currentFolder.params.name&&this.linksCache[this.currentFolder.params.name].data.forEach((function(i){i.id===t&&(i.title=e)}),this)},clearCurrentLinksCache:function(){this.currentFolder&&this.currentFolder.params.name&&this.clearLinksCache(this.currentFolder.params.name)},changeFolderCount:function(t,e){t.params.count+=e,t.elem("count").html(t.params.count)},changeCurrentFolderCount:function(t){this.currentFolder&&this.changeFolderCount(this.currentFolder,t)},refreshFavs:function(){this.linksCache=[],this.bFolders.initBlock(),this.bLinks.initBlock()}},{live:function(){this.liveBindTo("click",(function(t){this._onClick(t)}))},foldersTypes:{F:"favorites",A:"autofolders",C:"custom"}})},function(t,e){BEM.DOM.decl("b-favs-widget",{onSetMod:{js:function(){this._bPage=this.findBlockOutside("b-page")}},show:function(){var t=this;if(!this.hasMod("visibility","yes")){$(document).on("keyup.favs-widget",(function(e){27===e.keyCode&&t.hide()}));var e=this._bPage.findBlockInside({block:"b-widget",modName:"visibility",modVal:"yes"});e&&e.hide(),this.setMod("visibility","yes"),this._bPage.setMod("scroll","disable"),$(document).scrollTop(0),setTimeout((function(){t.setMod("animate","yes")}),100)}},hide:function(){var t=this;this.hasMod("visibility","yes")&&(this.delMod("animate"),setTimeout((function(){$(document).off("keyup.favs-widget"),t.delMod("visibility"),t._bPage.delMod("scroll"),t.trigger("hide")}),400))},_onClick:function(){this.hide()}},{live:function(){this.liveBindTo("paranja","click",(function(t){this._onClick(t)}))}})},function(t,e){BEM.DOM.decl("b-favs-folders",{onSetMod:{js:function(){this.bPage=this.findBlockOutside("b-page"),this.bFavs=this.bPage.findBlockInside("b-favs"),this.foldersSpinner=this.findBlockInside("spin2"),this.initBlock()},mode:{edited:function(){this._setFoldersDraggable("true")},"":function(){this._setFoldersDraggable("false")}}},initBlock:function(){this._getFolders(),this.findBlockInside("scroll").elem("native").on("scroll",this.closeErrorPopup.bind(this))},_getFolders:function(){this._showSpinner(),BEM.create("wi-api-request",{apiPath:".favorites/folders",path:"",urlParams:["format=json"]}).run().then(this._onGotData.bind(this),BEM.blocks["wi-notification"].errorHandler()).always(function(){this._hideSpinner()}.bind(this))},_onGotData:function(t){t.data.forEach((function(t){t.type=this.bFavs.__self.foldersTypes[t.type]}),this);var e=BEMHTML.apply(this._getFoldersBEMJSON(t.data));BEM.DOM.update(this.elem("list"),e,this._onShowFoldersSuccess,this)},_onShowFoldersSuccess:function(){var t=this.findBlocksInside("b-favs-folder");t.length&&(null!=this.bFavs.currentFolderIndex?this.bFavs.currentFolder=t[this.bFavs.currentFolderIndex]||t[0]:this.bFavs.currentFolder=t[0],this.bFavs.currentFolder&&this.bFavs.currentFolder.setMod("current","true"),this.bFavs.currentFolderIndex=null,this.hasMod("mode","edited")&&this._setFoldersDraggable("true"))},_getFoldersBEMJSON:function(t){var e=[],i=this,s=!0;return t.forEach((function(t){"autofolders"===t.type&&s&&(e.push(i._getNewFolderBEMJSON()),s=!1),e.push(i._getFolderBEMJSON(t))})),e},_getFolderBEMJSON:function(t){var e="folder",i=t.name,s="custom";return"favorites"===t.type&&(e="bookmark",i=this.bFavs.defaultFolderName[1],s="default"),"autofolders"===t.type&&(s="auto",i=this.bFavs.autoFolders[t.name]||t.name),{block:"b-favs-folders",elem:"item",mix:[{block:"b-favs-folder",js:{name:t.name,type:t.type,count:t.favorites_count},mods:{type:s}}],content:[{block:"b-favs-folder",elem:"icon",mix:[{block:"awesome-icon",mods:{icon:e}}]},{block:"b-favs-folder",elem:"move",content:{block:"awesome-icon",mods:{icon:"ellipsis-v"}}},{block:"b-favs-folder",elem:"content",content:[{block:"b-favs-folder",elem:"name",content:i},{block:"b-favs-folder",elem:"count",content:t.favorites_count}]},{block:"b-favs-folder",elem:"remove",content:{block:"awesome-icon",mods:{icon:"remove"}}}]}},_getNewFolderBEMJSON:function(){return{block:"b-favs-folders",elem:"item",mix:[{block:"b-favs-folder",mods:{type:"new-folder"}},{block:"b-favs-new-folder",js:!0}],content:[{block:"b-favs-folder",elem:"icon",mix:[{block:"awesome-icon",mods:{icon:"plus-square"}}]},{block:"b-favs-folder",elem:"name",content:BEM.I18N("b-favs-folders","new_folder")}]}},_showSpinner:function(){this.foldersSpinner.setMod("show","yes"),this.foldersSpinner.setMod("progress","yes"),this.elem("list").hide()},_hideSpinner:function(){this.foldersSpinner.setMod("show","no"),this.foldersSpinner.delMod("progress"),this.elem("list").show()},_setFoldersDraggable:function(t){this.findBlocksInside({block:"b-favs-folder",modName:"type",modVal:"custom"}).forEach((function(e){e.domElem.attr("draggable",t)}))},closeErrorPopup:function(){this.channel("errors").trigger("errorHide")}})},function(t,e){BEM.DOM.decl("b-favs-folder",{onSetMod:{js:function(){this.__self.bPage||(this.__self.bPage=this.findBlockOutside("b-page")),this.__self.bFavs||(this.__self.bFavs=this.__self.bPage.findBlockInside("b-favs"))},mode:{edited:function(){this.hasMod("type","custom")&&this.domElem.attr("draggable","false")},"":function(){this.hasMod("type","custom")&&this.__self.bFavs.bFolders.hasMod("mode","edited")&&this.domElem.attr("draggable","true")}}},_onNameClick:function(){this._isEditable()&&(this.folderTitle||(this.folderTitleElem=this.findElem("name"),this.folderTitle=this.folderTitleElem.text(),BEM.DOM.after(this.folderTitleElem,BEMHTML.apply({block:"input",js:{autoFocus:"yes"},mods:{size:"s"},value:this.folderTitle,content:{elem:"control"}})),this.folderNameInput=this.findBlockInside("input"),this.folderNameInput.on("blur",this._closeInput,this),this.folderNameInput.bindTo("keypress",this._onInputKeypress.bind(this))),this.setMod("mode","edited"),this.folderNameInput.elem("control").focus(),this.__self.bFavs.bFolders.closeErrorPopup())},_onInputKeypress:function(t){13===t.keyCode&&this.folderNameInput.elem("control").blur()},_closeInput:function(){var t=this.folderNameInput.val();this.delMod("mode"),t!==this.folderTitle&&(this.folderTitleElem.text(t),this._renameFolder(t))},_renameFolder:function(t){BEM.create("wi-api-request",{apiPath:".favorites/folders/"+encodeURIComponent(this.params.name),path:"",method:"POST",data:{new_name:t},urlParams:!1}).run().then(this._onRenameSuccess.bind(this,t),this._onRenameError.bind(this))},_onRenameSuccess:function(t){this.folderTitle=t,this.params.name=t},_onRenameError:function(t){this.folderTitleElem.text(this.params.name),this.folderNameInput.val(this.params.name),BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(this.domElem,BEM.I18N("b-favs-folder","cant_rename_folder"),t))},_onClick:function(){this.hasMod("current","true")||this.hasMod("type","new-folder")||(this.__self.bFavs.currentFolder.delMod("current"),this.setMod("current","true"),this.__self.bFavs.currentFolder=this,this.__self.bFavs.bOptionsButton.hasMod("mode","edited")&&(this.hasMod("type","auto")?this.__self.bFavs.bLinks.delMod("mode"):this.__self.bFavs.bLinks.setMod("mode","edited")),this.__self.bFavs.bLinks.getLinks(this.params))},_getFolderPrevName:function(){return this.domElem.prev().length&&this.domElem.prev().bem("b-favs-folder").params.name||null},_onDragStart:function(t){var e=t.originalEvent.dataTransfer;if(!this.__self.bFavs.bFolders.hasMod("mode","edited"))return!1;this.setMod("mode","dragging"),this.__self.bFavs.bFolders.setMod("moving","yes"),this.__self.bFavs.draggingFolder=this,this.__self.bFavs.draggingFolderPrevName=this._getFolderPrevName(),e.setData("text/plain",""),e.effectAllowed="move",e.dropEffect="move"},_onDragEnd:function(t){var e=this.__self.bFavs.draggingFolder.params.name,i=this._getFolderPrevName();t.preventDefault(),this.hasMod("mode","dragging")&&this.delMod("mode"),this.__self.bFavs.bFolders.delMod("moving"),this.__self.bFavs.draggingFolderPrevName!==i&&this._dragBookmarkFolder(e,i),this.__self.bFavs.draggingFolder=!1,this.__self.bFavs.draggingFolderPrevName=null},_dragBookmarkFolder:function(t,e){BEM.create("wi-api-request",{apiPath:".favorites/folders/"+encodeURIComponent(t)+"/drag",path:"",method:"POST",data:{after:e},urlParams:!1}).run().then(this._onDragFolderSuccess.bind(this),BEM.blocks["wi-notification"].errorHandler())},_onDragFolderSuccess:function(){},_isEditable:function(){return this.__self.bFavs.bFolders.hasMod("mode","edited")&&this.hasMod("current","true")&&this.hasMod("type","custom")},_isDroppable:function(){return this.__self.bFavs.bFolders.hasMod("dragging","yes")&&!this.hasMod("current","true")&&!this.hasMod("type","auto")&&!this.hasMod("type","new-folder")},_onDragEnter:function(){return this._isDroppable()?(this.setMod("dragging","over"),!1):(!this.__self.bFavs.bFolders.hasMod("moving","yes")||this.__self.bFavs.draggingFolder===this)&&void 0},_onDragLeave:function(){return this._isDroppable()?(this.delMod("dragging"),!1):(!this.__self.bFavs.bFolders.hasMod("moving","yes")||this.__self.bFavs.draggingFolder===this)&&void 0},_onDragOver:function(t){return this._isDroppable()?(t.preventDefault(),!1):this.__self.bFavs.bFolders.hasMod("moving","yes")&&this.__self.bFavs.draggingFolder!==this?(t.preventDefault(),t.originalEvent.target.draggable&&(e=t.target.getBoundingClientRect(),i=(t.originalEvent.clientY-e.top)/(e.bottom-e.top)>.5,this.__self.bFavs.bFolders.elem("list")[0].insertBefore(this.__self.bFavs.draggingFolder.domElem[0],i&&t.originalEvent.target.nextSibling||t.originalEvent.target)),!1):void 0;var e,i},_onDrop:function(){var t,e;this._isDroppable()&&(e=(t=this.__self.bFavs.draggingLink).params.id,this.delMod("dragging"),this.__self.bFavs.isDropped=!0,t.setMod("mode","moving"),this._moveBookmark(e,this))},_moveBookmark:function(t,e){BEM.create("wi-api-request",{apiPath:".favorites/bookmarks/"+t+"/move",path:"",method:"POST",data:{target_folder_name:e.params.name},urlParams:!1}).run().then(this._onMoveSuccess.bind(this,e,t),this._onMoveError.bind(this))},_onMoveSuccess:function(t,e){var i=this;setTimeout((function(){i.__self.bFavs.draggingLink.domElem.hide(200),i.__self.bFavs.draggingLink=!1}),10),this.__self.bFavs.changeCurrentFolderCount(-1),this.__self.bFavs.changeFolderCount(t,1),this.__self.bFavs.removeLinkCacheFromCurrentFolder(e),this.__self.bFavs.clearLinksCache(t.params.name)},_onMoveError:function(t){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,null,t)),this.__self.bFavs.draggingLink.delMod("mode"),this.__self.bFavs.draggingLink=!1},_onRemoveClick:function(t){t.stopPropagation(),this.setMod("mode","removing"),BEM.create("wi-api-request",{apiPath:".favorites/folders/"+encodeURIComponent(this.params.name),path:"",method:"DELETE",urlParams:!1}).run().then(this._onRemoveSuccess.bind(this),BEM.blocks["wi-notification"].errorHandler(this.domElem,BEM.I18N("b-favs-folder","cant_delete_folder"))).always(function(){this.delMod("mode")}.bind(this))},_onRemoveSuccess:function(){var t=this.__self.bPage.findBlockInside("b-favs-folder");this.domElem.hide(300),this.__self.bFavs.changeFolderCount(t,this.params.count),this.__self.bFavs.clearLinksCache(this.params.name),this.__self.bFavs.clearLinksCache(t.params.name),this.__self.bFavs.currentFolder===this&&t.domElem.trigger("click")}},{live:function(){this.liveBindTo("name","click",(function(){this._onNameClick()})),this.liveBindTo("remove","click",(function(t){this._onRemoveClick(t)})),this.liveBindTo("click",(function(){this._onClick()})),this.liveBindTo("dragstart",(function(t){this._onDragStart(t)})),this.liveBindTo("dragend",(function(t){this._onDragEnd(t)})),this.liveBindTo("dragenter",(function(t){this._onDragEnter(t)})),this.liveBindTo("dragleave",(function(t){this._onDragLeave(t)})),this.liveBindTo("dragover",(function(t){this._onDragOver(t)})),this.liveBindTo("drop",(function(t){this._onDrop(t)}))}})},function(t,e){BEM.DOM.decl("b-favs-new-folder",{onSetMod:{js:function(){this.bPage=this.findBlockOutside("b-page"),this.bFavs=this.bPage.findBlockInside("b-favs")}},_onClick:function(){this.folderBlock=this.findBlockOn("b-favs-folder"),this.folderTitleElem=this.folderBlock.findElem("name"),BEM.DOM.after(this.folderTitleElem,BEMHTML.apply({block:"input",js:{autoFocus:"yes"},mods:{size:"s"},value:BEM.I18N("b-favs-new-folder","new_folder"),content:{elem:"control"}})),BEM.DOM.destruct(this.folderBlock.elem("name")),this.folderNameInput=this.findBlockInside("input"),this.folderNameInput.on("blur",this._closeInput,this),this.folderNameInput.bindTo("keypress",this._onInputKeypress.bind(this)),this.folderBlock.setMod("mode","edited"),this.folderNameInput.elem("control").focus()},_onInputKeypress:function(t){this.bFavs.bFolders.closeErrorPopup(),13===t.keyCode&&this.folderNameInput.elem("control").blur()},_closeInput:function(){var t=this.folderNameInput.val();this.setMod("mode","creating"),this._createNewFolder(t)},_createNewFolder:function(t){BEM.create("wi-api-request",{apiPath:".favorites/folders/"+encodeURIComponent(t),path:"",method:"PUT",urlParams:!1}).run().then(this._onCreateSuccess.bind(this,t),this._onCreateError.bind(this)).always(function(){this.delMod("mode")}.bind(this))},_onCreateSuccess:function(){this.bFavs.currentFolderIndex=this.bFavs.currentFolder.domElem.index(),this.bFavs.bFolders._getFolders()},_onCreateError:function(t){this.bFavs.bFolders.hasMod("mode","edited")&&BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(this.domElem,BEM.I18N("b-favs-new-folder","cant_create_folder"),t))}},{live:function(){this.liveBindTo("click",(function(t){this._onClick(t)}))}})},function(t,e){BEM.DOM.decl("b-favs-links",{onSetMod:{js:function(){this.bPage=this.findBlockOutside("b-page"),this.bFavs=this.bPage.findBlockInside("b-favs"),this.linksSpinner=this.findBlockInside("spin2"),this._filterInput=this.findBlockInside({block:"input",modName:"type",modVal:"filter"}).on("change",this._onFilterInputChange,this),this.initBlock()},mode:{edited:function(){this.findElem("item").attr("draggable","true")},"":function(){this.findElem("item").attr("draggable","false")}},"data-loaded":{yes:function(){this._filterInput.val("").elem("control").attr("placeholder",BEM.I18N("b-favs-links","search_in_folder")+" «"+this._getCurFolderName()+"»"),this.afterCurrentEvent((function(){this._filterInput.elem("control").focus()}),this)}}},initBlock:function(){this.getLinks({type:"favorites",name:this.bFavs.defaultFolderName[0]})},getLinks:function(t){var e=t.name;this._curFolder=t,this.delMod("data-loaded"),this.bFavs.linksCache[e]?this._showLinks(e):(this._showSpinner(),BEM.create("wi-api-request",{apiPath:".favorites/folders/"+encodeURIComponent(e),path:"",urlParams:["format=json"]}).run().then(this._onGotData.bind(this,e),BEM.blocks["wi-notification"].errorHandler()).always(function(){this._hideSpinner()}.bind(this)))},_onFilterInputChange:function(t){this._filterItems(t.block.val())},_filterItemsCore:function(t,e,i){var s=i.title.toLowerCase(),o=this.__self._getTranslit(s),n=i.url.toLowerCase();return this.__self._removableDomains.forEach((function(t){n=n.replace(t,"")})),-1!==s.indexOf(t)||-1!==s.indexOf(e)||-1!==o.indexOf(t)||-1!==n.indexOf(t)||-1!==n.indexOf(e)},_filterItems:function(t){var e=this._curFolder?this.bFavs.linksCache[this._curFolder.name]:null,i=e?e.data:null,s=t.toLowerCase(),o=this.__self._getTranslit(s);i?(BEM.DOM.update(this.elem("list"),BEMHTML.apply(this.__self.getLinksBEMJSON(i.filter(this._filterItemsCore.bind(this,s,o))))),this.hasMod("mode","edited")&&this.findElem("item").attr("draggable","true")):(this._showSpinner(),BEM.create("wi-api-request",{apiPath:".favorites/folders/"+encodeURIComponent(this._curFolder.name),path:"",urlParams:["format=json"]}).run().then(function(e){this.bFavs.linksCache[this._curFolder.name]={data:e.data,html:BEMHTML.apply(this.__self.getLinksBEMJSON(e.data))},this._filterItems(t)}.bind(this),BEM.blocks["wi-notification"].errorHandler()).always(function(){this._hideSpinner()}.bind(this)))},_onGotData:function(t,e){this.bFavs.linksCache[t]={data:e.data,html:BEMHTML.apply(this.__self.getLinksBEMJSON(e.data))},this._showLinks(t)},_showLinks:function(t){var e=this.bFavs.linksCache[t];e&&(BEM.DOM.update(this.elem("list"),this.bFavs.linksCache[t].html),e.data.length&&this.setMod("data-loaded","yes"),this.hasMod("mode","edited")&&this.findElem("item").attr("draggable","true"))},_showSpinner:function(){this.linksSpinner.setMod("show","yes"),this.linksSpinner.setMod("progress","yes"),this.elem("list").hide()},_hideSpinner:function(){this.linksSpinner.setMod("show","no"),this.linksSpinner.delMod("progress"),this.elem("list").show()},_getCurFolderName:function(){return"favorites"===this._curFolder.type?this.bFavs.defaultFolderName[1]:"autofolders"===this._curFolder.type?this.bFavs.autoFolders[this._curFolder.name]:this._curFolder.name}},{_getTranslit:function(t){var e,i={"а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","ё":"e","ж":"zh","з":"z","и":"i","й":"j","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"h","ц":"c","ч":"ch","ш":"sh","щ":"sh","ъ":"","ы":"y","ь":"","э":"e","ю":"yu","я":"ya",a:"а",b:"б",c:"с",d:"д",e:"е",f:"ф",g:"г",h:"х",i:"и",j:"ж",k:"к",l:"л",m:"м",n:"н",o:"о",p:"п",q:"к",r:"р",s:"с",t:"т",u:"у",v:"в",w:"в",x:"кс",y:"уай",z:"з"},s="";for(e=0;e<t.length;e++)s+=void 0!==i[t[e]]?i[t[e]]:t[e];return s},_removableDomains:[window.location.origin,"http://wiki.yandex-team.ru","https://wiki-unstable.dev.yandex-team.ru"],getLinksBEMJSON:function(t){var e=this,i=[];return t.forEach((function(t){var s=t.url;e._removableDomains.forEach((function(t){s=s.replace(t,"")}));var o={block:"b-favs-links",elem:"item",mix:[{block:"b-favs-link",js:{id:t.id}}],content:[{block:"b-favs-link",elem:"move",content:{block:"awesome-icon",mods:{icon:"ellipsis-v"}}},{block:"b-favs-link",elem:"title",content:{block:"link",url:t.url,content:t.title}},{block:"b-favs-link",elem:"url",content:s},{block:"b-favs-link",elem:"date",timestamp:t.page_modified_at},{block:"b-favs-link",elem:"remove",content:{block:"awesome-icon",mods:{icon:"remove"}}}]};i.push(o)})),i}})},function(t,e){BEM.DOM.decl("b-favs-link",{onSetMod:{js:function(){this.__self.bPage||(this.__self.bPage=this.findBlockOutside("b-page")),this.__self.bFavs||(this.__self.bFavs=this.__self.bPage.findBlockInside("b-favs"))},mode:{edited:function(){this.domElem.attr("draggable","false")},"":function(){this.__self.bFavs.bLinks.hasMod("mode","edited")&&this.domElem.attr("draggable","true")}}},_onClick:function(t){this.__self.bFavs.bLinks.hasMod("mode","edited")?(t.preventDefault(),this.linkTitle||this.bLink||(this.linkTitle=this.findElem("title"),this.bLink=this.findBlockInside("title","link"),this.linkText=this.bLink.domElem.text(),BEM.DOM.append(this.linkTitle,BEMHTML.apply({block:"input",js:{autoFocus:"yes"},mods:{size:"s"},value:this.linkText,content:{elem:"control"}})),this.linkInput=this.findBlockInside("title","input"),this.linkInput.on("blur",this._closeInput,this),this.linkInput.bindTo("keypress",this._onInputKeypress.bind(this))),this.setMod("mode","edited"),this.linkInput.elem("control").focus()):yaCounter&&yaCounter.reachGoal("from_bookmarks")},_onInputKeypress:function(t){13===t.keyCode&&this.linkInput.elem("control").blur()},_closeInput:function(){var t=this.linkInput.val();this.delMod("mode"),t&&t!==this.linkText&&(this.bLink.domElem.text(t),this._renameBookmark(t))},_renameBookmark:function(t){BEM.create("wi-api-request",{apiPath:".favorites/bookmarks/"+this.params.id,path:"",method:"POST",data:{title:t},urlParams:!1}).run().then(this._onRenameSuccess.bind(this,t,this.params.id),this._onRenameError.bind(this))},_onRenameSuccess:function(t,e){this.linkText=t,this.__self.bFavs.renameLinkInCurFolderCache(e,t)},_onRenameError:function(t){this.bLink.domElem.text(this.linkText),this.linkInput.val(this.linkText),BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(this.linkTitle,BEM.I18N("b-favs-link","cant_rename_link"),t))},_onRemoveClick:function(){this.setMod("mode","removing"),BEM.create("wi-api-request",{apiPath:".favorites/bookmarks/"+this.params.id,path:"",method:"DELETE",urlParams:!1}).run().then(this._onRemoveSuccess.bind(this,this.params.id),this._onRemoveError.bind(this))},_onRemoveSuccess:function(t){var e=this,i=this.getLocation(this.findBlockInside("link").domElem.attr("href"));setTimeout((function(){e.domElem.hide(300)}),10),this.__self.bFavs.removeLinkCacheFromCurrentFolder(t),this.__self.bFavs.changeCurrentFolderCount(-1),location.pathname+location.hash===i.pathname+i.hash&&BEM.WISTORE.get("page").set("isFav",!1)},_onRemoveError:function(t){this.delMod("mode"),BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(this.linkTitle,BEM.I18N("b-favs-link","cant_delete_link"),t))},getLocation:function(t){var e=document.createElement("a");return e.href=t,e},_getLinkPrevID:function(){return this.domElem.prev().length&&this.domElem.prev().bem("b-favs-link").params.id||null},_onDragStart:function(t){var e=t.originalEvent.dataTransfer;if(!this.__self.bFavs.bLinks.hasMod("mode","edited"))return!1;this.setMod("mode","dragging"),this.__self.bFavs.bLinks.setMod("dragging","yes"),this.__self.bFavs.bFolders.setMod("dragging","yes"),this.__self.bFavs.draggingLink=this,this.__self.bFavs.draggingLinkPrevID=this._getLinkPrevID(),e.setData("text/plain",""),e.effectAllowed="move",e.dropEffect="move"},_onDragEnd:function(t){var e=this.__self.bFavs.draggingLink.params.id,i=this._getLinkPrevID();t.preventDefault(),this.hasMod("mode","dragging")&&this.delMod("mode"),this.__self.bFavs.bFolders.delMod("dragging"),this.__self.bFavs.bLinks.delMod("dragging"),this.__self.bFavs.isDropped||(this.__self.bFavs.draggingLinkPrevID!==i&&this._dragBookmark(e,i),this.__self.bFavs.draggingLink=!1,this.__self.bFavs.draggingLinkPrevID=null),this.__self.bFavs.isDropped=!1},_onDragEnter:function(){if(this.__self.bFavs.draggingLink!==this)return!1},_onDragLeave:function(){if(this.__self.bFavs.draggingLink!==this)return!1},_onDragOver:function(t){var e,i;return t.preventDefault(),this.__self.bFavs.bLinks.hasMod("dragging","yes")&&this.__self.bFavs.draggingLink!==this&&(e=t.target.getBoundingClientRect(),(i=(t.originalEvent.clientY-e.top)/(e.bottom-e.top)>.5)&&!t.originalEvent.target.nextSibling&&this.__self.bFavs.bLinks.elem("list")[0].appendChild(this.__self.bFavs.draggingLink.domElem[0]),this.__self.bFavs.bLinks.elem("list")[0].insertBefore(this.__self.bFavs.draggingLink.domElem[0],i&&t.originalEvent.target.nextSibling||t.originalEvent.target)),!1},_dragBookmark:function(t,e){BEM.create("wi-api-request",{apiPath:".favorites/bookmarks/"+t+"/drag",path:"",method:"POST",data:{after:e},urlParams:!1}).run().then(this._onDragSuccess.bind(this,t,e),BEM.blocks["wi-notification"].errorHandler())},_onDragSuccess:function(t,e){this.__self.bFavs.moveLinkInCurrentFolderCache(t,e)}},{live:function(){this.liveBindTo("title","click",(function(t){this._onClick(t)})),this.liveBindTo("remove","click",(function(t){this._onRemoveClick(t)})),this.liveBindTo("dragstart",(function(t){this._onDragStart(t)})),this.liveBindTo("dragend",(function(t){this._onDragEnd(t)})),this.liveBindTo("dragenter",(function(t){this._onDragEnter(t)})),this.liveBindTo("dragleave",(function(t){this._onDragLeave(t)})),this.liveBindTo("dragover",(function(t){this._onDragOver(t)}))}})},function(t,e){BEM.DOM.decl("b-favs-options-button",{onSetMod:{js:function(){this.bPage=this.findBlockOutside("b-page"),this.bFavs=this.bPage.findBlockInside("b-favs"),this.editButton=this.findBlockOn("button2")},mode:{edited:function(){this.editButton.elem("text").text(BEM.I18N("b-favs-options-button","complete")),this.bFavs.currentFolder.hasMod("type","auto")||this.bFavs.bLinks.setMod("mode","edited"),this.bFavs.bFolders.setMod("mode","edited")},"":function(){this.editButton.elem("text").text(BEM.I18N("b-favs-options-button","settings")),this.bFavs.bLinks.delMod("mode"),this.bFavs.bFolders.delMod("mode")}}},_onClick:function(){this.toggleMod("mode","edited")}},{live:function(){this.liveBindTo("click",(function(t){this._onClick(t)}))}})},,function(t,e){BEM.DOM.decl({block:"m-suggest",modName:"type",modVal:"intranet-suggest"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.params.pathname&&(this._cluster=this.__self._getCluster(this.params.pathname)),this._requestSettings.url=this.params.url||"//search.yandex-team.ru/suggest/"}},_isNotEmptyResult:function(t){var e=!1;return Object.keys(t).forEach((function(i){t[i].length&&(e=!0)})),e||Boolean(this._cluster)},_getItemsHTML:function(t){var e,i,s=[],o=this,n=this.params.target,a="";return this._cluster&&(e=this._cluster.match(/\//g),s.push(this._getItemBEMJSON("cluster-search",{cluster:this._cluster,withoutFrom:!0,href:"//search.yandex-team.ru/wikisearch?text="+this._getInputValue4Request()+"&facet.cluster"+(e?e.length+1:1)+"="+this._cluster},!0))),Object.keys(t).forEach((function(e){if("meta"!==e){var r=e.replace("people","staff");(i=o._getItemTypeFromOptions(r)).maxCount&&(t[e]=t[e].slice(0,i.maxCount)),a=o.params.inHeader||o.params.inSearchHeader||"staff"===r?"":r,s.push({block:"m-suggest-group",groupLabel:a,content:$.map(t[e],(function(t){return n&&(t.target=n),o._getItemBEMJSON(r,t,!0)}))})}})),BEMHTML.apply(s)}},{_getCluster:function(t){var e,i=BEM.WISTORE.get("page");return i?i.get("superTag"):(e=decodeURIComponent(t)).substr(1,e.length-2)}})},,function(t,e){BEM.DOM.decl("i-explainer",{},{uniqueLinks:[],linksTree:{},explainLinks:function(t){var e=this;this.uniqueLinks=[],this.linksTree={},t.findBlocksInside("link").forEach((function(t){e._addLink(t)})),this._sendExplainLinksRequest()},explainAllLinks:function(t){var e=this;this.uniqueLinks=[],this.linksTree={},t.findBlocksInside({block:"wiki-ref",modName:"wiki",modVal:"yes"}).forEach((function(t){t.findBlockOn("wiki-ref").hasMod("file","yes")||e._addLink(t)})),t.findBlocksInside("wiki-action").forEach((function(t){t.findBlocksInside("link").forEach((function(t){e._addLink(t)}))})),this._sendExplainLinksRequest()},_addLink:function(t){var e=t.domElem.attr("data-link")||t.domElem.attr("href");e&&($.inArray(e,this.uniqueLinks)<0&&(this.uniqueLinks.push(e),this.linksTree[e]=[]),this.linksTree[e].push(t))},_sendExplainLinksRequest:function(){var t=BEM.WISTORE.get("page"),e={links:{}};e.links[t.get("superTag")]=this.uniqueLinks,this.uniqueLinks.length&&BEM.create("wi-api-request",{apiPath:".explainlinks",method:"POST",data:e,urlParams:!1,path:BEM.blocks["wi-history"].getCorrectPath()}).run().then(this._onExplainLinksSuccess.bind(this),BEM.blocks["wi-notification"].errorHandler())},_onExplainLinksSuccess:function(t){var e=this,i=t.data.links,s=function(t){i.hasOwnProperty(t)&&t in e.linksTree&&e.linksTree[t].forEach((function(e){var s,o;-1!==i[t]&&0!==i[t]||BEM.DOM.prepend(e.domElem,BEMHTML.apply({block:"awesome-icon",mods:{icon:-1===i[t]?"plus-circle":"lock",explainer:"yes"}})),-1===i[t]&&(o=(s=BEM.blocks["wi-history"].parseURL(e.domElem.attr("href"))).breadcrumbs.length?s.breadcrumbs.pop():"",e.domElem.attr("href",BEM.blocks["wi-history"].formURL({pathname:s.path,handler:".create",search:{title:this._getLinkTitle(e,o)}})))}),e)};for(var o in i)s(o)},_getLinkTitle:function(t,e){var i=t.domElem.text();return t.domElem.attr("href")===i?_.escape(e):_.escape(i)}})},function(t,e){BEM.DOM.decl("w-notifier",{onSetMod:{js:function(){this.__base.apply(this,arguments),this.delMod("hidden")}},_onCloseFail:function(t){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,null,t))}})},function(t,e){BEM.DOM.decl({block:"b-toc",modName:"type",modVal:"sidebar"},{onSetMod:{js:function(){this.on("ready",(function(){this.channel("sidebar").trigger("tab:ready")})),this.__base.apply(this,arguments)}},_onTocGetData:function(){this.__base.apply(this,arguments),this.bindTo(this.findBlockInside("wiki-toc").domElem,"click",(function(t){t.target.classList.contains("b-link")&&yaCounter&&yaCounter.reachGoal("tocitem_click")}))}},{})},function(t,e){BEM.DOM.decl({block:"wiki-toc",modName:"type",modVal:"sidebar"},{_getWikiDoc:function(){var t=this.findBlockOutside("b-page").findBlockInside({block:"wiki-doc",modName:"status",modVal:"main"});return t||this.__base.apply(this,arguments)}})},,function(t,e){BEM.DOM.decl({block:"popup2",modName:"hiding",modVal:"yes"},{_calcIsAnchorVisible:function(){return!0}})},,,function(t,e){function i(t,e,i,s,o,n,a){try{var r=t[n](a),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(s,o)}function s(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return o(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return o(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}BEM.DOM.decl({block:"w-translate-content",modName:"type",modVal:"article"},{_resetTranslate:function(t){var e=BEM.WISTORE.get("page").get("withNewWf")?".raw":".bemjson";this.hasMod("lang-selected")&&!this.hasMod("progress")&&(this.setMod("progress","yes"),BEM.create("wi-api-request",{apiPath:e,method:"GET",urlParams:!1,path:"/"+this.params.supertag}).run().then(this._onSuccessSkipTranslate.bind(this,t),this._onErrorSkipTranslate.bind(this)).always(function(){this.delMod("progress")}.bind(this)))},_processContentResult:function(t){var e=$(t[0].text[0]);return e.attr("data-wf",this._wfAttr),[Object.assign({},t[0],{text:[e[0].outerHTML].concat(s(t[0].text.slice(1)))}),t.slice(1)]},_request:function(t){var e,s=this;return(e=regeneratorRuntime.mark((function e(){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=$,e.next=3,s._bPage.getContentHTML();case 3:return e.t1=e.sent,i=(0,e.t0)(e.t1),s._wfAttr=i.attr("data-wf"),i.attr("data-wf",""),i=i[0].outerHTML,e.abrupt("return",$.when($.ajax({type:"POST",url:BEM.blocks["i-global"].param("hosts").translateApi,data:{format:"html",text:i,lang:t}}),$.ajax({type:"GET",url:BEM.blocks["i-global"].param("hosts").translateApi,data:{format:"plain",text:s._bPage.findBlockInside("b-page-title").domElem.html(),lang:t}})).then((function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return e})));case 9:case"end":return e.stop()}}),e)})),function(){var t=this,s=arguments;return new Promise((function(o,n){var a=e.apply(t,s);function r(t){i(a,o,n,r,l,"next",t)}function l(t){i(a,o,n,r,l,"throw",t)}r(void 0)}))})()},_updateContent:function(t,e){this.channel("content").trigger("update",{data:{title:e[0].text[0],html:t[0].text[0]}})}})},,,,,,,function(t,e){BEM.DOM.decl({block:"checkbox",modName:"assigned",modVal:"form"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.params.required&&this.findBlockOutside("b-wiki-form")._requiredFields.push(this)}}})},function(t,e){BEM.DOM.decl("w-access-button",{},{live:function(){this.liveBindTo("click",(function(){BEM.channel("common").trigger("w-action.create-access")}))}})},,function(t,e){BEM.DOM.decl({block:"w-action",modName:"type",modVal:"access"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.params&&this.params.isAction||BEM.channel("common").on("w-action.create-access",this._run,this)}},_onGetAccessData:function(t,e){this._accessWidget=BEM.DOM.append(BEM.DOM.scope,BEMHTML.apply({block:"b-widget",mods:{type:"page-access"},user:e.user,data:e.data})).bem("b-widget").on("access-change",this._onAccessChange,this),this._accessWidget.show(),this._pushState(t,".access")},_onAccessChange:function(t,e){BEM.WISTORE.get("page").set("access",e)},destruct:function(){BEM.channel("common").un("w-action.create-access"),this.__base.apply(this,arguments)},_run:function(t,e){var i=this.__base.apply(this,arguments);i&&(this.__self._isNewTabClick(t)?window.open(BEM.blocks["wi-history"].getCorrectPath()+".access","_blank").focus():this._accessWidget?(this._accessWidget.show(),this._pushState(e,".access")):(this.setMod("progress","yes"),BEM.create("wi-api-request",{apiPath:".access",method:"GET",data:!1,urlParams:!1,path:BEM.blocks["wi-history"].getCorrectPath()}).run().then(this._onGetAccessData.bind(this,e),BEM.blocks["wi-notification"].errorHandler(null,BEM.I18N("w-access-button","cant_get_data"))).always(function(){this.delMod("progress")}.bind(this))))}})},,function(t,e){BEM.DOM.decl({block:"input",modName:"assigned",modVal:"form"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.params.required&&this.findBlockOutside("b-wiki-form")._requiredFields.push(this)},focused:{yes:function(){this.__base.apply(this,arguments),this._parentField||(this._parentField=this.findBlockOutside("b-wiki-form-field")),this._parentField.errorMessage&&(this.elem("control").on("input.formerror",function(){this._parentField.errorMessage=null,this._parentField.delMod("validation"),this.channel("errors").trigger("errorHide"),this.elem("control").off("input.formerror")}.bind(this)),BEM.channel("wiki-form").trigger("error",{text:this._parentField.errorMessage,node:this._parentField}))}}}})},,,function(t,e){BEM.DOM.decl({block:"m-replacer",modName:"type",modVal:"page-title"},{onSetMod:{js:function(){this.__base.apply(this,arguments),BEM.channel("common").on("update",(function(t,e){"page-title"===e.type&&(this.elem("text").text(e.data),this.elem("field").length&&this.elem("field").val(e.data))}),this)}}})},function(t,e){BEM.DOM.decl({block:"editor-help",modName:"type",modVal:"sidebar"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.afterCurrentEvent((function(){this.channel("sidebar").trigger("tab:ready")}))}}},{})},function(t,e){BEM.DOM.decl({block:"b-cluster-tree",modName:"type",modVal:"sidebar"},{onSetMod:{js:function(){this.on("ready",(function(){this.channel("sidebar").trigger("tab:ready")})),this.__base.apply(this,arguments)}}})},,,function(t,e){BEM.DOM.decl({block:"b-events-log",modName:"type",modVal:"sidebar"},{onSetMod:{js:function(){this.on("ready",(function(){this.channel("sidebar").trigger("tab:ready")})),this.__base.apply(this,arguments)}}},{})},,function(t,e){BEM.DOM.decl({block:"w-attachments",modName:"type",modVal:"sidebar"},{onSetMod:{js:function(){this.on("ready",(function(){this.channel("sidebar").trigger("tab:ready")})),this.__base.apply(this,arguments)}}},{})},function(t,e){BEM.DOM.decl("w-attach",{onSetMod:{dragable:{yes:function(){this.bindTo("dragstart",this._onDragStart.bind(this)).bindTo("dragend",this._onDragEnd.bind(this)).domElem.attr("draggable","true")},"":function(){this.domElem&&this.unbindFrom("dragstart",this._onDragStart,this).unbindFrom("dragend",this._onDragEnd,this).domElem.attr("dragable","")}}},_onDragStart:function(t){var e=t.originalEvent.dataTransfer,i=this._attachWfUrl;return this.setMod("dragging","yes"),e.setData("text/plain","file:"+i),e.setDragImage(this.elem("attach-name").get(0),-10,15),!0},_onDragEnd:function(){this.setMod("dragging","")}},{})},function(t,e){BEM.DOM.decl({block:"b-grid-table-code",modName:"type",modVal:"sidebar"},{onSetMod:{js:function(){this.findBlockInside("b-grid-table-code-form").on("ready",(function(){this.channel("sidebar").trigger("tab:ready")}),this),this.__base.apply(this,arguments)}}},{})},function(t,e){BEM.DOM.decl("b-grid-table-settings",{onSetMod:{js:function(){this.on("ready",(function(){this.channel("sidebar").trigger("tab:ready")}),this),this.__base.apply(this,arguments)}}})},function(t,e){function i(t,e,i,s,o,n,a){try{var r=t[n](a),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(s,o)}function s(t){return function(){var e=this,s=arguments;return new Promise((function(o,n){var a=t.apply(e,s);function r(t){i(a,o,n,r,l,"next",t)}function l(t){i(a,o,n,r,l,"throw",t)}r(void 0)}))}}BEM.DOM.decl({block:"b-grid-table-cell",modName:"type",modVal:"string"},{val:function(){var t;if(this.__base.apply(this,arguments))return t=this._textarea.val(),t.length?t:null},_initBlock:function(){if(this.__base.apply(this,arguments),!this._storage._table.hasMod("mode","edit")||this.hasMod("state","edit")||this.hasMod("saving","yes"))return!1;this._setEdit()},_onSaved:function(t,e){var i=arguments,o=this;return s(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o.__base.apply(o,i),BEM.DOM.destruct(o.findElem("i")),t.t0=BEM.DOM,t.t1=o.domElem,t.t2=BEMHTML,t.next=7,BEM.blocks["b-grid-table"].getStringBEMJSON(e.data.cell,o._storage._table.domElem,o._storage._table.params.supertag);case 7:t.t3=t.sent,t.t4=t.t2.apply.call(t.t2,t.t3),t.t0.prepend.call(t.t0,t.t1,t.t4),Ya.FormatterViewPort.BEM.DOM.init(self.domElem),o._timeEndCellEditSave();case 12:case"end":return t.stop()}}),t)})))()},_setEdit:function(){this._textarea||(BEM.DOM.append(this.domElem,this._getTextarea()),this._textarea=this.findBlockInside("input"),this._textarea.val(this.params.raw||"")),this.__base.apply(this,arguments),this.afterCurrentEvent((function(){this._textarea.setMod("focused","yes").elem("control").select(),this._timeEndCellEditStart()}))},_getTextarea:function(){return BEMHTML.apply({block:"input",mods:{type:"textarea",size:"s"},content:{elem:"control"}})},_resizeEdit:function(){this._textarea.domElem.width(this._sizes.outerWidth+1),this._textarea.elem("control").height(this._sizes.outerHeight-1)},_clearSize:function(){this._textarea.elem("box").width(""),this._textarea.elem("control").height(""),this.__base.apply(this,arguments)},_save:function(){var t=this.__base.apply(this,arguments);t.val=this.val(),t.val!==this.params.raw?this.setMod("saving","yes").trigger("save",t):(this.delMod("state"),this._clearSize())},_resetValue:function(){!1!==this.__base.apply(this,arguments)&&this.val()!==this.params.raw&&this._textarea.val(this.params.raw)}})},,function(t,e){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}BEM.DOM.decl({block:"m-suggest",modName:"type",modVal:"intranet-v2"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._requestSettings={type:this.__self.REQUEST_TYPE,url:BEM.blocks["i-global"].param("hosts").suggest.url,crossDomain:!0,xhrFields:{withCredentials:!0},dataType:"json",timeout:this.__self.REQUEST_TIMEOUT},this._layers=[],this.params.types.forEach((function(t){"object"===i(t)?this._layers.push(t.name):this._layers.push(t)}),this)}},_isNotEmptyResult:function(t){var e=!1;return this._layers.forEach((function(i){t[i]&&t[i].result.length&&(e=!0)})),e},_prepareRequestData:function(t){return $.extend({},this._requestSettings,{data:$.extend({text:t,layers:this._layers.join(),language:BEM.I18N.lang(),version:2},this.params.addRequestParams)})},_getItemsHTML:function(t){var e=this._layers.filter((function(e){return t[e]&&t[e].result.length>0})).map((function(e){var i=this._getItemTypeFromOptions(e),s="";return this.params.hideHeader||this.params.inSearchHeader||"people"===e||(s=e),{block:"m-suggest-group",groupLabel:s.replace("people","staff").replace("groups","group"),content:t[e].result.map((function(t){return t.valueField=i.valueField||null,this._getItemBEMJSON(e,t)}),this)}}),this);return BEMHTML.apply(e)},_selectItem:function(t){this.val(t,!0),this.__base.apply(this,arguments),this._items[this._curItemIndex]&&this._items[this._curItemIndex].delMod("hovered"),this._curItemIndex=-1,this._popup.delMod("visible");var e=t.params.fullData;e&&e.click_urls&&e.click_urls.forEach((function(t){document.createElement("img").setAttribute("src",t)}))}})},function(t,e){BEM.WISTORE.decl("application",{action:"string",view:"string",debug:"boolean",contentLoaded:"boolean",sidebar:"string"},{})},function(t,e){BEM.WISTORE.decl("session",{sidebarState:{type:"string",def:"close"},sidebarTab:"string"},{})},function(t,e){BEM.DOM.decl("wiki-session",{onSetMod:{js:function(){this._onSessionChangeDebounce=$.debounce(this._onSessionChange,100,this),BEM.WISTORE.get("session")&&BEM.WISTORE.get("session").on("change",this._onSessionChangeDebounce,this)}},destruct:function(){BEM.WISTORE.get("session").off("change",this._onSessionChangeDebounce,this),this.__base.apply(this,arguments)},_onSessionChange:function(t){var e=t.attributes;Object.keys(e).forEach((function(t){e[t]?$.cookie("w-"+t,e[t],{path:"/"}):$.cookie("w-"+t,null,{path:"/"})}))}},{})},function(t,e){BEM.DOM.decl({block:"scroll",modName:"tech",modVal:"js"},{onSetMod:{js:{inited:function(){this._setAllElems(),this._setSizes(),this._bindToContentChange(),this._bindToScroll(),this._correctSelectedScrollPosition(),this.bindToWin("resize",this._setSizes),this.cursorLossTimerPull={horizontal:[],vertical:[]},this.sizes={content:{}}}}},getDefaultParams:function(){return{minThumbSize:30,cursorLossTimer:1e3,stick:{step:400,timer:200,delay:200}}},getContentElem:function(){return this.elems.content},cursorLossTimerPull:null,stickScrollMouseup:!1,_setLossTimer:function(t,e){this.cursorLossTimerPull[t].push(e)},_clearAllLossTimers:function(t){this.cursorLossTimerPull[t]=this.cursorLossTimerPull[t].filter((function(t){return clearTimeout(t),!1}))},_setSizes:function(){this.dim=this._getDimensions(),this._setCorrectSize(),this._setTracksSize(),this._setThumbsSize(),this._setThumbsPositions()},_setNewSizes:function(){(this._isContentSizeChanged()||this._isThumbsSizeChanged())&&this._setSizes()},_isContentSizeChanged:function(){var t=this.elems.content,e=this.sizes.content,i=t.width(),s=t.height();return e.width&&e.height?!(e.width===i&&e.height===s)&&(e.width=i,e.height=s,!0):(e.width=i,e.height=s,!1)},_isThumbsSizeChanged:function(){var t=this.dim.content,e=this.elems.nativeElem[0],i=this.dim.scroll.horizontal,s=this.dim.scroll.vertical;return s.thumbHeight!==this._calcThumbSize("vertical",t.visibleHeight,s.height,e.scrollHeight)||i.thumbWidth!==this._calcThumbSize("horizontal",t.visibleWidth,i.width,e.scrollWidth)},_bindToContentChange:function(){var t=this._setNewSizes.bind(this),e=this.channel("sys").on({tick:t,idle:function(){e.un("tick",t)},wakeup:function(){e.on("tick",t)}})},_getDimensions:function(){return{content:{visibleWidth:this.domElem.width(),visibleHeight:this.domElem.height()},scroll:{horizontal:{},vertical:{}}}},_setAllElems:function(){this.elems={nativeElem:this._getElem("native"),content:this._getElem("content"),track:{horizontal:this._getElem("track","orientation","horizontal"),vertical:this._getElem("track","orientation","vertical")},thumb:{horizontal:this._getElem("thumb","orientation","horizontal"),vertical:this._getElem("thumb","orientation","vertical")}}},_getElem:function(t,e,i){var s=this.buildSelector(),o=this.domElem;return this.elem(t,e,i).filter((function(){return o.index($(this).closest(s))>-1}))},_setTracksSize:function(){var t=this.dim.scroll,e=this.elems.track;t.horizontal.width=e.horizontal.width(),t.vertical.height=e.vertical.height()},_getCorrect:function(){var t=this.elems.nativeElem;return{right:t.width()-t[0].clientWidth,bottom:t.height()-t[0].clientHeight+parseInt(t.css("padding-bottom"),10)}},_setCorrectSize:function(){var t=this.elems.nativeElem,e=this._getCorrect();t.css({"margin-right":-e.right,"margin-bottom":-e.bottom}),this.getMod("elastic-height","yes")&&"yes"!==this.getMod("page")||t.css("padding-bottom",e.bottom),this.elems.content.css("width","").css("width",t[0].scrollWidth)},_setThumbsSize:function(){var t=this.dim.scroll.horizontal,e=this.dim.scroll.vertical,i=this.dim.content,s=this.elems.nativeElem[0],o={orientation:"horizontal",property:"width",realVisibleSizeName:"realVisibleWidth",thumbSize:t.thumbWidth,visibleSize:i.visibleWidth,scrollSize:t.width,contentSize:s.scrollWidth,realVisibleSize:i.realVisibleWidth},n={orientation:"vertical",property:"height",realVisibleSizeName:"realVisibleHeight",thumbSize:e.thumbHeight,visibleSize:i.visibleHeight,scrollSize:e.height,contentSize:s.scrollHeight,realVisibleSize:i.realVisibleHeight};t.thumbWidth=this._setThumbSize(o,i),e.thumbHeight=this._setThumbSize(n,i),0===e.thumbHeight&&this._setThumbSize(o,i),0!==t.thumbWidth&&0!==e.thumbHeight&&this._delSingleMod()},_setThumbSize:function(t,e){var i=this._calcThumbSize(t.orientation,t.visibleSize,t.scrollSize,t.contentSize);return 0===i&&this._setSingleMod("horizontal"===t.orientation?"vertical":"horizontal"),this.elems.thumb[t.orientation].css(t.property,i),e[t.realVisibleSizeName]=this._calcRealVisibleContentSize(t.contentSize,i,t.scrollSize),i},_calcThumbSize:function(t,e,i,s){var o=e*i/s,n=this.params.minThumbSize;return o>=i?0:(this.dim.scroll[t].realThumbSize=o,o>0&&o<n?n:o)},_calcRealVisibleContentSize:function(t,e,i){return t*e/i},_setSingleMod:function(t){this.setMod("single",t),this._setTracksSize()},_delSingleMod:function(){this.delMod("single"),this._setTracksSize()},_bindToScroll:function(){return this.bindTo("native","scroll",$.throttle(this._setThumbsPositions,30)),this},_correctSelectedScrollPosition:function(){this.bindToDoc("mouseup",(function(){var t=this.domElem;(t.scrollTop()>0||t.scrollLeft()>0)&&t.animate({scrollTop:0,scrollLeft:0},50)}))},_unbindFromScroll:function(){return this.unbindFrom("native","scroll"),this},_setThumbsPositions:function(){var t=this.elems.nativeElem,e=this.dim.scroll;this.elems.thumb.horizontal.css({left:this._calcThumbPosition(t.scrollLeft(),e.horizontal.width,t[0].scrollWidth,e.horizontal.thumbWidth,e.horizontal.realThumbSize)}),this.elems.thumb.vertical.css({top:this._calcThumbPosition(t.scrollTop(),e.vertical.height,t[0].scrollHeight,e.vertical.thumbHeight,e.vertical.realThumbSize)})},_calcThumbPosition:function(t,e,i,s,o){return this._calcCorrectThumbPosition(t*e/i,e,s,o)},_calcCorrectThumbPosition:function(t,e,i,s){return t*(e-i)/(e-s)},_calcScrollPosition:function(t,e,i,s,o){return this._calcCorrectScrollPosition(t*e/i,t,s,o)},_calcCorrectScrollPosition:function(t,e,i,s){return t*(e-i)/(e-s)},_setThumbPosition:function(t,e){var i=e.scroll,s=e.position,o=e.content,n=this.elems.nativeElem[0],a="horizontal"===t?{scrollSize:i.horizontal.width,thumbSize:i.horizontal.thumbWidth,thumbPos:s.thumb.left,contentSize:n.scrollWidth,visibleSize:o.visibleWidth,realVisibleSize:o.realVisibleWidth,clientPos:e.e.clientX,posStart:s.start.x,thumb:e.thumb,side:"left",scrollMethod:"scrollLeft"}:{scrollSize:i.vertical.height,thumbSize:i.vertical.thumbHeight,thumbPos:s.thumb.top,contentSize:n.scrollHeight,visibleSize:o.visibleHeight,realVisibleSize:o.realVisibleHeight,clientPos:e.e.clientY,posStart:s.start.y,thumb:e.thumb,side:"top",scrollMethod:"scrollTop"},r=Math.min(Math.max(a.thumbPos+a.clientPos-a.posStart,0),a.scrollSize-a.thumbSize);a.thumb.css(a.side,r),this.elems.nativeElem[a.scrollMethod](this._calcScrollPosition(a.contentSize,r,a.scrollSize,a.visibleSize,a.realVisibleSize))},_getTrackOfThumb:function(t,e){return this.elems.track[e||this._getTargetOrientation(t)]},_getTargetOrientation:function(t){return this.getMod($(t.target),"orientation")},_getTargetScrollPosition:function(t,e,i,s){return(t-e)*i/s},_getOneStepScrollPosition:function(t,e){return t+this.params.stick.step*(e>t?1:-1)},_getStickAnimateDuration:function(t,e){return Math.abs(e-t)/this.params.stick.step*this.params.stick.timer},_setStickScrollPosition:function(t,e){"horizontal"===t?this._setScrollPosition({that:e.that,nativeElem:e.nativeElem,property:"scrollLeft",startScrollPosition:e.nativeElem.scrollLeft(),clientPos:e.e.pageX,trackOffset:e.trackOffset.left,contentSize:e.nativeElem[0].scrollWidth,scrollSize:this.dim.scroll.horizontal.width}):this._setScrollPosition({that:e.that,nativeElem:e.nativeElem,property:"scrollTop",startScrollPosition:e.nativeElem.scrollTop(),clientPos:e.e.pageY,trackOffset:e.trackOffset.top,contentSize:e.nativeElem[0].scrollHeight,scrollSize:this.dim.scroll.vertical.height})},_setScrollPosition:function(t){var e=this,i=this._getTargetScrollPosition(t.clientPos,t.trackOffset,t.contentSize,t.scrollSize),s=this.params.stick,o={first:{},full:{}};o.first[t.property]=this._getOneStepScrollPosition(t.startScrollPosition,i),o.full[t.property]=i,t.nativeElem.animate(o.first,s.timer,(function(){this.stickScrollMouseup||t.nativeElem.delay(s.delay).animate(o.full,{step:function(){e.stickScrollMouseup&&t.nativeElem.stop()}},t.that._getStickAnimateDuration(t.startScrollPosition,i))}))},_onThumbMousedown:function(t){if(1===t.which){var e=$(t.target),i={x:t.clientX,y:t.clientY},s=e.position(),o=this.getMod(e,"orientation"),n=this.dim.scroll,a=this.dim.content,r=!1;this.setMod("dragged","yes")._unbindFromScroll().bindToDoc("mousemove",$.throttle((function(t){r||this._setThumbPosition(o,{e:t,thumb:e,scroll:n,content:a,position:{start:i,thumb:s}})}),30)).bindToDoc("mouseup",(function(){r=!0,this.delMod("dragged").unbindFromDoc("mousemove")._bindToScroll()})),t.preventDefault(),t.stopPropagation()}},_onTrackMousedown:function(t){if(1===t.which){var e=$(t.target);this.getMod(e,"hovered","yes")&&(this.stickScrollMouseup=!1,this.bindToDoc("mouseup",(function(){this.stickScrollMouseup=!0})),this._setStickScrollPosition(this._getTargetOrientation(t),{that:this,nativeElem:this.elems.nativeElem,e:t,trackOffset:e.offset()}),t.preventDefault())}}},{live:function(){return this.liveBindTo("thumb","mouseover",(function(t){var e=this._getTargetOrientation(t);this._clearAllLossTimers(e),this.setMod(this._getTrackOfThumb(t,e),"hovered","yes")})).liveBindTo("track thumb","mouseout",(function(t){var e=this,i=this._getTargetOrientation(t);this._setLossTimer(i,setTimeout((function(){e.delMod(e._getTrackOfThumb(t,i),"hovered")}),this.params.cursorLossTimer))})).liveBindTo("track","mouseover",(function(t){this._clearAllLossTimers(this._getTargetOrientation(t))})).liveBindTo("thumb","mousedown",(function(t){this._onThumbMousedown(t)})).liveBindTo("track","mousedown",(function(t){this._onTrackMousedown(t)})),!1}})},function(t,e){BEM.DOM.decl({block:"scroll",modName:"page",modVal:"yes"},{onSetMod:{js:{inited:function(){this._setSingleMod(),this.__base()}}},_setSingleMod:function(){$("html").css("height","100%"),BEM.DOM.scope.css({height:"100%",padding:0,margin:0,overflow:"hidden"})}})},,function(t,e){BEM.DOM.decl({block:"wf-ref",modName:"type",modVal:"docviewer"},{onSetMod:{js:{inited:function(){this.params=this.domElem.data("wf"),this.bindTo(this.domElem,"click",this._docviewerTrigger)}}},_docviewerTrigger:function(t){t.preventDefault();var e=this.__self._getPopup(this,this.params),i=this;e._anchor===this.domElem?e.toggleMod("visible","yes",""):e.hasMod("visible","yes")?(e.on("afterClose",(function(){e.setAnchor(i).un("afterClose"),setTimeout((function(){e.setMod("visible","yes")}),0)})),e.delMod("visible")):(e.setAnchor(i),setTimeout((function(){e.setMod("visible","yes")}),0))}},{_getPopup:function(t,e){return this._popup?(this._popupDownloadLink.attr("href",e.url),this._popupViewLink.attr("href",e.docviewer)):(this._popup=BEM.DOM.append(t.domElem,BEMHTML.apply(this._getPopupBEMJSON(e))).bem("popup2"),this._popupDownloadLink=this._popup.findBlockInside({block:"link",modName:"role",modVal:"download"}).domElem,this._popupViewLink=this._popup.findBlockInside({block:"link",modName:"role",modVal:"view"}).domElem),this._popup},_getPopupBEMJSON:function(t){return{block:"popup2",mods:{target:"anchor",theme:"normal",autoclosable:"yes",role:"docviewer"},hasTail:!0,directions:["right-center","right-top","right-bottom","bottom-right","bottom-center","bottom-left"],content:{elem:"content",content:[{block:"link",mods:{theme:"normal",role:"download"},url:t.url,text:BEM.I18N("wf-ref","download"),target:"_blank"},{block:"link",mods:{theme:"normal",role:"view"},url:t.docviewer,text:BEM.I18N("wf-ref","view"),target:"_blank"}]}}}})},function(t,e){BEM.DOM.decl({block:"b-widget",modName:"type",modVal:"request-access"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.show()}}})},,,function(t,e){BEM.DOM.decl({block:"w-page-setting",modName:"type",modVal:"redirect"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._title=BEM.I18N("w-page-setting","setup-redirect"),this._data||(this._data="")},progress:function(t,e){this.__base.apply(this,arguments),this._suggest.setMod("disabled","yes"===e?"yes":""),this._setClusterButton.setMod("disabled","yes"===e||this._data===this._suggest.val()?"yes":"")},active:function(t,e){this.__base.apply(this,arguments),"yes"===e&&this._suggest.val(this._data)}},_initBlocks:function(){this.__base.apply(this,arguments),this._suggest=this.findBlockInside("m-suggest").on("change",this._onInputChange,this),this._setClusterButton=this.findBlockInside("button2").on("click",this._setCluster,this)},_onInputChange:function(t){this._setClusterButton.setMod("disabled",t.block.val()===this._data?"yes":"")},_setCluster:function(){var t=this._suggest.val(),e={apiPath:".redirect",method:t?"POST":"DELETE",path:this.params.path,urlParams:!1};t&&(e.data={redirect_to_tag:t}),this.setMod("progress","yes"),BEM.create("wi-api-request",e).run().then(this._onDataSave.bind(this,t),this._onDataSaveError.bind(this))},_onDataSave:function(t){this._data=t,this.delMod("progress"),BEM.DOM.update(this.findElem("data-preview"),t||BEM.I18N("w-page-setting","no-redirect")),this.trigger("change")},_onDataSaveError:function(t){this.delMod("progress"),BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(this._setClusterButton.domElem,null,t))}})},,function(t,e){BEM.DOM.decl({block:"w-page-setting",modName:"readonly",modVal:"yes"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.unbindFrom("click")}}})},function(t,e,i){BEM.DOM.decl({block:"b-widget",modName:"type",modVal:"page-copy"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._copyDataCheckbox=this.findBlockInside({block:"checkbox",modName:"type",modVal:"copy-data"}),this._renameCheckbox=this.findBlockInside({block:"checkbox",modName:"type",modVal:"page-title"}).on("change",this._onRenameCheckboxChange,this),this._pageRenameInput=this.findBlockInside({block:"input",modName:"type",modVal:"page-title"}).on("change",this._onRenameInputChange,this),this._suggest=this.findBlockInside({block:"m-suggest"}),this._copyButton=this.findBlockInside({block:"button2",modName:"role",modVal:"copy-cluster"}),this._cancelButton=this.findBlockInside({block:"button2",modName:"role",modVal:"copy-cluster-cancel"}),this._spin=this.findBlockInside({block:"spin2",modName:"type",modVal:"copy-load"}),this.on("show",this._onWidgetShow,this),this._cancelButton.on("click",this._onCancelClick,this),this._copyButton.on("click",this._onCopyButtonClick,this)},progress:function(t,e){this._spin.setMod("progress",e),this._copyButton.setMod("disabled",e),this._cancelButton.setMod("disabled",e)}},_onCancelClick:function(){this.hide()},_onRenameInputChange:function(){var t=this._newUrl.split("/"),e=this._pageRenameInput.elem("control").val();t.pop(),this.pageSlug=e,-1!==e.indexOf("/")&&(this.pageSlug=e.replace(/\//g,""),this._pageRenameInput.elem("control").val(this.pageSlug)),this._newUrl=t.concat(this.pageSlug).join("/"),this.elem("new-url-page").text(this._newUrl)},_onRenameCheckboxChange:function(t,e){e.checked?(this.setMod("page-title","visible"),this._pageRenameInput.val(this._pageName.slice(1))):(this.delMod("page-title"),this.elem("new-url-page").html(this._pageName),this._newUrl=this._pageName)},_onCopyButtonClick:function(){var t;this._copiedUrl?(t=this._copiedUrl,"/"===this._copiedUrl.slice(-1)?t+=this._newUrl.substr(1):t+=this._newUrl):t=this._newUrl,t=this.__self._cutUnusedSlashes(t),this.setMod("progress","yes");var e="grid"===this.params.type;BEM.create("wi-api-request",{apiPath:e?".grid/clone":".clone",method:"POST",data:Object.assign({destination:t},e?{with_data:this._copyDataCheckbox&&this._copyDataCheckbox.isChecked()}:{}),urlParams:!1,path:this.params.ajaxPath}).run().then(this._onPageCopy.bind(this,t),BEM.blocks["wi-notification"].errorHandler(this._copyButton.domElem,BEM.I18N("b-widget","cant_copy_cluster"))).always(function(){this.delMod("progress")}.bind(this))},_onWidgetShow:function(){this._fillWidgetWithData(),this._setNewPageHTML(),this._clusterPath=this._getClusterPath(),this._newUrl=this.pageSlug,this._pageName=this.pageSlug,this._copiedUrl=this._clusterPath,this._suggest.val(this._clusterPath),this.elem("new-url-page").html(this.pageSlug)},_getClusterPath:function(){var t=this.tag.split("/");return t.pop(),t.join("/")},_onPageCopy:function(t){location.href=t},_fillWidgetWithData:function(){this.tag="/"+BEM.WISTORE.get("page").get("tag"),this.splitedSupertag=this.tag.split("/"),this.params.isAction&&this.params.source&&(this.tag=this.params.source),this.pageSlug="/"+this.splitedSupertag.pop(),this.elem("current-address-url").html(location.host+this.tag+"/"),this.elem("new-url").html(location.host+this.splitedSupertag.join("/"))},_setNewPageHTML:function(){this._pageName="",this._clusterPath="",this._suggest.on("select change",(function(t,e){this._updateNewUrl("select"===t.type?e.entityData.tag:this.__self._urlJoin("/",e))}),this)},_updateNewUrl:function(t){"/"!==t&&this.elem("new-url").html(location.host+t),this._copiedUrl=t}},{_urlJoin:i(72),_cutUnusedSlashes:function(t){var e;return/(http?\w+:).+/.exec(t)?((e=(t=t.replace(/^\/+/,"")).split(":"))[1]=e[1].replace(/\/+/g,"/"),t=e.join(":/")):t=t.replace(/\/+/g,"/"),t}})},function(t,e){BEM.DOM.decl({block:"w-grid-preview",modName:"great",modVal:"yes"},{onSetMod:{js:function(){BEM.blocks.checkbox.on(this.domElem,"change",this._onCheckboxChange,this),this._subscribeSelects()}},destruct:function(t){BEM.blocks.checkbox.un(this.domElem,"change",this._onCheckboxChange,this),this._unsubscribeSelects(),this.__base(t)},getData:function(){var t={},e=!0;return this.params.data.import_columns.forEach((function(i,s){var o,n=this.elem("col","index",s);this.findBlockInside(n,"checkbox").isChecked()?(e=!1,"new"===(o=this.findBlockInside(n,{block:"select2",modName:"role",modVal:"col-to-import"}).getVal())?t["icolumn_"+s+"_type"]=this.findBlockInside(n,{block:"select2",modName:"role",modVal:"data-type"}).getVal():t["icolumn_"+s+"_to"]=o):t["icolumn_"+s+"_enabled"]=!1}),this),{columns:t,allDisabled:e}},updateContent:function(t){var e,i=0;for(e=0;e<t.column_count;e++){var s=t.import_columns[e]["icolumn_"+e+"_enabled"];BEM.DOM.update(this.findElem(this.findElem("col","index",e.toString()),"imported-rows"),s?BEMHTML.apply(t.imported_rows.map((function(t){return this._getPreviewItem(t,"imported-content",i)}),this)):""),BEM.DOM.update(this.findElem(this.findElem("col","index",e.toString()),"existing-rows"),s?BEMHTML.apply(t.existing_rows.map((function(t){return this._getPreviewItem(t,"existing-content",i)}),this)):""),s&&i++}},enable:function(){for(var t,e=0;e<this.params.data.column_count;e++)t=this.findElem("col","index",e.toString()),this.findBlockInside(t,"checkbox").delMod("disabled").isChecked()&&"new"===this.findBlockInside(t,{block:"select2",modName:"role",modVal:"col-to-import"}).delMod("disabled").getVal()&&this.findBlockInside(t,{block:"select2",modName:"role",modVal:"data-type"}).delMod("disabled")},disable:function(){this.findBlocksInside("select2").concat(this.findBlocksInside("checkbox")).forEach((function(t){t.setMod("disabled","yes")}))},_getPreviewItem:function(t,e,i){var s=t[i].value,o=t[i].type,n={block:"w-grid-preview",elem:"preview-item"};return"staff"===o?s.length&&(n.content={block:"m-username",mix:[{block:"mi-staff-card",js:{user:s[0]}}],url:"//staff.yandex-team.ru/"+s[0],content:s[0]}):"checkbox"===o?"boolean"==typeof s&&(n.content={block:"checkbox",mods:{size:"s",checked:s?"yes":"",disabled:"yes",type:e},text:s?BEM.I18N("w-grid-preview","true"):BEM.I18N("w-grid-preview","false")}):"select"===o?s.length&&(n.content=s[0]):"number"===o||"date"===o?n.content=s:s&&s.length&&(n.content=JSON.parse(s)),n},_subscribeSelects:function(){BEM.blocks.select2.on(this.domElem,"change",this._onSelectChange,this)},_unsubscribeSelects:function(){BEM.blocks.select2.un(this.domElem,"change",this._onSelectChange,this)},_onCheckboxChange:function(t,e){var i,s=e.checked,o=t.block.getMod("index");this.setMod(this.findElem("col","index",o),"disabled",s?"":"yes"),this.findBlocksInside(this.findElem("col","index",o),"select2").forEach((function(t){t.setMod("disabled",s?"":"yes")}),this),this.setMod(this.findElem(this.findElem("col","index",o),"imported-rows"),"visibility",s?"":"hidden"),this.setMod(this.findElem(this.findElem("col","index",o),"existing-rows"),"visibility",s?"":"hidden"),s||"new"!==(i=this.findBlockInside(this.findElem("col","index",o),{block:"select2",mdoName:"role",modVal:"col-to-import"})).getVal()&&(this._unsubscribeSelects(),i.getVal("new"),this._subscribeSelects(),this._recalculateSelectsOptions(),BEM.DOM.update(this.findElem(this.findElem("col","index",o),"existing-rows"),"")),this._triggerChange()},_onSelectChange:function(t){var e,i=t.block.getVal();"col-to-import"===t.block.getMod("role")&&(e=this.findBlockInside(t.block.domElem.parent(),{block:"select2",modName:"role",modVal:"data-type"}).setMod("disabled","new"===i?"":"yes"),"new"!==i&&this.params.data.existing_columns.forEach((function(t){t[0]===i&&BEM.DOM.replace(e.domElem,BEMHTML.apply({block:"select2",mods:{size:"s",theme:"normal",role:"data-type",type:"radiocheck",disabled:"yes"},val:t[2],items:this.params.data.column_data_types.map((function(t){return{val:t[0],text:t[1]}}),this)}))}),this),this._recalculateSelectsOptions()),this._triggerChange()},_recalculateSelectsOptions:function(){var t,e,i,s,o=[{val:"new",text:BEM.I18N("w-grid-preview","new")}].concat(this.params.data.existing_columns.map((function(t){return{val:t[0],text:t[1]}}),this)),n=[];this._unsubscribeSelects(),this.findBlocksInside({block:"select2",modName:"role",modVal:"col-to-import"}).forEach((function(t){var e=t.getVal();"new"!==e&&n.push(e)}),this),this.findBlocksInside({block:"select2",modName:"role",modVal:"col-to-import"}).forEach((function(a){t=[],i=a.getVal(),s=o.slice(),e=n.slice(),"new"!==i&&e.splice(e.indexOf(i),1),o.forEach((function(i,s){-1!==e.indexOf(i.val)&&t.push(s)}),this),t.forEach((function(t,e){s.splice(t-e,1)}),this);var r=a.domElem.parent(),l=a.getMod("index");a.destruct(),BEM.DOM.prepend(r,BEMHTML.apply({block:"select2",mods:{size:"s",theme:"normal",type:"radiocheck",role:"col-to-import",index:l,text:"vary"},val:i,text:BEM.I18N("w-grid-preview","new"),items:s.map((function(t){return{val:t.val,text:t.text}}))}))}),this),this._subscribeSelects()},_triggerChange:function(){this.trigger("change",this.getData())}})},function(t,e){BEM.DOM.decl({block:"w-page-info",modName:"type",modVal:"dismissed-authors"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.findBlockInside({block:"button2",modName:"role",modVal:"get-authorship"}).on("click",this._showRequestAuthorshipMessage,this)}},_showRequestAuthorshipMessage:function(){var t=BEM.blocks["i-routes"].actions[".requestauthorship"].page,e=BEM.WISTORE.get("page").get("type");BEM.channel("common").trigger(t[e].block+"."+t[e].event)}})},,,,,,,,,function(t,e){BEM.DOM.decl({block:"select-multiple",modName:"assigned",modVal:"form"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.params.required&&this.findBlockOutside("b-wiki-form")._requiredFields.push(this)}}})},,,function(t,e){BEM.DOM.decl("b-page",{onSetMod:{js:function(){this.__base.apply(this,arguments),BEM.channel("common").on("b-page.accessRequest",this._getPageAccess,this),BEM.WISTORE.get("app").on("change:sidebar",this._onSidebarStateChange,this);var t=BEM.WISTORE.get("page");t&&t.on("change:isReadonly",this._updateCanEditState,this),t&&t.on("change:authors",this._updateCanEditState,this),t&&t.on("change:canEdit",this._onCanEditStateChange,this)}},_onSidebarStateChange:function(t,e){this.setMod("sidebar",e)},_updateCanEditState:function(){var t=BEM.WISTORE.get("page"),e=t.get("currentUser");t.set("canEdit",!t.get("isReadonly")||Boolean(t.get("authors").find((function(t){return t.login=e.login}))))},_onCanEditStateChange:function(t,e){this.setMod("readonly",!e)},_getPageAccess:function(t,e){this._accessWidgetPopup?this._accessWidgetPopup.show():this._accessWidgetPopup=BEM.DOM.append(BEM.DOM.scope,BEMHTML.apply({block:"b-widget",mods:{type:"request-access"},js:{data:e.params}})).bem("b-widget")},_onNotifierClose:function(){this.delMod("notifier")}})},,function(t,e){BEM.decl("mi-notifier",{log:function(t,e){var i=this._notificationsOptions[t];this._push({block:"m-notification",js:{delay:i.delay},mods:{theme:t,icons:i.icons?"yes":"",autoclosable:i.autoclosable?"yes":"",clear:i.clear?"yes":""},content:{html:e}})}})},,,,,function(t,e){BEM.DOM.decl("m-editor",{val:function(t){var e=this._textarea.elem("control").val();return void 0===t?e:(this._textarea.val(t),e===t||this._preventTriggerChange||(this._preventTriggerChange=!0,this.trigger("change",t)),t)},_onTextChange:function(){this._drafts&&this._processChangeForDrafts(),this.afterCurrentEvent((function(){this._preventTriggerChange=!0,this.trigger("change",this.val())}))}})},,,,,,function(t,e){BEM.DOM.decl({block:"m-editor-popup",modName:"type",modVal:"code"},{onSetMod:{js:function(){}}})},,,,function(t,e){BEM.DOM.decl("w-old-page-mark",{_onClick:function(){var t=this._getPopup();t.hasMod("visible","yes")?t.delMod("visible"):this._showPopup()},_showPopup:function(){this._loaded?this._getPopup().setMod("visible","yes"):(this.setMod("progress","yes"),BEM.create("wi-api-request",{apiPath:".actuality",path:BEM.blocks["wi-history"].getCorrectPath(),urlParams:["format=json"]}).run().then(this._onGotData.bind(this),this._onFailedData.bind(this)))},_onGotData:function(t){this.delMod("progress");var e=this._getPopup();BEM.DOM.append(e.domElem,this.__self._getPopupContentHTML(t.data)),e.findBlockInside({block:"button2",modName:"role",modVal:"unmark"}).on("click",(function(){e.delMod("visible")})),e.setMod("visible","yes"),this._loaded=!0},_onFailedData:function(t){this.delMod("progress"),BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,null,t)),this._getPopup().delMod("visible")},_getPopup:function(){return this._popup||(this._popup=BEM.DOM.append(this.domElem,BEMHTML.apply({block:"popup2",mods:{target:"anchor",theme:"normal",autoclosable:"yes",role:"old-page-mark"},directions:["bottom-left"],content:{block:"w-old-page-mark",elem:"date",content:[BEM.I18N("w-old-page-mark","last_update")+" ",{block:"m-date",format:"full",timestamp:BEM.WISTORE.get("page").get("modifiedAt")}]}})).bem("popup2"),this._popup.setAnchor(this.domElem)),this._popup}},{live:function(){this.liveBindTo("click",(function(){this._onClick()}))},_getPopupContentHTML:function(t){return BEMHTML.apply({block:"w-old-page-mark",elem:"popup-content",data:t})}})},function(t,e){BEM.DOM.decl("w-page-official",{_onClick:function(){this.__self._data?this._togglePopup():BEM.create("wi-api-request",{apiPath:".officiality",path:BEM.blocks["wi-history"].getCorrectPath(),urlParams:["format=json"]}).run().then(this._onGotData.bind(this),this._onFailedData.bind(this))},_onGotData:function(t){this.__self._data={persons:t.data.responsible_persons,groups:t.data.responsible_groups},this._togglePopup()},_onFailedData:function(t){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,null,t))},_togglePopup:function(){this.__self._getPopup(this.domElem,this.__self._data).toggleMod("visible","yes","")}},{live:function(){this.liveBindTo("click",(function(){this._onClick()}))},_getPopupBEMJSON:function(t){var e=t.persons,i=t.groups,s=[];return e.length&&(s.push({block:"w-page-official",elem:"user-title",content:1===e.length?BEM.I18N("w-page-official","responsible"):BEM.I18N("w-page-official","responsibles")}),e.forEach((function(t){s.push({block:"b-page-official-user",user:t})}))),i.length&&(s.push({block:"w-page-official",elem:"user-title",content:1===i.length?BEM.I18N("w-page-official","responsible_group"):BEM.I18N("w-page-official","responsible_groups")}),i.forEach((function(t){s.push({block:"w-page-official",elem:"group",content:t.url?{block:"link",mods:{theme:"normal"},url:t.url,text:t.name}:t.name})}))),{block:"popup2",mods:{target:"anchor",theme:"normal",autoclosable:"yes",role:"page-official"},directions:["bottom-left"],content:s}},_getPopup:function(t,e){return this._popup||(this._popup=BEM.DOM.append(t,BEMHTML.apply(this._getPopupBEMJSON(e))).bem("popup2")),this._popup.setAnchor(t),this._popup}})},function(t,e){BEM.DOM.decl("w-mixed-tooltip",{destruct:function(){this._tooltip&&this._tooltip.destruct(),this.__base.apply(this,arguments)},getTooltip:function(){return this._tooltip||(this._tooltip=BEM.DOM.append(this.domElem,BEMHTML.apply(this.params.tooltip)).bem("tooltip").setOwner(this.domElem)),this._tooltip},_hide:function(){this.getTooltip().delMod("shown")},_show:function(){($(window).width()<=this.params.screenWidthToShow||"opened"===BEM.WISTORE.get("app").get("sidebar")&&$(window).width()-this.__self._sidebarWidth<=this.params.screenWidthToShow)&&this.getTooltip().setMod("shown","yes")}},{live:function(){this.liveBindTo("click",(function(){this._hide()})),this.liveBindTo("mouseover",(function(){this._show()})),this.liveBindTo("mouseout",(function(){this._hide()}))},_sidebarWidth:280})},function(t,e){BEM.DOM.decl("w-fav-button",{onSetMod:{progress:{yes:function(){this._getButton().setMod("disabled","yes")},"":function(){this._getButton().delMod("disabled")}}},_getButton:function(){return this._button||(this._button=this.findBlockOn("button2")),this._button},_getHref:function(){var t=window.location.href;try{return decodeURI(t)}catch(e){return console.warn(e),t}},_addToFavs:function(){var t=this._getHref();this.setMod("progress","yes"),BEM.create("wi-api-request",{apiPath:".favorites/bookmarks",method:"PUT",data:{folder_name:"__INBOX__",title:BEM.WISTORE.get("page").get("title"),url:t},path:"",urlParams:!1}).run().then(this._onSuccess.bind(this,!0),this._onError.bind(this))},_removeFromFavs:function(){this.setMod("progress","yes"),BEM.create("wi-api-request",{apiPath:".favorites/bookmarks",path:"",method:"POST",data:{supertag:BEM.WISTORE.get("page").get("superTag")},urlParams:!1}).run().then(this._onSuccess.bind(this,!1),this._onError.bind(this))},_onSuccess:function(t){this.delMod("progress"),BEM.WISTORE.get("page").set("isFav",t)},_onError:function(t){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(this.domElem,null,t)),this.delMod("progress")}},{live:function(){this.liveBindTo("click",(function(){this.hasMod("fav","yes")?this._removeFromFavs():this._addToFavs()}))}})},function(t,e){BEM.DOM.decl("w-subscribe-button",{onSetMod:{js:{inited:function(){var t=this.findBlockOn({block:"dropdown2",modName:"role",modVal:"subscribe"});this._tooltip=this.findBlockOn("w-mixed-tooltip").getTooltip(),this._button=t.getSwitcher(),this._popup=t.getPopup(),this._menu=this._popup.findBlockInside("menu"),this._menu.on("click",this._onItemClick,this),this._menu.on("change",this._onChange,this)}},type:function(t,e){var i=BEM.I18N("w-subscribe-button","button_type_"+e);BEM.DOM.update(this._button.elem("text"),i),BEM.DOM.update(this._tooltip.elem("content"),i)},progress:{yes:function(){this._button.setMod("disabled","yes")},"":function(){this._button.delMod("disabled")}}},_onItemClick:function(){this._popup.delMod("visible")},_onChange:function(t,e){this.setMod("progress","yes");var i=!1,s=this.__self._types[e.currVal];"watch"===s&&(i={unwatch_children:!0}),BEM.create("wi-api-request",{apiPath:"."+s,method:"POST",data:i,urlParams:!1,path:BEM.blocks["wi-history"].getCorrectPath()}).run().then(this._onSuccess.bind(this,e.currVal),this._onError.bind(this))},_onSuccess:function(t){this.delMod("progress"),BEM.WISTORE.get("page").set("userSubscription",t)},_onError:function(t){this.delMod("progress"),BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(this.domElem,null,t))}},{live:function(){this.liveBindTo("click",(function(){}))},_types:{page:"watch",cluster:"masswatch",none:"massunwatch"}})},,,,,function(t,e){BEM.DOM.decl({block:"b-page",modName:"type",modVal:"error"},{onSetMod:{js:function(){this.bPage=this.findBlockOutside("b-page"),BEM.blocks["i-routes"].getRoute("error"),this.errorBlock=this.findBlockInside("b-error-page"),this.errorCode=this.errorBlock.params.code,this["_error"+this.errorCode]&&this["_error"+this.errorCode]()}},_error404:function(){var t=this.bPage.findBlockInside({block:"button2",modName:"error",modVal:"new-page"}),e=this.bPage.findBlockInside("b-head");t.on("click",(function(){e.openCreatePageWidget()}))},_error403:function(){this.button=this.bPage.findBlockInside("b-wiki-form").findBlockInside("button2"),this.link=this.bPage.findBlockInside({block:"link",modName:"open",modVal:"form"}),this.link&&this.link.on("click",this._on403LinkClick,this),this.button.on("click",this._on403FormClick,this)},_on403LinkClick:function(){this.bPage.findBlockInside("b-wiki-form").toggleMod("show","yes","no"),this.link.destruct()},_on403FormClick:function(){var t=this.bPage.findBlockInside("b-wiki-form").findBlockInside("input").val(),e=BEM.blocks["wi-history"].getPath();BEM.create("wi-api-request",{apiPath:".requestaccess",method:"PUT",data:{reason:t},urlParams:!1,path:"/"===e?"/homepage":e}).run().then(this._on403FormSubmit.bind(this),this._on403FormSubmitError.bind(this))},_on403FormSubmit:function(){var t=BEM.I18N("b-page","access_request_sended");this._owner&&this._owner.is_dismissed&&(t=BEM.I18N("b-page","access_request_sended_to_support")),this.bPage.findBlockInside("b-page").elem("text").text(t)},_on403FormSubmitError:function(t){var e=BEM.I18N("b-page","error_occurred"),i=BEM.blocks["wi-notification"].createErrorMessage(t);this.findElem("error").length&&this.findElem("error").remove();var s={block:"b-page",elem:"error",content:e+" "+i};BEM.DOM.before(this.bPage.findBlockInside("b-wiki-form").domElem,BEMHTML.apply(s))}})},function(t,e){BEM.DOM.decl({block:"b-widget",modName:"type",modVal:"page-move"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.findBlockInside({block:"checkbox",modName:"type",modVal:"page-title"}).on("change",this._onCheckboxChange,this),this._subpages=this.findBlockInside("b-cluster-subpages"),this._suggest=this.findBlockInside({block:"m-suggest"}),this._checkbox=this.findBlockInside({block:"checkbox",modName:"type",modVal:"clusters"}),this._moveButton=this.findBlockInside({block:"button2",modName:"role",modVal:"move-cluster"}),this._cancelButton=this.findBlockInside({block:"button2",modName:"role",modVal:"move-cluster-cancel"}),this._pageRenameInput=this.findBlockInside({block:"input",modName:"type",modVal:"page-title"}),this._spin=this.findBlockInside({block:"spin2",modName:"type",modVal:"move-load"}),this.on("show",this._onWidgetShow,this),this._cancelButton.bindTo("click",function(){this.hide()}.bind(this)),this._moveButton.bindTo("click",this._onMoveButtonClick.bind(this)),this._pageRenameInput.bindTo("input",this._onRenameFieldChange.bind(this)),this._pageRenameInput.on("change",this._onRenameInputClear,this)}},_onRenameInputClear:function(t){t.block.val()||(this.elem("new-url-page").text(""),this._newUrl="/")},_onRenameFieldChange:function(){var t=this._newUrl.split("/"),e=this._pageRenameInput.elem("control").val();t.pop(),this.pageSlug=e,-1!==e.indexOf("/")&&(this.pageSlug=e.replace(/\//g,""),this._pageRenameInput.elem("control").val(this.pageSlug)),this._newUrl=t.concat(this.pageSlug).join("/"),this.elem("new-url-page").text(this._newUrl)},_onCheckboxChange:function(t,e){e.checked?(this.setMod("page-title","visible"),this._pageRenameInput.val(this._pageName.slice(1))):(this.delMod("page-title"),this.elem("new-url-page").text(this._pageName),this._newUrl=this._pageName)},_onMoveButtonClick:function(){var t,e=this;this._movedUrl?(t=this._movedUrl,"/"===this._movedUrl.slice(-1)?t+=this._newUrl.substr(1):t+=this._newUrl):t=this._newUrl,t=this._cutUnusedSlashes(t),this._updatedUrl=t,this._spin.setMod("progress","yes"),BEM.create("wi-long-task-requester",{callForResultParams:{apiPath:".move_async",method:"POST",data:{destination:t,move_cluster:this._checkbox.isChecked()},urlParams:!1,path:BEM.blocks["wi-history"].getCorrectPath()},hideProgressBarCallback:function(){e._spin.delMod("progress")}}).run().then(this._onPageMove.bind(this),BEM.blocks["wi-notification"].errorHandler(this._moveButton.domElem,BEM.I18N("b-widget","cant_move_cluster")))},_cutUnusedSlashes:function(t){var e;return/(http?\w+:).+/.exec(t)?((e=(t=t.replace(/^\/+/,"")).split(":"))[1]=e[1].replace(/\/+/g,"/"),t=e.join(":/")):t=t.replace(/\/+/g,"/"),t},_onWidgetShow:function(){this._fillWidgetWithData(),this._setNewPageHTML(),this._clusterPath=this._getClusterPath(),this._newUrl=this.pageSlug,this._pageName=this.pageSlug,this._movedUrl=this._clusterPath,this._suggest.val(this._clusterPath),this.elem("new-url-page").text(this.pageSlug)},_getClusterPath:function(){var t=this.tag.split("/");return t.pop(),t.join("/")},_onPageMove:function(){location.href=this._updatedUrl},_fillWidgetWithData:function(){this.tag="/"+BEM.WISTORE.get("page").get("tag"),this.splitedSupertag=this.tag.split("/"),this.params.isAction&&this.params.source&&(this.tag=this.params.source),this.pageSlug="/"+this.splitedSupertag.pop(),this.params.data.subpages_count&&(this.setMod(this.elem("current-address-subpages"),"visibility","visible"),BEM.DOM.update(this._checkbox.elem("label"),BEMHTML.apply([BEM.I18N("b-widget","move_the_cluster")+" ",{block:"link",mods:{theme:"pseudo",pseudo:"yes",type:"show-subpages"},content:BEM.I18N("b-widget","cluster_subpages",{count:2})}," ("+this.params.data.subpages_count+")"])),this.findBlockInside({block:"link",modName:"type",modVal:"show-subpages"}).on("click",this._onShowSubpagesLinkClick,this)),this.elem("current-address-url").text(location.host+this.tag+"/"),this.elem("new-url").text(location.host+this.splitedSupertag.join("/"))},_setNewPageHTML:function(){this._pageName="",this._clusterPath="",this._suggest.on("select change",(function(t,e){this._updateNewUrl("select"===t.type?e.entityData.tag:e)}),this)},_updateNewUrl:function(t){"/"!==t&&this.elem("new-url").text(location.host+t),this._movedUrl=t},_onShowSubpagesLinkClick:function(){this.hide(!0),BEM.channel("common").trigger("w-action.create-tree",{baseWidgetData:{showEvent:"w-action.create-move"}})}})},,function(t,e){BEM.DOM.decl({block:"m-calendar",modName:"assigned",modVal:"form"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.params.required&&this.findBlockOutside("b-wiki-form")._requiredFields.push(this.findBlockInside({block:"input",modName:"toggler",modVal:"datepicker"}))}}})},,function(t,e){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}BEM.DOM.decl({name:"b-form-input",modName:"form",modVal:"yes"},{_onSelectItem:function(t){var e=t.select(!0),s="object"===i(e)?e.needUpdate:!1!==e,o="object"===i(e)&&e.needEvent;this._preventRequest=!0,s&&this.val(this._userVal=t.val(),{source:"autocomplete",itemIndex:this._curItemIndex}),this.del("_preventRequest"),(s||o)&&this.trigger("select",{item:t,byKeyboard:!0})}})},,,function(t,e){BEM.DOM.decl("m-head-search",{onSetMod:{js:function(){this.afterCurrentEvent((function(){window.location.hash||this.findBlockInside("textinput").elem("control").focus()}),this),this._search=this.elem("search"),this._suggest=this.findBlockInside("m-suggest"),this._actionPathname="wikisearch",this._suggest.on("state-update",(function(){Number(_.get(this._suggest,"state.result.meta.features.wiki_to_search"))&&(this._actionPathname="search")}),this),this.domElem.on("submit",function(){$(this._search).attr("action","//search.yandex-team.ru/"+this._actionPathname),$(this._search).submit()}.bind(this))}}})},,,,function(t,e){BEM.DOM.decl({block:"m-editor",modName:"type",modVal:"edit-page"},{hasNewDraft:!1,onSetMod:{js:function(){this.__base.apply(this,arguments),this._bPage=this.findBlockOutside("b-page"),this.afterCurrentEvent(this._backward),this.on("draft-store",this._onDraftStore,this),this.on("draft-restore",this._onDraftRestore,this)}},_onDraftStore:function(){this.hasNewDraft=!0},_onDraftRestore:function(){confirm(BEM.I18N("m-editor","unsaved_changes"))&&(this.restore(),this.trigger("change",this.val()))},_backward:function(){var t=this.__self._storageKey;window.localStorage.getItem(t)||(localStorage.removeItem("_ajaxTickets"),setTimeout((function(){Object.keys(window.localStorage).forEach((function(t){0===t.search("#/")&&window.localStorage.removeItem(t)})),window.localStorage.setItem(t,!0)}),1e4))},close:function(){var t=$.url.getAllParams(location.href);if(this._bPage.hasMod("editor")?this._bPage.delMod("editor"):this._bPage.hasMod("new-page")&&this._bPage.delMod("new-page"),this._bPage.setMod("revision",""),t.goanchor){var e=$(".wiki-head__anchor[name="+t.goanchor+"]");e.length&&$(window).scrollTop(e.offset().top-this.__self._topVisibleOffset)}BEM.blocks["wi-history"].removeState(),BEM.blocks["wi-history"]._clearUrl(),this.hasNewDraft=!1}},{_storageKey:"_draftsProcessed",_topVisibleOffset:40})},function(t,e){BEM.DOM.decl("w-page-main-info",{_showAuthorsWidget:function(){this.afterCurrentEvent((function(){BEM.channel("common").trigger("w-action.create-settings",{tab:"authors"})}))},_updateModifiedInfo:function(){var t=BEM.WISTORE.get("page");BEM.DOM.replace(this.findElem("modified"),BEMHTML.apply({block:"w-page-main-info",elem:"modified",isOld:t.get("isOld"),modifiedAt:t.get("modifiedAt")}))},_updateAuthorInfo:function(){var t=BEM.WISTORE.get("page");BEM.DOM.replace(this.findElem("left"),BEMHTML.apply({block:"w-page-main-info",elem:"left",authors:t.get("authors"),isOfficial:t.get("isOfficial")})),BEM.DOM.replace(this.findElem("first-author-link"),BEMHTML.apply({block:"w-page-main-info",elem:"first-author-link",authors:t.get("authors"),isOfficial:t.get("isOfficial")}))}},{live:function(){this.liveInitOnStoreEvent("page","change:isOld",(function(){this._updateModifiedInfo()})),this.liveInitOnStoreEvent("page","change:authors",(function(){this._updateAuthorInfo()})),this.liveBindTo("open-authors","click",(function(){this._showAuthorsWidget()}))}})},function(t,e){BEM.DOM.decl("b-footer",{_cancelForceDesktop:function(){$.cookie("force-desktop","",{path:"/"}),location.reload()}},{live:function(){this.liveBindTo("mobile-link","click",(function(){this._cancelForceDesktop()}))}})},function(t,e){var i;BEM.DOM.decl({block:"attach",modName:"role",modVal:"import-page"},{_update:function(){var t=this.elem("control").val(),e=t.split("\\").pop(),i=e.split(".").pop().toLowerCase();!t||this.__self.EXTENSIONS[i]?(this.__base.apply(this,arguments),this.setMod("hidden-button",t?"yes":"")):this.afterCurrentEvent((function(){this.resetFile(),this.delMod("hidden-button"),BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,BEM.I18N("attach","page_import_invalid_format")))}),this)},_setFilePath:function(t,e){var i=this._filePath;this._filePath=t;var s=t.split("\\").pop(),o=s.split(".").pop().toLowerCase(),n=new RegExp("\\."+o+"$");this.setMod(this.elem("holder"),"file",this._extensionsToMods[o]||this.params.unknownType),this.toggleMod(this.elem("holder"),"state","hidden",!s),BEM.DOM.update(this.elem("text"),BEMHTML.apply(s?[{block:"attach",elem:"file-name",content:s.replace(n,"")},{block:"attach",elem:"file-extension",content:"."+o}]:this._noFileText)),(e||t!==i)&&this.trigger("change")},resetFile:function(){this.__base.apply(this,arguments),this.delMod("hidden-button")}},{EXTENSIONS:(i=Object.create(null),i.docx=!0,i.txt=!0,i)})},,,,,,function(t,e){function i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],s=!0,o=!1,n=void 0;try{for(var a,r=t[Symbol.iterator]();!(s=(a=r.next()).done)&&(i.push(a.value),!e||i.length!==e);s=!0);}catch(t){o=!0,n=t}finally{try{s||null==r.return||r.return()}finally{if(o)throw n}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return s(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return s(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}BEM.DOM.decl("w-page-panel",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments);var t=i(this.domElem,1),e=t[0],s=document.createElement("div");e.parentElement.insertBefore(s,e);var o=new IntersectionObserver((function(t){var s=i(t,1)[0].intersectionRatio;e.classList.toggle("sticky",s<1)}),{threshold:[1]});o.observe(s),this._observer=o},"":function(){this._observer.disconnect(),this.__base.apply(this,arguments)}}},destruct:function(){this.delMod("js"),this.__base.apply(this,arguments)}},{live:function(){return this.liveInitOnStoreEvent("page","change:access",(function(t,e){BEM.DOM.replace(this.findElem("access"),BEMHTML.apply({block:"w-page-panel",elem:"access",data:e}))})),this.liveInitOnStoreEvent("page","change:isFav",(function(t,e){BEM.DOM.replace(this.findElem("fav"),BEMHTML.apply({block:"w-page-panel",elem:"fav",isFav:e}))})),this.liveInitOnStoreEvent("page","change:userSubscription",(function(t,e){this.findBlockInside("w-subscribe-button").setMod("type",e)})),this.liveInitOnStoreEvent("page","change:canEdit",(function(t,e){var i=this.params.editUrl;BEM.DOM.replace(this.findElem("edit"),BEMHTML.apply({block:"w-page-panel",elem:"edit",canEdit:e,editUrl:i}))})),!1}}),BEM.DOM.decl("w-page-panel",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments);var t=this.findBlockInside({block:"button2",modName:"role",modVal:"edit-page"});t&&t.bindTo("click",(function(){yaCounter&&yaCounter.reachGoal("edit_in_cloud_click")}))}}}})},function(t,e){BEM.DOM.decl({block:"b-page",modName:"type",modVal:"grid"},{onSetMod:{js:function(){if(BEM.blocks["i-routes"].getRoute("grid"),this.__base.apply(this,arguments),("ontouchstart"in window||window.navigator.msPointerEnabled)&&this.setMod("browser","touch"),this.channel("content").on("update",this._updateContent,this),BEM.WISTORE.get("page").on("change:comments",this._onCommentsStatusChange,this),this.params.notifier&&this.params.notifier.id){var t=this.params.notifier;BEM.DOM.prepend(this.domElem,BEMHTML.apply({block:"w-notifier",mods:{hidden:"yes"},data:{url:t.url,message:t.message,id:t.id}})).bem("w-notifier").on("close",this._onNotifierClose,this)}}},_onCommentsStatusChange:function(){var t=BEM.WISTORE.get("page").get("comments");this._comments||(this._comments=this.findBlockInside("w-comments")),this._comments.setMod("enabled",t?"yes":"")},_updateContent:function(t,e){var i=this.findBlockInside("b-grid-table"),s=this.findBlockInside("b-page-title");i&&i.rebuild(e.data),s&&s.domElem.text(e.data.structure.title)}})},function(t,e){function i(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=o(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var s=0,n=function(){};return{s:n,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,l=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return r=t.done,t},e:function(t){l=!0,a=t},f:function(){try{r||null==i.return||i.return()}finally{if(l)throw a}}}}function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],s=!0,o=!1,n=void 0;try{for(var a,r=t[Symbol.iterator]();!(s=(a=r.next()).done)&&(i.push(a.value),!e||i.length!==e);s=!0);}catch(t){o=!0,n=t}finally{try{s||null==r.return||r.return()}finally{if(o)throw n}}return i}(t,e)||o(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){if(t){if("string"==typeof t)return n(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(t,e):void 0}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}BEM.DOM.decl({block:"b-widget",modName:"type",modVal:"new-page"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._localStorage=BEM.blocks["mi-storage"],this._bPage=this.findBlockOutside("b-page"),this._cancel=this.findBlockInside({block:"button2",modName:"role",modVal:"new-page-cancel"}),this._save=this.findBlockInside({block:"button2",modName:"role",modVal:"new-page-save"}),this._type=this.findBlockInside({block:"radio-button",modName:"type",modVal:"new-page"}),this._clusterType=this.findBlockInside({block:"select2",modName:"role",modVal:"cluster-type"}),this._area=this.findBlockInside({block:"input",modName:"role",modVal:"note"}),this._url=this.findBlockInside({block:"input",modName:"type",modVal:"new-page-url"}),this._title=this.findBlockInside({block:"input",modName:"type",modVal:"new-page-title"}),this._spinner=this.findBlockInside({block:"spin2",modName:"type",modVal:"create-load"}),this._attach=this.findBlockInside({block:"attach",modName:"role",modVal:"import-page"}),this.setMod("page-type","page"),this._type.on("change",this._onTypeChange,this),this._clusterType.on("change",this._onClusterTypeChange,this),this._cancel.on("click",this._onCancel,this),this._save.on("click",this._onSave,this),this._title.on("change",this._onTitleChange,this),this._url.on("change",this._onUrlChange,this)},"cluster-type":function(t,e){if(e){this._clusterType.getVal()!==e&&(this._preventClusterTypeChange=!0,this._clusterType.setVal(e));var i=this._getPrefixByClusterType(e);if(this._unsetIgnoreTitleChange(),!this._clusterChangedFromUrl){var s;if(this.getMod("is404")){s=BEM.blocks["wi-history"].getCorrectPath();try{s=decodeURI(s)}catch(t){console.warn(t)}}else s=i+"newpage";this._url.val()!==s&&(this._setIgnoreUrlChange(),this._url.val(s)),this._title.val()&&this._onTitleChange()}this._clusterChangedFromUrl=!1,BEM.DOM.update(this.elem("description"),BEM.I18N("b-widget","cluster_description_"+e,{cluster:"cluster"===e?"/users/"+this._bPage.params.login+"/":this.__self._cleanupUrl("/"+BEM.blocks["wi-history"].getCorrectPath())}))}},is404:function(t,e){this._clusterType.setMod("disabled",e)},"page-type":function(t,e){this._type&&this._type.val(e)},progress:{yes:function(){keymaster.unbind("ctrl+enter, command+enter"),this._spinner.setMod("progress","yes"),this._cancel.setMod("disabled","yes"),this._save.setMod("disabled","yes"),this._attach.setMod("disabled","yes"),this._url.setMod("disabled","yes"),this._title.setMod("disabled","yes"),this._clusterType.setMod("disabled","yes")},"":function(){keymaster.unbind("ctrl+enter, command+enter"),keymaster("ctrl+enter, command+enter",this._onSave.bind(this)),this._spinner.delMod("progress"),this._cancel.delMod("disabled"),this._save.delMod("disabled"),this._attach.delMod("disabled"),this._url.delMod("disabled"),this._title.delMod("disabled"),this._clusterType.setMod("disabled",this.getMod("is404"))}}},destruct:function(){return keymaster.unbind("ctrl+enter, command+enter"),this.__base.apply(this,arguments)},_onTypeChange:function(t,e){this.setMod("page-type",e.currentVal)},_onClusterTypeChange:function(t,e){this._preventClusterTypeChange||this.setMod("cluster-type",e.currVal),this._preventClusterTypeChange=!1},show:function(){this.__base.apply(this,arguments),keymaster.unbind("ctrl+enter, command+enter"),keymaster("ctrl+enter, command+enter",this._onSave.bind(this))},hide:function(){this.__base.apply(this,arguments),keymaster.unbind("ctrl+enter, command+enter"),this._setIgnoreTitleChange(),this._title.val(""),this._unsetIgnoreTitleChange(),this.delMod("cluster-type")},_createUrl:function(){var t="";switch(this._type.val()){default:case"page":t=this._url.val();break;case"grid":t=this._url.val()+"/.grid/create";break;case"note":t=".notes"}return t},_checkIsTitleFilled:function(){return!!this._title.val().trim()||(BEM.channel("notification").trigger("error",{elem:this._title.domElem,message:BEM.I18N("b-widget","input_page_name")}),!1)},_checkIsUrlFilled:function(){return!!this._url.val().trim()||(BEM.channel("notification").trigger("error",{elem:this._url.domElem,message:BEM.I18N("b-widget","input_page_url")}),!1)},_normalizeUrl:function(t){var e=this.__self._cleanupUrl(t),i=this._getPrefixByUrl(e),s=this._getClusterTypeByPrefix(i),o="",n=e.substr(i.length);if("cluster"===s)o="users/"+this._bPage.params.login+"/"+n;else if("sub"===s){var a=BEM.WISTORE.get("page").get("tag");a.endsWith("/")||(a+="/"),o=a+n}else o=n;return o},_getClusterTypeByPrefix:function(t){for(var e=0,o=Object.entries(this.__self.prefixes);e<o.length;e++){var n,a=s(o[e],2),r=a[0],l=i(a[1]);try{for(l.s();!(n=l.n()).done;){if(n.value===t)return r}}catch(t){l.e(t)}finally{l.f()}}return"root"},_getPrefixByClusterType:function(t){return Array.isArray(this.__self.prefixes[t])?this.__self.prefixes[t][0]:"/"},_getPrefixByUrl:function(t){for(var e=0,s=Object.values(this.__self.prefixes);e<s.length;e++){var o,n=i(s[e]);try{for(n.s();!(o=n.n()).done;){var a=o.value;if(t.startsWith(a))return a}}catch(t){n.e(t)}finally{n.f()}}return""},_pageExist:function(t){var e=this,i=this._url.val(),s=this._normalizeUrl(i);this._checkIsUrlFilled()&&this._checkIsTitleFilled()&&(this.setMod("progress","yes"),BEM.create("wi-api-request",{apiPath:s,method:"HEAD",data:!1,urlParams:["format=json"],path:""}).run().then((function(){var t=e._type.val(),i=BEM.I18N("b-widget","page_already_exist");switch(t){case"page":i=BEM.I18N("b-widget","page_already_exist");break;case"grid":i=BEM.I18N("b-widget","grid_already_exist")}e.delMod("progress"),BEM.channel("notification").trigger("error",{elem:e._save.domElem,message:i})}),t.bind(this)))},_validateUrl:function(t){var e=this._normalizeUrl(this._url.val());BEM.create("wi-api-request",{apiPath:".validate_tag",method:"GET",urlParams:["tag="+(e||"")],path:""}).run().then(t.bind(this),function(t){BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(this._save.domElem,BEM.I18N("b-widget","validation_error"),t)),this.delMod("progress")}.bind(this))},_onCancel:function(){this.hide(),this._attach.resetFile(),BEM.blocks["wi-history"].removeState()},_onSave:function(){switch(this._type.val()){case"page":this._onSavePage();break;case"grid":this._onSaveGrid();break;case"note":this._onSaveNote()}},_onSaveNote:function(){this.setMod("progress","yes"),yaCounter&&yaCounter.reachGoal("create_note",{clusterType:this._clusterType.getVal(),fileAttached:this._isFilesAttached()}),BEM.create("wi-api-request",{apiPath:this._createUrl(),method:"POST",data:{body:this._area.val()},path:""}).run().then(this._onSaveData.bind(this),this._onPageSaveError.bind(this))},_checkTitleLength:function(){var t=this._title.val();return!(t.length>this.__self.TITLE_MAX_LENGTH)||(BEM.blocks["wi-notification"].errorHandler(this._save.domElem,BEM.I18N("b-widget","title_length_error")+" "+(t.length-this.__self.TITLE_MAX_LENGTH))(),!1)},_onSavePage:function(){yaCounter&&yaCounter.reachGoal("create_page",{clusterType:this._clusterType.getVal(),fileAttached:this._isFilesAttached()}),this._checkIsUrlFilled()&&this._checkIsTitleFilled()&&this._checkTitleLength()&&(this.setMod("progress","yes"),this._validateUrl((function(t){if(t.data.success){if("page"===this._type.val()){var e=new FormData,i=this._attach.elem("control")[0].files;i.length&&e.append("file",i[0]),e.append("title",this._title.val()),e.append("body",""),BEM.create("wi-api-request",{apiPath:"",method:"PUT",data:e,path:"/"+this._normalizeUrl(this._createUrl())}).run().then(this._onSaveData.bind(this),this._onPageSaveError.bind(this))}}else this.delMod("progress"),BEM.blocks["wi-notification"].errorHandler(this._save.domElem,BEM.I18N("b-widget","validation_error"))()})))},_isFilesAttached:function(){return Boolean(this._attach.elem("control")[0].files.length)},_onSaveGrid:function(){yaCounter&&yaCounter.reachGoal("create_grid",{clusterType:this._clusterType.getVal(),fileAttached:this._isFilesAttached()}),this._checkTitleLength()&&this._pageExist((function(){this._validateUrl((function(t){t.data.success?BEM.create("wi-api-request",{apiPath:this._normalizeUrl(this._createUrl()),method:"POST",data:{title:this._title.val(),body:""},path:""}).run().then(this._onSaveData.bind(this),this._onGridSaveError.bind(this)):BEM.blocks["wi-notification"].errorHandler(this._save.domElem,BEM.I18N("b-widget","validation_error"))()}))}))},_onSaveData:function(t){switch(this._type.val()){case"page":window.location=t.data.url+"/.edit";break;case"grid":t.data.url&&(this._localStorage.setItem("wiki-sidebar","true"),this._localStorage.setItem("wiki-new-grid","true"),window.location=t.data.url);break;case"note":t.data.url&&(window.location=t.data.url)}},_onPageSaveError:function(t){this.delMod("progress"),BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,BEM.I18N("b-widget","cant_create_page"),t))},_onGridSaveError:function(t){this.delMod("progress"),BEM.channel("notification").trigger("error",BEM.blocks["wi-notification"].getError(null,BEM.I18N("b-widget","cant_create_grid"),t))},_getErrorData:function(t,e){return{node:this._save.domElem,error:e,content:{body:t}}},open:function(t,e,i){t||(t="root"),this.setMod("is404",i),this.setMod("page-type","page"),this.setMod("cluster-type",t),this._title.val(e||""),this.show(),setTimeout(function(){this._title.elem("control").focus(),this._title.val(""),this._title.val(e||"")}.bind(this),0)},_setIgnoreUrlChange:function(){this._ignoreUrlChange=!0},_setIgnoreTitleChange:function(){this._ignoreUrlChange||(this._ignoreTitleChange=!0)},_unsetIgnoreUrlChange:function(){this._ignoreUrlChange=!1},_unsetIgnoreTitleChange:function(){this._ignoreTitleChange=!1},_onTitleChange:function(){if(!this.getMod("is404")&&!this._ignoreTitleChange){var t=this._title.val(),e=this._url.val(),i=this.__self._cleanupUrl(this._getPrefixByUrl(e)+t);e!==i&&(this._setIgnoreUrlChange(),this._url.val(i))}},_onUrlChange:function(){if(this._ignoreUrlChange)this._unsetIgnoreUrlChange();else{this._setIgnoreTitleChange();var t=this._url.val(),e=this.__self._cleanupUrl(t);t!==e&&(this._setIgnoreUrlChange(),this._url.val(e)),this.getMod("is404")||(e.startsWith("~/")&&"cluster"!==this._clusterType.getVal()?(this._clusterChangedFromUrl=!0,this._clusterType.setVal("cluster")):e.startsWith("!/")&&"sub"!==this._clusterType.getVal()?(this._clusterChangedFromUrl=!0,this._clusterType.setVal("sub")):e.startsWith("~/")||e.startsWith("!/")||"root"===this._clusterType.getVal()||(this._clusterChangedFromUrl=!0,this._clusterType.setVal("root")))}}},{TITLE_MAX_LENGTH:200,prefixes:{cluster:["~/","~"],sub:["!/","!"],root:["/"]},_cleanupUrl:function(t){return t.trim().replace(/\/{2,}/g,"/").replace(/\s+/g,"-")}})},function(t,e){BEM.DOM.decl({block:"b-page",modName:"type",modVal:"cloud"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),BEM.blocks["i-routes"].getRoute("cloud")}}}})},function(t,e){function i(t,e,i,s,o,n,a){try{var r=t[n](a),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(s,o)}function s(t){return function(){var e=this,s=arguments;return new Promise((function(o,n){var a=t.apply(e,s);function r(t){i(a,o,n,r,l,"next",t)}function l(t){i(a,o,n,r,l,"throw",t)}r(void 0)}))}}BEM.DOM.decl({block:"b-page",modName:"type",modVal:"article"},{onSetMod:{js:function(){if(BEM.blocks["i-routes"].getRoute("article"),this.__base.apply(this,arguments),this.channel("content").on("update",this._updateContent,this),this.channel("common").on("reset-hash",(function(){this._resetHashTimeout&&(clearTimeout(this._resetHashTimeout),this._resetHashTimeout=null),this._resetHashTimeout=setTimeout(this._resetHash.bind(this),300)}),this),this.afterCurrentEvent((function(){BEM.blocks["i-explainer"].explainAllLinks(this)}),this),("ontouchstart"in window||window.navigator.msPointerEnabled)&&this.setMod("browser","touch"),BEM.WISTORE.get("page").on("change:comments",this._onCommentsStatusChange,this),this.bindToDoc("scroll.bar",this._updateGridsPanels.bind(this)),this.bindToWin("resize.bar",this._updateGridsPanels.bind(this)),this.params.notifier&&this.params.notifier.id){var t=this.params.notifier;BEM.DOM.prepend(this.domElem,BEMHTML.apply({block:"w-notifier",mods:{hidden:"yes"},data:{url:t.url,message:t.message,id:t.id}})).bem("w-notifier").on("close",this._onNotifierClose,this)}this._getWfInstance(),BEM.channel("anchor").on("go",this._onGoAnchorEvent,this)}},destruct:function(){this.__base.apply(this,arguments),BEM.channel("anchor").un("go",this._onGoAnchorEvent,this)},getToc:function(){return this._getWfInstance().getToc()},getContentHTML:function(){var t=this;return s(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=$,!BEM.WISTORE.get("page").get("withNewWf")){e.next=7;break}return e.next=4,t._getWfInstance().renderToString(BEM.WISTORE.get("page").get("raw"));case 4:e.t1=e.sent,e.next=8;break;case 7:e.t1=t._getContent()[0].outerHTML;case 8:return e.t2=e.t1,e.abrupt("return",(0,e.t0)(e.t2));case 10:case"end":return e.stop()}}),e)})))()},_onGoAnchorEvent:function(t,e){Ya.FormatterViewPort.BEM.channel("anchor").trigger("go",e)},_getContent:function(){return this._content||(this._content=this.findBlockInside("w-content").domElem),this._content},_getWfInstance:function(){return this._formatterViewPort||(this._formatterViewPort=new Ya.FormatterViewPort({domElem:this._getContent()[0]})),this._formatterViewPort},_getGrids:function(){if(this._grids)return this._grids;var t=this.findBlockInside("w-content"),e=t.findBlocksInside("b-grid-table");return t.findBlocksInside("wiki-widget-action").every((function(t){return t.hasMod("loaded")}))&&(this._grids=e),e},_updateGridsPanels:function(){this._getGrids().forEach((function(t){var e=this._inViewport(t.domElem);t.setMod("panels",e?"yes":""),e&&t.updatePanelsPosition()}),this)},_onCommentsStatusChange:function(){var t=BEM.WISTORE.get("page").get("comments");this._comments||(this._comments=this.findBlockInside("w-comments")),this._comments.setMod("enabled",t?"yes":"")},_resetHash:function(){var t=location.hash;t&&(location.hash="#fakehash",location.hash=t),this._resetHashTimeout=null},_updateContent:function(t,e){var i=this;return s(regeneratorRuntime.mark((function t(){var s,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!BEM.WISTORE.get("page").get("withNewWf")){t.next=15;break}if(void 0===e.data.body){t.next=7;break}return t.next=4,i._getWfInstance().render(e.data.body);case 4:BEM.DOM.init(i._getContent()),t.next=12;break;case 7:if(!e.data.html){t.next=12;break}return t.next=10,i._getWfInstance().render("");case 10:BEM.DOM.update(i._getContent(),e.data.html.replace(/\S*_js_inited/g,"")),Ya.FormatterViewPort.BEM.DOM.init(i._getContent());case 12:i._grids=null,t.next=18;break;case 15:s=i.findBlockInside("w-content"),e.data.bemjson?(e.data.bemjson.mods={status:"main"},o=BEMHTML.apply(e.data.bemjson)):e.data.html&&(o=e.data.html.replace(/\S*_js_inited/g,"")),s&&(BEM.DOM.update(s.domElem,o),i._grids=null);case 18:i._updateTitle(e.data.title),i.channel("content").trigger("updated");case 20:case"end":return t.stop()}}),t)})))()},_updateTitle:function(t){var e=this.findBlockInside("b-page-title");e&&e.domElem.text(t)},_inViewport:function(t){var e=t.offset().top,i=e+t.outerHeight(),s=BEM.DOM.win.scrollTop(),o=s+BEM.DOM.win.height();return i>s&&e<o}})},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){var s={"./ru":485,"./ru.js":485};function o(t){var e=n(t);return i(e)}function n(t){if(!i.o(s,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return s[t]}o.keys=function(){return Object.keys(s)},o.resolve=n,t.exports=o,o.id=1109}])]);
//# sourceMappingURL=4fef5fa8ccd067e3f3c8.js.map