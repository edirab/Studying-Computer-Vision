(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{1242:function(t,e){BEM.DOM.decl("staff-lite-card",{onSetMod:{js:function(){this._card={destruct:function(){}},this._onMouseOver()}},_onMouseOver:function(){var t=this.domElem,e=this.params.user,i=this;this._unbindFromMouseOver(),this.__self._cardReady(this._getStaffHost()).then((function(){i._card=new StaffLiteCard({elem:t,login:e}),i._card.show()}),(function(){i._bindToMouseOver()}))},_bindToMouseOver:function(){this.bindTo("pointerover",this._onMouseOver)},_unbindFromMouseOver:function(){this.unbindFrom("pointerover",this._onMouseOver)},_getStaffHost:function(){return this.params.staffLiteHost||"https://staff.yandex.ru"},destruct:function(){return this._card.destruct(),this.__base.apply(this,arguments)}},{_cardScriptRequest:null,_cardReady:function(t){if(this._cardScriptRequest)return this._cardScriptRequest;if("undefined"==typeof StaffLiteCard){var e=document.createElement("script"),i=jQuery.Deferred(),n=this;return e.type="text/javascript",e.src=t+"/m/staff-lite-card/build/index.js",e.onload=i.resolve,e.onerror=function(){n._cardScriptRequest=null,i.reject(),e.remove()},document.body.appendChild(e),this._cardScriptRequest=i.promise(),this._cardScriptRequest}return jQuery.when()},live:function(){this.liveBindTo("pointerover")}})},1265:function(t,e){BEM.DOM.decl("user-organization",{_onClick:function(t){var e={domEvent:t};this.trigger("click",e)},_onMouseOver:function(){this.setMod("hovered","yes").bindTo("mouseleave",this._onMouseLeave)},_onMouseLeave:function(){this.delMod("hovered").unbindFrom("mouseleave",this._onMouseLeave)},_onFocusIn:function(){this.trigger("focus").setMod("focused","yes").bindTo("focusout",this._onFocusOut)},_onFocusOut:function(){this.trigger("blur").delMod("focused").unbindFrom("focusout",this._onFocusOut)}},{live:function(){this.liveBindTo("pointerclick",this.prototype._onClick).liveBindTo("focusin",this.prototype._onFocusIn).liveBindTo("mouseover",this.prototype._onMouseOver)}})},1266:function(t,e){BEM.decl("y-cookie",{},function(t){"use strict";function e(t){try{return decodeURIComponent(t)}catch(e){return t}}return t.parse=function(t){if(!t||"string"!=typeof t||!t.length)return{};/%23\d{10}/.test(t)&&(t=e(t)),t=t.split("#");for(var i,n=Date.now()/1e3,o={},a=0,s=t.length;a<s;a++)2===(i=t[a].split(".")).length?o[i[0]]=e(i[1]):i.length>2&&(isNaN(i[0])?o[i[0]]=e(i.slice(1).join(".")):i[0]>n&&(o[i[1]]={value:e(i.slice(2).join(".")),expires:new Date(Number(i[0]+"000"))}));return o},t.stringify=function(t){if(t&&"object"==typeof t){for(var e,i,n=[],o=0,a=Object.keys(t),s=a.length;o<s;o++)e=t[a[o]],i=[a[o],encodeURIComponent(e.value||e)],/\d+/.test(e.expires)&&i.unshift(e.expires),n.push(i.join("."));return n.join("#")}},t}({}))},1268:function(t,e){BEM.DOM.decl({block:"user2",modName:"fetch-accounts",modVal:"yes"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._accountsElem=this.findElem(this._menu.domElem,"accounts"),this._accountsSpin=this.findBlockInside(this._accountsElem,"spin2"),this._accountsDataProvider=BEM.create(this.params.accountsDataProvider,{callbackCtx:this,accountsUrl:this.params.accountsUrl}),this._fetchAccounts()}}},onElemSetMod:{accounts:{loading:function(t,e,i){this._accountsSpin.setMod("progress",i)}}},_fetchAccounts:function(){this.setMod(this._accountsElem,"loading","yes"),this._accountsDataProvider.get({yu:this.params._yu},(function(t){this._hasOrganizations=t.accounts&&t.accounts.some((function(t){return t.attributes.has_organization}))||!1;var e=!0,i=this._popup.findBlockInside({block:"user-account",modName:"template",modVal:"yes"});if(i){if(t.accounts){var n=this.params.accountsMax;t.accounts.forEach((function(e,o){e.uid!==t.default_uid&&o<=n&&this._accountsContainer[0].appendChild(this._renderAccount(e,o,i))}),this),e=Boolean(t["can-add-more"])}var o=i.domElem.parent();i.destruct(),o.remove()}this.updateCounters&&this.updateCounters(),this.toggleMod(this.findElem(this._accountsElem,"add-account"),"hidden","","yes",e),this.delMod(this._accountsElem,"loading")}))},_renderAccount:function(t,e,i){var n=t.defaultEmail||t.displayName.social,o=this.params._avatarHost||"https://avatars.mds.yandex.net",a=t.displayName.default_avatar,s=i.domElem.clone().bem("user-account"),r=JSON.parse(s.domElem.attr("data-bem"));n="object"==typeof n?{fb:"Facebook",tw:"Twitter",mr:"Mail.ru",gg:"Google",ok:"Odnoklassniki",vk:"Vkontakte",dz:"Deezer",fs:"Foursquare",ig:"Instagram",lf:"Last.FM",lj:"LiveJournal",in:"LinkedIn",mt:"МТС-Россия",ms:"Microsoft",yh:"Yahoo",ya:"Yandex",vf:"Vodafone-Украина",tg:"Telegram"}[n.provider]:n,r.user2__account={uid:t.uid,pos:e},s.domElem.attr("data-bem",JSON.stringify(r)),s.delMod("template"),s.elem("name-text").text(t.displayName.name),n&&(s.setMod("has-subname","yes"),s.elem("subname").text(n));var c=s.findBlockInside("user-pic"),d=o+"/get-yapic/"+a+"/islands-middle",u=o+"/get-yapic/"+a+"/islands-retina-middle";c.elem("image").attr("src",d),c.elem("image").attr("srcSet",d+" 1x, "+u+" 2x");var l=document.createElement("div");return l.className="menu__item",l.appendChild(s.domElem[0]),l},getDefaultParams:function(){return $.extend(this.__base.apply(this,arguments),{accountsDataProvider:"user2__accounts-provider",accountsMax:this._params.accountsMax||5,maxLength:this._params.maxLength||16})}})},1269:function(t,e){BEM.decl({block:"user2__accounts-provider",baseBlock:"i-request_type_ajax"},{getDefaultParams:function(){return $.extend(this.__base.apply(this,arguments),{url:this._params.accountsUrl,timeout:5e3,dataType:"json",xhrFields:{withCredentials:!0},cache:!1})}})},1270:function(t,e){BEM.DOM.decl({block:"user2",modName:"fetch-unread",modVal:"yes"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._unreadDataProvider=BEM.create(this.params.unreadDataProvider,{callbackCtx:this,exportHost:this.params.exportHost}),this._fetchUnread()}}},_fetchUnread:function(){this._unreadDataProvider.get({key:this.params._yu},this._onFetchUnreadSuccess)},_onFetchUnreadSuccess:function(t){this.setUnreadCount(t.unread||0)},getDefaultParams:function(){return $.extend(this.__base.apply(this,arguments),{unreadDataProvider:"user2__unread-provider"})}})},1271:function(t,e){BEM.decl({block:"user2__unread-provider",baseBlock:"i-request_type_ajax"},{getDefaultParams:function(){var t=this._params.exportHost||"https://export.yandex.ru";return $.extend(this.__base.apply(this,arguments),{url:t+"/for/unread.xml",cache:!1})}})},1272:function(t,e){BEM.DOM.decl({block:"user2",modName:"with-organizations",modVal:"yes"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._organizationsContainer=this.findElem(this._menu.domElem,"organizations").bem("user2__organizations"),this._organizationsCropperContainer=this.findElem(this._menu.domElem,"organizations-cropper"),this._expandIcon=this._organizationsContainer.findBlockInside({block:"icon",modName:"glyph",modVal:"type-arrow"})}}},_onCurrentOrganizationClick:function(t,e){e.domEvent.preventDefault(),this.trigger("current-organization-click"),this._organizationsContainer.toggleMod("collapsed","yes"),this._expandIcon.toggleMod("direction","top")},_onOrganizationClick:function(t,e){t.block.findBlockOn("user2__organizations-trigger")?this._onCurrentOrganizationClick(t,e):this.trigger("organization-click")}},{live:function(){this.__base.apply(this,arguments),this.liveInitOnBlockInsideEvent("init","user-organization").liveInitOnBlockInsideEvent("click","user-organization",this.prototype._onOrganizationClick)}})},1273:function(t,e){BEM.DOM.decl({block:"user2",modName:"fetch-organizations",modVal:"yes"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments);var t=this.findElem(this._menu.domElem,"organizations");this._organizationsSpin=this.findBlockInside(t,"spin2"),this._organizationsDataProvider=BEM.create(this.params.organizationsDataProvider,{callbackCtx:this,organizationsUrl:this.params.organizationsUrl}),this.getMods()["fetch-accounts"]||this._fetchOrganizations()}}},onElemSetMod:{accounts:{loading:{"":function(){this._hasOrganizations&&this._fetchOrganizations()}}},organizations:{loading:function(t,e,i){this._organizationsSpin.setMod("progress",i)}}},_fetchOrganizations:function(){this.setMod(this._organizationsContainer.domElem,"loading","yes");var t={};this._organizationsDataProvider.get({},(function(e){(t=e)[this.params._uid]&&this._renderOrganizations(t[this.params._uid]),this.delMod(this._organizationsContainer.domElem,"loading")}),(function(){this.delMod(this._organizationsContainer.domElem,"loading")}))},_renderOrganizations:function(t){t.length>=15&&this.findElem(this._organizationsContainer.domElem,"add-organization")[0].remove();var e=this.findBlockInside(this._organizationsContainer.domElem,{block:"user-organization",modName:"template",modVal:"yes"});if(t.length>0){var i=this._getDestructuredOrganizations(t);i.current=this._getOrgElem(i.current,e),i.current.classList.add("user2__organizations-trigger"),i.others=i.others.map(function(t){return this._getOrgElem(t,e)}.bind(this));var n=this.findElem(this._organizationsContainer.domElem,"organizations-cropper");this._currentOrganization=i.current,i.others.forEach((function(t){n.append($(t))})),i.others.length>0&&this._organizationsContainer.setMod("expandable","yes"),this._organizationsContainer.domElem.prepend(n),this._organizationsContainer.domElem.prepend(i.current)}e.destruct()},_getOrgElem:function(t,e){var i=e.domElem.clone().bem("user-organization");return i.delMod("template").elem("name").text(t.name),t.logo&&(i.elem("image")[0].src=t.logo),i.domElem[0].href+="&org_id="+t.id,i.domElem[0]},_getDestructuredOrganizations:function(t){var e;if(BEM.blocks["y-cookie"].parse($.cookie("yp"))&&BEM.blocks["y-cookie"].parse($.cookie("yp")).org_id&&(e=BEM.blocks["y-cookie"].parse($.cookie("yp")).org_id.value),e)for(var i=0;i<t.length;i++)if(t[i].id.toString()===e.toString())return{current:t[i],others:t.slice(0,i).concat(t.slice(i+1))};return{current:t[0],others:t.slice(1)}},_setCurrentOrganizationId:function(t){window.location.href=this.params.contextSwitchUrl+"&org_id="+t},getDefaultParams:function(){return $.extend(this.__base.apply(this,arguments),{organizationsDataProvider:"user2__organizations-provider"})}})},1274:function(t,e){BEM.decl({block:"user2__organizations-provider",baseBlock:"i-request_type_ajax"},{getDefaultParams:function(){return $.extend(this.__base.apply(this,arguments),{url:this._params.organizationsUrl,timeout:5e3,dataType:"json",xhrFields:{withCredentials:!0},cache:!1})}})}}]);
//# sourceMappingURL=2628c2c6f5559479a3ca.js.map